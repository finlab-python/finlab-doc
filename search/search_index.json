{"config": {"lang": ["en"], "separator": "[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+", "pipeline": ["stemmer"], "fields": {"title": {"boost": 1000.0}, "text": {"boost": 1.0}, "tags": {"boost": 1000000.0}}}, "docs": [{"location": "", "title": "\u7ffb\u8f49\u53f0\u80a1\u91cf\u5316\u4ea4\u6613", "text": "<p>FinLab \u63d0\u4f9b\u4e00\u5957\u7c21\u6f54\u3001\u5be6\u7528\u7684\u91cf\u5316\u7814\u7a76\u8207\u56de\u6e2c\u5de5\u5177\uff0c\u8b93\u4f60\u7528\u6700\u5c11\u7684\u7a0b\u5f0f\u78bc\u5b8c\u6210\u8cc7\u6599\u4e0b\u8f09\u3001\u7b56\u7565\u64b0\u5beb\u3001\u56de\u6e2c\u5206\u6790\u8207\u81ea\u52d5\u5316\u90e8\u7f72\u3002</p>"}, {"location": "#_2", "title": "\u6211\u5011\u5728\u505a\u4ec0\u9ebc", "text": "<ul> <li>\u4e00\u884c\u53d6\u5f97\u53f0\u80a1\u8207\u8ca1\u5831\u8cc7\u6599\uff0c\u652f\u63f4\u591a\u5e02\u5834\u8207\u591a\u983b\u7387\u6574\u4f75\u3002</li> <li>\u4ee5 Pandas \u70ba\u6838\u5fc3\u7684\u7c21\u6f54 API\uff0c\u5e6b\u4f60\u81ea\u52d5\u5c0d\u9f4a\u4e0d\u540c\u983b\u7387\u8cc7\u6599\u3002</li> <li>\u56de\u6e2c\u8207\u5831\u8868\u958b\u7bb1\u5373\u7528\uff0c\u652f\u63f4\u505c\u640d\u505c\u5229\u3001\u8f2a\u52d5\u3001\u505a\u591a/\u505a\u7a7a\u8207\u591a\u7b56\u7565\u6574\u5408\u3002</li> <li>\u4ecb\u63a5\u5238\u5546 API\uff0c\u4e32\u63a5\u6295\u7d44\u8207\u6392\u7a0b\uff0c\u81ea\u52d5\u5316\u843d\u5730\u57f7\u884c\u3002</li> </ul>"}, {"location": "#_3", "title": "\u600e\u9ebc\u958b\u59cb", "text": "<ul> <li>\u5728\u96f2\u7aef\u4f7f\u7528\uff1a\u958b\u555f Google Colab\uff0c<code>!pip install finlab</code> \u5f8c\u7167\u8457\u6587\u4ef6\u64b0\u5beb\u7b56\u7565\u3002</li> <li>\u5728\u672c\u6a5f\u4f7f\u7528\uff1a<code>pip install finlab</code>\uff0c\u6216\u4f7f\u7528 Docker \u57f7\u884c\u6211\u5011\u7684 Jupyter \u6620\u50cf\u6a94\u3002</li> <li>\u60f3\u66f4\u7701\u4e8b\uff1a\u524d\u5f80\u7b56\u7565\u5e73\u53f0\u5efa\u7acb\u7b56\u7565\u4e26\u8a2d\u5b9a\u81ea\u52d5\u66f4\u65b0\u3002</li> <li>\u7528 AI \u5beb\u7a0b\u5f0f\uff1a\u5728 AI \u7de8\u7a0b\u52a9\u624b\uff08Claude Code\u3001Cursor \u7b49\uff09\u4e2d\u5b89\u88dd FinLab Skill\uff0c\u8b93 AI \u76f4\u63a5\u5e6b\u4f60\u64b0\u5beb\u7b56\u7565\u8207\u56de\u6e2c\u7a0b\u5f0f\u78bc\u3002</li> </ul>"}, {"location": "#_4", "title": "\u6211\u5011\u7684\u4fe1\u5ff5", "text": "<p>\u7528\u7c21\u55ae\u5305\u88dd\u8907\u96dc\u3002\u628a\u7e41\u7463\u7684\u8cc7\u6599\u5de5\u7a0b\u8207\u56de\u6e2c\u7d30\u7bc0\u85cf\u5728\u6613\u7528\u7684\u4ecb\u9762\u4e0b\uff0c\u8b93\u4f60\u5c08\u6ce8\u5728\u7b56\u7565\u672c\u8eab\u3002</p>"}, {"location": "#_5", "title": "\u5c55\u671b", "text": "<p>\u6301\u7e8c\u64f4\u5145\u8cc7\u6599\u3001\u56de\u6e2c\u3001\u8996\u89ba\u5316\u8207\u81ea\u52d5\u5316\u80fd\u529b\uff0c\u4e26\u7d50\u5408 AI \u8207\u591a\u5e02\u5834\u652f\u63f4\uff0c\u8b93\u91cf\u5316\u6295\u8cc7\u66f4\u89aa\u6c11\u3001\u66f4\u53ef\u9760\u3002</p>"}, {"location": "change-log/", "title": "\u66f4\u65b0\u65e5\u8a8c", "text": ""}, {"location": "change-log/#158-2026-02-04", "title": "1.5.8 (2026-02-04)", "text": ""}, {"location": "change-log/#performance", "title": "Performance", "text": "<ul> <li>\u6574\u9ad4\u7b56\u7565\u57f7\u884c\u901f\u5ea6\u63d0\u5347 3.4x\uff0812.9s \u2192 3.8s\uff0c\u542b\u8cc7\u6599\u8b80\u53d6\u3001\u8a0a\u865f\u8a08\u7b97\u3001\u56de\u6e2c\uff09</li> </ul> \u6b65\u9a5f \u512a\u5316\u524d \u512a\u5316\u5f8c \u52a0\u901f <code>data.get</code> (4 calls) 0.40s 0.00s \u221e <code>vol.average(20)</code> 0.69s 0.62s 1.1x <code>pb.rank()</code> 1.57s 1.04s 1.5x <code>rev.rank()</code> 1.49s 0.50s 3.0x <code>is_smallest(10)</code> 5.25s 0.40s 13.3x <code>sim()</code> 3.30s 1.08s 3.1x <ul> <li><code>dataframe</code>: <code>is_largest</code> / <code>is_smallest</code> \u6539\u7528 numpy <code>argsort(kind='stable')</code> \u53d6\u4ee3 pandas <code>apply(nlargest/nsmallest)</code>\uff0c\u4fdd\u7559\u6b04\u4f4d\u9806\u5e8f\u4e00\u81f4\u7684 tie-breaking\uff0813.3x\uff09</li> <li><code>dataframe</code>: <code>rank(axis=1)</code> \u6539\u7528 numpy <code>argsort</code> \u5feb\u901f\u8def\u5f91\uff0c\u4e26\u5728 <code>index_str_to_date()</code> \u5c55\u958b\u524d\u5148\u6392\u540d\uff0c\u907f\u514d\u5b63\u8cc7\u6599\uff0851 \u5217\uff09\u5c55\u958b\u70ba\u65e5\u8cc7\u6599\uff082110 \u5217\uff09\u5f8c\u624d\u6392\u540d\uff083.0x\uff09</li> <li><code>dataframe</code>: <code>reshape()</code> \u65b0\u589e\u5feb\u901f\u8def\u5f91\uff0c\u7576\u5169\u500b DataFrame \u7684 index/columns \u5df2\u76f8\u540c\u6642\u8df3\u904e reindex</li> <li><code>backtest</code>: <code>sim()</code> \u5167\u90e8\u4f7f\u7528 <code>prefer_local_if_exists</code> \u907f\u514d\u91cd\u8907\u6aa2\u67e5\u96f2\u7aef\u904e\u671f\u6642\u9593</li> <li><code>backtest</code>: position normalization \u6539\u7528 numpy \u9663\u5217\u904b\u7b97\u53d6\u4ee3 pandas <code>.div().fillna()</code></li> <li><code>backtest</code>: <code>upload</code> \u6539\u70ba daemon thread \u975e\u540c\u6b65\u57f7\u884c\uff0c\u4e0d\u963b\u585e\u56de\u6e2c\u7d50\u679c\u56de\u50b3</li> <li><code>backtest</code>: \u5feb\u53d6 <code>TWMarket._categories_cache</code> \u907f\u514d\u91cd\u8907\u547c\u53eb <code>data.get('security_categories')</code></li> <li><code>data</code>: \u65b0\u589e <code>_finalized_cache</code>\uff0c\u5feb\u53d6 <code>data.get()</code> \u8655\u7406\u5f8c\u7684\u7d50\u679c\uff0c\u91cd\u8907\u547c\u53eb\u6642\u8df3\u904e <code>process_data</code> \u8f49\u63db</li> <li><code>data</code>: \u5148\u6aa2\u67e5\u904e\u671f\u6642\u9593\u518d\u8b80\u53d6 DataFrame\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u78c1\u789f I/O</li> <li><code>data</code>: <code>FileStorage.get_dataframe()</code> \u5728\u8a18\u61b6\u9ad4\u5feb\u53d6\u547d\u4e2d\u6642\u8df3\u904e <code>os.path.getmtime</code> \u7cfb\u7d71\u547c\u53eb</li> </ul>"}, {"location": "change-log/#fix", "title": "Fix", "text": "<ul> <li><code>backtest</code>: \u4fee\u6b63 <code>touched_exit</code> \u8df3\u7a7a\u958b\u76e4\u89f8\u767c\u505c\u5229/\u505c\u640d\u6642\uff0c\u6301\u5009\u50f9\u503c\u88ab\u591a\u4e58 <code>cr_old</code> \u5c0e\u81f4 <code>creturn</code> \u504f\u9ad8\u7684 bug\u3002\u7576\u958b\u76e4\u50f9\u76f4\u63a5\u8d85\u904e\u505c\u5229\uff08\u6216\u505c\u640d\uff09\u50f9\u4f4d\u6642\uff0c<code>touch_open</code> \u8def\u5f91\u7684\u516c\u5f0f <code>pos *= open_r / r</code> \u8207 <code>touch_high</code>/<code>touch_low</code> \u4e0d\u4e00\u81f4\uff0c\u5df2\u4fee\u6b63\u70ba <code>pos = entry_pos * open_r</code></li> </ul>"}, {"location": "change-log/#157-2026-01-28", "title": "1.5.7 (2026-01-28)", "text": ""}, {"location": "change-log/#features", "title": "Features", "text": "<ul> <li><code>data</code>: \u6539\u9032 <code>data.search()</code> \u51fd\u6578\uff0c\u4f7f\u7528 Firestore API \u4e26\u7c21\u5316\u8f38\u51fa\u683c\u5f0f\u70ba list\uff0c\u56de\u50b3\u53ef\u76f4\u63a5\u7528\u65bc <code>data.get()</code> \u7684\u5b57\u4e32\u5217\u8868</li> <li><code>data</code>: \u652f\u63f4\u7f8e\u80a1\u8cc7\u6599\u641c\u5c0b (US catalog)</li> </ul>"}, {"location": "change-log/#refactor", "title": "Refactor", "text": "<ul> <li><code>data</code>: \u6539\u9032\u8cc7\u6599\u64f7\u53d6\u548c\u5132\u5b58\u6a21\u7d44\uff0c\u63d0\u53d6\u5171\u7528\u51fd\u6578\u4ee5\u63d0\u9ad8\u53ef\u8b80\u6027</li> </ul>"}, {"location": "change-log/#fix_1", "title": "Fix", "text": "<ul> <li><code>backtest</code>: \u4fee\u6b63 pandas 3.0 ArrowStringArray \u76f8\u5bb9\u6027\u554f\u984c\uff0c\u78ba\u4fdd DataFrame columns \u6b63\u78ba\u8f49\u63db\u70ba numpy array</li> <li><code>data</code>: \u7e2e\u5c0f <code>indicator()</code> \u7684\u4f8b\u5916\u8655\u7406\u7bc4\u570d\uff0c\u907f\u514d\u7121\u6548\u6307\u6a19\u540d\u7a31\u7522\u751f\u8aa4\u5c0e\u7684 TA-Lib \u5b89\u88dd\u8a0a\u606f</li> <li><code>data</code>: \u4fee\u6b63\u8cc7\u6599\u76ee\u9304\u4e2d\u7684\u91cd\u8907\u9805\u76ee</li> <li><code>tests</code>: \u4fee\u6b63 <code>calc_regression_stats</code> \u6e2c\u8a66\u7684\u96a8\u6a5f\u6027\u554f\u984c\uff0c\u6dfb\u52a0\u56fa\u5b9a\u7a2e\u5b50\u78ba\u4fdd\u6e2c\u8a66\u7a69\u5b9a</li> </ul>"}, {"location": "change-log/#chore", "title": "Chore", "text": "<ul> <li>\u505c\u6b62\u652f\u63f4 Python 3.8\uff0c\u6700\u4f4e\u9700\u6c42\u70ba Python 3.9</li> </ul>"}, {"location": "change-log/#154-2025-11-21", "title": "1.5.4 (2025-11-21)", "text": ""}, {"location": "change-log/#fix_2", "title": "Fix", "text": "<ul> <li><code>core</code>: \u4fee\u6b63 <code>Report</code> \u5728 <code>is_rebalance_due</code> \u6642\uff0c\u5728 resample \u70ba str \u6642\uff0c\u7522\u751f\u932f\u8aa4\u3002</li> <li><code>data</code>: \u4fee\u6b63 <code>FileStorage</code> \u5728 <code>get_time_expired</code> \u6642\u5728\u591a\u500b process \u5171\u4eab\u6642\uff0c\u6703\u51fa\u73fe\u8cc7\u6599\u672a\u81ea\u52d5\u66f4\u65b0\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#features_1", "title": "Features", "text": "<ul> <li><code>doc</code>: \u66f4\u7cbe\u7c21\u7684\u7bc4\u4f8b\u6587\u6a94</li> </ul>"}, {"location": "change-log/#154-2025-11-14", "title": "1.5.4 (2025-11-14)", "text": ""}, {"location": "change-log/#refactor_1", "title": "Refactor", "text": "<ul> <li><code>data.universe</code>: \u91cd\u69cb <code>universe</code> \u6a21\u7d44</li> </ul>"}, {"location": "change-log/#fix_3", "title": "Fix", "text": "<ul> <li><code>core</code>: \u4fee\u6b63 <code>Report</code> \u5728 <code>is_rebalance_due</code> \u6642\uff0c\u4e0d\u9593\u5bb9\u820a\u7248\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#153-2025-10-03", "title": "1.5.3 (2025-10-03)", "text": ""}, {"location": "change-log/#features_2", "title": "Features", "text": "<ul> <li><code>dataframe</code>: \u5be6\u4f5c\u622a\u65b7\u8996\u7a97\uff08truncation window\uff09\u529f\u80fd\uff0c\u4f9d\u64da <code>finlab.data</code> \u8a2d\u5b9a\u52a0\u901f\u8cc7\u6599\u64f7\u53d6</li> </ul>"}, {"location": "change-log/#refactor_2", "title": "Refactor", "text": "<ul> <li><code>data</code>: \u91cd\u7d44\u5132\u5b58\u67b6\u69cb\u8207\u6a21\u7d44\u62c6\u5206\uff08\u5f15\u5165 <code>storage.py</code>\u3001\u8abf\u6574 <code>__init__.py</code> \u8207 <code>universe.py</code>\uff09\uff0c\u6574\u5408\u622a\u65b7\u6d41\u7a0b</li> <li><code>portfolio</code>: \u7cbe\u7c21\u4ea4\u6613\u66f4\u65b0\u6d41\u7a0b\uff0c\u8cc7\u7522\u50f9\u503c\u8a08\u7b97\u7d0d\u5165\u5e02\u5834\u5225\u5831\u50f9\u4ee5\u63d0\u9ad8\u6e96\u78ba\u6027</li> </ul>"}, {"location": "change-log/#fix_4", "title": "Fix", "text": "<ul> <li><code>data.indicator</code>: \u66f4\u6b63 <code>adjust_price</code> \u578b\u5225\u9a57\u8b49\u70ba\u5e03\u6797\u503c\u4e26\u5f37\u5316\u932f\u8aa4\u8a0a\u606f</li> <li><code>label</code>: <code>excess_over_median/mean</code> \u6539\u7528 <code>subtract</code> \u63d0\u5347\u904b\u7b97\u4e00\u81f4\u6027\u8207\u53ef\u8b80\u6027</li> <li><code>backtest</code>: \u6539\u5584 <code>arguments</code> \u7684\u91cd\u63a1\u6a23\u908f\u8f2f\uff0c\u7d71\u4e00\u8655\u7406 <code>resample_dates</code> \u8207 <code>position</code> \u7d22\u5f15\u578b\u5225</li> </ul>"}, {"location": "change-log/#docs", "title": "Docs", "text": "<ul> <li><code>factor_analysis</code>: \u4fee\u6b63\u8b8a\u6578\u547d\u540d\u8207\u88dc\u5145\u66f4\u6e05\u6670\u7684\u7bc4\u4f8b\uff1b\u66f4\u65b0\u5c0e\u89bd\u8207\u6559\u5b78\u5167\u5bb9</li> <li><code>docs</code>: \u79fb\u9664\u4e0d\u5b58\u5728\u7684\u5c0e\u822a\u9805\u76ee\u4e26\u66f4\u65b0\u7bc4\u4f8b\u6587\u6a94\u8207 mkdocs \u8a2d\u5b9a</li> </ul>"}, {"location": "change-log/#150-2025-08-01", "title": "1.5.0 (2025-08-01)", "text": ""}, {"location": "change-log/#features_3", "title": "Features", "text": "<ul> <li><code>factor_analysis</code>: \u65b0\u589e\u56e0\u5b50\u8da8\u52e2\u5206\u6790\u529f\u80fd\uff0c\u4e26\u65b0\u589e\u8aaa\u660e\u7c21\u6613\u7bc4\u4f8b\u6587\u6a94</li> <li><code>plot</code>: \u65b0\u589e\u7d71\u4e00\u7684 plotly \u6a23\u5f0f\uff0c\u591a\u7a2e\u984f\u8272\u7bc4\u570d\u53ca\u6a19\u8a18\u529f\u80fd\uff0c\u5f37\u5316\u7dda\u5716\u7684\u53ef\u8996\u5316\u6548\u679c\uff0c\u4e26\u652f\u63f4\u81ea\u5b9a\u7fa9\u984f\u8272\u5340\u9593</li> <li><code>plot</code>: \u589e\u5f37 <code>plot_line</code> \u51fd\u5f0f\uff0c\u65b0\u589e\u9032\u968e\u81ea\u5b9a\u7fa9\u9078\u9805\u548c\u7d9c\u5408\u7bc4\u4f8b\uff0c\u65b0\u589e <code>plot_line_example</code> \u548c <code>plot_line_financial_example</code> \u51fd\u5f0f</li> <li><code>tests</code>: \u589e\u52a0\u5c07\u56de\u6e2c\u7d50\u679c\u5e8f\u5217\u5316\u70ba pickle \u683c\u5f0f\u7684\u529f\u80fd</li> </ul>"}, {"location": "change-log/#refactor_3", "title": "Refactor", "text": "<ul> <li><code>factor_analysis</code>: \u91cd\u69cb\u51fd\u5f0f\u540d\u7a31\u548c\u53c3\u6578\u4ee5\u63d0\u9ad8\u6e05\u6670\u5ea6\uff0c\u66f4\u65b0\u6587\u6a94\u4ee5\u53cd\u6620\u8b8a\u66f4</li> <li><code>docs</code>: \u66f4\u65b0\u8b8a\u66f4\u65e5\u8a8c\uff0c\u8abf\u6574\u6a21\u7d44\u7d50\u69cb\u53ca\u547d\u540d</li> </ul>"}, {"location": "change-log/#fix_5", "title": "Fix", "text": "<ul> <li><code>data</code>: \u65b0\u589e <code>use_local_data_only</code> \u548c <code>force_cloud_download</code> \u529f\u80fd\u9078\u9805</li> <li><code>feature</code>: \u512a\u5316\u5e02\u5834\u914d\u7f6e\u908f\u8f2f\uff0c\u78ba\u4fdd\u5728\u591a\u6838\u74b0\u5883\u4e0b\u6b63\u78ba\u6062\u5fa9\u539f\u59cb\u5e02\u5834\u8a2d\u7f6e</li> <li><code>liquidityAnalysis</code>: \u78ba\u4fdd\u4ea4\u6613\u50f9\u683c\u548c\u6210\u4ea4\u91cf\u7684\u5f62\u72c0\u4e00\u81f4\uff0c\u4e26\u5c07\u5176\u8f49\u63db\u70ba DataFrame \u683c\u5f0f</li> <li><code>backtest</code>: \u4fee\u6b63\u4f4d\u7f6e\u904e\u6ffe\u908f\u8f2f\uff0c\u78ba\u4fdd\u53ea\u4fdd\u7559\u6709\u6548\u7684\u5e02\u5834\u6578\u64da\u4e26\u8f49\u63db\u70ba\u6d6e\u9ede\u6578</li> <li><code>doc</code>: \u4fee\u6b63 plotly \u7121\u6cd5\u6e32\u67d3\u7684\u554f\u984c\uff08\u6539\u7528\u975c\u614b png\uff09</li> </ul>"}, {"location": "change-log/#docs_1", "title": "Docs", "text": "<ul> <li>\u65b0\u589e\u56e0\u5b50\u64c1\u64e0\u5ea6\u5206\u6790\u9801\u9762\u81f3\u5c0e\u822a</li> <li>\u65b0\u589e\u7c21\u6613\u6559\u5b78\u6587\u6a94\uff0c\u66f4\u65b0\u5be6\u7528\u7bc4\u4f8b\u6559\u5b78\uff0c\u8b93\u6559\u5b78\u66f4\u6e05\u695a</li> <li>\u4fee\u6539\u5be6\u7528\u7bc4\u4f8b\u6587\u6a94</li> <li>\u65b0\u589e KaTeX \u652f\u63f4\u7528\u65bc\u6578\u5b78\u6e32\u67d3\uff0c\u4e26\u79fb\u9664\u904e\u6642\u7684\u56e0\u5b50\u64c1\u64e0\u5ea6\u5206\u6790</li> <li>\u65b0\u589e\u5143\u5bcc\u8b49\u5238\u8a2d\u5b9a\u8aaa\u660e\u81f3\u4e0b\u55ae API \u6587\u6a94\uff0c\u4e26\u79fb\u9664\u904e\u6642\u7684 PE-PB \u5716\u8868\u5716\u7247</li> <li>\u4fee\u6b63\u4e0b\u55ae API \u6587\u6a94\u4e2d\u5c0d\u5143\u5bcc\u8b49\u5238\u7684\u5f15\u7528</li> </ul>"}, {"location": "change-log/#140-2024-05-29", "title": "1.4.0 (2024-05-29)", "text": ""}, {"location": "change-log/#features_4", "title": "Features", "text": "<ul> <li><code>portfolio</code>: \u65b0\u589e <code>get_total_position</code> \u65b9\u6cd5\uff0c\u4ee5 DataFrame \u683c\u5f0f\u56de\u50b3\u7576\u524d\u6301\u80a1</li> <li><code>pyproject</code>: \u70ba\u958b\u767c\u7fa4\u7d44\u65b0\u589e <code>shioaji</code> \u652f\u63f4</li> </ul>"}, {"location": "change-log/#refactor_4", "title": "Refactor", "text": "<ul> <li><code>backtest</code>: \u5c07 <code>Exception</code> \u66ff\u63db\u70ba <code>ValueError</code> \u548c <code>TypeError</code> \u4ee5\u9032\u884c\u66f4\u597d\u7684\u932f\u8aa4\u8655\u7406</li> <li><code>market</code>: \u5c07 <code>Market</code> \u985e\u5225\u8f49\u63db\u70ba\u62bd\u8c61\u57fa\u790e\u985e\u5225\u4e26\u66f4\u65b0 <code>tw</code> \u5e02\u5834</li> </ul>"}, {"location": "change-log/#fix_6", "title": "Fix", "text": "<ul> <li><code>qlib</code>: \u6539\u5584\u7f3a\u5c11 <code>finlab[qlib]</code> \u6a21\u7d44\u7684\u932f\u8aa4\u8655\u7406\uff0c\u63d0\u4f9b\u66f4\u8a73\u7d30\u7684\u8a0a\u606f</li> <li><code>data</code>: \u65b0\u589e <code>use_local_data_only</code> \u548c <code>force_cloud_download</code> \u529f\u80fd</li> <li><code>data</code>: \u66f4\u65b0 <code>get</code> \u51fd\u5f0f\u7684\u56de\u50b3\u985e\u578b\u70ba <code>FinlabDataFrame</code></li> <li><code>data</code>: \u5728 <code>__all__</code> \u4e2d\u5305\u542b\u984d\u5916\u7684\u532f\u51fa</li> <li><code>pytorch_nn</code>: \u79fb\u9664\u640d\u58de\u7684 import \u4e26\u65b0\u589e <code>ICLoss</code> \u7528\u65bc\u8a08\u7b97\u8cc7\u8a0a\u4fc2\u6578\u640d\u5931</li> <li><code>portfolio</code>: \u512a\u5316\u79fb\u9664\u90e8\u4f4d\u7684\u908f\u8f2f\u4e26\u52a0\u5f37\u66f4\u65b0\u689d\u4ef6</li> <li><code>docker</code>: \u5c07 <code>finlab</code> \u7248\u672c\u9396\u5b9a\u5728 1.4.0</li> </ul>"}, {"location": "change-log/#130-2024-05-24", "title": "1.3.0 (2024-05-24)", "text": ""}, {"location": "change-log/#features_5", "title": "Features", "text": "<ul> <li><code>online</code>: \u65b0\u589e\u53e3\u888b\u8b49\u5238 (pocket account) \u76f8\u95dc\u529f\u80fd</li> <li><code>fubon</code>: \u65b0\u589e\u5143\u5bcc\u8b49\u5238\u7684\u4e0b\u55ae\u7cfb\u7d71</li> <li><code>data</code>: \u65b0\u589e\u8ca1\u52d9\u6578\u64da\u6307\u6a19\u7684 entry names</li> <li><code>dataframe</code>: <code>rank</code> \u65b9\u6cd5\u65b0\u589e\u672a\u4f86\u8cc7\u6599\u7aba\u770b\u8b66\u544a</li> <li><code>setup</code>: \u65b0\u589e Python 3.7 \u548c 3.8 \u7684 classifiers</li> <li><code>requirements</code>: \u65b0\u589e <code>Jinja2</code> \u8207 <code>ipython</code> \u5957\u4ef6</li> <li><code>test</code>: \u65b0\u589e <code>pytest</code> \u7684\u958b\u767c\u4f9d\u8cf4\u8207 <code>slow</code> \u6a19\u8a18</li> <li>\u66f4\u65b0\u4f7f\u7528 uv \u4f86\u7ba1\u7406\u4f9d\u8cf4</li> </ul>"}, {"location": "change-log/#refactor_5", "title": "Refactor", "text": "<ul> <li><code>alphalens</code>: \u79fb\u9664 <code>alphalens</code> \u6a21\u7d44\u8207\u76f8\u95dc\u529f\u80fd</li> <li><code>portfolio</code>: \u512a\u5316 <code>PortfolioSyncManager</code> \u4e2d\u79fb\u9664\u90e8\u4f4d\u7684\u65e5\u8a8c\u7d00\u9304</li> <li><code>backtest</code>: \u8a3b\u89e3\u6389\u8a2d\u5b9a\u5168\u57df\u56de\u6e2c\u5831\u544a\u7684\u672a\u4f7f\u7528\u7a0b\u5f0f\u78bc</li> <li><code>plot</code>: \u5f9e <code>plot_test.py</code> \u79fb\u9664\u904e\u6642\u7684\u7e6a\u5716\u6e2c\u8a66</li> <li><code>ml</code>: \u6539\u5584 <code>combine</code> \u51fd\u5f0f\u4e2d\u7684\u5de5\u5ee0\u521d\u59cb\u5316\u548c\u578b\u5225\u63d0\u793a</li> </ul>"}, {"location": "change-log/#fix_7", "title": "Fix", "text": "<ul> <li><code>setup</code>: \u555f\u7528 <code>find_namespace_packages</code> \u652f\u63f4\u4e26\u6539\u5584\u8def\u5f91\u8655\u7406</li> <li><code>liquidityAnalysis</code>: \u4fee\u6b63\u8655\u7f6e\u80a1\u7968\u7684\u5224\u65b7\u908f\u8f2f\u8207\u6f32\u8dcc\u5e45\u8a55\u4f30\u7684\u65e5\u671f\u57fa\u6e96</li> <li><code>docker</code>: \u66f4\u65b0 <code>pandas</code> \u8207 <code>ta-lib</code> \u7248\u672c</li> <li><code>backtest</code>: \u66f4\u65b0\u56de\u6e2c\u4e0a\u50b3\u8a0a\u606f</li> <li><code>ml</code>: \u4fee\u6b63 <code>combine</code> \u51fd\u5f0f\u4e2d\u7684\u8b8a\u6578\u5f15\u7528</li> <li><code>analysis</code>: \u4fee\u6b63 <code>drawdown</code> \u7684\u7d50\u675f\u65e5\u671f</li> <li><code>parallel</code>: \u4fee\u6b63 <code>ParallelExt</code> \u4ee5\u652f\u63f4\u8f03\u65b0\u7248\u672c\u7684 <code>joblib</code></li> <li><code>pyproject</code>: \u6307\u5b9a <code>Cython</code> \u7248\u672c\u4ee5\u78ba\u4fdd\u76f8\u5bb9\u6027</li> </ul>"}, {"location": "change-log/#docs_2", "title": "Docs", "text": "<ul> <li><code>docs</code>: \u91cd\u65b0\u547d\u540d <code>getting-start.md</code> \u4e26\u66f4\u65b0 <code>mkdocs.yml</code></li> <li><code>order_api</code>: \u66f4\u65b0\u6191\u8b49\u53d6\u5f97\u8207\u5957\u4ef6\u5b89\u88dd\u8aaa\u660e</li> </ul>"}, {"location": "change-log/#type-safety", "title": "Type Safety", "text": "<ul> <li><code>core</code>: \u70ba <code>FinlabDataFrame</code> \u548c <code>backtest</code> \u6a21\u7d44\u65b0\u589e\u578b\u5225\u63d0\u793a</li> </ul>"}, {"location": "change-log/#1227-2025-05-15", "title": "1.2.27 (2025-05-15)", "text": ""}, {"location": "change-log/#features_6", "title": "Features", "text": "<ul> <li>\u65b0\u589e\u5143\u5bcc\u8b49\u5238\u7684\u4e0b\u55ae\u7cfb\u7d71</li> <li><code>finlab.ml.feature.combine</code> \u652f\u63f4 dictionary of function \u4f86\u7522\u751f\u7279\u5fb5</li> <li><code>finlab.dataframe.FinlabDataFrame</code> \u91cd\u69cb <code>rank</code> \u65b9\u6cd5\uff0c\u81ea\u52d5\u8655\u7406\u8ca1\u5831\u6a6b\u5411\u6bd4\u8f03\uff0c\u907f\u514d look ahead \u7684\u53ef\u80fd\u3002</li> <li><code>finlab.dataframe.FinlabDataFrame</code> \u91cd\u69cb <code>rank</code> \u65b9\u6cd5\uff0c\u8b66\u544a\u4f7f\u7528\u8005\u4f7f\u7528\u4e86 look ahead \u7684\u53ef\u80fd\u3002</li> </ul>"}, {"location": "change-log/#fix_8", "title": "Fix", "text": "<ul> <li>qlib \u6a21\u578b\u5f15\u7528\u4fee\u6b63</li> </ul>"}, {"location": "change-log/#1224-2025-05-02", "title": "1.2.24 (2025-05-02)", "text": ""}, {"location": "change-log/#features_7", "title": "Features", "text": "<ul> <li>\u5c07\u6574\u500b qlib \u7684\u529f\u80fd\u6574\u5408\u5230 finlab.ml \u4e2d\uff0c\u53ea\u9700\u8981\u5b89\u88dd finlab \u5c31\u53ef\u4ee5\u4f7f\u7528 qlib \u7684\u529f\u80fd(pip install finlab[qlib])</li> </ul>"}, {"location": "change-log/#refactor_6", "title": "Refactor", "text": "<ul> <li><code>report</code> \u652f\u63f4 <code>report.to_html(path)</code> \u5c07\u5831\u544a\u8f49\u63db\u6210 HTML \u6a94\u6848</li> <li><code>report</code> \u652f\u63f4 <code>report._repr_html_()</code> \u76f4\u63a5\u5728 Jupyter Notebook \u4e2d\u986f\u793a\u5831\u544a</li> <li>\u5c07 <code>dashboard</code> \u79fb\u51fa <code>report</code> \u6a21\u7d44\uff0c\u7368\u7acb\u6210\u70ba <code>finlab.core.dashboard</code> \u6a21\u7d44</li> </ul>"}, {"location": "change-log/#fix_9", "title": "Fix", "text": "<ul> <li>\u4fee\u5fa9 <code>report.trades</code> \u4e2d\u95dc\u65bc\u8b66\u793a\u80a1\u3001\u8655\u7f6e\u80a1\u3001\u5168\u984d\u4ea4\u5272\u80a1\u5c11\u90e8\u5206\u7684\u8cc7\u6599\u932f\u8aa4</li> <li>\u4fee\u5fa9 <code>report.weights.name</code> \u4ee5\u53ca <code>report.next_weights.name</code> \u53ef\u80fd\u70ba None \u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#1223-2025-03-25", "title": "1.2.23 (2025-03-25)", "text": ""}, {"location": "change-log/#fix_10", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 <code>report.upload</code> \u5728 resample=pd.DatetimeIndex \u6703\u5831\u932f\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#1222-2025-03-25", "title": "1.2.22 (2025-03-25)", "text": ""}, {"location": "change-log/#features_8", "title": "Features", "text": "<ul> <li><code>PositionScheduler</code> \u652f\u63f4\u591a\u7b56\u7565\u8207\u91cd\u65b0\u5e73\u8861\u908f\u8f2f</li> <li><code>backtest.sim</code> \u65b0\u589e <code>resample=None</code> \u6642\u81ea\u52d5\u8a08\u7b97\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5</li> </ul>"}, {"location": "change-log/#fixes", "title": "Fixes", "text": "<ul> <li>\u66f4\u65b0 macOS \u69cb\u5efa\u67b6\u69cb\u8a2d\u5b9a\uff0c\u50c5\u4fdd\u7559 <code>universal2</code></li> <li>\u4fee\u6b63 <code>resample</code> \u53c3\u6578\u7684\u908f\u8f2f\uff0c\u5141\u8a31\u76f4\u63a5\u4f7f\u7528</li> <li>\u8abf\u6574 <code>PositionScheduler.from_report</code> \u65b9\u6cd5\u4ee5\u7b26\u5408\u65b0\u7684 <code>resample</code> \u908f\u8f2f</li> <li>\u66f4\u65b0\u4e26\u4fee\u6b63\u76f8\u95dc\u7684\u55ae\u5143\u6e2c\u8a66</li> </ul>"}, {"location": "change-log/#1221-2025-03-12", "title": "1.2.21 (2025-03-12)", "text": ""}, {"location": "change-log/#features_9", "title": "Features", "text": "<ul> <li><code>report.is_stop_triggered()</code> \u76e3\u6e2c\u662f\u5426\u6709\u505c\u640d\u505c\u5229\u89f8\u767c</li> <li><code>report.is_rebalance_due()</code> \u76e3\u6e2c\u662f\u5426\u6709\u518d\u5e73\u8861\u89f8\u767c</li> <li><code>report.to_pickle('PATH')</code> \u5c07\u5831\u544a\u5b58\u6210 pickle \u6a94\u6848</li> <li><code>report.from_pickle('PATH')</code> \u5f9e pickle \u6a94\u6848\u8b80\u53d6\u5831\u544a</li> <li><code>backtest.sim</code> \u56de\u6e2c\u901f\u5ea6\u512a\u5316</li> </ul>"}, {"location": "change-log/#fixes_1", "title": "Fixes", "text": "<ul> <li><code>PortfolioSyncManager</code> \u8003\u616e weight = 0 \u7684\u60c5\u6cc1</li> <li><code>data.get</code> \u5728\u4e0b\u8f09\u7570\u5e38\u6642\uff0c\u6703\u81ea\u52d5\u91cd\u8a66</li> <li><code>backtest.sim</code> \u91dd\u5c0d\u80a1\u7968\u4ee3\u865f\u7570\u5e38\u6642\uff0c\u6703\u81ea\u52d5\u8df3\u904e</li> <li><code>backtest.sim</code> \u4fee\u6b63\u505a\u7a7a\u7684\u5831\u916c\u7387\u986f\u793a\u932f\u8aa4</li> </ul>"}, {"location": "change-log/#1220-2024-12-09", "title": "1.2.20 (2024-12-09)", "text": ""}, {"location": "change-log/#refactor_7", "title": "Refactor", "text": "<ul> <li><code>MarketInfo</code> \u73fe\u5728\u79fb\u52d5\u81f3 <code>finlab.market</code> \u6a21\u7d44\u4e4b\u4e2d</li> <li><code>TWMarketInfo</code> \u73fe\u5728\u79fb\u52d5\u81f3 <code>finlab.markets.tw</code> \u6a21\u7d44\u4e4b\u4e2d\uff0c\u4e26\u4e14\u6539\u540d\u70ba <code>TWMarket</code></li> <li>fix(market_info): rename loop variable for clarity in shared memory creation</li> <li>\u4f7f\u7528 <code>finlab.config.set_market</code> \u4f86\u8a2d\u5b9a\u5168\u57df\u5e02\u5834\u8cc7\u8a0a</li> <li>\u53d6\u6d88 <code>ml.get_market</code> \u4ee5\u53ca <code>ml.set_market</code>\uff0c\u4f7f\u7528 <code>finlab.config.set_market</code> \u4ee3\u66ff</li> <li>\u53d6\u6d88 <code>data.indicator(...market)</code> \u8207 <code>finlab.config.set_market</code> \u5408\u4f75</li> <li>\u53d6\u6d88 <code>df.hold_until(...market)</code> \u8207 <code>finlab.config.set_market</code> \u5408\u4f75</li> </ul>"}, {"location": "change-log/#1217-2024-10-19", "title": "1.2.17 (2024-10-19)", "text": ""}, {"location": "change-log/#features_10", "title": "Features", "text": "<ul> <li><code>report.weight.name</code> \u7684\u540d\u7a31\u6539\u6210\u56de\u6e2c\u6700\u5f8c\u4e00\u5929\u7684\u65e5\u671f\uff0c\u65b9\u4fbf\u67e5\u770b\uff0c</li> <li><code>report.next_weight.name</code> \u7684\u540d\u7a31\u6539\u6210\u63db\u80a1\u65e5\u671f\uff0c\u65b9\u4fbf\u67e5\u770b\uff0c</li> <li><code>\u652f\u63f4 numpy&gt;=2.0</code> \u7136\u800c <code>talib</code> \u9084\u6c92\u652f\u63f4\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528 talib \u7684\u8a71\u9700\u8981\u518d\u7b49\u7b49\u3002</li> <li><code>Position</code> \u652f\u63f4 <code>weight</code> (optional) \u7684\u5132\u5b58\u8207\u8a08\u7b97\uff0c\u65b9\u4fbf\u5feb\u901f\u6bd4\u8f03\u5f35\u6578\u8207\u6b0a\u91cd\u3002</li> <li><code>FugleAccount</code> \u6539\u6210\u4f7f\u7528 websocket \u9032\u884c\u8a02\u55ae\u7684\u9023\u7dda\u8207\u66f4\u65b0</li> <li><code>OrderExecutor</code> \u65b0\u589e progress \u53ef\u4ee5\u91dd\u5c0d\u300c\u7576\u524d\u90e8\u4f4d\u300d\u8207\u300c\u76ee\u6a19\u90e8\u4f4d\u300d\u9032\u884c\u5167\u5dee\uff0c\u65b9\u4fbf\u8f49\u5009\u5e73\u6ed1\u904e\u5ea6</li> </ul>"}, {"location": "change-log/#fixes_2", "title": "Fixes", "text": "<ul> <li><code>finlab.online.sinopac</code> \u8655\u7406\u7576\u80a1\u7968\u7576\u5929\u7121\u4ea4\u6613\u6642\uff0c\u907f\u514d\u76f4\u63a5\u5831\u932f</li> </ul>"}, {"location": "change-log/#1216-2024-10-02", "title": "1.2.16 (2024-10-02)", "text": ""}, {"location": "change-log/#fixed", "title": "Fixed", "text": "<ul> <li><code>data.get</code> \u6e1b\u5c11\u975e\u5fc5\u8981\u7684\u9023\u7dda\u6b21\u6578</li> <li><code>cli</code> \u4fee\u6b63 webview \u975e\u5fc5\u8981 import \u7684\u932f\u8aa4</li> <li><code>finlab.online.sinopac</code> \u4fee\u6b63 <code>get_trades</code> \u5728\u8a08\u7b97\u6642\u9593\u6642\uff0c\u6703\u5c07\u6642\u9593\u8f49\u63db\u6210 UTC \u6642\u9593</li> <li><code>finlab.portfolio</code> \u4fee\u6b63 <code>PortfolioSyncManager</code> \u5728 <code>to_cloud</code> \u6216 <code>to_json</code> \u6642\uff0c\u53ef\u80fd\u6703\u7522\u751f\u4e0d\u76f8\u5bb9\u7684\u683c\u5f0f</li> </ul>"}, {"location": "change-log/#1215-2024-09-08", "title": "1.2.15 (2024-09-08)", "text": ""}, {"location": "change-log/#fixed_1", "title": "Fixed", "text": "<ul> <li><code>position.from_report</code> \u4fee\u6b63 <code>weight.index</code> \u70ba\u975e str \u7684\u554f\u984c</li> <li><code>finlab.portfolio</code> \u4fee\u6b63\u6301\u6709\u7121\u6cd5\u4ea4\u6613\u80a1\u7968\u6642\uff0c\u6703\u5831\u932f\u7684\u554f\u984c</li> <li><code>finlab.online</code> \u4fee\u6b63\u6b32\u7121\u6cd5\u4ea4\u6613\u80a1\u7968\u6642\uff0c\u6703\u5831\u932f\u7684\u554f\u984c\uff08\u6539\u6210\u8df3\u51fa\u8b66\u793a\uff09</li> <li><code>finlab.data</code> \u4fee\u6b63 <code>data.search</code> \u6642\u641c\u7d22\u6578\u64da\u70ba\u7a7a\u7684\u554f\u984c</li> <li><code>finlab.portfolio</code> \u4fee\u6b63\u505c\u640d\u505c\u5229\u6642\uff0c\u5728\u67d0\u4e9b\u6642\u523b\u4e0b\u6703\u8df3\u904e\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#1212-2024-8-27", "title": "1.2.12 (2024-8-27)", "text": ""}, {"location": "change-log/#features_11", "title": "Features", "text": "<ul> <li>dashboard: \u65b0\u589e\u5100\u8868\u677f\u4e2d\u7684\u300c\u8207\u5927\u76e4\u76f8\u95dc\u6027\u300d\uff0c\u4e26\u4e14\u80fd\u5920\u9078\u64c7\u6642\u9593\u5340\u9593</li> <li>portfolio: \u65b0\u589e <code>PortfolioSyncManager</code> \u7684 <code>get_position(at='open')</code> \u7684\u529f\u80fd\uff0c\u7528\u65bc\u898f\u5283\u7576\u65e5\u958b\u76e4\u7684\u90e8\u4f4d</li> <li>online.position: \u512a\u5316\u986f\u793a\u90e8\u4f4d\u7684\u529f\u80fd</li> <li>online.position: \u589e\u52a0\u4ee5 for loop \u63d0\u53d6\u90e8\u4f4d\u8cc7\u8a0a\u7684\u529f\u80fd</li> <li>tool.factor_analysis: \u589e\u52a0\u56e0\u5b50\u5206\u6790\u529f\u80fd\uff0c\u9664\u4e86 IC \u4ee5\u5916\uff0c\u652f\u63f4 <code>get_metric</code> \u4f86\u904b\u7b97\u56e0\u5b50\u7684\u5404\u7a2e\u6307\u6a19</li> <li>portfolio: \u65b0\u589e <code>PortfolioSyncManager</code> \u81ea\u52d5\u5224\u65b7 <code>smooth_transition</code> \u7684\u6642\u6a5f\uff0c\u5728\u521d\u59cb\u5316\u6642\u4e0d\u9700\u5e73\u6ed1\u904e\u5ea6\uff0c\u65bc\u4e4b\u5f8c\u90fd\u4f7f\u7528\u5e73\u6ed1\u904e\u5ea6</li> <li>doc: \u512a\u5316 <code>portfolio</code> \u4e0b\u55ae\u7684\u6559\u5b78\u6587\u4ef6</li> <li>sinopac: \u6c38\u8c50\u8b49\u5238\u652f\u63f4 <code>get_trades</code> \u529f\u80fd\u7528\u65bc\u6bd4\u5c0d\u5e33\u6236\u4ea4\u6613\u7d00\u9304</li> </ul>"}, {"location": "change-log/#fixed_2", "title": "Fixed", "text": "<ul> <li>data: \u4fee\u6b63 <code>data.get</code> \u6703\u65bc\u5c11\u6578\u4f5c\u696d\u7cfb\u7d71\u7522\u751f circular import \u7684\u554f\u984c</li> <li>cli: \u4fee\u6b63 <code>finlab nb</code> \u6307\u4ee4\u6703\u7522\u751f <code>import webview</code> \u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#1211-2024-8-19", "title": "1.2.11 (2024-8-19)", "text": ""}, {"location": "change-log/#fixed_3", "title": "Fixed", "text": "<ul> <li>backtest: \u4fee\u6b63\u505c\u640d\u505c\u5229\u6642\uff0c\u5728\u5c11\u6578\u60c5\u6cc1\u6703\u7528\u5230\u672a\u4f86\u8cc7\u6599\u7684\u554f\u984c</li> <li>test: \u6e2c\u8a66\u56de\u6e2c\u7cfb\u7d71\u6642\uff0c\u4f7f\u7528\u6b77\u53f2\u8cc7\u6599</li> <li>report: \u4fee\u6b63\u56de\u6e2c\u5831\u544a\u4e2d\u7684\u7522\u696d\u5225\u986f\u793a\u932f\u8aa4</li> <li>online: \u4fee\u6b63\u4e0b\u55ae\u6642\uff0c\u986f\u793a\u904e\u591a\u5c0f\u6578\u9ede\u7684\u554f\u984c</li> <li>schedule: \u4fee\u6b63\u57f7\u884c\u7b56\u7565\u6642\uff0c\u4f7f\u7528\u5230\u932f\u8aa4 Token \u7684\u554f\u984c</li> <li>portfolio.cloud_report: \u4fee\u6b63\u652f\u63f4 int \u578b\u614b\u7684 return \uff08\u5728\u5c11\u6578\u60c5\u6cc1\u4e0b\u6703\u7528\u5230\uff09</li> <li>backtest: \u56de\u6e2c in-sample \u6642\uff0c\u5c07 out-sample \u7684\u8cc7\u6599\u96b1\u85cf</li> <li>data: \u7576\u4e0b\u8f09\u8d85\u904e 5 \u5206\u9418\u6642\uff0c\u6703\u81ea\u52d5\u7d42\u6b62\u4e26\u4e14\u986f\u793a\u932f\u8aa4\u8a0a\u606f</li> </ul>"}, {"location": "change-log/#129-2024-8-3", "title": "1.2.9 (2024-8-3)", "text": ""}, {"location": "change-log/#feature", "title": "Feature", "text": "<ul> <li>\u65b0\u589e <code>finlab.portfolio</code> \u7684 <code>PortfolioSyncManager.update</code> \u4f7f\u7528 <code>custom_position</code> \u4f86\u8a2d\u5b9a\u80a1\u7968\u5f35\u6578</li> <li>\u65b0\u589e <code>finlab.portfolio</code> \u7684 <code>PortfolioSyncManager.update</code> \u4f7f\u7528 <code>excluded_stock_ids</code> \u4f86\u8a2d\u5b9a\u5ffd\u7565\u7684\u80a1\u7968</li> </ul>"}, {"location": "change-log/#128-2024-8-1", "title": "1.2.8 (2024-8-1)", "text": ""}, {"location": "change-log/#fix_11", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63\u5728\u67d0\u4e9b\u72c0\u6cc1\u4e0b\uff0c\u56de\u6e2c\u5831\u932f\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#127-2024-8-1", "title": "1.2.7 (2024-8-1)", "text": ""}, {"location": "change-log/#fix_12", "title": "Fix", "text": "<ul> <li>\u80a1\u7968\u7d50\u7b97\u65bc\u975e\u6536\u76e4\u50f9\uff0c\u5c0e\u81f4\u7684\u5831\u916c\u7387\u8a08\u7b97\u932f\u8aa4</li> <li>\u4fee\u6b63 <code>finlab.portfolio</code> \u4e2d <code>PortfolioSyncManager</code> \u5728 <code>update</code> \u6642\uff0c\u7522\u751f\u975e\u5fc5\u8981\u6027 <code>warning</code></li> </ul>"}, {"location": "change-log/#125-2024-7-29", "title": "1.2.5 (2024-7-29)", "text": ""}, {"location": "change-log/#feature_1", "title": "Feature", "text": "<ul> <li>\u65b0\u589e\u80a1\u7968\u5100\u8868\u677f\u4e2d\uff0c\u96b1\u85cf\u80a1\u7968\u540d\u7a31\u7684\u529f\u80fd</li> </ul>"}, {"location": "change-log/#fix_13", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63\u80a1\u7968\u5100\u8868\u677f\u4e2d <code>open_close_avg</code> \u70ba\u300c\u5e73\u5747\u50f9\u300d</li> <li>\u4fee\u6b63\u5831\u916c\u7387\u7684\u8a08\u7b97\u65b9\u5f0f\uff0c\u4e0d\u540c\u671f\u4e4b\u9593\u4e0d\u9700\u8981\u8a08\u7b97\u4ea4\u6613\u624b\u7e8c\u8cbb</li> <li>\u4fee\u6b63\u5100\u8868\u677f\u4e2d <code>NaN</code> \u7684\u72c0\u6cc1</li> </ul>"}, {"location": "change-log/#124-2024-7-28", "title": "1.2.4 (2024-7-28)", "text": ""}, {"location": "change-log/#feature_2", "title": "Feature", "text": "<ul> <li>\u65b0\u589e <code>finlab.portfolio</code> \u7684 <code>PortfolioSyncManager</code> \u4f7f\u7528 <code>to_file</code> \u548c <code>from_file</code> \u4f86\u8b80\u53d6\u8cc7\u6599</li> </ul>"}, {"location": "change-log/#fix_14", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 <code>finlab.portfolio</code> \u4f7f\u7528 <code>PortfolioSyncManager</code> \u8655\u7406\u96f6\u80a1\u5831\u932f\u554f\u984c</li> <li>\u4fee\u6b63 <code>finlab.portfolio</code> \u4f7f\u7528 <code>PortfolioSyncManager</code> \u96f6\u80a1\u986f\u793a\u5c0f\u6578\u9ede\u7b2c\u56db\u4f4d</li> </ul>"}, {"location": "change-log/#122-2024-7-27", "title": "1.2.2 (2024-7-27)", "text": ""}, {"location": "change-log/#fix_15", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 <code>finlab.cli</code> \u5047\u5982\u5c1a\u672a\u521d\u59cb\u5316 nb \u6307\u4ee4\u6703\u5831\u932f\u7684\u554f\u984c</li> <li>\u4fee\u6b63 <code>finlab.portfolio</code> \u96f2\u7aef\u4e0b\u8f09\u7b56\u7565\uff0c\u627e\u4e0d\u5230\u7b56\u7565 raise Error \u63d0\u4f9b\u66f4\u8a73\u7d30\u7684\u932f\u8aa4\u8a0a\u606f</li> <li>\u4fee\u6b63 <code>finlab.portfolio</code> \u91dd\u5c0d live_trading_performance \u70ba None \u5831\u932f\u7684\u554f\u984c</li> <li>\u4fee\u6b63 <code>finlab.portfolio</code> create_mutli_asset_report \u8def\u5f91\u8207\u56de\u50b3\u6578\u503c\u7684\u554f\u984c</li> <li>\u4fee\u6b63 <code>finlab.portfolio</code> syn manager \u5728\u505c\u640d\u505c\u5229\u6642\u7684\u5831\u932f\u554f\u984c</li> <li>\u4fee\u6b63 <code>finlab.backtest</code> \u5c07 resample=None \u7684\u6642\u5019\uff0c\u5831\u916c\u7387\u8a08\u7b97\u65b9\u5f0f\u70ba\u6301\u6709\u671f\u9593\u5831\u916c\u7387</li> <li>\u4fee\u6b63 <code>finlab.backtest</code> \u5728\u76e4\u4e2d\u6a21\u64ec\u6642\uff0c\u8a08\u7b97\u6536\u76e4\u7d50\u7b97\u5f15\u5165NaN\u9020\u6210\u7684\u554f\u984c</li> <li>\u4fee\u6b63 <code>finlab.report</code> \u91dd\u5c0d\u6bcf\u671f\u5831\u916c\u7387\u5206\u958b\u6642\uff0c\u986f\u793a\u51fa\u5834\u539f\u56e0\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#120-2024-7-27", "title": "1.2.0 (2024-7-27)", "text": ""}, {"location": "change-log/#features_12", "title": "Features", "text": "<ul> <li>\u65b0\u589e <code>finlab.backtest</code> \u7684\u76e4\u4e2d\u5100\u8868\u677f\u548c\u7d2f\u8a08\u5831\u916c\u5100\u8868\u677f</li> <li>\u65b0\u589e <code>finlab.backtest</code> \u6a21\u64ec\u6642\uff0c\u4e0d\u8ad6 <code>trade_at_price</code> \u70ba\u4f55\uff0c\u6240\u6709\u7d50\u7b97\u5747\u65bc\u76e4\u5f8c\u9032\u884c\u7d50\u7b97</li> <li>\u65b0\u589e <code>finlab.backtest</code> \u8003\u616e\u958b\u76e4\u8cb7\u8ce3\uff0c\u6536\u76e4\u50f9\u6c7a\u5b9a\u505c\u640d\u505c\u5229</li> <li>\u65b0\u589e <code>finlab.report</code> \u5c07 <code>report.trades</code> \u65b0\u589e\u7522\u696d\u5225</li> <li>\u65b0\u589e <code>finlab.portfolio</code> \u6a21\u7d44\uff0c\u7528\u65bc\u5c07\u7b56\u7565\u7528\u65bc\u5be6\u969b\u6295\u8cc7\u7d44\u5408</li> <li>\u65b0\u589e <code>finlab.portfolio</code> \u6587\u4ef6\u6559\u5b78\uff0c\u7528\u65bc\u6559\u5b78\u5982\u4f55\u5c07\u7b56\u7565\u7528\u65bc\u5be6\u969b\u6295\u8cc7\u7d44\u5408</li> <li>\u65b0\u589e <code>finlab.cli</code> \u6a21\u7d44\uff0c\u7528\u65bc\u547d\u4ee4\u884c\u64cd\u4f5c\u8207\u4e0b\u55ae</li> <li>\u65b0\u589e <code>finlab.cli</code> \u6587\u4ef6\u6559\u5b78\uff0c\u7528\u65bc\u6559\u5b78\u5982\u4f55\u4f7f\u7528\u547d\u4ee4\u884c\u64cd\u4f5c\u8207\u4e0b\u55ae</li> <li>\u65b0\u589e doc \u4ecb\u7d39\u5229\u7528 regex \u4f86\u9078\u53d6\u7522\u696d\u5225</li> <li>\u65b0\u589e <code>finlab.online</code> \u529f\u80fd\uff0c\u8b93 <code>Fugle API</code> \u53ef\u4ee5\u81ea\u52d5\u767b\u5165\u4e0d\u9700\u4eba\u5de5\u8f38\u5165\u5bc6\u78bc</li> </ul>"}, {"location": "change-log/#fix_16", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 <code>finlab.sinopac</code> \u4e2d\u7684\u5e33\u6236\u9918\u984d\u8a08\u7b97\u65bc\u661f\u671f\u5929\u51cc\u6668\u63d0\u65e9\u7d50\u7b97\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#116-2024-7-11", "title": "1.1.6 (2024-7-11)", "text": ""}, {"location": "change-log/#fix_17", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63\u56de\u6e2c\u4e2d\uff0c\u96e2\u7dda\u7248\u91dd\u5c0d\u8cc7\u6599\u5feb\u53d6\u8b80\u53d6\u7684\u554f\u984c</li> <li>\u4fee\u6b63\u56de\u6e2c\u4e2d\uff0cWindows datetime \u8f49\u63db\u6210 int32 \u4e0d\u652f\u63f4\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#114-2024-7-9", "title": "1.1.4 (2024-7-9)", "text": ""}, {"location": "change-log/#features_13", "title": "Features", "text": "<ul> <li>\u65b0\u589e\u7b56\u7565\u5230\u671f\u6642\u9593\uff0c\u7528\u65bc\u63d0\u9192\u8cc7\u6599\u5df2\u7d93\u904e\u671f\uff0c\u9700\u8981\u91cd\u65b0\u57f7\u884c</li> <li>\u56de\u5074\u9762\u7248\uff1a\u540c\u6642\u986f\u793a\u9032\u5834\u8207\u7576\u524d\u50f9\u683c</li> <li>\u56de\u6e2c\u9762\u7248\uff1a\u5c07\u9810\u8a2d\u5831\u916c\u7387\u986f\u793a\u5f9e\u5f8c\u5f80\u524d</li> <li>\u56de\u6e2c\u9762\u7248\uff1a\u6301\u80a1\u50f9\u683c\u986f\u793a\u512a\u5316</li> </ul>"}, {"location": "change-log/#fix_18", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 finlab.tools.factor_analysis \u6703\u56e0\u70ba\u56e0\u5b50\u65e5\u671f\u6c92\u6709\u5c0d\u9f4a\u800c\u5831\u932f\u7684\u554f\u984c</li> <li>\u4fee\u6b63 Pandas 2.2.0 \u7248\u672c\u4e0b\uff0c\u929c\u63a5 Pandas 3.0.0 \u7522\u751f\u7684 Warning</li> <li>\u4fee\u6b63 ffn_core \u4e2d\uff0cTabular \u5efa\u69cb\u932f\u8aa4\u7684\u554f\u984c</li> <li>\u4fee\u6b63 ffn_core \u4e2d\uff0c\u91dd\u5c0d Pandas 3.0.0 \u7248\u672c\u7684\u517c\u5bb9\u6027\u554f\u984c</li> <li>\u4fee\u6b63\u56de\u6e2c\u9801\u9762\u80a1\u7968\u9032\u5834\u50f9\u683c\u986f\u793a\u932f\u8aa4\u7684\u554f\u984c</li> <li>\u56de\u6e2c\u9801\u9762\uff1a\u4fee\u6b63\u80a1\u7968\u6b77\u53f2\u7d00\u9304</li> <li>\u56de\u6e2c\u9801\u9762\uff1a\u8003\u616e\u8fd1\u671f\u6700\u5927\u4e0b\u8dcc</li> <li>\u4fee\u6b63 plot \u4e2d\u6bcf\u5e74\u5e73\u5747\u5831\u916c\uff0c\u8003\u616e\u6c92\u6709\u56de\u6e2c\u7684\u72c0\u6cc1</li> </ul>"}, {"location": "change-log/#113-2024-6-4", "title": "1.1.3 (2024-6-4)", "text": ""}, {"location": "change-log/#features_14", "title": "Features", "text": "<ul> <li>\u5c07finlab.tools.factor_analysis \u9032\u884c\u4fee\u6b63\uff0c\u652f\u63f4\u591a\u56e0\u5b50</li> <li>LINE Notify \u65b0\u589e\u7b56\u7565\u540d\u7a31\u767c\u9001</li> </ul>"}, {"location": "change-log/#fix_19", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 show_alerting_stocks \u7121\u6cd5\u4f7f\u7528\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#112-2024-5-23", "title": "1.1.2 (2024-5-23)", "text": ""}, {"location": "change-log/#feature_3", "title": "Feature", "text": "<ul> <li>\u65b0\u589e finlab.tools.factor_analysis \u6a21\u7d44\uff0c\u7528\u65bc\u56e0\u5b50\u5206\u6790</li> </ul>"}, {"location": "change-log/#fix_20", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63\u50f9\u683c NaN \u7684\u61c9\u5c0d\u8655\u7406</li> <li>\u4fee\u6b63 finlab.ml.feature.ta \u51fd\u5f0f\u7684\u591a\u6838\u8655\u7406\u908f\u8f2f\uff0c\u6839\u64da\u55ae\u6838\u5fc3\u5831\u932f</li> <li>\u4fee\u6b63\u53c3\u7167\u4e0b\u6b21\u518d\u5e73\u8861\u7684\u6642\u6a5f\uff0c\u4ee5\u90e8\u4f4d\u8b8a\u5316\u65e5\u671f\u70ba\u6e96\uff0c\u6539\u6210\u7576\u524d\u7684\u6536\u76e4\u50f9\u683c\u65e5\u671f\u70ba\u6e96\uff0c\u907f\u514d\u5728\u4e0b\u6b21\u518d\u5e73\u8861\u6642\uff0c\u53c3\u7167\u5230\u932f\u8aa4\u7684\u50f9\u683c</li> <li>\u4fee\u6b63 finlab.ml.qlib.get_models \u4e2d\u7684\u6a21\u578b\uff0c\u5728\u8a13\u7df4\u6642 label \u6703\u6709 inf \u6216 NaN \u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#refactor_8", "title": "Refactor", "text": "<ul> <li>\u91dd\u5c0d\u9280\u884c\u9918\u984d\u8207\u4ea4\u5272\u8a0a\u606f\u91cd\u69cb</li> </ul>"}, {"location": "change-log/#111-2024-4-25", "title": "1.1.1 (2024-4-25)", "text": ""}, {"location": "change-log/#refactor_9", "title": "Refactor", "text": "<ul> <li>\u5728 machine_learning.md \u4e2d\u65b0\u589e \"\u5fc5\u8981\u5b89\u88dd\" \u548c \"\u6a21\u578b\u51fd\u5f0f\u5eab\uff08\u975e\u5fc5\u9808\uff09\" \u5169\u500b\u5c0f\u7bc0\uff0c\u6e05\u6670\u5283\u5206\u5b89\u88dd\u6307\u4ee4\u3002</li> <li>market_info.py \u4e2d MarketInfo \u548c TWMarketInfo \u985e\u5225\u7684\u65b9\u6cd5 market_close_at_timestamp \u548c tzinfo \u9032\u884c\u4e86\u4fee\u6b63\u548c\u6a19\u6e96\u5316\uff0c\u4ee5\u6539\u5584\u65b9\u6cd5\u7684\u53ef\u8b80\u6027\u548c\u4e00\u81f4\u6027\u3002</li> <li>\u5c07\u90e8\u5206\u65b9\u6cd5\u7684\u5be6\u73fe\u5f9e\u52d5\u614b\u5230\u975c\u614b\uff0c\u4ee5\u63d0\u9ad8\u6548\u7387\u548c\u6e1b\u5c11\u4f9d\u8cf4\u3002</li> <li>\u65b0\u589e qlib.py \u4e2d WrapperModel \u7684 fit \u65b9\u6cd5\u4e2d\u5c0d segments \u53c3\u6578\u7684\u8655\u7406\uff0c\u78ba\u4fdd\u81ea\u5b9a\u7fa9\u6578\u64da\u6bb5\u53ef\u4ee5\u88ab\u6b63\u78ba\u8655\u7406\u3002</li> </ul>"}, {"location": "change-log/#fix_21", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 market_info.py \u4e2d\u908f\u8f2f\u689d\u4ef6\u5224\u65b7\u932f\u8aa4\uff0c\u6b63\u78ba\u5340\u5206\u689d\u4ef6\u5224\u65b7\u5f0f\u3002</li> <li>\u4fee\u6539 data.py \u4e2d\u5c0d\u65bc NaN \u503c\u7684\u8655\u7406\u65b9\u5f0f\uff0c\u907f\u514d\u5728\u8a08\u7b97\u6307\u6a19\u6642\u5305\u542b\u7121\u6548\u6578\u64da\u3002</li> <li>feature.py \u4e2d ta \u51fd\u5f0f\u7684\u591a\u6838\u8655\u7406\u908f\u8f2f\u8abf\u6574\uff0c\u6839\u64da\u6838\u5fc3\u6578\u91cf\u6c7a\u5b9a\u6578\u64da\u8655\u7406\u65b9\u5f0f\uff0c\u907f\u514d\u5728 docker \u4e2d\u7121\u6cd5\u4f7f\u7528\u3002</li> <li>\u4fee\u6b63 label.py \u4e2d\uff0c\u4f7f\u7528 maximum_adverse_excursion \u51fd\u5f0f\u6642\u7684\u932f\u8aa4\uff0c\u78ba\u4fdd\u51fd\u5f0f\u6b63\u78ba\u904b\u884c\u3002</li> <li>\u4fee\u6b63 label.py \u4e2d\uff0c\u4f7f\u7528 maximum_favorable_excursion \u51fd\u5f0f\u6642\u7684\u932f\u8aa4\uff0c\u78ba\u4fdd\u51fd\u5f0f\u6b63\u78ba\u904b\u884c\u3002</li> </ul>"}, {"location": "change-log/#110", "title": "1.1.0", "text": ""}, {"location": "change-log/#features_15", "title": "Features", "text": "<ul> <li>\u65b0\u589e\u4e86\u5c0d Microsoft Qlib \u7684\u652f\u6301\uff0c\u900f\u904e\u5728 Dockerfile \u4e2d\u6dfb\u52a0 pyqlib \u4f9d\u8cf4\uff0c\u4f7f\u5f97\u7528\u6236\u80fd\u5920\u76f4\u63a5\u5728 Docker \u5bb9\u5668\u4e2d\u4f7f\u7528 Qlib\u3002</li> </ul>"}, {"location": "change-log/#fix_22", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63\u4e86\u7248\u672c\u865f\u5728\u591a\u500b\u6a94\u6848\u4e2d\u7684\u4e0d\u4e00\u81f4\u554f\u984c\uff0c\u7d71\u4e00\u5c07\u7248\u672c\u865f\u66f4\u6539\u70ba 1.0.10\u3002</li> <li>\u91cd\u69cb\u4e86 finlab/ml/qlib.py \u4e2d\u7684\u4ee3\u78bc\uff0c\u79fb\u9664\u4e86\u904e\u6642\u7684\u8a3b\u91cb\u548c\u672a\u4f7f\u7528\u7684\u4ee3\u78bc\uff0c\u63d0\u9ad8\u4e86\u4ee3\u78bc\u7684\u6e05\u6670\u5ea6\u548c\u7dad\u8b77\u6027\u3002</li> <li>\u66f4\u65b0\u4e86 finlab/online \u5b50\u6a21\u7d44\u7684\u5f15\u7528\uff0c\u4ee5\u7372\u53d6\u6700\u65b0\u7684\u529f\u80fd\u548c\u4fee\u5fa9\u3002</li> <li>\u7c21\u5316\u4e86 run_online_test.sh \u548c run_all_test.sh \u8173\u672c\uff0c\u79fb\u9664\u4e86\u4e0d\u5fc5\u8981\u7684\u8a3b\u91cb\u548c\u4ee3\u78bc\uff0c\u4f7f\u5f97\u6e2c\u8a66\u904e\u7a0b\u66f4\u70ba\u7c21\u6f54\u9ad8\u6548\u3002</li> </ul>"}, {"location": "change-log/#106", "title": "1.0.6", "text": "<ul> <li>fix(report): \u4fee\u6b63 importlib.resources \u5728 python&lt;=3.6, python==3.8,3.7, python &gt;=3.9 \u4e0d\u80fd\u7528\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#105", "title": "1.0.5", "text": "<ul> <li>fix(report): \u4fee\u6b63 importlib.resources \u5728 python&lt;=3.8 \u4e0d\u80fd\u7528\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#104", "title": "1.0.4", "text": "<ul> <li>feat(backtest): \u65b0\u589e\u56de\u6e2c\u8207\u6a19\u7684\u7684\u76f8\u95dc\u6e2c\u8a66\u529f\u80fd</li> <li>fix(backtest): \u4fee\u6b63 removing next_weight force to 1 \u7684\u554f\u984c</li> <li>fix(us_market): \u4fee\u6b63\u652f\u63f4 market_close_at_timestamp support None \u7684\u554f\u984c</li> <li>chore(pandas 3.0): \u652f\u63f4\u65b0\u7248\u7684 Pandas &gt;= 3.0.0 new resample string format</li> <li>feat(backtest): \u65b0\u589e sl_enter \u548c tp_enter\uff0c\u4f86\u4ee3\u8868\u7acb\u5373\u505c\u640d\u505c\u5229\uff0c\u76f4\u5230\u4e0b\u6b21\u63db\u80a1\u518d\u8cb7\u5165\u7684\u6a19\u793a</li> </ul>"}, {"location": "change-log/#103", "title": "1.0.3", "text": ""}, {"location": "change-log/#fix_23", "title": "Fix", "text": "<ul> <li>\u4fee\u5fa9\u652f\u63f4\u7db2\u9801\u7aef\u57f7\u884c\u56de\u6e2c</li> <li>\u4fee\u6b63 <code>report.current_trades</code> \u5047\u5982\u6709\u91cd\u8907\u7684\u80a1\u7968\u540d\u7a31\uff0c\u4ee5\u6700\u65b0\u7684\u90e8\u4f4d\u70ba\u4e3b</li> <li>\u4fee\u6b63\u5100\u8868\u677f\u986f\u793a\u6bcf\u6708\u71df\u6536\u7684\u8a08\u7b97\u65b9\u5f0f\uff0c\u5f9e 1 \u865f\u5230 31 \u865f\uff0c\u8b8a\u6210\u8ddf\u4e4b\u524d\u4e00\u6a23\uff0c\u5f9e\u4e0a\u6708 31 \u865f\u5230\u6b64\u6708 31 \u865f</li> <li>\u4fee\u6b63 <code>trail_stop</code> \u5728\u8cb7\u540c\u4e00\u5f35\u80a1\u7968\u6642\uff0c\u63d0\u65e9\u51fa\u5834\u7684\u554f\u984c</li> <li>\u9694\u5929\u8981\u9032\u5834\uff0c\u540c\u6642\u53c8\u505c\u640d\u505c\u5229\uff0c\u91dd\u5c0d <code>stop_trading_next_period</code> \u5c0d\u65bc <code>report.action</code> \u4ee5\u53ca <code>report.next_weights</code> \u7684\u986f\u793a\u8cc7\u6599\u9032\u884c\u4fee\u6b63\uff0c\u4e26\u589e\u52a0\u55ae\u5143\u6e2c\u8a66\u3002</li> </ul>"}, {"location": "change-log/#102", "title": "1.0.2", "text": ""}, {"location": "change-log/#refactor_10", "title": "Refactor", "text": "<ul> <li>\u79fb\u9664 tailwind default css\uff0c\u6539\u800c\u4f7f\u7528 vite \u8f38\u51fa\u7684 style.css</li> <li>\u79fb\u9664 web server \u6539\u800c\u4f7f\u7528 iframe docsrc \uff08\u7d93\u904e\u6e2c\u8a66\u652f\u63f4\u6240\u6709\u5e73\u53f0\uff09</li> </ul>"}, {"location": "change-log/#fix_24", "title": "Fix", "text": "<ul> <li>\u986f\u793a\u5728 docker \u4e0a web server port \u7121\u6cd5\u4f7f\u7528\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#101", "title": "1.0.1", "text": ""}, {"location": "change-log/#features_16", "title": "Features", "text": "<ul> <li>\u986f\u793a\u79fb\u52d5\u505c\u640d</li> <li>\u5100\u8868\u677f\u53f3\u4e0a\u89d2\u63a7\u5236 light/dark \u6a21\u5f0f</li> <li>\u53e6\u5b58\u5100\u8868\u677f\u81f3\u6307\u5b9a\u7684\u8def\u5f91\u4e0b</li> </ul>"}, {"location": "change-log/#fix_25", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63 Windows \u4e0b report \u9810\u8a2d\u8b80\u5beb\u7de8\u78bc\u70ba cp950 \u9020\u6210\u7684\u554f\u984c\u3002</li> <li>\u4fee\u6b63\u505c\u640d\u7121\u6cd5\u986f\u793a</li> <li>Colab \u4e2d CSS \u5b57\u9ad4\u8207\u6392\u7248\u8abf\u6574</li> <li>light/dark \u6a21\u5f0f\u4e2d\uff0c\u5716\u8868\u5ea7\u6a19\u8ef8\u984f\u8272\u97ff\u61c9</li> <li>\u4fee\u6b63\u5716\u8868\u8a18\u61b6\u9ad4\u6c92\u6709\u91cb\u653e\uff0c\u5c0e\u81f4 tab \u5207\u63db\u5ef6\u9072\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#100", "title": "1.0.0", "text": ""}, {"location": "change-log/#features_17", "title": "Features", "text": "<ul> <li>\u65b0\u589e Position.from_report \u7684\u55ae\u5143\u6e2c\u8a66</li> <li>\u5728\u591a\u7a2e\u689d\u4ef6\u4e0b\u6e2c\u8a66 report.next_weights \u529f\u80fd</li> <li>\u63a8\u51fa\u5168\u65b0\u5100\u8868\u677f\u4ecb\u9762</li> <li>\u652f\u63f4 Python 3.12 \u7248\u672c</li> </ul>"}, {"location": "change-log/#fix_26", "title": "Fix", "text": "<ul> <li>\u4fee\u6b63\u4e86\u5728\u555f\u7528\u505c\u640d\u6216\u505c\u5229\u6642\uff0c\u5831\u544a\u4e2d report.next_weights \u7684\u6b63\u898f\u5316\u554f\u984c</li> <li>\u89e3\u6c7a\u4e86\u5728 Pandas \u7684 reindex \u51fd\u6578\u4e2d\uff0c\u5206\u985e\u578b\u6b04\u4f4d\u7121\u6cd5\u6b63\u78ba\u7d22\u5f15\u7684\u554f\u984c</li> <li>\u4fee\u6b63\u4e86\u5728\u6dfb\u52a0\u904b\u7b97\u5b50\u6642\uff0c\u5206\u985e\u578b\u6b04\u4f4d\u7e6a\u5716\u932f\u8aa4\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#0513", "title": "0.5.13", "text": ""}, {"location": "change-log/#features_18", "title": "Features", "text": "<ul> <li>\u6574\u5408 Pytest\uff08\u63d0\u4ea4 e7a487c\uff09\uff1a\u52a0\u5165\u4e86 Pytest\uff0c\u8b93\u6e2c\u8a66\u66f4\u9ad8\u6548\u3002</li> <li>finlab.ml \u65e5\u5167\u4ea4\u6613\u5831\u916c\u7387\u8a08\u7b97\uff08\u63d0\u4ea4 8804fb1\uff09\uff1a\u65b0\u589e\u4e86\u8a08\u7b97\u65e5\u5167\u4ea4\u6613\u7684 label</li> <li>finlab.ml.feature.ta \u7279\u5fb5\u8a08\u7b97\u652f\u6301\u591a\u9032\u7a0b\uff08\u63d0\u4ea4 1ab0463\uff09\uff1a\u5728\u7279\u5fb5\u8a08\u7b97\u6a21\u7d44\u4e2d\u5f15\u5165\u591a\u9032\u7a0b\u652f\u6301\uff0c\u63d0\u5347\u6027\u80fd\u3002</li> </ul>"}, {"location": "change-log/#fix_27", "title": "Fix", "text": "<ul> <li>\u512a\u5316 'get_location' \u51fd\u6578\uff08\u63d0\u4ea4 253e98c\uff09\uff1a\u6539\u9032\u4e86 'data.py' \u4e2d\u7684 'get_location' \u51fd\u6578\uff0c\u4f7f\u5176\u66f4\u597d\u5730\u8655\u7406\u5931\u6557\u60c5\u6cc1\u3002</li> <li>\u5e02\u5834\u4fe1\u606f\u652f\u6301\u6642\u5340\uff08\u63d0\u4ea4 aa2756b &amp; 79b3671\uff09\uff1a\u5728 'market_info.py' \u4e2d\u52a0\u5165\u4e86\u6642\u5340\u4fe1\u606f\u7684\u8655\u7406\u3002</li> <li>\u79fb\u52d5\u505c\u640d\u4fee\u6b63\uff08\u63d0\u4ea4 6522bf7 &amp; e7fc1f3\uff09\uff1a\u8abf\u6574\u4e86 'backtest.py' \u4e2d\u7684\u4ea4\u6613\u8a08\u7b97\uff0c\u4fee\u6b63\u79fb\u52d5\u505c\u640d\u7684\u529f\u80fd\u3002</li> <li>Dataframe \u7684\u5c0e\u5165\u4fee\u6b63\uff08\u63d0\u4ea4 626ada1\uff09\uff1a\u4fee\u6b63\u4e86 'dataframe.py' \u4e2d\u7684\u5c0e\u5165\u554f\u984c\u3002</li> <li>\u7279\u5fb5\u521d\u59cb\u5316\u4fee\u6b63\uff08\u63d0\u4ea4 772d659\uff09\uff1a\u89e3\u6c7a\u4e86 'ml/feature.py' \u4e2d\u7684\u521d\u59cb\u5316\u554f\u984c\u3002</li> <li>\u5f37\u5236\u96f2\u7aef\u4e0b\u8f09\uff08\u63d0\u4ea4 7ec28a3\uff09\uff1a\u4fee\u5fa9\u4e86 'data.py' \u4e2d\u7684 'force_cloud_download' \u5be6\u73fe\u3002</li> </ul>"}, {"location": "change-log/#other-updates", "title": "Other updates", "text": "<ul> <li>\u91cd\u69cb\uff08\u63d0\u4ea4 26d1518\uff09\uff1a\u5c0d 'online' \u6a21\u7d44\u9032\u884c\u4e86\u91cd\u69cb\uff0c\u4f7f\u4ee3\u78bc\u7d50\u69cb\u66f4\u597d\u3002</li> <li>\u6587\u6a94\u66f4\u65b0\uff08\u63d0\u4ea4 44a93d4, 9f5683f, cd4a894\uff09\uff1a\u66f4\u65b0\u4e86 'backtest.py'\u3001'data.py' \u548c 'ml/feature.py' \u7684\u6587\u6a94\u3002</li> <li>\u7248\u672c\u66f4\u65b0\uff08\u63d0\u4ea4 d361d7f\uff09\uff1a\u5c07\u7248\u672c\u5347\u7d1a\u5230\u4e86 0.5.13\u3002</li> <li>\u589e\u52a0\u6e2c\u8a66\u8986\u84cb\u7387\uff08\u63d0\u4ea4 350dfbc\uff09\uff1a\u5728 Docker \u914d\u7f6e\u4e2d\u589e\u52a0\u4e86\u6e2c\u8a66\u8986\u84cb\u7387\u3002</li> <li>\u6e2c\u8a66\u7cfb\u7d71\u7684\u7a69\u5065\u6027\uff08\u63d0\u4ea4 1647479\uff09\uff1a\u63d0\u5347\u4e86\u6e2c\u8a66\u7cfb\u7d71\u7684\u7a69\u5065\u6027\u3002</li> <li>\u5728\u7dda\u6e2c\u8a66 <code>Position.to_list</code>\uff08\u63d0\u4ea4 f3d086f\uff09\uff1a\u66f4\u65b0\u4e86 'online_test.py'\uff0c\u589e\u52a0\u4e86\u8f49\u63db\u70ba\u5217\u8868\u7684\u529f\u80fd\u3002</li> </ul>"}, {"location": "change-log/#0512", "title": "0.5.12", "text": "<ul> <li>\u4fee\u6b63\u4e86 run_online_test.sh \u4e2d\u7684\u5728\u7dda\u6e2c\u8a66\u66f4\u65b0\u50f9\u683c\uff0c\u4ee5\u5305\u542b FUGLE \u914d\u7f6e\u7684\u74b0\u5883\u8b8a\u91cf\u3002</li> <li>\u8abf\u6574\u4e86 online_test.py \u4e2d\u7684 test_update_price\uff0c\u4ee5\u6b63\u78ba\u6bd4\u8f03\u6d6e\u9ede\u6578\u91cf\u3002</li> <li>\u4fee\u6539\u4e86 event_study.py\uff0c\u901a\u904e\u91cd\u65b0\u7d22\u5f15\u5de5\u4f5c\u65e5\u4f7f\u5176\u8207\u975e\u4ea4\u6613\u65e5\u517c\u5bb9\u3002</li> </ul>"}, {"location": "change-log/#0511", "title": "0.5.11", "text": "<ul> <li>\u4fee\u5fa9 position \u70ba\u96f6\u6642\uff0c\u6703\u5831 error \u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#0510", "title": "0.5.10", "text": "<ul> <li>\u6c38\u8c50 API \u4e0b\u55ae\u5927\u65bc 1000 \u5143\u7121\u6cd5\u4e0b\u55ae\u7684\u554f\u984c</li> <li>\u4fee\u6b63 <code>FinlabDataframe</code> \u7684 memory leak error</li> <li>\u4fee\u6b63\u767b\u5165\u986f\u793a\u7684\u6a23\u5f0f\uff0c\u907f\u514d colab \u767b\u5165\u6642\u51fa\u73fe error</li> <li>\u4fee\u6b63 <code>data.search</code> \u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#059", "title": "0.5.9", "text": "<ul> <li>\u4fee\u6b63 dataframe operator \u904b\u7b97\u6642\u7684 reshape \u554f\u984c</li> <li>\u6539\u5584 <code>df[bool_selector]</code> \u7121\u6cd5\u4f7f\u7528\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#058", "title": "0.5.8", "text": "<ul> <li>\u6539\u5584 <code>data.get</code>\u901f\u5ea6</li> <li>\u66f4\u65b0\u6c38\u8c50 API \u4e0b\u55ae\u6548\u7387\uff08\u7136\u800c\u5f15\u51fa\u4e00\u4e9b\u554f\u984c\uff0c\u5df2\u7d93\u4fee\u5fa9\uff09</li> </ul>"}, {"location": "change-log/#057-2023-11-4", "title": "0.5.7 (2023-11-4)", "text": ""}, {"location": "change-log/#fix_28", "title": "Fix \ud83d\ude80", "text": "<ul> <li><code>FinlabDataFrame</code>\uff1a\u82e5\u672a\u8a2d\u7f6e\u5247\u6b63\u78ba\u4f7f\u7528 UUID \u4fee\u6b63\u4e86<code>__hash__</code>\u65b9\u6cd5\u3002</li> <li><code>hold_until</code>\u65b9\u6cd5\uff1a\u4fee\u6b63\u4e86<code>self</code>\u3001<code>exit</code>\u548c<code>rank</code>\u7684<code>reindex</code>\u554f\u984c\u3002</li> <li><code>market_info.get_market_info</code>\uff1a\u66f4\u6b63\u4e86<code>reindex</code>\u908f\u8f2f\uff0c\u78ba\u4fdd\u4f7f\u7528\u66f4\u65b0\u5f8c\u7684\u7d22\u5f15\u3002</li> <li><code>fetch_data</code>\uff1a\u4fee\u6b63\u4e86\u5831\u544a\u90e8\u5206\u7684\u65e5\u5747\u8a08\u7b97\u932f\u8aa4\u3002</li> <li><code>data.py</code>\uff1a\u70ba HTTP \u8acb\u6c42\u6dfb\u52a0\u4e86<code>User-Agent</code>\u6a19\u982d\u4ee5\u9632\u6b62\u53d6\u5f97\u932f\u8aa4\u3002</li> <li><code>data.py</code>\uff1a\u4fee\u6b63\u4e86\u4fdd\u5b58\u7a7a<code>DataFrame</code>\u7684\u554f\u984c\u3002</li> <li><code>ffn_core.py</code>\uff1a\u4fee\u6b63\u4e86<code>calc_sharpe</code>\u65b9\u6cd5\u4e2d\u9664\u4ee5\u96f6\u7684\u932f\u8aa4\u3002</li> </ul>"}, {"location": "change-log/#features_19", "title": "Features \ud83d\ude80", "text": "<ul> <li><code>tools</code>: \u65b0\u589e <code>finlab.tools.event_study</code> \u7814\u7a76\u4e8b\u4ef6\u4ea4\u6613\u7b49\u76f8\u95dc\u529f\u80fd\u3002</li> <li><code>backtest.py</code>\uff1a\u5f15\u5165\u4e86<code>fast_mode</code>\uff0c\u5728\u4e0d\u8003\u616e\u505c\u640d\u6216\u505c\u5229\u7684\u60c5\u6cc1\u4e0b\u9032\u884c\u5feb\u901f\u56de\u6e2c\u3002</li> <li><code>dataframe.py</code>\uff1a\u5c07<code>index_str_to_date</code>\u65b9\u6cd5\u9032\u884c\u4e86\u7de9\u5b58\uff0c\u63d0\u9ad8\u6027\u80fd\u3002</li> <li><code>report.add_trade_info</code>\uff1a\u5c0e\u5165 Cython \u512a\u5316\u904b\u7b97\u901f\u5ea6\u3002</li> <li><code>setup.py</code>\uff1a\u7de8\u8b6f Cython \u64f4\u5c55\u6642\u555f\u7528 O3 \u512a\u5316\u3002</li> <li><code>backtest.py</code>\uff1a\u70ba<code>sim</code>\u51fd\u6578\u65b0\u589e\u6587\u6a94\uff0c\u8a73\u7d30\u8aaa\u660e\u65b0\u7279\u6027\u548c\u53c3\u6578\u3002</li> <li><code>dataframe.py</code>\uff1a\u5be6\u73fe\u4e86\u7d22\u5f15\u512a\u5316\uff0c\u5c07\u5b57\u7b26\u4e32\u7d22\u5f15\u8f49\u63db\u70ba\u65e5\u671f\u4e26\u9032\u884c\u7de9\u5b58\u3002</li> <li>\u8abf\u6574<code>setup.py</code>\uff0c\u5c07 Python \u7248\u672c\u8981\u6c42\u5f9e &gt;=3.7 \u6539\u70ba &gt;=3.6\u3002</li> <li>\u66f4\u65b0\u5b50\u6a21\u7d44\u81f3\u6700\u65b0\u63d0\u4ea4\u3002</li> </ul>"}, {"location": "change-log/#tests", "title": "Tests \ud83d\ude80", "text": "<ul> <li>\u70ba<code>report_test.py</code>\u6a21\u584a\u65b0\u589e\u6e2c\u8a66\uff0c\u4ee5\u4fdd\u8b49\u67e5\u8a62\u529f\u80fd\u7684\u6b63\u78ba\u6027\u3002</li> <li>\u70ba<code>report_test.py</code>\u65b0\u589e\u591a\u500b\u91dd\u5c0d\u4e0d\u540c\u6578\u64da\u985e\u578b\u7684\u6e2c\u8a66\u6848\u4f8b\u3002</li> <li>\u66f4\u65b0<code>run_test_docker.sh</code>\u8173\u672c\uff0c\u5305\u542b\u65b0\u7684\u6e2c\u8a66\u6848\u4f8b\u3002</li> </ul>"}, {"location": "change-log/#052-2023-09-28", "title": "0.5.2 (2023-09-28)", "text": ""}, {"location": "change-log/#fix_29", "title": "Fix \ud83d\ude80", "text": "<ul> <li>\u5728\u5c11\u90e8\u5206\u7684 OS \u4e0a\u51fa\u73fe recursive import \u7684\u554f\u984c</li> <li>\u4fee\u6b63 liquility analysis \u4e2d\u7522\u751f NaN \u6642\uff0c\u88ab Pandas \u6697\u81ea\u8f49\u63db\u6210 float \u9020\u6210\u7684\u554f\u984c</li> <li>trade_at_price \u4fee\u6b63</li> <li>\u4fee\u6b63\u5728\u5617\u8a66 merge \u904e\u7a0b\u4e2d\u6d88\u8017\u5927\u91cf\u8a18\u61b6\u9ad4\u7684\u554f\u984c</li> </ul>"}, {"location": "change-log/#050-2023-09-14", "title": "0.5.0 (2023-09-14)", "text": ""}, {"location": "change-log/#features_20", "title": "Features \ud83d\ude80", "text": "<ul> <li>\u65b0\u589e\u79fb\u52d5\u505c\u640d\u529f\u80fd <code>sim(..., trail_stop=0.1)</code> \u4f86\u8a2d\u5b9a\u79fb\u52d5\u505c\u640d\u3002</li> <li><code>data.universe</code> \u652f\u63f4 <code>market='etf'</code> \u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u9078 ETF \u7684\u7a2e\u985e\u5982\uff1a<code>domestic_etf</code>, <code>foreign_etf</code>, <code>leveraged_etf</code>, <code>vanilla_futures_etf</code>, <code>leveraged_futures_etf</code></li> <li><code>data.get</code> \u652f\u63f4\u5f9e\u7f8e\u570b\u3001\u53f0\u7063\u5169\u5730\u66f4\u65b0\u8cc7\u6599\uff0c\u6703\u81ea\u52d5\u9078\u64c7\u6bd4\u8f03\u8fd1\u7684\u4f3a\u670d\u5668\u4f86\u7d22\u53d6\u8cc7\u6599\u3002</li> <li><code>data.get</code> \u81ea\u52d5\u5075\u6e2c\u4e26\u9023\u7d50 Google Drive \u4f86\u5b58\u653e\u4e0b\u8f09\u7684\u8cc7\u6599\u3002</li> <li><code>data.get</code> \u5c07\u5168\u9762\u652f\u63f4\u5728\u672c\u5730\u7aef\u66f4\u65b0\u8cc7\u6599\uff0c\u4ee5\u5f8c\u518d\u4e5f\u4e0d\u7528\u5168\u9762\u4e0b\u8f09\u6240\u6709\u8cc7\u6599\uff0c\u800c\u662f\u4e0b\u8f09 patch \u4e26\u85c9\u7531\u672c\u5730\u7aef\u7684\u7a0b\u5f0f\u4f86\u9032\u884c\u7dad\u8b77\uff0c\u53ea\u6709\u5728\u5fc5\u8981\u7684\u6642\u5019\u9032\u884c\u6574\u6279\u8cc7\u6599\u7684\u91cd\u7f6e\uff08\u9810\u8a2d\u958b\u555f\uff09</li> <li><code>sim(..., trade_at_price)</code> \u53ef\u9078\u64c7\u5176\u4ed6\u50f9\u683c\u4f86\u6a21\u64ec\u8cb7\u8ce3\uff0c\u53ef\u9078'close'\u3001'open'\u3001'open_close_avg'\u3001'high_low_avg'\u6216 'price_avg'\u3002</li> <li>\u65b0\u589e\u5e95\u5c64\u529f\u80fd\u4ee5\u78ba\u4fdd\u65b0\u7684\u7db2\u7ad9\u80fd\u5920\u517c\u5bb9</li> </ul>"}, {"location": "change-log/#fixes_3", "title": "Fixes", "text": "<ul> <li>\u4fee\u6b63\u505a\u7a7a\u7684\u505c\u640d\u505c\u5229</li> <li>FinlabDataFrame.hold_until \u73fe\u5728\u8f38\u51fa\u70ba bool \uff08\u800c\u975e\u4ee5\u524d\u7684 int\uff09</li> <li>FinlabDataFrame \u66f4\u5ee3\u6cdb\u7684\u652f\u63f4\u81ea\u52d5 reshape \u8207\u586b\u503c\u7684\u904b\u7b97\uff0c\u4f8b\u5982\u300c&amp;=\u300d\u3001\u300c+=\u300d\u7b49\u76ee\u524d\u5df2\u652f\u63f4</li> <li>\u79fb\u9664\u4e86\u5f37\u5236\u8a2d\u7f6e\u7684 logger</li> <li>finlab.online \u4fee\u6b63\u4e86\u7372\u53d6\u7e3d\u9918\u984d\u6642\u7684\u6642\u5340\u554f\u984c\u3002</li> <li>data.FileStorage \u89e3\u6c7a\u4e86 Windows \u7cfb\u7d71\u4e0a\u7684\u6587\u4ef6\u8def\u5f91\u932f\u8aa4\u3002</li> <li>ffn \u79fb\u9664\u5373\u5c07\u4e0d\u652f\u63f4\u7684\u8a9e\u6cd5\uff0c\u66f4\u65b0\u4e86 pandas2.1 \u9593\u5bb9\u7684\u8a9e\u6cd5\u3002</li> <li>\u81ea\u52d5\u5075\u6e2c backtest(position) \u4e2d\u7684 position.index \u8f49\u63db\u70ba datetime</li> <li>\u89e3\u6c7a report.trades \u592a\u9577\u4e0a\u50b3\u7684\u554f\u984c</li> <li>\u89e3\u6c7a\u56de\u6e2c\u6642\u4e0a\u6b21\u51fa\u5834\u7684\u6a19\u7684\uff0c\u9019\u6b21\u4e0d\u9032\u5834\u7684\u932f\u8aa4</li> </ul>"}, {"location": "change-log/#046-2023-08-11", "title": "0.4.6 (2023-08-11)", "text": ""}, {"location": "change-log/#fixes_4", "title": "Fixes \ud83d\udd27", "text": "<ul> <li>\u4fee\u6b63\u512a\u52e2\u50f9\u683c\u8cb7\u8ce3(extra_bid_pct)\u5728\u59d4\u8a17\u50f9\u683c\u8d85\u904e\u6f32\u8dcc\u505c\u50f9\u6642\u7684\u59d4\u8a17\u5931\u6557\u554f\u984c\uff0c\u59d4\u8a17\u50f9\u4ee5\u6f32\u8dcc\u505c\u70ba\u4e0a\u9650\u3002</li> <li>\u89e3\u6c7a\u4e86\u4e0b\u55ae API \u4e2d Position.from_report \u505c\u640d\u505c\u5229\u90e8\u4f4d\u5224\u65b7\u932f\u8aa4\u7684\u554f\u984c\u3002</li> <li>\u89e3\u6c7a\u4e86\u6c38\u8c50 API \u96f6\u80a1\u6539\u50f9\u5931\u6557\u554f\u984c\uff0c\u81ea\u52d5\u522a\u55ae\u518d\u91cd\u4e0b\u3002</li> <li>\u6708\u71df\u6536\u7d22\u5f15\u6539\u70ba datetime \u683c\u5f0f\uff0c\u89e3\u6c7a data.set_storage \u6a21\u5f0f\u4e0b\u5f37\u5236\u4e0b\u8f09\u6708\u71df\u6536\u8cc7\u6599\u7684\u554f\u984c\u3002</li> <li>\u907f\u514d finlab.dataframe.industry rank() \u51fa\u73fe nan \u6578\u503c\u3002</li> </ul>"}, {"location": "change-log/#features_21", "title": "Features \ud83d\ude80", "text": "<ul> <li>\u52a0\u5165\u7b56\u7565\u5831\u7c4c\u7387\u7d71\u8a08\u5206\u6790\u5716\u8868\u529f\u80fd finlab.plot.StrategyReturnStats\u3002</li> <li>Fugle \u884c\u60c5 API v1.0 \u7248 \u76f8\u5bb9 finlab.online\uff0c\u4e0d\u76f8\u5bb9 v0.3\u3002 \u63d0\u9192\u7528\u6236\u8acb\u5c07\u884c\u60c5 API v0.3 \u7248\u672c\u5347\u7d1a\u81f3\u6700\u65b0\u7684 v1.0 \u7248\u672c\uff0c\u820a\u7248\u672c\u5c07\u88ab Fugle \u5b98\u65b9\u68c4\u7528\uff0c\u8981\u6ce8\u610f\u5728\u884c\u60c5 API v1.0 \u7248\u672c\u4e2d\uff0c\u63a1\u7528\u4e86\u4e0d\u540c\u7684\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f\uff0c\u56e0\u6b64 v0.3 \u7684 API \u91d1\u9470\u5c07\u7121\u6cd5\u9069\u7528\u65bc v1.0 \u7684 HTTP API \u548c WebSocket API\u3002\u60a8\u9700\u8981\u91cd\u65b0\u7533\u8acb API \u91d1\u9470\u4ee5\u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684 API\u3002\u8acb\u524d\u5f80 \u91d1\u9470\u7533\u8acb\u9801\u9762 \u9032\u884c\u7533\u8acb https://developer.fugle.tw/docs/key/%E3%80%82</li> <li>\u65b0\u589e\u4e0b\u55ae API \u65bc\u300c\u66f4\u65b0\u59d4\u8a17\u55ae\u50f9\u683c\u300d\u6642\u652f\u63f4\u512a\u52e2\u50f9\u683c\u8cb7\u8ce3(extra_bid_pct)\u7684\u529f\u80fd\uff0c\u4ee5\u9ad8\u65bc\u6210\u4ea4\u50f9\u7684 x%\u8cb7\u5165\uff0c\u4f4e\u65bc\u6210\u4ea4\u50f9\u7684 x%\u8ce3\u51fa\u3002</li> </ul>"}, {"location": "change-log/#045-2023-07-05", "title": "0.4.5 (2023-07-05)", "text": ""}, {"location": "change-log/#fixes_5", "title": "Fixes \ud83d\udd27", "text": "<ul> <li>\u89e3\u6c7a\u4e86\u5728 hold_until \u4e2d rank \u53c3\u6578 inf \u5c0e\u81f4\u7684\u6392\u540d\u529f\u80fd\u5931\u6548\u554f\u984c\u3002</li> <li>\u4fee\u6b63\u4e86 alphalens \u5728 pandas 2.0 \u7248\u672c\u4e0a\u7684\u4e0d\u76f8\u5bb9\u554f\u984c\u3002</li> <li>\u89e3\u6c7a\u4e86\u6c38\u8c50 API \u4e0b\u55ae\u6642\uff0c\u96f6\u80a1\u5e02\u50f9\u7121\u6cd5\u4e0b\u55ae\u7684\u554f\u984c\uff0c\u73fe\u5728\u6539\u6210\u6f32\u8dcc\u505c\u4e0b\u55ae\u3002</li> <li>\u91dd\u5c0d candle plot \u7684\u6a19\u984c\u986f\u793a\u4f4d\u79fb\u554f\u984c\u9032\u884c\u4e86\u4fee\u6b63\u3002</li> <li>\u4fee\u6b63\u4e86 report.position \u4e1f\u5165 sim \u5f8c\u5f97\u5230\u4e00\u81f4\u7d50\u679c\u7684\u554f\u984c\u3002</li> <li>\u89e3\u6c7a\u4e86 edge ratio \u6642\u9593\u5e8f\u5217\u6392\u5e8f\u554f\u984c\uff0c\u73fe\u5728\u53ef\u4ee5\u6309\u6642\u9593\u9806\u5e8f\u6392\u5e8f\u3002</li> </ul>"}, {"location": "change-log/#features_22", "title": "Features \ud83d\ude80", "text": "<ul> <li>\u52a0\u5165 us_universe \u9078\u64c7\u7f8e\u80a1\u5b50\u7522\u696d\u7684\u529f\u80fd\u3002</li> <li>\u65b0\u589e\u4e0b\u55ae API \u652f\u63f4\u512a\u52e2\u50f9\u683c\u8cb7\u8ce3\u7684\u529f\u80fd\uff0c\u73fe\u5728\u53ef\u4ee5\u4ee5\u9ad8\u65bc\u6210\u4ea4\u50f9\u7684 x%\u8cb7\u5165\uff0c\u4f4e\u65bc\u6210\u4ea4\u50f9\u7684 x%\u8ce3\u51fa\u3002</li> </ul>"}, {"location": "change-log/#doc", "title": "Doc \ud83d\udcda", "text": "<ul> <li>\u65b0\u589e\u7f8e\u80a1\u7b56\u7565\u7bc4\u4f8b\uff0c\u63d0\u4f9b\u7528\u6236\u53c3\u8003\u548c\u5b78\u7fd2\u3002</li> <li>\u65b0\u589e\u5728 data.indicator \u4e2d\u4f7f\u7528\u7f8e\u80a1\u6642\u7684 market \u53c3\u6578\u8aaa\u660e\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u66f4\u5bb9\u6613\u7406\u89e3\u5176\u4f7f\u7528\u65b9\u5f0f\u3002</li> </ul>"}, {"location": "change-log/#043-2023-05-11", "title": "0.4.3 (2023-05-11)", "text": ""}, {"location": "change-log/#warnings-backtesting-result-and-performance-will-change", "title": "Warnings: Backtesting result and performance will change.", "text": ""}, {"location": "change-log/#features_23", "title": "Features \ud83d\ude80", "text": "<ul> <li>Improved RAM usage by removing sorting and swaplevel for machine learning features (e081c924).</li> <li>Optimized backtest report (8babbd7a).</li> <li>Implemented cross-validation for machine learning (e55828c0).</li> <li>support infomation for stop loss and take profit assets (5f9272f3).</li> <li>Hold_until functionality made available for US data (8437d62).</li> <li>Added indicators control in plot_stats (7364d58).</li> </ul>"}, {"location": "change-log/#fixes_6", "title": "Fixes \ud83d\udd27", "text": "<ul> <li>Fixed deadline considering business date for DataFrame (312f2fe1).</li> <li>Fixed the issue where a float object had no attribute 'month' (d51a5901).</li> <li>Fixed run_all_test (6203f56f).</li> <li>Prevented deletion during map iteration in backtest_core (2d1d9b05).</li> <li>Fixed login info (d177ed47).</li> <li>Fixed alpha annualize estimation in analysis (26a8becf).</li> <li>Fixed issue with short selling in online module (919521b9).</li> <li>Synced win_ratio in maeMfeAnalysis (a9a31189).</li> <li>Added rotc deadline in DataFrame (ac10597).</li> </ul>"}, {"location": "change-log/#refactoring", "title": "Refactoring \ud83d\udca1", "text": "<ul> <li>Refactored f_disclosure_date to_business_date, removed date too far, and improved speed (7dcb203b).</li> <li>Refactored market selection according to DataFrame columns (039cbc96).</li> <li>Fixed bugs and future warnings in the analysis module (ec93088f).</li> <li>Refactored environment name capitalization in login module (635caed4).</li> <li>Refactored login to use FINLAB_API_TOKEN (a5c9064d).</li> <li>Informed free users that data is limited (bbabad14).</li> </ul>"}, {"location": "change-log/#tests_1", "title": "Tests \ud83e\uddea", "text": "<ul> <li>Added test_hold_until (ccc4ba89).</li> </ul>"}, {"location": "change-log/#doc_1", "title": "Doc \ud83d\uddc2\ufe0f", "text": "<ul> <li>Updated daily_sortino documentation (b7d1d91d).</li> <li>Updated get_data documentation (276862c2).</li> </ul>"}, {"location": "change-log/#042-2023-04-27", "title": "0.4.2 (2023-04-27)", "text": ""}, {"location": "change-log/#_2", "title": "\u65b0\u589e\u529f\u80fd\uff1a", "text": "<ul> <li>\u5728\u6a5f\u5668\u5b78\u7fd2\u4e2d\u52a0\u5165\u4e86\u6a19\u7c64\u4ea4\u6613\u50f9\u683c\u7684\u529f\u80fd</li> <li>\u5728\u5831\u544a\u4e2d\u65b0\u589e\u4e86 report.display() \u7684\u4f7f\u7528\u8aaa\u660e</li> <li>\u5728\u5e02\u5834\u8cc7\u8a0a\u4e2d\u65b0\u589e\u4e86\u7f8e\u570b\u5e02\u5834\u8cc7\u8a0a</li> </ul>"}, {"location": "change-log/#_3", "title": "\u4fee\u5fa9\u554f\u984c\uff1a", "text": "<ul> <li>\u5728\u7dda\u4e0a\u7a0b\u5f0f\u4e2d\u4fee\u6b63\u4e86\u986f\u793a\u5b57\u4e32\u7684\u554f\u984c</li> <li>\u5c07\u56de\u6e2c\u529f\u80fd\u56de\u5fa9\u5230\u7a69\u5b9a\u7248\u672c</li> <li>\u8abf\u6574\u56de\u6e2c\u529f\u80fd\u4e2d\u6839\u64da\u9032\u51fa\u5834\u50f9\u683c\u8abf\u6574\u6301\u5009\u7684\u554f\u984c</li> <li>\u4fee\u6b63 qlib.init \u7684\u5075\u6e2c\u554f\u984c</li> <li>\u5728\u5831\u544a\u4e2d\u4fee\u6b63\u4e86\u57fa\u6e96\u6307\u6578\u6642\u5340\u7684\u554f\u984c</li> <li>\u8655\u7406\u4e86 pandas 2.0.0 \u7248\u672c\u517c\u5bb9\u6027\u554f\u984c</li> <li>\u8655\u7406\u4e86 talib \u4f9d\u8cf4\u6027\u554f\u984c</li> <li>\u4fee\u6b63\u4e86\u5728\u56de\u6e2c\u529f\u80fd\u4e2d\u9032\u51fa\u5834\u6bd4\u4f8b\u70ba nan \u7684\u554f\u984c</li> <li>\u5728\u6587\u6a94\u4e2d\u4fee\u6b63\u4e86 fugle Account numpy \u7684\u5f15\u7528\u554f\u984c</li> </ul>"}, {"location": "change-log/#_4", "title": "\u5176\u4ed6\uff1a", "text": "<ul> <li>\u5728\u6a5f\u5668\u5b78\u7fd2\u4e2d\u65b0\u589e\u4e86\u76f8\u95dc\u6587\u4ef6</li> <li>\u5728\u5e02\u5834\u8cc7\u8a0a\u4e2d\u65b0\u589e\u4e86\u76f8\u95dc\u6587\u4ef6</li> </ul>"}, {"location": "change-log/#041-2023-04-14", "title": "0.4.1 (2023-04-14)", "text": "<ul> <li>(fix): fugle np not found</li> </ul>"}, {"location": "change-log/#0319-2023-04-04", "title": "0.3.19 (2023-04-04)", "text": "<ul> <li>(improve): memory usage in machine learning feature creation</li> <li>(improve): machine learning feature for different freqnecy index</li> <li>(fix): data.indicator support almost all talib functions</li> <li>(fix): 2023/4/10 monthly revenue reveal change to 2023/4/12</li> <li>(fix): sinopac calculate account balance</li> </ul>"}, {"location": "change-log/#0318-2023-03-28", "title": "0.3.18 (2023-03-28)", "text": "<ul> <li>(Breaking): update shioaji &gt;= 1.0.0. Please refer to finlab.inline module</li> <li>(feat): finlab.ml (document are not ready yet)</li> <li>(feat): support qlib data</li> <li>(feat): report add yearly and monthly return table</li> <li>(fix): backtest entry exit signal both activate conflict</li> </ul>"}, {"location": "change-log/#0312-2022-11-29", "title": "0.3.12 (2022-11-29)", "text": "<ul> <li>(Breaking): report.get_stats() has new format</li> <li>(feat): data.get now read expire date from server and update data dynamically</li> <li>(feat): add a bunch of analysis for backtesting report</li> <li>(feat): getpass password to hide api_token</li> <li>(fix): report.weight and report.next_weights remove considering of price changed</li> <li>(fix): backtest(..., resample_offset='10d') fix backtesting display date</li> <li>(fix): finlab.online.order_executor show_alerting_stocks fix price</li> <li>(fix): fugle order status not change even when it is filled</li> <li>(fix): support update price of fraction lot size</li> </ul>"}, {"location": "change-log/#0311-2022-11-10", "title": "0.3.11 (2022-11-10)", "text": "<ul> <li>(Fix) finlab backtest asset shorting fee miner adjust</li> <li>(Fix) finlab.report.weights and finlab.report.next_weights not defined</li> <li>(Fix) fugle-trade remove flag accoding to 0.4.0</li> <li>(Fix) fugle-trade fetch other source when stock.close is nan</li> <li>(Fix) fugle-trade FugleAccount.get_position not latest position</li> <li>(Feat) finlab.data.universe('STOCK_FUTURE') subset of TWII stocks</li> <li>(Feat) add yearly return when upload report</li> <li>(Feat) add fugle_trade version not compatable warning</li> </ul>"}, {"location": "change-log/#0310-2022-10-13", "title": "0.3.10 (2022-10-13)", "text": ""}, {"location": "change-log/#039-2022-10-13", "title": "0.3.9 (2022-10-13)", "text": "<ul> <li>(Fix) finlab.online.sinopac_account order_lot position zero</li> <li>(Fix) finlab.online.fugle_account order_lot position duplicated</li> <li>(Fix) finlab.backtest weight display remove normalized</li> <li>(Fix) finlab.data windows FileStorage fix</li> <li>(Fix) finlab.data indicator exception error</li> </ul>"}, {"location": "change-log/#038-2022-9-27", "title": "0.3.8 (2022-9-27)", "text": "<ul> <li>(Fix) finlab.online.order_executor price +-10% limit order restricted</li> <li>(Fix) finlab.online.order_executor Position.from_report handle price=0, weight=0, and duplicated stock id</li> <li>(Fix) finlab.plot.StrategySunburst compatibility</li> <li>(Fix) finlab.report.display display multiple chart</li> </ul>"}, {"location": "change-log/#038dev1-2022-9-27", "title": "0.3.8.dev1 (2022-9-27)", "text": "<ul> <li>(Fix) talib abstract module incompatible</li> <li>(Fix) backtest result: alpha and beta</li> <li>(Fix) finlab.online.panel</li> <li>(Fix) finlab.online.fugle_account stock not traded error</li> <li>(Fix) add cert custom password for sinopac</li> <li>(Fix) remove duplicated columns from unnumeric_dtype.</li> <li>(Fix) KY company disclosure deadline</li> <li>(Chore) Candlestick data format generalized</li> <li>(Chore) raise error when data.get not found</li> <li>(Chore) logger.info to logger.warning in finlab.data</li> <li>(Chore) fig return for report.display</li> <li>(Feat) add retain_cost_when_rebalance flag</li> </ul>"}, {"location": "change-log/#037dev1-2022-8-8", "title": "0.3.7.dev1 (2022-8-8)", "text": "<ul> <li>\u91dd\u5c0d touched_exit \u505a\u66f4\u7d30\u90e8\u7684\u56de\u6e2c\uff1a</li> <li>\u539f\u672c\u89f8\u50f9\u53cd\u5f48\u5f8c\u4e0d\u6703\u88ab\u5217\u5165\u89f8\u50f9\u8ce3\u51fa\uff0c\u73fe\u5728\u6703\u6a21\u64ec\u89f8\u50f9\u8ce3\u51fa</li> <li>\u539f\u672c\u958b\u76e4\u8df3\u7a7a\uff0c\u6703\u6c92\u8fa6\u6cd5\u8ce3\u5728 0.07\uff0c\u73fe\u5728\u4e5f\u6703\u8ce3\u5728\u66f4\u4f4e\u7684\u4f4d\u7f6e</li> </ul>"}, {"location": "change-log/#035dev-2022-7-18", "title": "0.3.5.dev (2022-7-18)", "text": "<ul> <li>\u65b0\u589e finlab.optimize \u679a\u8209\u689d\u4ef6\u7d44\u5408\u56de\u6e2c</li> <li>\u65b0\u589e mae_mfe \u5716\u8868</li> <li>mae_mfe \u505a\u7a7a\u5206\u6790</li> <li>report.get_trades()['position'] \u6539\u6210 weighting</li> <li>backtest touched_exit \u4fee\u6b63</li> <li>\u4fee\u5fa9 finlab.analysis bugs</li> </ul>"}, {"location": "change-log/#033dev-2022-7-1", "title": "0.3.3.dev (2022-7-1)", "text": ""}, {"location": "change-log/#bugs", "title": "Bugs \u4fee\u6b63", "text": "<ul> <li>\u4fee\u6b63\u653e\u7a7a\u80a1\u7968\u7684 weight \u6b0a\u91cd\u986f\u793a\u554f\u984c</li> <li>TreeMap \u7e6a\u5716\u4fee\u6b63</li> <li>\u8ca1\u5831\u516c\u4f48\u6b77\u53f2\u6642\u9593\u4fee\u6b63</li> </ul>"}, {"location": "change-log/#analysis", "title": "Analysis \u5206\u6790\u56de\u6e2c\u7d50\u679c", "text": "<p>\u65b0\u589e Analysis \u67b6\u69cb\uff0c\u53ef\u4ee5\u5c07\u56de\u6e2c\u7d50\u679c\u5b8c\u6574\u5206\u6790\u3002 \u4e4b\u5f8c\u7684\u5206\u6790\u90fd\u5c07\u7e7c\u627f Analysis \u4e26\u4e14\u986f\u793a\u5716\u8868\uff0c\u8b93 report \u4f7f\u7528\u8d77\u4f86\u66f4\u8c50\u5bcc\uff01</p>"}, {"location": "change-log/#liquidityanalysis", "title": "liquidityAnalysis \u6d41\u52d5\u6027\u6e2c\u8a66", "text": "<p>\u7b56\u7565\u6703\u6a21\u64ec\u80a1\u7968\u5728\u6536\u76e4\u6216\u958b\u76e4\u50f9\u8cb7\u9032\u8ce3\u51fa\uff0c\u4f46\u5be6\u969b\u4e0a\uff0c\u80a1\u7968\u4e5f\u6709\u53ef\u80fd\u6c92\u8fa6\u6cd5\u9806\u5229\u4ea4\u6613\uff0c\u4f8b\u5982\u9047\u5230\u8655\u7f6e\u80a1\u3001\u5168\u984d\u4ea4\u5272\u80a1\uff0c\u6216\u662f\u9577\u8dcc\u505c\u677f\u3002 liquidityAnalysis \u6703\u6aa2\u6e2c\u56de\u6e2c\u6642\uff0c\u662f\u5426\u6709\u8cb7\u5230\u9019\u985e\u884c\u7684\u6a19\u7684\uff0c\u4e26\u4e14\u8a08\u7b97\u6bd4\u4f8b\uff0c\u5df2\u78ba\u4fdd\u7b56\u7565\u7684\u6d41\u52d5\u6027\u7b26\u5408\u60a8\u7684\u8cc7\u91d1\u9700\u6c42\u3002 \u67e5\u770b\u66f4\u8a73\u7d30\u7684\u6559\u5b78\u6587\u7ae0\u3002</p> <pre><code>report.run_analysis('LiquidityAnalysis')\n</code></pre>"}, {"location": "change-log/#inequalityanalysis", "title": "inequalityAnalysis \u4e0d\u7b49\u5f0f\u6e2c\u8a66", "text": "<p>\u539f\u672c\u5df2\u7d93\u6709\u7b56\u7565\uff0c\u60f3\u8981\u984d\u5916\u52a0\u5165\u5176\u4ed6\u6280\u8853\u6307\u6a19\u3001\u7c4c\u78bc\u3001\u7372\u5229\u6307\u6a19\uff0c\u53ef\u4ee5\u900f\u904e inequalityAnalaysis \u4f86\u6aa2\u8996\u662f\u5426\u80fd\u5920\u63d0\u9ad8\u9078\u80a1\u7e3e\u6548\u3002 \u4ee5\u80a1\u50f9\u6de8\u503c\u6bd4\u800c\u8a00\uff0c\u6211\u5011\u60f3\u89c0\u5bdf\u4ee5\u80a1\u50f9\u6de8\u503c\u6bd4\u4f86\u9032\u4e00\u6b65\u7be9\u9078\u80a1\u7968\u7684\u7e3e\u6548\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u7684\u65b9\u5f0f\uff1a</p> <pre><code>report.run_analysis('InequalityAnalysis', name='price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\n</code></pre> <p>\u8981\u5982\u4f55\u770b\u7d50\u679c\uff0c\u53ef\u4ee5\u53c3\u8003\u66f4\u8a73\u7d30\u7684\u6559\u5b78\u6587\u7ae0\u3002</p>"}, {"location": "change-log/#032dev-2022-6-23", "title": "0.3.2.dev (2022-6-23)", "text": ""}, {"location": "change-log/#sunburst", "title": "SunBurst \u6aa2\u8996\u7b56\u7565\u90e8\u4f4d", "text": "<p>\u53ef\u4ee5\u986f\u793a\u7576\u524d\u7684\u80a1\u7968\uff0c\u6709\u54ea\u4e9b\u7522\u696d\uff0c\u7522\u696d\u7684\u504f\u91cd\u662f\u54ea\u4e00\u584a\uff0c\u67e5\u770b\u8a73\u7d30\u5167\u5bb9\uff01</p>"}, {"location": "change-log/#_5", "title": "\u505a\u7a7a\u4ee5\u53ca\u500b\u80a1\u6b0a\u91cd", "text": "<p>FinLab Package \u7d42\u65bc\u652f\u63f4\u505a\u7a7a\u4e86\uff0c\u5047\u5982\u4f60\u539f\u672c\u5c31\u6709\u4e00\u500b\u597d\u7b56\u7565\uff0c\u53ef\u4ee5\u505a\u7a7a 0050 \u8a66\u8a66\u770b\uff0c\u96d6\u7136\u5831\u916c\u7387\u53ef\u4ee5\u80fd\u6703\u4e0b\u964d\uff0c\u4f46\u662f\u98a8\u96aa\u4e5f\u6703\u5927\u5e45\u7e2e\u5c0f\uff01\u975e\u5e38\u9069\u5408\u6211\u5011\u505a\u591a\u6a94\u80a1\u7968\u8cc7\u7522\u914d\u7f6e\u4f7f\u7528\u3002</p> <p>\u53e6\u5916\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u65b0\u7684\u7248\u672c position \u9664\u4e86\u4ee5\u524d\u7684\u5e03\u6797\u8a0a\u865f (True/False) \u5916\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6b0a\u91cd\uff01\u6240\u4ee5\u4e0b\u65b9\u7a0b\u5f0f\u78bc\uff0c\u5c31\u662f 50% \u6bd4\u91cd\u7d66 2330 \u505a\u591a\uff0c50% \u7d66 1101 \u505a\u7a7a\u3002</p> <p>\u9019\u6a23\u7684\u6b0a\u91cd\u5206\u914d\u65b9\u5f0f\uff0c\u5b8c\u5168\u517c\u5bb9\u4e4b\u524d\u7684\u7248\u672c\uff0c\u4e5f\u5c31\u662f position \u662f True / False \u7684\u72c0\u6cc1\uff0c\u56e0\u70ba True \u5728\u96fb\u8166\u904b\u7b97\u4e2d\uff0c\u672c\u4f86\u5c31\u4ee3\u8868 1 \uff0c\u800c False \u4ee3\u8868 0\u3002\u6b0a\u91cd\u90fd\u662f 1 \u7684\u60c5\u6cc1\u4e0b\uff0c\u7a0b\u5f0f\u5c31\u6703\u8ddf\u4ee5\u524d\u4e00\u6a23\u5e73\u5747\u5206\u914d\u8cc7\u7522\u5594\u3002</p> <pre><code>from finlab import data\nfrom finlab import backtest\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\nposition = close &lt; 0\nposition['2330'] = 0.5\nposition['1101'] = -0.5\n\nr = backtest.sim(position)\nr.display()\n</code></pre>"}, {"location": "change-log/#pandas_ta", "title": "\u652f\u63f4 Pandas_ta \u8a08\u7b97\u6280\u8853\u6307\u6a19", "text": "<p>Pandas_ta \u6700\u8fd1\u4e00\u5169\u5e74\u7b97\u662f\u8a08\u7b97\u6280\u8853\u6307\u6a19\u7684\u5f8c\u8d77\u4e4b\u79c0\uff0c\u539f\u56e0\u5728\u65bc TaLib \u6709\u6642\u5019\u5be6\u592a\u96e3\u5b89\u88dd\u4e86\uff0c\u800c\u4e14\u6280\u8853\u6307\u6a19\u5c31\u53ea\u6709\u90a3 100 \u500b\uff0c\u90fd\u662f\u8001\u8abf\u91cd\u5f48\uff0c\u6c92\u6709\u66f4\u65b0\u3002\u6709\u9452\u65bc\u6b64\uff0cPandas_ta \u63a1\u7528\u7d14 Pandas \u8a08\u7b97\u6280\u8853\u6307\u6a19\uff0c\u8ddf\u4e0d\u540c\u7684\u4f5c\u696d\u7cfb\u7d71\u6709\u6bd4\u8f03\u597d\u7684\u76f8\u5bb9\u6027\u3002\u53e6\u5916\uff0cPandas_ta \u4e5f\u6709\u5f88\u591a\u6700\u65b0\u7684\u6280\u8853\u6307\u6a19\uff0c\u4f8b\u5982 supertrend indicator\u3002\u6709\u975e\u5e38\u591a\u6c92\u6709\u770b\u904e\u7684\u6307\u6a19\uff0c\u50cf\u662f\u300cEven Better Sinewave \u300d\uff0c\u807d\u8d77\u4f86\u5be6\u5728\u662f\u975e\u5e38\u6709\u8da3\u5440\uff01\u9019\u4e9b\u90fd\u53ef\u4ee5\u5728 Pandas_ta \u6587\u6a94\u4e2d\u627e\u5230\u3002</p> <pre><code>from finlab import data\n\nvalues = data.indicator('supertrend')\n</code></pre>"}, {"location": "faq/", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "faq/#ai", "title": "AI \u7de8\u7a0b\u52a9\u624b", "text": "\u5982\u4f55\u4f7f\u7528 AI \u52a9\u624b\u64b0\u5beb FinLab \u7b56\u7565\uff1f <p>FinLab \u63d0\u4f9b\u5b98\u65b9 AI Skill\uff0c\u53ef\u5b89\u88dd\u81f3 Claude Code\u3001Cursor\u3001Windsurf \u7b49 AI \u7de8\u7a0b\u5de5\u5177\u4e2d\uff0c\u8b93 AI \u719f\u6089\u6574\u5957 API\u3002</p> <p>\u5b89\u88dd\u65b9\u5f0f\uff1a\u524d\u5f80 finlab.finance \u4f9d\u7167\u6307\u793a\u5b89\u88dd\u3002</p> <p>\u5b89\u88dd\u5f8c\u53ef\u4ee5\u505a\u4ec0\u9ebc\uff1a</p> <ul> <li>\u8a62\u554f\u300c\u5e6b\u6211\u7528\u71df\u6536\u6210\u9577\u548c\u6280\u8853\u7a81\u7834\u5beb\u4e00\u500b\u9078\u80a1\u7b56\u7565\u300d\uff0cAI \u6703\u7522\u751f\u53ef\u57f7\u884c\u7684\u7a0b\u5f0f\u78bc</li> <li>\u8a62\u554f\u300c<code>data.get</code> \u6709\u54ea\u4e9b\u8ca1\u5831\u76f8\u95dc\u7684\u8cc7\u6599\u8868\uff1f\u300d\uff0cAI \u6703\u5217\u51fa\u6b63\u78ba\u7684\u9375\u540d</li> <li>\u8cbc\u4e0a\u932f\u8aa4\u8a0a\u606f\uff0cAI \u6703\u5e6b\u4f60\u8a3a\u65b7\u4e26\u4fee\u6b63</li> <li>\u8981\u6c42\u300c\u5e6b\u6211\u628a\u9019\u500b\u7b56\u7565\u52a0\u4e0a 10% \u505c\u640d\u4e26\u56de\u6e2c\u300d\uff0cAI \u6703\u76f4\u63a5\u4fee\u6539\u7a0b\u5f0f\u78bc</li> </ul> <p>\u8a73\u7d30\u8aaa\u660e\u8acb\u53c3\u8003\u5feb\u901f\u4e0a\u624b\u3002</p> AI Skill \u548c studio.finlab.tw \u6709\u4ec0\u9ebc\u4e0d\u540c\uff1f <ul> <li>studio.finlab.tw\uff1a\u7dda\u4e0a AI \u5e73\u53f0\uff0c\u4e0d\u9700\u5b89\u88dd\u4efb\u4f55\u6771\u897f\uff0c\u76f4\u63a5\u5728\u700f\u89bd\u5668\u4e2d\u5c0d\u8a71\u64b0\u5beb\u7b56\u7565\u3002</li> <li>FinLab Skill\uff1a\u5b89\u88dd\u81f3\u672c\u6a5f AI \u7de8\u7a0b\u5de5\u5177\uff08Claude Code\u3001Cursor \u7b49\uff09\uff0cAI \u53ef\u76f4\u63a5\u5728\u4f60\u7684\u958b\u767c\u74b0\u5883\u4e2d\u8b80\u5beb\u6a94\u6848\u3001\u57f7\u884c\u7a0b\u5f0f\u78bc\u3001\u9664\u932f\u3002\u9069\u5408\u5df2\u6709\u672c\u6a5f\u958b\u767c\u74b0\u5883\u7684\u9032\u968e\u7528\u6236\u3002</li> </ul>"}, {"location": "faq/#_2", "title": "\u767b\u5165\u9a57\u8b49\u76f8\u95dc", "text": "\u627e\u4e0d\u5230<code>api_token</code>\u7684\u8f38\u5165\u6846\uff0c\u5c0e\u81f4\u7121\u6cd5\u6293\u53d6\u8cc7\u6599\u600e\u9ebc\u8fa6\u5462\uff1f <p>\u53ef\u80fd\u60a8\u662f\u4f7f\u7528VSCode\u3001\u6216\u5176\u4ed6IDE\uff0c\u5728\u7a0b\u5f0f\u6700\u524d\u9762\u52a0\u4e0a\u4ee5\u4e0b\u8a9e\u6cd5\uff0c\u4e5f\u80fd\u76f4\u63a5\u767b\u5165\u645f <pre><code>import finlab\nfinlab.login('\u60a8\u7684api_token')\n</code></pre></p>"}, {"location": "faq/#_3", "title": "\u8cc7\u6599\u4e0b\u8f09", "text": "\u6293\u4e0d\u5230\u5b8c\u6574\u8cc7\u6599\uff1f\u70ba\u4ec0\u9ebc\u8cc7\u6599\u7bc4\u570d\u53ea\u52302020\u5e74\u5462\uff1f <p>\u56e0\u70ba\u60a8\u5c1a\u672a\u8a02\u95b1VIP\uff0c\u5c0d\u672a\u8a02\u95b1VIP\u6703\u54e1\u6211\u5011\u53ea\u958b\u653e\u81f32020\u5e74\u5e95\u7684\u8cc7\u6599\uff0c\u53ef\u4ee5\u8003\u616e\u8a02\u95b1\u8d77\u4f86\uff01 \u5373\u53ef\u4f7f\u7528\u622a\u6b62\u81f3\u6700\u65b0\u4ea4\u6613\u65e5\u7684\u6b77\u53f2\u8cc7\u6599\u3002</p> \u70ba\u4ec0\u9ebc\u8f09\u4e0b\u4f86\u7684\u8cc7\u6599\u4e2d\uff0c\u53ea\u6709index\u6709\u503c\uff0cvalue\u7686\u70ba\u7a7a\u503c\u5462\uff1f <p>\u60a8\u53ef\u80fd\u6709\u8a2d\u5b9a\u5230<code>set_universe</code>\uff0c\u57f7\u884c<code>data.universe_stocks = {}</code> \u6216\u662f\u6574\u500bkernal\u91cd\u555f\u5f8c\u518d\u57f7\u884c\u539f\u7a0b\u5f0f\u78bc\u5373\u53ef\u3002</p>"}, {"location": "faq/#_4", "title": "\u5e38\u7528\u7b56\u7565\u8a9e\u6cd5\u554f\u984c", "text": "\u6bcf\u7a2e\u8ca1\u7d93\u8cc7\u6599\u7684 index \u6c92\u6709\u5c0d\u9f4a\uff0c\u8981\u7528 reindex \u53bb\u505a\u904b\u7b97\uff1f <p>\u4e0d\u9700\u8981\uff0c\u9019\u6a23\u6703\u82b1\u8cbb\u5927\u91cf\u6642\u9593\u5728\u505a\u8cc7\u6599\u7684\u8abf\u6574\uff0c\u5728 finlab package \u4e2d\uff0c\u6240\u6709\u4ee5 <code>data.get</code> \u6240\u62ff\u53d6\u7684\u8cc7\u6599\uff0c\u5728\u505a\u4e8c\u5143\u904b\u7b97\u6642\uff0c\u90fd\u6703\u5077\u5077\u5e6b\u4f60\u81ea\u52d5\u5c0d\u9f4a\uff0c\u60a8\u4e0d\u9700\u8981\u82b1\u8cbb\u4efb\u4f55\u6642\u9593\u4f86\u5c0d\u9f4a\u8cc7\u6599\uff0c\u4ee5\u4e0b\u70ba\u4f8b\u5b50\u3002 \u4f8b\u5982\u6211\u5011\u62ff\u53d6\u6b64\u8cc7\u6599\uff1a <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nroa = data.get('fundamental_features:ROA\u7a05\u5f8c\u606f\u524d')\n</code></pre> \u6b64\u6642 <code>close</code> \u4ee5\u53ca <code>roa</code> \u90fd\u662f <code>FinlabDataFrame</code>\uff0c\u6240\u4ee5\u8207\u5176\u9019\u6a23\u88fd\u4f5c\u689d\u4ef6</p> <pre><code>roa_daily = roa.reindex(close.index, method='ffill')\n\ncondition = (close &lt; 30) &amp; (roa_daily &gt; 0)\n</code></pre> <p>\u60a8\u53ef\u4ee5\u5316\u7c21\u5982\u4e0b</p> <pre><code>condition = (close &lt; 30) &amp; (roa &gt; 0)\n</code></pre> <p>\u5728\u505a\u9019\u4e9b\u56db\u5247\u904b\u7b97\u6216\u4e0d\u7b49\u5f0f\u904b\u7b97\u6642\uff0c\u6211\u5011\u6703\u5077\u5077\u5e6b\u4f60\u8a08\u7b97 <code>roa_daily</code>\uff0c\u6240\u4ee5\u60a8\u4e0d\u9700\u8981\u89aa\u81ea\u52d5\u624b\u5beb\u5594\uff01</p> \u60f3\u8981\u5728\u7279\u5b9a\u6708\u4efd\u505c\u6b62\u4ea4\u6613\uff0c\u8981\u600e\u9ebc\u5728\u56de\u6e2c\u4e2d\u6392\u9664\u7279\u5b9a\u6708\u4efd\u5462\uff1f <p>\u4ee57,8\u6708\u4e0d\u8981\u6709\u7b56\u7565\u8a0a\u865f\u70ba\u4f8b\uff0c\u5c07month_condition\u8207\u5176\u4ed6\u689d\u4ef6\u53d6\u4ea4\u96c6\u5373\u53ef\u3002 <pre><code>month_condition = close.index.to_series().apply(lambda x:x.month not in [7,8])\n</code></pre></p> \u8981\u5982\u4f55\u5c07\u8cc7\u6599\u5eab\u4e2d\u4f8b\u5982\u300c\u4f01\u696d\u57fa\u672c\u8cc7\u8a0a\u300d\u7684\u7279\u5b9a\u6b04\u4f4d\u6574\u7406\u6210\u50cf\u5176\u4ed6\u56de\u6e2c\u8cc7\u6599\u540c\u6a23\u7684\u683c\u5f0f\u5462\uff1f(index\u70badate\u3001columns\u70bastock_id)\" <p>\u4ee5\u6574\u7406\u300c\u5df2\u767c\u884c\u666e\u901a\u80a1\u6578\u6216TDR\u539f\u767c\u884c\u80a1\u6578\u300d\u6b04\u4f4d\u70ba\u4f8b\uff1a <pre><code>from finlab.dataframe import FinlabDataFrame\nfrom finlab import data\nbasic_info = data.get('company_basic_info')\nbasic_info.index = basic_info.stock_id\n\u71df\u696d\u6536\u5165 = data.get('financial_statement:\u71df\u696d\u6536\u5165\u6de8\u984d')\n\u6d41\u901a\u5728\u5916\u80a1\u6578 = basic_info['\u5df2\u767c\u884c\u666e\u901a\u80a1\u6578\u6216TDR\u539f\u767c\u884c\u80a1\u6578']\n\u6d41\u901a\u5728\u5916\u80a1\u6578 = FinlabDataFrame(pd.DataFrame([list(\u6d41\u901a\u5728\u5916\u80a1\u6578)], columns=basic_info.index, index=\u71df\u696d\u6536\u5165.index))\n</code></pre></p>"}, {"location": "faq/#_5", "title": "\u7b56\u7565\u56de\u6e2c", "text": "\u70ba\u4f55\u6c92\u6709\u6b63\u78ba\u7684\u505c\u640d\u505c\u5229\uff1f <p>\u7576\u4f7f\u7528 <pre><code>report = sim(position, stop_loss=0.1)\n</code></pre> \u7684\u6642\u5019\uff0c\u5c31\u7b97\u662f stop_loss \u6709\u958b\u555f\uff0c\u7576\u5075\u6e2c\u5230 position \u7576\u5929\u6709\u90e8\u4f4d\u6642\uff0c\u9084\u662f\u512a\u5148\u4ee5 position \u70ba\u6e96\u3002\u9664\u975e\u60a8\u7684 position index \u662f\u7a00\u758f\u7684\u72c0\u6cc1\u4e0b\uff08\u4f8b\u5982 index \u53ea\u6709\u6bcf\u500b\u6708\uff09\uff0c\u7cfb\u7d71\u67e5\u627e\u4e0d\u5230\u7576\u5929\u9700\u8a2d\u5b9a\u7684\u90e8\u4f4d\u6642\uff0c\u624d\u6703\u4ee5 stop_loss \u4f86\u76e3\u6e2c\u662f\u5426\u8ce3\u51fa\u3002 </p> <p>\u4f60\u53ef\u80fd\u6703\u89ba\u5f97\u9019\u6a23\u4e0d\u592a\u76f4\u89ba\uff0c\u4f46\u662f\u8a2d\u60f3\u5047\u5982\u505c\u640d\u5f8c\uff0c\u9084\u662f\u7dad\u6301 position \u662f True\uff0c\u90a3\u660e\u5929\u7a76\u7adf\u662f\u5df2\u7d93\u505c\u640d\u9084\u662f\u61c9\u8a72\u91cd\u65b0\u8cb7\u5165\uff1f\u5c31\u6703\u8b8a\u6210\u5927\u54c9\u554f\u3002\u6240\u4ee5\u5047\u5982 position \u662f True\uff0c\u5c31\u4ee5 position \u70ba\u6e96\uff0c\u800c\u4e0d\u984d\u5916\u505c\u640d\uff0c\u662f\u6700\u55ae\u7d14\u7684\u65b9\u5f0f\u3002 </p> <p>\u5047\u5982\u60a8\u7684 position \u7684 index \u662f\u6bcf\u500b\u4ea4\u6613\u65e5\uff0c\u78ba\u5be6\u6703\u5c0e\u81f4 stop_loss \u6c92\u6709\u4f5c\u7528\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <ol> <li>\u5047\u5982\u60a8\u525b\u597d\u6709\u4f7f\u7528 hold_until \u4f86\u88fd\u4f5c position \u6642\uff0c\u53ef\u4ee5\u4f7f\u7528 <pre><code># \u539f\u672c\u7684\nposition = buy.hold_until(sell)\n# \u6709\u505c\u640d\u7684\nposition = buy.hold_until(sell, stop_loss=0.1)\n</code></pre></li> <li>\u5047\u5982\u60a8\u539f\u672c\u5c31\u6c92\u6709\u4f7f\u7528 hold_until\uff0c\u5247\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4f86\u8a2d\u5b9a <pre><code>position.is_entry().hold_until(position.is_exit(), stop_loss=0.1) \n</code></pre> \u4f86\u8a2d\u5b9a\u505c\u640d\u505c\u5229</li> </ol> \u8a72\u5982\u4f55\u512a\u5316\u8207\u9a57\u8b49\u7b56\u7565\uff1f <p>\u8a73\u7d30\u6982\u5ff5\u53ef\u53c3\u8003\uff1a https://www.finlab.tw/phcebus-thinking-report-part2-backtest-sop/ \u4e26\u900f\u904eFinlab\u56de\u6e2c\u7cfb\u7d71\u9032\u884c\u5be6\u4f5c\u3002</p> \u5728local\u6216colab\u57f7\u884c\u56de\u6e2c\u6642\uff0c\u53ef\u4ee5\u4e0d\u8981\u5370\u51fa\u7db2\u9801\u5831\u8868\u55ce\uff1f <p>\u5728sim\u56de\u6e2c\u6a21\u7d44\u4e2d\u8a2d\u5b9a\u53c3\u6578upload=False\u5373\u53ef\u3002 <pre><code>report = sim(position, upload=False)\n</code></pre></p> \u70ba\u4ec0\u9ebc\u56de\u6e2c\u51fa\u4f86\u7684\u5831\u916c\u8ddf\u81ea\u5df1\u7b97\u51fa\u4f86\u7684\u90fd\u4e0d\u4e00\u6a23\u5462\uff1f <p>\u53ef\u4ee5\u5148\u6aa2\u67e5\u662f\u5426\u5df2\u7528\u9084\u539f\u80a1\u50f9\u8a08\u7b97\u3001\u78ba\u8a8d\u7b56\u7565\u9032\u51fa\u5834\u78ba\u5207\u6642\u9593\u9ede\u3001\u662f\u4f7f\u7528\u6293\u958b\u76e4\u6216\u6536\u76e4\u50f9\u3002\u82e5\u4f9d\u7136\u6709\u7591\u616e\u53ef\u81f3Discord\u8ad6\u58c7\u5340\u8a0e\u8ad6\u3002</p> report\u7684display_mae_mfe_analysis\uff0cEdge ratio\u70ba\u4ec0\u9ebc\u6c92\u6709\u986f\u793a\uff1f <p>\u9700\u5728<code>sim</code>\u56de\u6e2c\u6a21\u7d44\u4e2d\u8a2d\u5b9a\u53c3\u6578<code>mae_mfe_window</code>\uff0c\u53c3\u8003 https://doc.finlab.tw/reference/backtest/ \u3002</p> \u600e\u9ebc\u9032\u4e00\u6b65\u5ba2\u88fd\u5316\u63db\u80a1\u983b\u7387\u5462\uff1f(resample\u7684\u9032\u968e\u61c9\u7528\uff1f)\" <p>\u53ef\u53c3\u8003pandas\u6587\u4ef6\u8aaa\u660e https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.resample.html \uff0c\u76f4\u63a5\u4f7f\u7528\u65bc\u653e\u5165\u56de\u6e2c\u6a21\u7d44\u524d\u7684position\u3002</p> \u5728\u5e73\u53f0\u4e0a\u57f7\u884c\u9047\u5230MemoryError\u8981\u600e\u9ebc\u89e3\u6c7a\u5462\uff1f <p>\u8d85\u904e\u7db2\u9801\u8a18\u61b6\u9ad4\u9650\u5236\uff0c\u5efa\u8b70\u79fb\u81f3 Google Colab \u4f7f\u7528\u3002</p> \u7b56\u7565\u540d\u7a31\u65c1\u7684\u7da0\u9ede\u9ede\u662f\u4ec0\u9ebc\u610f\u601d\uff1f <p>\u8868\u793a\u8a72\u7b56\u7565\u70ba\u8a0a\u865f\u7570\u52d5\u65e5\u6216\u63db\u80a1\u65e5\u3002</p>"}, {"location": "faq/#_6", "title": "\u74b0\u5883\u76f8\u95dc", "text": "Talib\u8981\u5982\u4f55\u5b89\u88dd\uff1f <ul> <li>\u5728 Google Colab: \u53ef\u4ee5\u4f7f\u7528\u8a9e\u6cd5<code>!pip install ta-lib-bin</code> \u4f86\u9032\u884c\u5b89\u88dd</li> <li>\u900f\u904e conda \u5b89\u88dd\uff1a\u5728\u5176\u4ed6 kernel: \u57f7\u884c <code>$ conda install -c conda-forge ta-lib</code> \u4f86\u9032\u884c\u5b89\u88dd</li> <li>MacOS \u5b89\u88dd\uff1a\u8acb\u5148\u5b89\u88dd Homebrew\uff0c\u4e26\u4e14\u4f7f\u7528 <code>brew install ta-lib</code> \u4f86\u9032\u884c\u5b89\u88dd\uff0c</li> <li>Windows \u5b89\u88dd\uff1a\u53ef\u4ee5\u81f3 https://www.lfd.uci.edu/~gohlke/pythonlibs/#ta-lib \u4e0b\u8f09\u76f8\u61c9\u7248\u672cwheel\uff0c\u4e26\u5728\u4e0b\u8f09\u8def\u5f91\u57f7\u884c <code>$ pip install \u6a94\u6848\u5168\u540d.whl</code></li> </ul> \u8981\u5982\u4f55\u5728colab\u5c07\u8cc7\u6599\u532f\u51fa\uff1f\u5982\u4f55\u532f\u5165\u8cc7\u6599\u4e26\u8a2d\u5b9a\u6b63\u78ba\u8def\u5f91\uff1f <p>\u9700\u639b\u63a5google \u96f2\u7aef\u786c\u789f\uff0c\u53ef\u5728\u9801\u9762\u5de6\u5074\u300c\u6a94\u6848\u300d\u9078\u55ae\u4e2d\u9ede\u9078\u300c\u639b\u63a5\u96f2\u7aef\u786c\u789f\u300d\uff0c\u6216\u76f4\u63a5\u8f38\u5165\u4e26\u57f7\u884c\uff1a <pre><code>from google.colab import drive\ndrive.mount('/content/drive')\n</code></pre> \u5176\u4e2d\u300c/drive/MyDrive\u300d\u5373\u70bagoogle\u96f2\u7aef\u786c\u789f\u6839\u76ee\u9304\u3002</p> \u5728\u672c\u6a5f\u6216colab\u8dd1\u7684\u56de\u6e2c\u7e3e\u6548\u8ddf\u5e73\u53f0\u4e0a\u8dd1\u51fa\u4f86\u7684\u4e0d\u4e00\u6a23\uff1f <p>\u4ee5\u5728\u672c\u6a5f\u6216colab\u4f7f\u7528\u6700\u65b0\u7248\u5957\u4ef6\u57f7\u884c\u7684\u7d50\u679c\u70ba\u6e96\u3002</p> \u624b\u6a5f\u9069\u5408\u64cd\u4f5c FinLab \u91cf\u5316\u5e73\u53f0\u55ce\uff1f <p>\u82e5\u662f\u67e5\u770b\u5404\u7b56\u7565\u7e3e\u6548\u3001\u5176\u4ed6\u500b\u80a1\u3001\u7522\u696d\u8cc7\u8a0a\u7b49\uff0c\u7528\u624b\u6a5f\u662f\u53ef\u884c\u7684\uff1b\u4e0d\u904e\u82e5\u6b32\u64b0\u5beb\u7b56\u7565\u4e26\u57f7\u884c\uff0c\u56e0\u8a18\u61b6\u9ad4\u9650\u5236\u8003\u91cf\uff0c\u5efa\u8b70\u4ee5\u96fb\u8166\u4f86\u4f7f\u7528\u70ba\u4e3b\u3002</p>"}, {"location": "faq/#_7", "title": "\u4e0b\u55ae\u9032\u51fa\u5834", "text": "\u5728finlab\u5e73\u53f0\u7121\u6cd5\u76f4\u63a5\u57f7\u884c\u4e0b\u55ae\uff1f <p>\u662f\u7684\uff0c\u5982\u9700\u4e32\u63a5\u4e0b\u55aeAPI\uff0c\u9700\u4f7f\u7528\u5176\u4ed6\u74b0\u5883\u9032\u884c\u64cd\u4f5c\u3002</p> \u8981\u5982\u4f55\u4e32\u63a5\u5238\u5546API\u4e0b\u55ae\u5462\uff1f <p>Finlab\u6709\u8207\u6c38\u8c50\u8b49\u5238\u3001\u7389\u5c71Fugle\u5408\u4f5c\uff0c\u53ef\u5728\u958b\u7acb\u76f8\u95dc\u5e33\u6236\u5f8c\u67e5\u95b1\u6587\u4ef6\u958b\u59cb\u4e32\u63a5\uff0c\u5167\u6587\u4ea6\u9644\u6709\u6559\u5b78\u5f71\u7247\uff0c\u4f9d\u6b65\u9a5f\u57f7\u884c\u5373\u53ef\uff1a https://doc.finlab.tw/details/order_api/</p> \u4e0b\u55ae\u6642\u5982\u4f55\u907f\u514d\u51fa\u6389\u975e\u8a72\u7b56\u7565\u7684\u90e8\u4f4d\uff1f <p>\u5148\u5275\u5efaPosition\u7269\u4ef6\u4e26\u5b9a\u7fa9\u624b\u55ae\u90e8\u4f4d(\u975e\u8a72\u6b21\u7b56\u7565\u76f8\u95dc\u7684\u90e8\u4f4d)\uff0c\u5728OrderExecutor\u7684position\u653e\u5165\u8a72\u7b56\u7565\u90e8\u4f4d\u8207\u624b\u55ae\u90e8\u4f4d\u7684\u52a0\u7e3d\uff0c\u5373\u53ef\u76f4\u63a5\u4e0b\u55ae\u3002</p> \u932f\u904e\u7b56\u7565\u7684\u9032\u51fa\u5834\u65e5\u671f\uff0c\u8a72\u600e\u9ebc\u8fa6\uff1f <p>\u53ef\u85c9\u7531Edge Ratio\u5206\u6790\u4f86\u5224\u65b7\u662f\u5426\u9069\u5408\u4e2d\u9014\u9032\u5834\uff0c\u8a73\u7d30\u8aaa\u660e\u8acb\u898bBen\u5927\u6587\u7ae0\u89e3\u8aaa\uff1ahttps://www.finlab.tw/edge-ratio-follow-application/</p>"}, {"location": "faq/#_8", "title": "\u5e73\u53f0\u4f7f\u7528", "text": "\u54ea\u88e1\u80fd\u8a2d\u5b9a\u7b56\u7565\u81ea\u52d5\u66f4\u65b0\uff0c\u4e0d\u60f3\u6bcf\u5929\u6309\uff1f <p>\u5728\u5e73\u53f0\u7b56\u7565\u9801\u9762\u4e0a\u65b9\uff0c\u6309\u4e0b\u300c\u81ea\u52d5\u66f4\u65b0\u300d\uff0c\u5373\u53ef\u9078\u64c7\u6b32\u66f4\u65b0\u4e4b\u7b56\u7565\u3001\u8a2d\u5b9a\u6642\u9593\u4f86\u9032\u884c\u6bcf\u65e5\u81ea\u52d5\u66f4\u65b0\u3002</p> \u7b56\u7565\u8a0a\u865f\u6709\u7570\u52d5\uff0c\u6703\u6709\u901a\u77e5\u529f\u80fd\u55ce\uff1f <p>\u5728\u5e73\u53f0\u4e0a\u6709\u8a2d\u5b9a\u81ea\u52d5\u66f4\u65b0\u4e4b\u7b56\u7565\uff0c\u5c07\u5728\u8a0a\u865f\u51fa\u73fe\u7570\u52d5\u6642\uff0c\u5bc4\u51famail\u901a\u77e5(\u901a\u77e5\u5728\u5de5\u4f5c\u65e50600~0700\u4e4b\u9593\u5bc4\u51fa)\u3002</p> \u7b56\u7565\u6e05\u55ae\uff0c\u300c\u7576\u524d\u7d71\u8a08\u300d\u548c\u300c\u8fd1\u671f\u66f4\u52d5\u6e05\u55ae\u300d\u7684\u5dee\u7570\u5728\u54ea\uff1f <p>\u7576\u524d\u7d71\u8a08\u6e05\u55ae\u5305\u542b\u7b56\u7565\u76ee\u524d\u5be6\u969b\u6301\u80a1\uff0c\u8fd1\u671f\u66f4\u52d5\u6e05\u55ae\u9664\u4e86\u76ee\u524d\u5be6\u969b\u6301\u80a1\u3001\u4e5f\u5305\u542b\u8fd1\u671f\u5404\u500b\u80a1\u7684\u7570\u52d5\u3002</p> \u70ba\u4f55\u300c\u8fd1\u671f\u7570\u52d5\u6e05\u55ae\u300d\u6703\u6bcf\u5929\u8b8a\uff1f <p>\u96a8\u8457\u7b56\u7565\u4e2d\u4f7f\u7528\u5230\u7684\u6578\u64da\u6bcf\u65e5\u7570\u52d5\uff0c\u5c1a\u672a\u9032\u5834\u7684\u9078\u80a1\u5c07\u96a8\u4e4b\u8b8a\u5316\uff0c\u5be6\u969b\u61c9\u7528\u4e0a\uff0c\u65bc\u539f\u5148\u8a2d\u5b9a\u4e4b\u63db\u80a1\u5468\u671f\u9032\u884c\u63db\u80a1\u64cd\u4f5c\u5373\u53ef\u3002</p>"}, {"location": "faq/#_9", "title": "\u8a02\u95b1\u8207\u5176\u4ed6\u554f\u984c", "text": "\u53ef\u4ee5\u66f4\u6539\u8a02\u95b1\u6642\u7d81\u5b9a\u7684\u4fe1\u7528\u5361\u55ce\uff1f <p>\u53ef\u4ee5\uff0c\u8acb\u9ede\u9078\u5e73\u53f0\u7684\u53f3\u4e0a\u89d2\u7684\u6703\u54e1\u9801\u9762\uff0c\u4e26\u4e14\u9ede\u9078\u300c\u4ed8\u6b3e\u8a2d\u5b9a\u8207\u7d00\u9304\u300d\u5206\u9801\uff0c\u4e26\u9ede\u9078\u300c\u66f4\u6539\u767c\u7968\u4ee5\u53ca\u4fe1\u7528\u5361\u300d\u5373\u53ef\u3002</p> \u8a3b\u518a\u932f\u5e33\u865f\u4e86\uff0c\u60f3\u66f4\u63db\u8a3b\u518a\u4f7f\u7528\u7684FinLab\u5e33\u865f\uff0c\u600e\u9ebc\u8fa6\uff1f <p>\u53ef\u76f4\u63a5\u4f7f\u7528\u65b0\u7684google\u5e33\u865f\u767b\u5165\u5f8c\uff0c\u7528\u820a\u7684\u5e33\u865f\u5c0d\u61c9\u5230\u7684 email \u5230 finlab.company@finlab.tw \u4f86\u66f4\u63db\u5373\u53ef</p> \u6211\u6709\u91cf\u5316\u5e73\u53f0\u4f7f\u7528\u4e0a\u7684\u554f\u984c\uff0c\u8acb\u554f\u52a9\u6559\u7cfb\u7d71\u5728\u54ea\u88e1\uff1f\u8a72\u5982\u4f55\u8a62\u554f\u554f\u984c\uff1f <p>Finlab\u6709\u5c08\u5c6cDiscord\u804a\u5929\u5ba4\uff0c\u53ef\u81f3Discord\u641c\u5c0b\u300cPython \u9078\u80a1\u5be6\u9a57\u5ba4\u300d\uff0c\u6216\u662f\u81f3Finlab\u7db2\u9801\u5de6\u5074\u300c\u793e\u7fa4&gt;Discord \u804a\u5929\u5ba4\u300d\u9032\u5165\u3002</p> <p>\u767c\u554f\u5167\u5bb9\u4ee5\u5e73\u53f0/\u5957\u4ef6\u4f7f\u7528\u76f8\u95dc\u7591\u96e3\u96dc\u75c7\u70ba\u4e3b\uff0c\u4e00\u822c\u7a0b\u5f0f\u8a9e\u6cd5\u6216\u5176\u4ed6\u8207Finlab\u7121\u95dc\u4e4b\u969c\u7919\u53ef\u5148\u591a\u5617\u8a66\u4f7f\u7528google\u6216ChatGPT\u5354\u52a9\u8655\u7406\u3002</p> <p>\u767c\u554f\u6642\uff0c\u9700\u5b8c\u6574\u63cf\u8ff0\u6240\u9047\u5230\u7684\u72c0\u6cc1\uff0c\u53ef\u80fd\u5305\u542b\u4f7f\u7528\u74b0\u5883\u3001\u5957\u4ef6\u7248\u672c\u3001\u4f7f\u7528\u6642\u9593\uff0c\u4e26\u9644\u4e0a\u5b8c\u6574\u7a0b\u5f0f\u78bc\u8207\u932f\u8aa4\u8a0a\u606f\uff0c\u7576\u63d0\u4f9b\u7684\u8cc7\u8a0a\u8d8a\u5b8c\u6574\uff0c\u52a9\u6559\u5c07\u80fd\u8d8a\u8fc5\u901f\u70ba\u60a8\u89e3\u6c7a\u3002\u800c\u82e5\u662f\u91dd\u5c0d\u7b56\u7565\u64b0\u5beb\u7684\u7591\u554f\uff0c\u76e1\u91cf\u4ee5\u5177\u6709\u908f\u8f2f\u7684\u65b9\u5f0f\u63cf\u8ff0\u5b8c\u6574\u6982\u5ff5\uff0c\u5c07\u80fd\u5f97\u5230\u66f4\u6709\u6548\u7387\u7684\u89e3\u6c7a\u65b9\u6848\u3002</p> <p>\u70ba\u5728\u8a0a\u606f\u91cf\u8f03\u5927\u6642\u907f\u514d\u88ab\u6d17\u6389\u3001\u4e14\u6709\u5ef6\u4f38\u8a0e\u8ad6\u6642\u80fd\u8f15\u6613\u8ffd\u8e64\uff0c\u53ef\u591a\u5584\u7528\u8ad6\u58c7\u5340\u9032\u884c\u4e3b\u984c\u5f0f\u8a0e\u8ad6\u3002</p> \u6709\u5efa\u8b70\u7684\u65b0\u529f\u80fd\uff0c\u8981\u5728\u54ea\u88e1\u8a31\u9858\uff1f <p>\u5448\u4e0a\uff0c\u53ef\u81f3Discord\u7684vip\u5c08\u5c6c\u8a31\u9858\u6c60\u7559\u4e0b\u60a8\u7684\u9858\u671b\uff0cVIP\u9650\u5b9a\uff01</p> \u52a9\u6559\u6703\u5728\u591a\u4e45\u5f8c\u56de\u8986\u6211\u7684\u554f\u984c\uff1f\u5ba2\u670d\u670d\u52d9\u6642\u9593\u662f\uff1f <p>\u5ba2\u670d\u6642\u9593\u70ba\u9031\u4e00\u81f3\u9031\u4e949:00~17:00\uff0c\u65bcDiscord\u7559\u4e0b\u7684\u554f\u984c\u5c07\u6703\u5728\u5169\u500b\u5de5\u4f5c\u5929\u5167\u76e1\u91cf\u5b8c\u6210\u56de\u8986\u3002</p> \u54ea\u88e1\u53ef\u4ee5\u5f97\u77e5\u65b0\u7684\u7814\u7a76\u6559\u5b78\u8a0a\u606f\uff1f <p>\u7814\u7a76\u6559\u5b78\u8cc7\u8a0a\u5c07\u5e03\u544a\u65bcDiscord\u7684\u6559\u5b78\u8cc7\u6e90\u983b\u9053\u8207FB\u7c89\u5c08\uff0c\u800c\u7814\u7a76\u6210\u679c\u591a\u4ee5\u90e8\u843d\u683c\u6587\u7ae0\u3001Youtube\u5f71\u97f3\u5f62\u5f0f\u70ba\u4e3b\uff0c\u5747\u53ef\u76f4\u63a5\u8ffd\u8e64\u6536\u85cf\u8d77\u4f86\uff01</p> <p>Finlab\u8ca1\u7d93\u5be6\u9a57\u5ba4Youtube\u983b\u9053\uff1a https://www.youtube.com/@FinlabPython Finlab\u90e8\u843d\u683c\uff1a https://www.finlab.tw/</p>"}, {"location": "faq/#_10", "title": "\u5e38\u898b\u932f\u8aa4\u8207\u89e3\u6c7a\u65b9\u6cd5", "text": "KeyError: 'price:\u6536\u76e4\u50f9' - \u627e\u4e0d\u5230\u8cc7\u6599\u8868 <p>\u73fe\u8c61\uff1a\u57f7\u884c <code>data.get()</code> \u6642\u62cb\u51fa <code>KeyError</code></p> <p>\u539f\u56e0\uff1a - \u8cc7\u6599\u8868\u540d\u7a31\u62fc\u5beb\u932f\u8aa4 - API Token \u672a\u8a2d\u5b9a\u6216\u7121\u6548 - \u975e VIP \u6703\u54e1\u5b58\u53d6\u6700\u65b0\u8cc7\u6599</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>import finlab\n\n# 1. \u78ba\u8a8d\u767b\u5165\nfinlab.login('YOUR_API_TOKEN')  # \u81f3 https://ai.finlab.tw/member_info \u53d6\u5f97\n\n# 2. \u4f7f\u7528 data.search() \u641c\u5c0b\u6b63\u78ba\u7684\u6b04\u4f4d\u540d\u7a31\nfrom finlab import data\nmatching_fields = data.search('\u6536\u76e4')\nprint(matching_fields)  # \u78ba\u8a8d\u6b63\u78ba\u540d\u7a31\n\n# 3. \u6e2c\u8a66\u8cc7\u6599\u4e0b\u8f09\nclose = data.get('price:\u6536\u76e4\u50f9')\nprint(f\"\u8cc7\u6599\u7bc4\u570d\uff1a{close.index[0]} ~ {close.index[-1]}\")\n</code></pre></p> <p>\u53c3\u8003\uff1a\u8cc7\u6599\u4e0b\u8f09\u932f\u8aa4\u8655\u7406</p> \u8cc7\u6599\u70ba\u7a7a\uff08Empty DataFrame\uff09 <p>\u73fe\u8c61\uff1a\u6210\u529f\u4e0b\u8f09\u4f46 DataFrame \u6c92\u6709\u4efb\u4f55\u8cc7\u6599</p> <p>\u539f\u56e0\uff1a - \u4f7f\u7528 <code>data.universe()</code> \u6642\uff0c\u7be9\u9078\u689d\u4ef6\u904e\u65bc\u56b4\u683c - \u985e\u80a1\u540d\u7a31\u4e0d\u5b58\u5728 - \u8cc7\u6599\u4f86\u6e90\u66ab\u6642\u7121\u8cc7\u6599</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>from finlab import data\n\n# \u6aa2\u67e5\u8cc7\u6599\u5b8c\u6574\u6027\nclose = data.get('price:\u6536\u76e4\u50f9')\n\nif close.empty:\n    print(\"\u274c \u8cc7\u6599\u70ba\u7a7a\")\n    print(\"\u53ef\u80fd\u539f\u56e0\uff1a\")\n    print(\"1. universe \u7be9\u9078\u689d\u4ef6\u904e\u56b4\")\n    print(\"2. \u8cc7\u6599\u8868\u672c\u8eab\u7121\u8cc7\u6599\")\nelse:\n    print(f\"\u2705 \u8cc7\u6599\u6b63\u5e38\uff1a{close.shape[0]} \u500b\u4ea4\u6613\u65e5\uff0c{close.shape[1]} \u6a94\u80a1\u7968\")\n</code></pre></p> <p>\u53c3\u8003\uff1a\u8cc7\u6599\u4e0b\u8f09\u932f\u8aa4\u8655\u7406</p> \u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304 <p>\u73fe\u8c61\uff1a\u56de\u6e2c\u5b8c\u6210\u4f46\u7121\u4efb\u4f55\u4ea4\u6613\uff0c<code>get_trades()</code> \u56de\u50b3\u7a7a DataFrame</p> <p>\u539f\u56e0\uff1a - \u9032\u5834\u689d\u4ef6\u904e\u65bc\u56b4\u683c\uff0c<code>position</code> \u5e7e\u4e4e\u5168\u70ba <code>False</code> - \u8cc7\u6599\u65e5\u671f\u7bc4\u570d\u904e\u77ed - \u7be9\u9078\u5f8c\u7684\u80a1\u7968\u6c60\u904e\u5c0f</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>from finlab.backtest import sim\n\n# \u6aa2\u67e5\u9032\u5834\u8a0a\u865f\u7d71\u8a08\nentry_stats = position.sum(axis=1)\nprint(f\"\u5e73\u5747\u6bcf\u65e5\u9032\u5834\u80a1\u7968\u6578\uff1a{entry_stats.mean():.2f}\")\nprint(f\"\u6700\u5927\u9032\u5834\u80a1\u7968\u6578\uff1a{entry_stats.max()}\")\n\nif entry_stats.mean() &lt; 1:\n    print(\"\u26a0\ufe0f \u8b66\u544a\uff1a\u9032\u5834\u689d\u4ef6\u904e\u56b4\")\n    print(\"\u5efa\u8b70\uff1a\")\n    print(\"1. \u653e\u5bec\u689d\u4ef6\uff08\u5982\u50f9\u683c\u5340\u9593\uff09\")\n    print(\"2. \u4f7f\u7528 .is_largest(N) \u78ba\u4fdd\u56fa\u5b9a\u6a94\u6578\")\n\n    # \u4fee\u6b63\u7bc4\u4f8b\uff1a\u78ba\u4fdd\u56fa\u5b9a\u6a94\u6578\n    position_fixed = (close &gt; ma20).is_largest(30)\n\n# \u57f7\u884c\u56de\u6e2c\nreport = sim(position, resample='M')\ntrades = report.get_trades()\n\nif len(trades) == 0:\n    print(\"\u274c \u7121\u4ea4\u6613\u8a18\u9304\uff0c\u8acb\u653e\u5bec\u9032\u5834\u689d\u4ef6\")\nelse:\n    print(f\"\u2705 \u56de\u6e2c\u6210\u529f\uff1a{len(trades)} \u7b46\u4ea4\u6613\")\n</code></pre></p> <p>\u53c3\u8003\uff1a\u56de\u6e2c\u932f\u8aa4\u8655\u7406</p> KeyError: Timestamp('2023-05-01') - \u65e5\u671f\u7d22\u5f15\u932f\u8aa4 <p>\u73fe\u8c61\uff1a\u57f7\u884c\u56de\u6e2c\u6642\u62cb\u51fa <code>KeyError</code>\uff0c\u932f\u8aa4\u8a0a\u606f\u986f\u793a\u67d0\u500b\u65e5\u671f\u4e0d\u5b58\u5728</p> <p>\u539f\u56e0\uff1a - \u4f7f\u7528\u591a\u500b\u8cc7\u6599\u6e90\u6642\uff0c\u65e5\u671f\u7d22\u5f15\u7bc4\u570d\u4e0d\u4e00\u81f4 - \u4f7f\u7528 <code>shift()</code> \u6216 <code>rolling()</code> \u5c0e\u81f4\u524d\u671f\u8cc7\u6599\u7f3a\u5931</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>import finlab\n\n# \u65b9\u6cd5 1\uff1a\u4f7f\u7528 truncate_start \u5c0d\u9f4a\u8d77\u59cb\u65e5\u671f\nfinlab.truncate_start = '2020-01-01'\n\n# \u65b9\u6cd5 2\uff1a\u624b\u52d5\u5c0d\u9f4a\u65e5\u671f\u7d22\u5f15\nfrom finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\nvolume = data.get('price:\u6210\u4ea4\u80a1\u6578')\n\n# \u6aa2\u67e5\u65e5\u671f\u7bc4\u570d\nprint(f\"\u6536\u76e4\u50f9\uff1a{close.index[0]} ~ {close.index[-1]}\")\nprint(f\"\u6210\u4ea4\u91cf\uff1a{volume.index[0]} ~ {volume.index[-1]}\")\n\n# \u5c0d\u9f4a\ncommon_dates = close.index.intersection(volume.index)\nclose_aligned = close.loc[common_dates]\nvolume_aligned = volume.loc[common_dates]\n\n# \u65b9\u6cd5 3\uff1a\u79fb\u9664\u7f3a\u5931\u503c\nposition = (close &gt; close.average(20)) &amp; (volume &gt; 1000)\nposition_cleaned = position.dropna(how='all', axis=0)  # \u79fb\u9664\u5168\u70ba NaN \u7684\u5217\nposition_cleaned = position_cleaned.fillna(False)\n</code></pre></p> <p>\u53c3\u8003\uff1a\u56de\u6e2c\u932f\u8aa4\u8655\u7406</p> \u5238\u5546\u5e33\u6236\u9023\u7dda\u5931\u6557 <p>\u73fe\u8c61\uff1a\u57f7\u884c <code>SinopacAccount()</code> \u6216 <code>EsunAccount()</code> \u6642\u62cb\u51fa\u9023\u7dda\u932f\u8aa4</p> <p>\u539f\u56e0\uff1a - \u74b0\u5883\u8b8a\u6578\u672a\u6b63\u78ba\u8a2d\u5b9a\uff08API KEY\u3001\u6191\u8b49\u8def\u5f91\uff09 - \u6191\u8b49\u6a94\u6848\u4e0d\u5b58\u5728\u6216\u5bc6\u78bc\u932f\u8aa4 - \u7db2\u8def\u9023\u7dda\u554f\u984c</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>import os\nfrom finlab.online.sinopac_account import SinopacAccount\n\n# \u6aa2\u67e5\u74b0\u5883\u8b8a\u6578\nrequired_vars = [\n    'SHIOAJI_API_KEY',\n    'SHIOAJI_SECRET_KEY',\n    'SHIOAJI_CERT_PATH',\n    'SHIOAJI_CERT_PASSWORD'\n]\n\nfor var in required_vars:\n    if not os.environ.get(var):\n        print(f\"\u274c {var} \u672a\u8a2d\u5b9a\")\n        print(\"\u8acb\u53c3\u8003\uff1ahttps://doc.finlab.tw/details/order_api/\")\n\n# \u6aa2\u67e5\u6191\u8b49\u6a94\u6848\ncert_path = os.environ.get('SHIOAJI_CERT_PATH')\nif cert_path and not os.path.exists(cert_path):\n    print(f\"\u274c \u6191\u8b49\u6a94\u6848\u4e0d\u5b58\u5728\uff1a{cert_path}\")\n\n# \u5617\u8a66\u9023\u7dda\ntry:\n    acc = SinopacAccount()\n    print(\"\u2705 \u5e33\u6236\u9023\u7dda\u6210\u529f\")\nexcept Exception as e:\n    print(f\"\u274c \u9023\u7dda\u5931\u6557\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5 API key\u3001\u6191\u8b49\u8def\u5f91\u8207\u5bc6\u78bc\")\n</code></pre></p> <p>\u53c3\u8003\uff1a\u5be6\u76e4\u4e0b\u55ae\u932f\u8aa4\u8655\u7406</p> \u4e0b\u55ae\u8cc7\u91d1\u4e0d\u8db3 <p>\u73fe\u8c61\uff1a\u57f7\u884c\u4e0b\u55ae\u6642\u63d0\u793a\u8cc7\u91d1\u4e0d\u8db3</p> <p>\u539f\u56e0\uff1a - \u53ef\u7528\u8cc7\u91d1\u4e0d\u8db3\u4ee5\u8cb7\u5165 position \u6307\u5b9a\u7684\u80a1\u7968 - \u672a\u8003\u616e\u624b\u7e8c\u8cbb\u8207\u8b49\u4ea4\u7a05 - \u5e33\u6236\u9918\u984d\u8207\u9810\u671f\u4e0d\u7b26</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>from finlab.online.order_executor import OrderExecutor\n\n# \u4e0b\u55ae\u524d\u6aa2\u67e5\u8cc7\u91d1\navailable_cash = account.get_balance()\nrequired_cash = position.total_value  # \u9810\u4f30\u6240\u9700\u8cc7\u91d1\uff08\u9700\u6839\u64da\u5be6\u969b API\uff09\n\nprint(f\"\u53ef\u7528\u8cc7\u91d1\uff1aNT$ {available_cash:,.0f}\")\nprint(f\"\u9810\u4f30\u6210\u672c\uff1aNT$ {required_cash:,.0f}\")\n\nif required_cash &gt; available_cash * 0.9:  # \u7559 10% \u7de9\u885d\n    print(\"\u274c \u8cc7\u91d1\u4e0d\u8db3\")\n    print(\"\u5efa\u8b70\uff1a\")\n    print(\"1. \u964d\u4f4e\u7e3d\u8cc7\u91d1\u6bd4\u4f8b\")\n    print(\"2. \u8ffd\u52a0\u8cc7\u91d1\")\n    print(\"3. \u6e1b\u5c11\u6301\u80a1\u6578\u91cf\")\nelse:\n    # \u57f7\u884c\u4e0b\u55ae\n    executor = OrderExecutor(position, account=account)\n    executor.create_orders(view_only=True)  # \u5148\u9810\u89bd\n</code></pre></p> <p>\u53c3\u8003\uff1a\u5be6\u76e4\u4e0b\u55ae\u932f\u8aa4\u8655\u7406</p> \u8a02\u55ae\u88ab\u62d2\u7d55\uff08\u8655\u7f6e\u80a1\u672a\u5708\u5b58\uff09 <p>\u73fe\u8c61\uff1a\u57f7\u884c <code>create_orders()</code> \u5f8c\uff0c\u90e8\u5206\u8a02\u55ae\u88ab\u5238\u5546\u62d2\u7d55</p> <p>\u539f\u56e0\uff1a - \u8655\u7f6e\u80a1\u672a\u5708\u5b58 - \u80a1\u7968\u66ab\u505c\u4ea4\u6613 - \u6f32\u8dcc\u505c\u9396\u6b7b\u7121\u6cd5\u6210\u4ea4</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>from finlab.online.order_executor import OrderExecutor\n\nexecutor = OrderExecutor(position, account=account)\n\n# 1. \u6aa2\u67e5\u8655\u7f6e\u80a1\nalerting_stocks = executor.show_alerting_stocks()\n\nif alerting_stocks:\n    print(\"\u26a0\ufe0f \u767c\u73fe\u8655\u7f6e\u80a1\uff0c\u8acb\u81f3\u5238\u5546\u5e73\u53f0\u5708\u5b58\u5f8c\u518d\u4e0b\u55ae\")\n    print(\"\u53c3\u8003\u5708\u5b58\u6559\u5b78\uff1a\")\n    print(\"- \u5bcc\u679c\uff1ahttps://support.fugle.tw/trading/trading-troubleshoot/5231/\")\n    print(\"- \u6c38\u8c50\uff1ahttps://www.sinotrade.com.tw/richclub/freshman/...\")\n    input(\"\u5708\u5b58\u5b8c\u6210\u5f8c\uff0c\u6309 Enter \u7e7c\u7e8c...\")\n\n# 2. \u5148\u9810\u89bd\nexecutor.create_orders(view_only=True)\n\n# 3. \u78ba\u8a8d\u5f8c\u57f7\u884c\nconfirmation = input(\"\u78ba\u8a8d\u7121\u8aa4\u5f8c\u8f38\u5165 'YES' \u57f7\u884c\u4e0b\u55ae\uff1a\")\nif confirmation == 'YES':\n    executor.create_orders()\n</code></pre></p> <p>\u53c3\u8003\uff1a\u5be6\u76e4\u4e0b\u55ae\u932f\u8aa4\u8655\u7406</p> \u6a94\u6848\u8b80\u53d6\u5931\u6557\uff08\u81ea\u8a02\u5e02\u5834\uff09 <p>\u73fe\u8c61\uff1a\u57f7\u884c\u81ea\u8a02\u5e02\u5834\u6642\u62cb\u51fa <code>FileNotFoundError</code></p> <p>\u539f\u56e0\uff1a - CSV \u6a94\u6848\u4e0d\u5b58\u5728\u6216\u8def\u5f91\u932f\u8aa4 - \u4f7f\u7528\u76f8\u5c0d\u8def\u5f91\u4f46\u5de5\u4f5c\u76ee\u9304\u4e0d\u6b63\u78ba</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>from finlab.market import Market\nimport pandas as pd\nimport os\n\nclass CryptoMarket(Market):\n    def __init__(self, data_dir='./data'):\n        self.data_dir = data_dir\n\n    def get_price(self, trade_at_price='close', adj=True):\n        file_path = os.path.join(self.data_dir, f'crypto_{trade_at_price}.csv')\n\n        # \u6aa2\u67e5\u6a94\u6848\u662f\u5426\u5b58\u5728\n        if not os.path.exists(file_path):\n            raise FileNotFoundError(\n                f\"\u274c \u627e\u4e0d\u5230\u8cc7\u6599\u6a94\u6848\uff1a{file_path}\\n\"\n                f\"\u8acb\u78ba\u8a8d\uff1a\\n\"\n                f\"1. \u6a94\u6848\u662f\u5426\u5b58\u5728\u65bc {self.data_dir} \u76ee\u9304\\n\"\n                f\"2. \u6a94\u6848\u540d\u7a31\u662f\u5426\u6b63\u78ba\\n\"\n                f\"3. \u5de5\u4f5c\u76ee\u9304\uff1a{os.getcwd()}\"\n            )\n\n        df = pd.read_csv(file_path, index_col=0, parse_dates=True)\n        return df\n\n# \u4f7f\u7528\ntry:\n    market = CryptoMarket(data_dir='/path/to/data')\n    close = market.get_price('close')\nexcept FileNotFoundError as e:\n    print(e)\n</code></pre></p> <p>\u53c3\u8003\uff1a\u81ea\u8a02\u5e02\u5834\u932f\u8aa4\u8655\u7406</p> \u8cc7\u6599\u683c\u5f0f\u932f\u8aa4\uff08Index must be DatetimeIndex\uff09 <p>\u73fe\u8c61\uff1aDataFrame \u683c\u5f0f\u4e0d\u7b26\u5408\u9810\u671f\uff0c\u5c0e\u81f4\u56de\u6e2c\u5931\u6557</p> <p>\u539f\u56e0\uff1a - Index \u4e0d\u662f DatetimeIndex - \u8cc7\u6599\u578b\u614b\u932f\u8aa4\uff08\u5b57\u4e32\u800c\u975e\u6578\u503c\uff09</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>import pandas as pd\n\n# \u8b80\u53d6 CSV\ndf = pd.read_csv('data.csv', index_col=0)\n\n# \u8f49\u63db index \u70ba DatetimeIndex\nif not isinstance(df.index, pd.DatetimeIndex):\n    try:\n        df.index = pd.to_datetime(df.index)\n        print(\"\u2705 Index \u5df2\u8f49\u63db\u70ba DatetimeIndex\")\n    except Exception as e:\n        print(f\"\u274c \u7121\u6cd5\u8f49\u63db Index\uff1a{e}\")\n        print(f\"Index \u7bc4\u4f8b\uff1a{df.index[:3].tolist()}\")\n        print(\"\u8acb\u78ba\u8a8d\u7b2c\u4e00\u6b04\u683c\u5f0f\u70ba\u65e5\u671f\uff08\u5982 2020-01-01\uff09\")\n\n# \u6aa2\u67e5\u8cc7\u6599\u578b\u614b\nnon_numeric_cols = df.select_dtypes(exclude=['number']).columns.tolist()\nif non_numeric_cols:\n    print(f\"\u26a0\ufe0f \u4ee5\u4e0b\u6b04\u4f4d\u975e\u6578\u503c\u578b\u614b\uff1a{non_numeric_cols}\")\n    for col in non_numeric_cols:\n        df[col] = pd.to_numeric(df[col], errors='coerce')\n</code></pre></p> <p>\u53c3\u8003\uff1a\u81ea\u8a02\u5e02\u5834\u932f\u8aa4\u8655\u7406</p> \u6a21\u578b\u8a13\u7df4\u8cc7\u6599\u4e0d\u8db3\uff08\u6a5f\u5668\u5b78\u7fd2\uff09 <p>\u73fe\u8c61\uff1aML \u6a21\u578b\u8a13\u7df4\u6642\u63d0\u793a\u8cc7\u6599\u91cf\u904e\u5c11</p> <p>\u539f\u56e0\uff1a - \u8a13\u7df4\u96c6\u8cc7\u6599 &lt; 1000 \u7b46 - \u7279\u5fb5\u8207\u6a19\u7c64\u5c0d\u9f4a\u5f8c\u640d\u5931\u5927\u91cf\u8cc7\u6599</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>from finlab.ml import feature as mlf, label as mll\n\n# \u7279\u5fb5\u8207\u6a19\u7c64\u5c0d\u9f4a\ndata_ml = features.join(labels, how='inner')\n\n# \u5207\u5206\u8a13\u7df4/\u6e2c\u8a66\u96c6\ntrain_data = data_ml[data_ml.index.get_level_values(0) &lt;= '2022-12-31']\n\nprint(f\"\u8a13\u7df4\u96c6\uff1a{len(train_data)} \u7b46\")\n\nif len(train_data) &lt; 1000:\n    print(\"\u26a0\ufe0f \u8a13\u7df4\u8cc7\u6599\u4e0d\u8db3\uff08&lt; 1000 \u7b46\uff09\")\n    print(\"\u5efa\u8b70\uff1a\")\n    print(\"1. \u589e\u52a0\u6b77\u53f2\u8cc7\u6599\u7bc4\u570d\")\n    print(\"2. \u964d\u4f4e resample \u983b\u7387\uff08'1d' \u6539\u70ba 'W'\uff09\")\n    print(\"3. \u6e1b\u5c11\u7279\u5fb5\u6578\u91cf\uff08\u964d\u4f4e\u7f3a\u5931\u503c\uff09\")\n</code></pre></p> <p>\u53c3\u8003\uff1aML \u932f\u8aa4\u8655\u7406</p> \u8a13\u7df4/\u6e2c\u8a66\u96c6\u65e5\u671f\u91cd\u758a\uff08\u6a5f\u5668\u5b78\u7fd2\uff09 <p>\u73fe\u8c61\uff1a\u5207\u5206\u8cc7\u6599\u96c6\u6642\uff0c\u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6\u65e5\u671f\u91cd\u758a\uff0c\u5c0e\u81f4\u8cc7\u6599\u6d29\u9732</p> <p>\u539f\u56e0\uff1a - \u672a\u6b63\u78ba\u4f7f\u7528\u6642\u9593\u5e8f\u5217\u5207\u5206 - \u8a13\u7df4\u96c6\u6700\u5f8c\u65e5\u671f &gt;= \u6e2c\u8a66\u96c6\u7b2c\u4e00\u65e5\u671f</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code># \u5b9a\u7fa9\u5207\u5206\u65e5\u671f\ntrain_end = '2022-12-31'\ntest_start = '2023-01-01'\n\ntrain_data = data_ml[data_ml.index.get_level_values(0) &lt;= train_end]\ntest_data = data_ml[data_ml.index.get_level_values(0) &gt;= test_start]\n\n# \u6aa2\u67e5\u65e5\u671f\u9806\u5e8f\ntrain_last_date = train_data.index.get_level_values(0).max()\ntest_first_date = test_data.index.get_level_values(0).min()\n\nif train_last_date &gt;= test_first_date:\n    raise ValueError(\n        f\"\u274c \u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6\u65e5\u671f\u91cd\u758a\uff01\\n\"\n        f\"\u8a13\u7df4\u96c6\u6700\u5f8c\u65e5\u671f\uff1a{train_last_date}\\n\"\n        f\"\u6e2c\u8a66\u96c6\u7b2c\u4e00\u65e5\u671f\uff1a{test_first_date}\\n\"\n        f\"\u9019\u6703\u5c0e\u81f4\u8cc7\u6599\u6d29\u9732\uff08data leakage\uff09\"\n    )\n\nprint(f\"\u2705 \u8cc7\u6599\u5207\u5206\u6b63\u78ba\")\n</code></pre></p> <p>\u53c3\u8003\uff1aML \u932f\u8aa4\u8655\u7406</p> \u9810\u6e2c\u7d50\u679c\u5168\u70ba NaN\uff08\u6a5f\u5668\u5b78\u7fd2\uff09 <p>\u73fe\u8c61\uff1aML \u6a21\u578b\u9810\u6e2c\u5f8c\uff0c\u7d50\u679c\u5168\u70ba NaN</p> <p>\u539f\u56e0\uff1a - \u6a21\u578b\u8a13\u7df4\u5931\u6557\u4f46\u672a\u62cb\u51fa\u932f\u8aa4 - \u9810\u6e2c\u8cc7\u6599\u5305\u542b NaN \u6216 Inf</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a <pre><code>import pandas as pd\n\n# \u9810\u6e2c\nall_pred = model.predict(data_ml.drop(columns=['label']))\n\n# \u6aa2\u67e5\u9810\u6e2c\u7d50\u679c\nif pd.Series(all_pred).isna().all():\n    print(\"\u274c \u9810\u6e2c\u7d50\u679c\u5168\u70ba NaN\")\n    print(\"\u8acb\u6aa2\u67e5\uff1a\")\n    print(\"1. \u6a21\u578b\u662f\u5426\u6b63\u78ba\u8a13\u7df4\")\n    print(\"2. \u9810\u6e2c\u8cc7\u6599\u662f\u5426\u5305\u542b NaN \u6216 Inf\")\n\n    # \u6aa2\u67e5\u9810\u6e2c\u8cc7\u6599\n    X_pred = data_ml.drop(columns=['label'])\n    print(f\"NaN \u6578\u91cf\uff1a{X_pred.isna().sum().sum()}\")\n    print(f\"Inf \u6578\u91cf\uff1a{(X_pred == float('inf')).sum().sum()}\")\n\n    # \u586b\u5145\u7f3a\u5931\u503c\n    X_pred = X_pred.fillna(0).replace([float('inf'), float('-inf')], 0)\n    all_pred = model.predict(X_pred)\n\nprint(f\"\u2705 \u9810\u6e2c\u5b8c\u6210\uff1a{len(all_pred)} \u7b46\")\n</code></pre></p> <p>\u53c3\u8003\uff1aML \u932f\u8aa4\u8655\u7406</p>"}, {"location": "getting-started/", "title": "\u5feb\u901f\u4e0a\u624b", "text": ""}, {"location": "getting-started/#_2", "title": "\u5b89\u88dd", "text": "<p>\u652f\u63f4 Windows\u3001macOS\u3001Linux \u8207 Colab\uff1b\u4e5f\u53ef\u7528 Docker\u3002</p>  AI \u81ea\u52d5\u5beb\u7a0b\u5f0f Google Colab \u672c\u6a5f Python Docker <p>\u7dda\u4e0a AI \u5e73\u53f0</p> <p>\u524d\u5f80 <code>studio.finlab.tw</code> \u76f4\u63a5\u8207 AI \u5c0d\u8a71\u64b0\u5beb\u7b56\u7565\uff0c\u7121\u9700\u5b89\u88dd\u4efb\u4f55\u5957\u4ef6\u3002</p> <p>\u672c\u6a5f AI \u7de8\u7a0b\u52a9\u624b\uff08\u63a8\u85a6\uff09</p> <p>\u5728 Claude Code\u3001Cursor\u3001Windsurf \u7b49 AI \u7de8\u7a0b\u5de5\u5177\u4e2d\u5b89\u88dd FinLab Skill\uff0c\u8b93 AI \u719f\u6089\u6574\u5957 FinLab API\uff0c\u5e6b\u4f60\u64b0\u5beb\u7b56\u7565\u3001\u67e5\u627e\u8cc7\u6599\u6b04\u4f4d\u3001\u9664\u932f\u56de\u6e2c\u554f\u984c\u3002</p> <ol> <li>\u524d\u5f80 finlab.finance \u53d6\u5f97 Skill \u5b89\u88dd\u9023\u7d50</li> <li>\u4f9d\u7167\u9801\u9762\u6307\u793a\u5c07 Skill \u52a0\u5165\u4f60\u7684 AI \u7de8\u7a0b\u5de5\u5177</li> <li>\u958b\u59cb\u5c0d\u8a71\uff0c\u4f8b\u5982\uff1a\u300c\u5e6b\u6211\u5beb\u4e00\u500b\u71df\u6536\u6210\u9577\u5275\u65b0\u9ad8\u7684\u7b56\u7565\u4e26\u56de\u6e2c\u300d</li> </ol> <p>Skill \u6db5\u84cb\u5167\u5bb9</p> <p>\u8cc7\u6599\u5b58\u53d6\uff08<code>data.get</code>\uff09\u3001\u56de\u6e2c\uff08<code>backtest.sim</code>\uff09\u3001\u56e0\u5b50\u5206\u6790\u3001\u6a5f\u5668\u5b78\u7fd2\uff08<code>finlab.ml</code>\uff09\u3001\u5be6\u76e4\u4e0b\u55ae\u7b49\u5b8c\u6574 API \u77e5\u8b58\u3002AI \u52a9\u624b\u53ef\u76f4\u63a5\u5e6b\u4f60\u64b0\u5beb\u3001\u57f7\u884c\u3001\u9664\u932f\u7a0b\u5f0f\u78bc\u3002</p> <pre><code># Colab \u65b0\u589e Notebook \u5f8c\u57f7\u884c\n!pip install finlab\n</code></pre> <pre><code>pip install finlab\n</code></pre> <p>\u76f8\u5bb9\u6027\u63d0\u793a</p> <p>\u82e5\u9047\u5230\u5957\u4ef6\u76f8\u4f9d\u554f\u984c\uff0c\u5efa\u8b70\u6539\u7528 Docker \u7248\u672c\u3002</p> <pre><code>docker pull finlab/jupyter-finlab\ndocker run -p 8888:8888 finlab/jupyter-finlab\n# \u4f9d\u7d42\u7aef\u986f\u793a\u7684 URL \u958b\u555f JupyterLab\n</code></pre>"}, {"location": "getting-started/#_3", "title": "\u4e0b\u8f09\u8cc7\u6599", "text": "<p>\u8f38\u5165\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\uff0c\u5373\u53ef\u4e0b\u8f09\u8cc7\u6599\u3002\u53ef\u4ee5\u67e5\u8a62\u6709\u54ea\u4e9b\u6b77\u53f2\u8cc7\u6599\u53ef\u4ee5\u4e0b\u8f09\u3002</p> <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9')\n</code></pre> date 0015 0050 0051 0052 0053 2007-04-23 9.54 57.85 32.83 38.4 nan 2007-04-24 9.54 58.1 32.99 38.65 nan 2007-04-25 9.52 57.6 32.8 38.59 nan 2007-04-26 9.59 57.7 32.8 38.6 nan 2007-04-27 9.55 57.5 32.72 38.4 nan"}, {"location": "getting-started/#_4", "title": "\u64b0\u5beb\u7b56\u7565", "text": "<p>\u53ef\u4ee5\u7528\u975e\u5e38\u7c21\u55ae\u7684 <code>Pandas</code> \u8a9e\u6cd5\u4f86\u64b0\u5beb\u7b56\u7565\u908f\u8f2f\uff0c\u4ee5\u5275\u65b0\u9ad8\u7684\u7b56\u7565\u4f86\u8aaa\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u7684\u5beb\u6cd5\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u5275\u4e09\u767e\u500b\u4ea4\u6613\u65e5\u65b0\u9ad8\nposition = close &gt;= close.rolling(300).max()\nposition\n</code></pre> date 0015 0050 0051 0052 0053 2007-04-23 00:00:00 False False False False False 2007-04-24 00:00:00 False False False False False 2007-04-25 00:00:00 False False False False False 2007-04-26 00:00:00 False False False True False 2007-04-27 00:00:00 False False False False False <p>\u5047\u8a2d\u6211\u5011\u5e0c\u671b\u6bcf\u500b\u6708\u5e95\uff0c\u641c\u5c0b\u4e0a\u8868\u4e2d\u6578\u503c\u70ba True \u7684\u80a1\u7968\u4e26\u4e14\u8cb7\u5165\u6301\u6709\u4e00\u500b\u6708\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u7684\u8a9e\u6cd5\uff1a</p>"}, {"location": "getting-started/#_5", "title": "\u56de\u6e2c\u7e3e\u6548", "text": "<pre><code>from finlab import backtest\n\nreport = backtest.sim(position, resample='M')\nreport.display()\n</code></pre>"}, {"location": "glossary/", "title": "FinLab \u5b98\u65b9\u8853\u8a9e\u8868", "text": "<p>\u672c\u9801\u9762\u5b9a\u7fa9 FinLab \u6587\u6a94\u4e2d\u4f7f\u7528\u7684\u6a19\u6e96\u8853\u8a9e\uff0c\u78ba\u4fdd\u4e00\u81f4\u6027\u3002</p>"}, {"location": "glossary/#_1", "title": "\u6838\u5fc3\u4ea4\u6613\u6982\u5ff5", "text": "\u4e2d\u6587 \u82f1\u6587 \u4ee3\u78bc/API \u5b9a\u7fa9 \u7bc4\u4f8b \u505c\u640d stop loss <code>stop_loss</code> \u6301\u5009\u8667\u640d\u9054\u4e00\u5b9a\u6bd4\u4f8b\u6642\u81ea\u52d5\u5e73\u5009\uff0c\u907f\u514d\u66f4\u5927\u640d\u5931 <code>stop_loss=0.1</code> \u8868\u793a\u8667\u640d 10% \u6642\u51fa\u5834 \u505c\u5229 take profit <code>take_profit</code> \u6301\u5009\u7372\u5229\u9054\u4e00\u5b9a\u6bd4\u4f8b\u6642\u81ea\u52d5\u5e73\u5009\uff0c\u9396\u5b9a\u5229\u6f64 <code>take_profit=0.2</code> \u8868\u793a\u7372\u5229 20% \u6642\u51fa\u5834 \u9032\u5834 entry <code>entry</code> \u7b56\u7565\u7522\u751f\u8cb7\u5165\u8a0a\u865f\u7684\u6642\u9ede <code>entry_signal = close &gt; ma20</code> \u51fa\u5834 exit <code>exit</code> \u7b56\u7565\u7522\u751f\u8ce3\u51fa\u8a0a\u865f\u7684\u6642\u9ede <code>exit_signal = close &lt; ma20</code> \u56de\u6e2c backtest <code>sim()</code> \u4f7f\u7528\u6b77\u53f2\u8cc7\u6599\u8a55\u4f30\u7b56\u7565\u7e3e\u6548 <code>report = sim(position, resample='M')</code>"}, {"location": "glossary/#_2", "title": "\u6295\u8cc7\u7d44\u5408\u6982\u5ff5", "text": "\u4e2d\u6587 \u82f1\u6587 \u4ee3\u78bc/API \u5b9a\u7fa9 \u7bc4\u4f8b \u6295\u8cc7\u7d44\u5408 portfolio <code>Portfolio</code> \u591a\u500b\u7b56\u7565\u7684\u96c6\u5408\uff0c\u7528\u65bc\u5206\u6563\u98a8\u96aa <code>portfolio = Portfolio({'\u7b56\u7565A': (report1, 0.5), ...})</code> \u6301\u5009 position <code>position</code> \u7576\u524d\u6301\u6709\u7684\u80a1\u7968\u53ca\u5176\u6b0a\u91cd <code>position = close &gt; ma20</code> \u518d\u5e73\u8861 rebalance <code>resample</code> \u5b9a\u671f\u8abf\u6574\u6301\u5009\u6b0a\u91cd\u81f3\u76ee\u6a19\u914d\u7f6e <code>resample='M'</code> \u8868\u793a\u6bcf\u6708\u518d\u5e73\u8861"}, {"location": "glossary/#_3", "title": "\u8cc7\u6599\u7d50\u69cb", "text": "\u4e2d\u6587 \u82f1\u6587 \u985e\u5225\u540d\u7a31 \u5b9a\u7fa9 \u7bc4\u4f8b \u8cc7\u6599\u6846\u67b6 DataFrame <code>DataFrame</code> pandas \u7684\u8868\u683c\u8cc7\u6599\u7d50\u69cb\uff08\u6ce8\u610f\uff1a\u9996\u5b57\u6bcd\u5927\u5beb\uff09 <code>close = data.get('price:\u6536\u76e4\u50f9')</code> FinLab \u8cc7\u6599\u6846\u67b6 FinlabDataFrame <code>FinlabDataFrame</code> \u64f4\u5145 pandas DataFrame \u7684\u81ea\u8a02\u985e\u5225 \u81ea\u52d5\u5c0d\u9f4a\u3001\u6280\u8853\u6307\u6a19\u65b9\u6cd5"}, {"location": "glossary/#_4", "title": "\u7e3e\u6548\u6307\u6a19", "text": "\u4e2d\u6587 \u82f1\u6587 API \u6b04\u4f4d \u5b9a\u7fa9 \u5e74\u5316\u5831\u916c\u7387 annual return <code>annual_return</code> \u7b56\u7565\u7684\u5e74\u5316\u6536\u76ca\u7387 \u590f\u666e\u7387 Sharpe ratio <code>daily_sharpe</code> \u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c\uff0c\u8d8a\u9ad8\u8d8a\u597d \u6700\u5927\u56de\u64a4 maximum drawdown <code>max_drawdown</code> \u6de8\u503c\u5f9e\u9ad8\u9ede\u5230\u4f4e\u9ede\u7684\u6700\u5927\u8dcc\u5e45"}, {"location": "glossary/#_5", "title": "\u907f\u514d\u4f7f\u7528\u7684\u8853\u8a9e", "text": "\u274c \u907f\u514d \u2705 \u4f7f\u7528 \u539f\u56e0 \u6b62\u640d\u3001\u6b62\u76c8 \u505c\u640d\u3001\u505c\u5229 \u5bb9\u6613\u6df7\u6dc6\uff0c\u4e14\u300c\u505c\u300d\u66f4\u7b26\u5408\u53f0\u7063\u7528\u8a9e dataframe DataFrame \u9996\u5b57\u6bcd\u61c9\u5927\u5beb\uff08\u9075\u5faa pandas \u5b98\u65b9\uff09 \u8cb7\u5165\u3001\u8ce3\u51fa \u9032\u5834\u3001\u51fa\u5834 \u8cb7\u5165/\u8ce3\u51fa\u8f03\u4fda\u8a9e\u5316\uff0c\u9032\u51fa\u5834\u66f4\u5c08\u696d \u91cd\u65b0\u5e73\u8861\u3001\u8f49\u5009 \u518d\u5e73\u8861 \u7d71\u4e00\u7528\u8a5e back test\uff08\u5169\u500b\u5b57\uff09 backtest\uff08\u4e00\u500b\u5b57\uff09 \u9075\u5faa\u696d\u754c\u6a19\u6e96"}, {"location": "glossary/#_6", "title": "\u4e2d\u82f1\u6587\u6df7\u5408\u539f\u5247", "text": "<ol> <li>\u6280\u8853\u8853\u8a9e\u512a\u5148\u4f7f\u7528\u82f1\u6587\uff1aDataFrame\u3001stop_loss\u3001backtest</li> <li>\u8aaa\u660e\u6587\u5b57\u4f7f\u7528\u4e2d\u6587\uff1a\u7576\u6d89\u53ca\u6982\u5ff5\u89e3\u91cb\u6642</li> <li>\u9996\u6b21\u63d0\u53ca\u52a0\u8a3b\u82f1\u6587\uff1a\u4f8b\u5982\u300c\u505c\u640d\uff08stop loss\uff09\u300d</li> <li>\u4ee3\u78bc\u53c3\u6578\u4fdd\u6301\u82f1\u6587\uff1a<code>stop_loss=0.1</code>\uff08\u4e0d\u5beb\u6210 <code>\u505c\u640d=0.1</code>\uff09</li> </ol>"}, {"location": "glossary/#_7", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357\uff08\u505c\u640d\u505c\u5229\u8a73\u89e3\uff09</li> <li>\u8cc7\u6599\u53d6\u5f97\u6559\u5b78\uff08DataFrame \u7528\u6cd5\uff09</li> <li>\u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406\uff08\u6295\u8cc7\u7d44\u5408\u6982\u5ff5\uff09</li> </ul>"}, {"location": "architecture/data_flow/", "title": "FinLab \u8cc7\u6599\u6d41\u7a0b\u8a73\u89e3", "text": "<p>\u672c\u6587\u8a73\u7d30\u8aaa\u660e FinLab \u7684\u8cc7\u6599\u67b6\u69cb\u3001\u4f86\u6e90\u3001\u66f4\u65b0\u983b\u7387\u3001\u5feb\u53d6\u6a5f\u5236\u8207\u67e5\u8a62\u6700\u4f73\u5be6\u8e10\u3002</p>"}, {"location": "architecture/data_flow/#_1", "title": "\u8cc7\u6599\u67b6\u69cb\u6982\u89bd", "text": "<pre><code>graph TB\n    A[\u8cc7\u6599\u4f86\u6e90] --&gt; B[GCS Bucket]\n    B --&gt; C[BigQuery]\n    C --&gt; D[finlab.data.get]\n    D --&gt; E{\u672c\u5730\u5feb\u53d6?}\n    E --&gt;|\u6709| F[\u8fd4\u56de\u5feb\u53d6\u8cc7\u6599]\n    E --&gt;|\u7121| G[\u5f9e BigQuery \u4e0b\u8f09]\n    G --&gt; H[\u5132\u5b58\u81f3\u5feb\u53d6]\n    H --&gt; F\n    F --&gt; I[FinlabDataFrame]\n    I --&gt; J[\u7b56\u7565\u958b\u767c]\n\n    style A fill:#e1f5ff\n    style D fill:#fff4e1\n    style F fill:#e8f5e9</code></pre>"}, {"location": "architecture/data_flow/#_2", "title": "\u8cc7\u6599\u4f86\u6e90", "text": ""}, {"location": "architecture/data_flow/#_3", "title": "\u53f0\u80a1\u8cc7\u6599", "text": "\u985e\u5225 \u8cc7\u6599\u4f86\u6e90 \u66f4\u65b0\u983b\u7387 \u8cc7\u6599\u7bc4\u570d \u80a1\u50f9 \u8b49\u4ea4\u6240/\u6ac3\u8cb7\u4e2d\u5fc3 \u6bcf\u65e5 18:00 2007\u5e74\u81f3\u4eca \u8ca1\u5831 \u516c\u958b\u8cc7\u8a0a\u89c0\u6e2c\u7ad9 \u6bcf\u5b63\u8ca1\u5831\u516c\u5e03\u5f8c 2000\u5e74\u81f3\u4eca \u6708\u71df\u6536 \u516c\u958b\u8cc7\u8a0a\u89c0\u6e2c\u7ad9 \u6bcf\u6708 10 \u65e5\u5f8c 2000\u5e74\u81f3\u4eca \u7c4c\u78bc \u8b49\u4ea4\u6240 \u6bcf\u65e5 18:00 2010\u5e74\u81f3\u4eca \u6280\u8853\u6307\u6a19 FinLab \u8a08\u7b97 \u5373\u6642\u8a08\u7b97 \u4f9d\u80a1\u50f9\u8cc7\u6599"}, {"location": "architecture/data_flow/#_4", "title": "\u7f8e\u80a1\u8cc7\u6599", "text": "\u985e\u5225 \u8cc7\u6599\u4f86\u6e90 \u66f4\u65b0\u983b\u7387 \u8cc7\u6599\u7bc4\u570d \u80a1\u50f9 Yahoo Finance \u6bcf\u65e5 2010\u5e74\u81f3\u4eca \u8ca1\u5831 SEC EDGAR \u6bcf\u5b63 2010\u5e74\u81f3\u4eca"}, {"location": "architecture/data_flow/#_5", "title": "\u8cc7\u6599\u66f4\u65b0\u6642\u7a0b", "text": "<pre><code>gantt\n    title \u53f0\u80a1\u8cc7\u6599\u6bcf\u65e5\u66f4\u65b0\u6642\u7a0b\n    dateFormat HH:mm\n    axisFormat %H:%M\n\n    section \u80a1\u50f9\u8cc7\u6599\n    \u6536\u76e4        :done, 13:30, 1m\n    \u722c\u87f2\u958b\u59cb     :done, 18:00, 10m\n    \u8cc7\u6599\u4e0a\u50b3     :done, 18:10, 20m\n    \u53ef\u4e0b\u8f09       :crit, 18:30, 1m\n\n    section \u7c4c\u78bc\u8cc7\u6599\n    \u722c\u87f2\u958b\u59cb     :done, 18:00, 30m\n    \u8cc7\u6599\u4e0a\u50b3     :done, 18:30, 30m\n    \u53ef\u4e0b\u8f09       :crit, 19:00, 1m\n\n    section \u8ca1\u5831\u8cc7\u6599\n    \u516c\u5e03         :done, 08:00, 1m\n    \u722c\u87f2\u958b\u59cb     :done, 09:00, 60m\n    \u8cc7\u6599\u4e0a\u50b3     :done, 10:00, 30m\n    \u53ef\u4e0b\u8f09       :crit, 10:30, 1m</code></pre>"}, {"location": "architecture/data_flow/#_6", "title": "\u8cc7\u6599\u5feb\u53d6\u6a5f\u5236", "text": ""}, {"location": "architecture/data_flow/#_7", "title": "\u672c\u5730\u5feb\u53d6\u76ee\u9304", "text": "<pre><code>import finlab\n\n# \u9810\u8a2d\u5feb\u53d6\u4f4d\u7f6e\nprint(finlab.get_data_dir())\n# \u8f38\u51fa: /Users/username/.finlab/data\n\n# \u81ea\u8a02\u5feb\u53d6\u4f4d\u7f6e\nfinlab.set_data_dir('/path/to/custom/cache')\n</code></pre>"}, {"location": "architecture/data_flow/#_8", "title": "\u5feb\u53d6\u66f4\u65b0\u908f\u8f2f", "text": "<pre><code>flowchart TD\n    A[\u547c\u53eb data.get] --&gt; B{\u672c\u5730\u6709\u5feb\u53d6?}\n    B --&gt;|\u5426| C[\u5f9e BigQuery \u4e0b\u8f09]\n    B --&gt;|\u662f| D{\u5feb\u53d6\u662f\u5426\u904e\u671f?}\n    D --&gt;|\u662f| C\n    D --&gt;|\u5426| E[\u4f7f\u7528\u5feb\u53d6\u8cc7\u6599]\n    C --&gt; F[\u5132\u5b58\u81f3\u672c\u5730]\n    F --&gt; E\n    E --&gt; G[\u8fd4\u56de DataFrame]</code></pre>"}, {"location": "architecture/data_flow/#_9", "title": "\u5feb\u53d6\u7ba1\u7406", "text": "<pre><code>from finlab import data\n\n# \u6e05\u9664\u6240\u6709\u5feb\u53d6\ndata.clear_cache()\n\n# \u6e05\u9664\u7279\u5b9a\u8cc7\u6599\u5feb\u53d6\ndata.clear_cache('price:\u6536\u76e4\u50f9')\n\n# \u5f37\u5236\u91cd\u65b0\u4e0b\u8f09(\u5ffd\u7565\u5feb\u53d6)\nclose = data.get('price:\u6536\u76e4\u50f9', force_download=True)\n</code></pre>"}, {"location": "architecture/data_flow/#_10", "title": "\u8cc7\u6599\u67e5\u8a62\u6700\u4f73\u5be6\u8e10", "text": ""}, {"location": "architecture/data_flow/#1", "title": "1. \u6279\u6b21\u8f09\u5165\u8cc7\u6599", "text": "<p>\u274c \u4e0d\u597d\u7684\u505a\u6cd5:\u6bcf\u6b21\u90fd\u547c\u53eb <code>data.get()</code></p> <pre><code># \u57f7\u884c 100 \u6b21\u56de\u6e2c,\u6bcf\u6b21\u90fd\u8f09\u5165\u8cc7\u6599(\u6162!)\nfor param in range(100):\n    close = data.get('price:\u6536\u76e4\u50f9')  # \u91cd\u8907\u8f09\u5165\n    position = close &gt; close.average(param)\n    report = sim(position)\n</code></pre> <p>\u2705 \u597d\u7684\u505a\u6cd5:\u4e00\u6b21\u8f09\u5165,\u91cd\u8907\u4f7f\u7528</p> <pre><code># \u53ea\u8f09\u5165\u4e00\u6b21\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u57f7\u884c 100 \u6b21\u56de\u6e2c\nfor param in range(100):\n    position = close &gt; close.average(param)\n    report = sim(position)\n</code></pre>"}, {"location": "architecture/data_flow/#2", "title": "2. \u4f7f\u7528\u65e5\u671f\u7be9\u9078", "text": "<pre><code># \u53ea\u8f09\u5165 2020 \u5e74\u5f8c\u7684\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\nclose_recent = close[close.index &gt;= '2020-01-01']\n\n# \u6216\u4f7f\u7528 loc\nclose_recent = close.loc['2020-01-01':]\n</code></pre>"}, {"location": "architecture/data_flow/#3", "title": "3. \u4f7f\u7528\u80a1\u7968\u7be9\u9078", "text": "<pre><code># \u53ea\u8f09\u5165\u7279\u5b9a\u80a1\u7968\nclose = data.get('price:\u6536\u76e4\u50f9')\nclose_subset = close[['2330', '2317', '2454']]\n\n# \u6216\u4f7f\u7528\u7be9\u9078\u689d\u4ef6\nmarket_cap = data.get('etl:market_value')\nlarge_cap = market_cap &gt; 100_000_000_000  # \u5e02\u503c &gt; 1000 \u5104\nclose_large = close[large_cap]\n</code></pre>"}, {"location": "architecture/data_flow/#4", "title": "4. \u907f\u514d\u91cd\u8907\u8a08\u7b97", "text": "<p>\u274c \u4e0d\u597d\u7684\u505a\u6cd5</p> <pre><code>for stock in ['2330', '2317', '2454']:\n    close = data.get('price:\u6536\u76e4\u50f9')[stock]\n    ma20 = close.rolling(20).mean()  # \u6bcf\u6b21\u90fd\u91cd\u65b0\u8a08\u7b97\n</code></pre> <p>\u2705 \u597d\u7684\u505a\u6cd5</p> <pre><code>close = data.get('price:\u6536\u76e4\u50f9')[['2330', '2317', '2454']]\nma20 = close.rolling(20).mean()  # \u4e00\u6b21\u8a08\u7b97\u6240\u6709\u80a1\u7968\n</code></pre>"}, {"location": "architecture/data_flow/#_11", "title": "\u8cc7\u6599\u54c1\u8cea\u8207\u8655\u7406", "text": ""}, {"location": "architecture/data_flow/#_12", "title": "\u8655\u7406\u7f3a\u5931\u503c", "text": "<pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u6aa2\u67e5\u7f3a\u5931\u503c\nmissing_ratio = close.isna().sum() / len(close)\nprint(f\"\u7f3a\u5931\u503c\u6bd4\u4f8b:\\n{missing_ratio[missing_ratio &gt; 0.1]}\")\n\n# \u65b9\u6cd5 1: Forward fill (\u63a8\u85a6)\nclose_filled = close.ffill()\n\n# \u65b9\u6cd5 2: \u79fb\u9664\u6709\u7f3a\u5931\u503c\u7684\u80a1\u7968\nclose_clean = close.dropna(axis=1, how='any')\n\n# \u65b9\u6cd5 3: \u79fb\u9664\u6709\u7f3a\u5931\u503c\u7684\u65e5\u671f\nclose_clean = close.dropna(axis=0, how='any')\n</code></pre>"}, {"location": "architecture/data_flow/#_13", "title": "\u8655\u7406\u7570\u5e38\u503c", "text": "<pre><code># \u79fb\u9664\u6f32\u8dcc\u505c\u9396\u6b7b\u7684\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\nopen_price = data.get('price:\u958b\u76e4\u50f9')\n\n# \u6aa2\u67e5\u662f\u5426\u6f32\u505c\u9396\u6b7b(\u958b\u76e4 = \u6536\u76e4 = \u6f32\u505c)\nlimit_up = close / close.shift() - 1 &gt; 0.095\nlocked = (close == open_price) &amp; limit_up\n\n# \u79fb\u9664\u9396\u6b7b\u65e5\u671f\u7684\u8cc7\u6599\nclose_filtered = close[~locked]\n</code></pre>"}, {"location": "architecture/data_flow/#_14", "title": "\u5e38\u898b\u8cc7\u6599\u8868\u8aaa\u660e", "text": ""}, {"location": "architecture/data_flow/#_15", "title": "\u80a1\u50f9\u8cc7\u6599", "text": "<pre><code># \u9084\u539f\u80a1\u50f9(\u8003\u616e\u9664\u6b0a\u606f)\nadj_close = data.get('etl:adj_close')\n\n# \u539f\u59cb\u80a1\u50f9\nraw_close = data.get('price:\u6536\u76e4\u50f9')\n\n# \u6210\u4ea4\u91cf\nvolume = data.get('price:\u6210\u4ea4\u80a1\u6578')\n</code></pre>"}, {"location": "architecture/data_flow/#_16", "title": "\u8ca1\u5831\u8cc7\u6599", "text": "<pre><code># \u6bcf\u80a1\u76c8\u9918\neps = data.get('financial_statement:\u6bcf\u80a1\u76c8\u9918')\n\n# \u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387\nroe = data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\n\n# \u71df\u696d\u5229\u76ca\u7387\noperating_margin = data.get('fundamental_features:\u71df\u696d\u5229\u76ca\u7387')\n</code></pre>"}, {"location": "architecture/data_flow/#_17", "title": "\u6708\u71df\u6536\u8cc7\u6599", "text": "<pre><code># \u7576\u6708\u71df\u6536\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# \u71df\u6536\u5e74\u589e\u7387\nrev_yoy = data.get('monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)')\n</code></pre>"}, {"location": "architecture/data_flow/#_18", "title": "\u7c4c\u78bc\u8cc7\u6599", "text": "<pre><code># \u6295\u4fe1\u8cb7\u8ce3\u8d85\ntrust = data.get('institutional_investors_trading_summary:\u6295\u4fe1\u8cb7\u8ce3\u8d85\u80a1\u6578')\n\n# \u5916\u8cc7\u8cb7\u8ce3\u8d85\nforeign = data.get('institutional_investors_trading_summary:\u5916\u8cc7\u8cb7\u8ce3\u8d85\u80a1\u6578')\n\n# \u878d\u8cc7\u4f7f\u7528\u7387\nmargin_ratio = data.get('margin_transactions:\u878d\u8cc7\u4f7f\u7528\u7387')\n</code></pre>"}, {"location": "architecture/data_flow/#_19", "title": "\u8cc7\u6599\u5132\u5b58\u8207\u5206\u4eab", "text": ""}, {"location": "architecture/data_flow/#csv", "title": "\u5132\u5b58\u8cc7\u6599\u81f3 CSV", "text": "<pre><code>close = data.get('price:\u6536\u76e4\u50f9')\n\n# \u5132\u5b58\u6574\u500b DataFrame\nclose.to_csv('close_prices.csv')\n\n# \u5132\u5b58\u7279\u5b9a\u80a1\u7968\nclose[['2330', '2317']].to_csv('selected_stocks.csv')\n</code></pre>"}, {"location": "architecture/data_flow/#csv_1", "title": "\u5f9e CSV \u8f09\u5165\u8cc7\u6599", "text": "<pre><code>import pandas as pd\n\n# \u8f09\u5165 CSV\nclose = pd.read_csv('close_prices.csv', index_col=0, parse_dates=True)\n\n# \u8f49\u63db\u70ba FinlabDataFrame\nfrom finlab.dataframe import FinlabDataFrame\nclose = FinlabDataFrame(close)\n\n# \u73fe\u5728\u53ef\u4ee5\u4f7f\u7528 FinLab \u7684\u65b9\u6cd5\nma20 = close.average(20)\n</code></pre>"}, {"location": "architecture/data_flow/#_20", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u6578\u64da\u6559\u5b78</li> <li>finlab.data API Reference</li> <li>FinlabDataFrame API Reference</li> <li>\u6a21\u7d44\u67b6\u69cb\u5716</li> </ul>"}, {"location": "architecture/extending_finlab/", "title": "\u64f4\u5145 FinLab \u958b\u767c\u6307\u5357", "text": "<p>\u672c\u6587\u8aaa\u660e\u5982\u4f55\u8ca2\u737b\u7a0b\u5f0f\u78bc\u3001\u8a2d\u5b9a\u958b\u767c\u74b0\u5883\u3001\u9075\u5faa\u7a0b\u5f0f\u78bc\u98a8\u683c,\u4ee5\u53ca\u5982\u4f55\u64f4\u5145 FinLab \u7684\u529f\u80fd\u3002</p>"}, {"location": "architecture/extending_finlab/#_1", "title": "\u958b\u767c\u74b0\u5883\u8a2d\u5b9a", "text": ""}, {"location": "architecture/extending_finlab/#1-fork-clone", "title": "1. Fork \u8207 Clone \u5c08\u6848", "text": "<pre><code># Fork finlab-python/finlab \u5230\u4f60\u7684 GitHub \u5e33\u865f\n\n# Clone \u4f60\u7684 fork\ngit clone https://github.com/YOUR_USERNAME/finlab.git\ncd finlab\n\n# \u65b0\u589e upstream remote\ngit remote add upstream https://github.com/finlab-python/finlab.git\n</code></pre>"}, {"location": "architecture/extending_finlab/#2", "title": "2. \u5b89\u88dd\u958b\u767c\u4f9d\u8cf4", "text": "<pre><code># \u4f7f\u7528 uv \u7ba1\u7406\u4f9d\u8cf4\npip install uv\n\n# \u5b89\u88dd\u6240\u6709\u958b\u767c\u4f9d\u8cf4\nuv sync --all-groups\n\n# \u6216\u4f7f\u7528 pip\npip install -e \".[dev,docs,test]\"\n</code></pre>"}, {"location": "architecture/extending_finlab/#3", "title": "3. \u57f7\u884c\u6e2c\u8a66", "text": "<pre><code># \u57f7\u884c\u6240\u6709\u6e2c\u8a66\nuv run pytest\n\n# \u57f7\u884c\u7279\u5b9a\u6e2c\u8a66\nuv run pytest tests/backtest_test.py\n\n# \u57f7\u884c\u6e2c\u8a66\u4e26\u7522\u751f\u8986\u84cb\u7387\u5831\u544a\nuv run pytest --cov=finlab --cov-report=html\n</code></pre>"}, {"location": "architecture/extending_finlab/#_2", "title": "\u7a0b\u5f0f\u78bc\u98a8\u683c\u6307\u5357", "text": ""}, {"location": "architecture/extending_finlab/#python", "title": "Python \u98a8\u683c", "text": "<p>\u9075\u5faa PEP 8 \u8207 Google Python Style Guide</p> <pre><code># \u597d\u7684\u7bc4\u4f8b\ndef calculate_moving_average(prices, window=20):\n    \"\"\"\u8a08\u7b97\u79fb\u52d5\u5e73\u5747\n\n    Args:\n        prices (pd.Series): \u50f9\u683c\u5e8f\u5217\n        window (int): \u8996\u7a97\u5927\u5c0f,\u9810\u8a2d 20\n\n    Returns:\n        pd.Series: \u79fb\u52d5\u5e73\u5747\u5e8f\u5217\n    \"\"\"\n    return prices.rolling(window).mean()\n\n# \u4e0d\u597d\u7684\u7bc4\u4f8b\ndef calc_ma(p, w=20):  # \u547d\u540d\u4e0d\u6e05\u695a\n    return p.rolling(w).mean()  # \u7f3a\u5c11\u6587\u6a94\n</code></pre>"}, {"location": "architecture/extending_finlab/#docstring", "title": "Docstring \u683c\u5f0f", "text": "<p>\u4f7f\u7528 Google \u98a8\u683c:</p> <pre><code>def sim(position, resample='M', **kwargs):\n    \"\"\"\u57f7\u884c\u56de\u6e2c\n\n    Args:\n        position (pd.DataFrame): \u6301\u5009\u8a0a\u865f\n        resample (str): \u91cd\u63a1\u6a23\u983b\u7387\n        **kwargs: \u5176\u4ed6\u53c3\u6578\n\n    Returns:\n        Report: \u56de\u6e2c\u5831\u544a\u7269\u4ef6\n\n    Raises:\n        ValueError: \u7576 position \u683c\u5f0f\u4e0d\u6b63\u78ba\u6642\n\n    Examples:\n        ```python\n        position = close &gt; close.average(20)\n        report = sim(position, resample='M')\n        ```\n    \"\"\"\n    pass\n</code></pre>"}, {"location": "architecture/extending_finlab/#_3", "title": "\u64f4\u5145\u529f\u80fd\u7bc4\u4f8b", "text": ""}, {"location": "architecture/extending_finlab/#1", "title": "1. \u65b0\u589e\u81ea\u8a02\u6280\u8853\u6307\u6a19", "text": "<p>\u5728 <code>finlab/dataframe.py</code> \u65b0\u589e\u65b9\u6cd5:</p> <pre><code>class FinlabDataFrame(pd.DataFrame):\n    # ... \u73fe\u6709\u7a0b\u5f0f\u78bc\n\n    def custom_indicator(self, param1, param2=10):\n        \"\"\"\u81ea\u8a02\u6280\u8853\u6307\u6a19\n\n        Args:\n            param1 (float): \u53c3\u6578 1\n            param2 (int): \u53c3\u6578 2,\u9810\u8a2d 10\n\n        Returns:\n            FinlabDataFrame: \u8a08\u7b97\u7d50\u679c\n        \"\"\"\n        result = self.rolling(param2).apply(\n            lambda x: your_calculation(x, param1)\n        )\n        return FinlabDataFrame(result)\n</code></pre>"}, {"location": "architecture/extending_finlab/#2_1", "title": "2. \u65b0\u589e\u81ea\u8a02\u5206\u6790\u6a21\u7d44", "text": "<p>\u7e7c\u627f <code>Analysis</code> \u985e\u5225:</p> <pre><code># finlab/analysis/custom_analysis.py\nfrom finlab.analysis import Analysis\n\nclass CustomAnalysis(Analysis):\n\n    def calculate_trade_info(self, report):\n        \"\"\"\u8a08\u7b97\u984d\u5916\u4ea4\u6613\u8cc7\u8a0a\"\"\"\n        custom_data = ...  # \u4f60\u7684\u908f\u8f2f\n        return [['custom_field', custom_data, 'entry_sig_date']]\n\n    def analyze(self, report):\n        \"\"\"\u57f7\u884c\u5206\u6790\"\"\"\n        trades = report.get_trades()\n        result = ...  # \u4f60\u7684\u5206\u6790\u908f\u8f2f\n        return result\n\n    def display(self):\n        \"\"\"\u986f\u793a\u7d50\u679c\"\"\"\n        return self.result\n</code></pre>"}, {"location": "architecture/extending_finlab/#3_1", "title": "3. \u65b0\u589e\u81ea\u8a02\u5e02\u5834", "text": "<p>\u7e7c\u627f <code>Market</code> \u985e\u5225:</p> <pre><code># finlab/markets/custom.py\nfrom finlab.market import Market\nimport pandas as pd\n\nclass CustomMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'custom_market'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u4f60\u7684\u8cc7\u6599\u8f09\u5165\u908f\u8f2f\n        df = pd.read_csv('path/to/data.csv')\n        return df\n</code></pre>"}, {"location": "architecture/extending_finlab/#_4", "title": "\u6e2c\u8a66\u64b0\u5beb\u6307\u5357", "text": ""}, {"location": "architecture/extending_finlab/#_5", "title": "\u6e2c\u8a66\u7d50\u69cb", "text": "<pre><code># tests/test_custom_feature.py\nimport unittest\nfrom finlab import data\nfrom finlab.dataframe import FinlabDataFrame\n\nclass TestCustomFeature(unittest.TestCase):\n\n    def setUp(self):\n        \"\"\"\u6e2c\u8a66\u524d\u6e96\u5099\"\"\"\n        self.close = data.get('price:\u6536\u76e4\u50f9')\n\n    def test_custom_indicator(self):\n        \"\"\"\u6e2c\u8a66\u81ea\u8a02\u6307\u6a19\"\"\"\n        result = self.close.custom_indicator(param1=0.5, param2=10)\n\n        # \u6aa2\u67e5\u7d50\u679c\u578b\u5225\n        self.assertIsInstance(result, FinlabDataFrame)\n\n        # \u6aa2\u67e5\u7d50\u679c\u5f62\u72c0\n        self.assertEqual(result.shape, self.close.shape)\n\n        # \u6aa2\u67e5\u7d50\u679c\u503c\n        self.assertFalse(result.isna().all().all())\n\n    def tearDown(self):\n        \"\"\"\u6e2c\u8a66\u5f8c\u6e05\u7406\"\"\"\n        pass\n</code></pre>"}, {"location": "architecture/extending_finlab/#_6", "title": "\u8ca2\u737b\u6d41\u7a0b", "text": ""}, {"location": "architecture/extending_finlab/#1_1", "title": "1. \u5efa\u7acb\u5206\u652f", "text": "<pre><code># \u66f4\u65b0 main \u5206\u652f\ngit checkout main\ngit pull upstream main\n\n# \u5efa\u7acb\u65b0\u5206\u652f\ngit checkout -b feature/your-feature-name\n</code></pre>"}, {"location": "architecture/extending_finlab/#2_2", "title": "2. \u958b\u767c\u8207\u6e2c\u8a66", "text": "<pre><code># \u64b0\u5beb\u7a0b\u5f0f\u78bc\n# ...\n\n# \u57f7\u884c\u6e2c\u8a66\nuv run pytest\n\n# \u57f7\u884c linter\nuv run ruff check .\nuv run ruff format .\n</code></pre>"}, {"location": "architecture/extending_finlab/#3_2", "title": "3. \u63d0\u4ea4\u7a0b\u5f0f\u78bc", "text": "<pre><code># \u63d0\u4ea4\u8b8a\u66f4\ngit add .\ngit commit -m \"feat: add custom indicator\"\n\n# \u63a8\u9001\u81f3\u4f60\u7684 fork\ngit push origin feature/your-feature-name\n</code></pre>"}, {"location": "architecture/extending_finlab/#4-pull-request", "title": "4. \u5efa\u7acb Pull Request", "text": "<ol> <li>\u524d\u5f80 GitHub \u4e0a\u4f60\u7684 fork</li> <li>\u9ede\u64ca \"New Pull Request\"</li> <li>\u586b\u5beb PR \u63cf\u8ff0(\u8aaa\u660e\u8b8a\u66f4\u5167\u5bb9\u8207\u76ee\u7684)</li> <li>\u7b49\u5f85\u7a0b\u5f0f\u78bc\u5be9\u67e5</li> </ol>"}, {"location": "architecture/extending_finlab/#_7", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>GitHub Repository</li> <li>Issue Tracker</li> <li>\u6a21\u7d44\u67b6\u69cb\u5716</li> </ul>"}, {"location": "architecture/module_relationships/", "title": "FinLab \u6a21\u7d44\u67b6\u69cb\u8207\u95dc\u4fc2\u5716", "text": "<p>\u672c\u6587\u900f\u904e\u8996\u89ba\u5316\u5716\u8868\u8aaa\u660e FinLab \u5404\u6a21\u7d44\u7684\u95dc\u4fc2\u3001\u8cc7\u6599\u6d41\u5411\u3001\u5de5\u4f5c\u6d41\u7a0b,\u5e6b\u52a9\u4f60\u5feb\u901f\u7406\u89e3\u7cfb\u7d71\u67b6\u69cb\u3002</p>"}, {"location": "architecture/module_relationships/#_1", "title": "\u6574\u9ad4\u67b6\u69cb\u5716", "text": "<p>FinLab \u63a1\u7528\u5206\u5c64\u67b6\u69cb,\u5f9e\u5e95\u5c64\u7684\u8cc7\u6599\u5c64\u5230\u9802\u5c64\u7684\u4ea4\u6613\u5c64:</p> <pre><code>graph TB\n    subgraph \"\u4ea4\u6613\u5c64 Trading Layer\"\n        portfolio[finlab.portfolio&lt;br/&gt;\u7d44\u5408\u7ba1\u7406]\n        online[finlab.online&lt;br/&gt;\u5be6\u76e4\u4ea4\u6613]\n    end\n\n    subgraph \"\u5206\u6790\u5c64 Analysis Layer\"\n        analysis[finlab.analysis&lt;br/&gt;\u7b56\u7565\u5206\u6790]\n        optimize[finlab.optimize&lt;br/&gt;\u53c3\u6578\u512a\u5316]\n        plot[finlab.plot&lt;br/&gt;\u8cc7\u6599\u8996\u89ba\u5316]\n    end\n\n    subgraph \"\u56de\u6e2c\u5c64 Backtest Layer\"\n        backtest[finlab.backtest&lt;br/&gt;\u56de\u6e2c\u5f15\u64ce]\n        report[finlab.report&lt;br/&gt;\u5831\u544a\u751f\u6210]\n        market[finlab.market&lt;br/&gt;\u5e02\u5834\u7269\u4ef6]\n    end\n\n    subgraph \"\u7b56\u7565\u5c64 Strategy Layer\"\n        ml_feature[finlab.ml.feature&lt;br/&gt;\u7279\u5fb5\u5de5\u7a0b]\n        ml_label[finlab.ml.label&lt;br/&gt;\u6a19\u7c64\u751f\u6210]\n        ml_model[finlab.ml.qlib&lt;br/&gt;\u6a21\u578b\u8a13\u7df4]\n    end\n\n    subgraph \"\u8cc7\u6599\u5c64 Data Layer\"\n        data[finlab.data&lt;br/&gt;\u8cc7\u6599\u5b58\u53d6]\n        dataframe[finlab.dataframe&lt;br/&gt;FinlabDataFrame]\n    end\n\n    %% \u8cc7\u6599\u6d41\u5411\n    data --&gt; dataframe\n    dataframe --&gt; ml_feature\n    dataframe --&gt; backtest\n    ml_feature --&gt; ml_label\n    ml_label --&gt; ml_model\n    ml_model --&gt; backtest\n    backtest --&gt; report\n    report --&gt; analysis\n    report --&gt; optimize\n    analysis --&gt; portfolio\n    optimize --&gt; backtest\n    portfolio --&gt; online\n    market --&gt; backtest\n    dataframe --&gt; plot\n\n    style data fill:#e1f5ff\n    style backtest fill:#fff4e1\n    style analysis fill:#e8f5e9\n    style online fill:#fce4ec</code></pre>"}, {"location": "architecture/module_relationships/#_2", "title": "\u6838\u5fc3\u5de5\u4f5c\u6d41\u7a0b", "text": ""}, {"location": "architecture/module_relationships/#1", "title": "\u6d41\u7a0b 1: \u57fa\u790e\u7b56\u7565\u958b\u767c", "text": "<p>\u5f9e\u8cc7\u6599\u8f09\u5165\u5230\u5831\u544a\u751f\u6210\u7684\u57fa\u672c\u6d41\u7a0b:</p> <pre><code>sequenceDiagram\n    participant User as \u4f7f\u7528\u8005\n    participant Data as finlab.data\n    participant DF as FinlabDataFrame\n    participant Backtest as finlab.backtest\n    participant Report as Report \u7269\u4ef6\n\n    User-&gt;&gt;Data: data.get('price:\u6536\u76e4\u50f9')\n    Data--&gt;&gt;User: DataFrame\n    User-&gt;&gt;DF: \u8a08\u7b97\u6307\u6a19 .average(20)\n    DF--&gt;&gt;User: FinlabDataFrame\n    User-&gt;&gt;DF: \u7522\u751f\u8a0a\u865f close &gt; ma20\n    DF--&gt;&gt;User: bool DataFrame\n    User-&gt;&gt;Backtest: sim(position, resample='M')\n    Backtest-&gt;&gt;Report: \u5efa\u7acb Report \u7269\u4ef6\n    Report--&gt;&gt;User: \u56de\u6e2c\u7d50\u679c\n    User-&gt;&gt;Report: report.display()\n    Report--&gt;&gt;User: \u986f\u793a\u7e3e\u6548\u5716\u8868</code></pre>"}, {"location": "architecture/module_relationships/#2", "title": "\u6d41\u7a0b 2: \u7b56\u7565\u512a\u5316", "text": "<p>\u4f7f\u7528 <code>sim_conditions()</code> \u6e2c\u8a66\u591a\u500b\u689d\u4ef6\u7d44\u5408:</p> <pre><code>flowchart TD\n    A[\u5b9a\u7fa9\u591a\u500b\u5019\u9078\u689d\u4ef6] --&gt; B[\u7d44\u5408\u6210 dict]\n    B --&gt; C{\u4f7f\u7528 sim_conditions}\n    C --&gt; D[\u751f\u6210\u6240\u6709\u7d44\u5408&lt;br/&gt;2^n - 1 \u7a2e]\n    D --&gt; E[\u5c0d\u6bcf\u500b\u7d44\u5408\u57f7\u884c\u56de\u6e2c]\n    E --&gt; F[\u6536\u96c6\u6240\u6709 Report]\n    F --&gt; G[\u5efa\u7acb ReportCollection]\n    G --&gt; H{\u9078\u64c7\u8996\u89ba\u5316\u65b9\u5f0f}\n    H --&gt;|\u71b1\u529b\u5716| I[plot_stats heatmap]\n    H --&gt;|\u68d2\u72c0\u5716| J[plot_stats bar]\n    H --&gt;|\u6298\u7dda\u5716| K[plot_creturns]\n    I --&gt; L[\u627e\u51fa\u6700\u4f73\u7d44\u5408]\n    J --&gt; L\n    K --&gt; L\n    L --&gt; M[\u4f7f\u7528\u6700\u4f73\u7d44\u5408\u91cd\u65b0\u56de\u6e2c]\n\n    style C fill:#fff4e1\n    style G fill:#e8f5e9\n    style L fill:#fce4ec</code></pre>"}, {"location": "architecture/module_relationships/#3", "title": "\u6d41\u7a0b 3: \u6a5f\u5668\u5b78\u7fd2\u7b56\u7565", "text": "<p>\u5b8c\u6574\u7684\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u958b\u767c\u6d41\u7a0b:</p> <pre><code>flowchart TD\n    A[\u8f09\u5165\u539f\u59cb\u8cc7\u6599&lt;br/&gt;finlab.data] --&gt; B[\u7279\u5fb5\u5de5\u7a0b&lt;br/&gt;finlab.ml.feature]\n    B --&gt; C[\u6a19\u7c64\u751f\u6210&lt;br/&gt;finlab.ml.label]\n    C --&gt; D[\u6a21\u578b\u8a13\u7df4&lt;br/&gt;finlab.ml.qlib]\n    D --&gt; E[\u9810\u6e2c\u6301\u5009\u6b0a\u91cd]\n    E --&gt; F[\u56de\u6e2c&lt;br/&gt;finlab.backtest.sim]\n    F --&gt; G{\u7e3e\u6548\u662f\u5426\u6eff\u610f?}\n    G --&gt;|\u5426| H[\u8abf\u6574\u7279\u5fb5\u6216\u6a21\u578b]\n    H --&gt; B\n    G --&gt;|\u662f| I[\u57f7\u884c\u6df1\u5ea6\u5206\u6790]\n    I --&gt; J[\u6a23\u672c\u5916\u6e2c\u8a66]\n    J --&gt; K{\u901a\u904e\u9a57\u8b49?}\n    K --&gt;|\u5426| H\n    K --&gt;|\u662f| L[\u90e8\u7f72\u5be6\u76e4]\n\n    style B fill:#e1f5ff\n    style D fill:#fff4e1\n    style I fill:#e8f5e9\n    style L fill:#fce4ec</code></pre>"}, {"location": "architecture/module_relationships/#4", "title": "\u6d41\u7a0b 4: \u5be6\u76e4\u4ea4\u6613", "text": "<p>\u5f9e\u56de\u6e2c\u5230\u5be6\u76e4\u4ea4\u6613\u7684\u5b8c\u6574\u6d41\u7a0b:</p> <pre><code>sequenceDiagram\n    participant User as \u4f7f\u7528\u8005\n    participant Report as Report \u7269\u4ef6\n    participant Account as Account \u7269\u4ef6\n    participant Executor as OrderExecutor\n    participant Broker as \u5238\u5546 API\n\n    User-&gt;&gt;Report: report.upload(name)\n    Report--&gt;&gt;User: \u4e0a\u50b3\u6210\u529f\n    User-&gt;&gt;Report: report.position_info()\n    Report--&gt;&gt;User: \u6301\u80a1\u6e05\u55ae\n    User-&gt;&gt;Account: \u8a2d\u5b9a\u5238\u5546\u5e33\u6236\n    Account--&gt;&gt;User: \u9023\u7dda\u6210\u529f\n    User-&gt;&gt;Executor: OrderExecutor(report, account)\n    Executor-&gt;&gt;Executor: \u8a08\u7b97\u8cb7\u8ce3\u6e05\u55ae\n    User-&gt;&gt;Executor: executor.execute()\n    Executor-&gt;&gt;Broker: \u767c\u9001\u8cb7\u55ae\n    Broker--&gt;&gt;Executor: \u8cb7\u55ae\u56de\u5831\n    Executor-&gt;&gt;Broker: \u767c\u9001\u8ce3\u55ae\n    Broker--&gt;&gt;Executor: \u8ce3\u55ae\u56de\u5831\n    Executor--&gt;&gt;User: \u57f7\u884c\u5b8c\u6210\n    User-&gt;&gt;Account: \u67e5\u8a62\u90e8\u4f4d\n    Account-&gt;&gt;Broker: \u53d6\u5f97\u90e8\u4f4d\u8cc7\u8a0a\n    Broker--&gt;&gt;Account: \u90e8\u4f4d\u8cc7\u6599\n    Account--&gt;&gt;User: \u986f\u793a\u5be6\u76e4\u6301\u80a1</code></pre>"}, {"location": "architecture/module_relationships/#_3", "title": "\u6a21\u7d44\u529f\u80fd\u5c0d\u7167\u8868", "text": "\u6a21\u7d44 \u4e3b\u8981\u985e\u5225/\u51fd\u6578 \u7528\u9014 \u4f9d\u8cf4\u6a21\u7d44 finlab.data <code>get()</code> \u5f9e\u8cc7\u6599\u5eab\u53d6\u5f97\u8ca1\u7d93\u8cc7\u6599 (\u7121) finlab.dataframe <code>FinlabDataFrame</code> \u589e\u5f37\u7248 DataFrame,\u652f\u63f4\u91d1\u878d\u904b\u7b97 pandas finlab.backtest <code>sim()</code> \u56de\u6e2c\u5f15\u64ce,\u6a21\u64ec\u4ea4\u6613 data, dataframe, market finlab.report <code>Report</code> \u56de\u6e2c\u5831\u544a,\u7e3e\u6548\u5206\u6790 backtest finlab.optimize <code>sim_conditions()</code>, <code>ReportCollection</code> \u6e2c\u8a66\u591a\u500b\u689d\u4ef6\u7d44\u5408 backtest finlab.analysis <code>LiquidityAnalysis</code>, <code>MaeMfeAnalysis</code>, \u7b49 \u6df1\u5ea6\u7b56\u7565\u5206\u6790 report finlab.market <code>Market</code>, <code>TWMarket</code>, <code>USMarket</code> \u5e02\u5834\u8cc7\u6599\u8207\u7279\u6027 data finlab.ml.feature <code>add_ta()</code>, <code>add_fundamental()</code> \u6a5f\u5668\u5b78\u7fd2\u7279\u5fb5\u5de5\u7a0b data finlab.ml.label <code>cls_label()</code>, <code>reg_label()</code> \u6a5f\u5668\u5b78\u7fd2\u6a19\u7c64\u751f\u6210 data finlab.ml.qlib <code>train()</code> \u6a21\u578b\u8a13\u7df4 ml.feature, ml.label finlab.portfolio <code>Portfolio</code>, <code>PortfolioSyncManager</code> \u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406 report finlab.online <code>OrderExecutor</code>, <code>SinopacAccount</code> \u5be6\u76e4\u4ea4\u6613\u57f7\u884c report, portfolio finlab.plot <code>plot_creturns()</code>, <code>plot_heatmap()</code> \u8cc7\u6599\u8996\u89ba\u5316 dataframe"}, {"location": "architecture/module_relationships/#_4", "title": "\u8cc7\u6599\u6d41\u5411\u5716", "text": "<p>\u5f9e\u8cc7\u6599\u4f86\u6e90\u5230\u5be6\u76e4\u4ea4\u6613\u7684\u5b8c\u6574\u8cc7\u6599\u6d41:</p> <pre><code>flowchart LR\n    A[\u8cc7\u6599\u4f86\u6e90&lt;br/&gt;GCS/BigQuery] --&gt; B[finlab.data.get]\n    B --&gt; C[DataFrame]\n    C --&gt; D{\u7528\u9014?}\n\n    D --&gt;|\u6280\u8853\u6307\u6a19| E[FinlabDataFrame&lt;br/&gt;\u904b\u7b97\u65b9\u6cd5]\n    D --&gt;|\u6a5f\u5668\u5b78\u7fd2| F[ml.feature&lt;br/&gt;\u7279\u5fb5\u5de5\u7a0b]\n\n    E --&gt; G[\u7522\u751f\u8a0a\u865f&lt;br/&gt;bool DataFrame]\n    F --&gt; H[ml.label&lt;br/&gt;\u6a19\u7c64\u751f\u6210]\n    H --&gt; I[ml.qlib&lt;br/&gt;\u6a21\u578b\u8a13\u7df4]\n    I --&gt; J[\u9810\u6e2c\u6b0a\u91cd&lt;br/&gt;float DataFrame]\n\n    G --&gt; K[finlab.backtest.sim]\n    J --&gt; K\n\n    K --&gt; L[Report \u7269\u4ef6]\n    L --&gt; M{\u5206\u6790\u985e\u578b?}\n\n    M --&gt;|\u53c3\u6578\u512a\u5316| N[optimize.sim_conditions]\n    M --&gt;|\u6df1\u5ea6\u5206\u6790| O[analysis \u6a21\u7d44]\n    M --&gt;|\u8996\u89ba\u5316| P[plot \u6a21\u7d44]\n    M --&gt;|\u5be6\u76e4\u4ea4\u6613| Q[online.OrderExecutor]\n\n    N --&gt; L\n    O --&gt; R[\u5206\u6790\u5831\u544a]\n    P --&gt; S[\u4e92\u52d5\u5f0f\u5716\u8868]\n    Q --&gt; T[\u5238\u5546 API]\n    T --&gt; U[\u5be6\u76e4\u90e8\u4f4d]\n\n    style B fill:#e1f5ff\n    style K fill:#fff4e1\n    style O fill:#e8f5e9\n    style Q fill:#fce4ec</code></pre>"}, {"location": "architecture/module_relationships/#_5", "title": "\u985e\u5225\u7e7c\u627f\u95dc\u4fc2", "text": ""}, {"location": "architecture/module_relationships/#market", "title": "Market \u7e7c\u627f\u6a39", "text": "<pre><code>classDiagram\n    class Market {\n        &lt;&lt;abstract&gt;&gt;\n        +get_name() str\n        +get_freq() str\n        +get_price() DataFrame\n        +get_benchmark() Series\n        +get_asset_id_to_name() dict\n    }\n\n    class TWMarket {\n        +get_name() \"tw_stock\"\n        +get_benchmark() \u52a0\u6b0a\u6307\u6578\n        +get_industry() dict\n        +market_close_at_timestamp()\n    }\n\n    class USMarket {\n        +get_name() \"us_stock\"\n        +get_benchmark() S&amp;P 500\n        +market_close_at_timestamp()\n    }\n\n    class ROTCMarket {\n        +get_name() \"rotc_stock\"\n    }\n\n    class CustomMarket {\n        +get_name() \"custom\"\n        +\u81ea\u8a02\u8cc7\u6599\u4f86\u6e90\n    }\n\n    Market &lt;|-- TWMarket\n    Market &lt;|-- USMarket\n    Market &lt;|-- ROTCMarket\n    Market &lt;|-- CustomMarket</code></pre>"}, {"location": "architecture/module_relationships/#analysis", "title": "Analysis \u7e7c\u627f\u6a39", "text": "<pre><code>classDiagram\n    class Analysis {\n        &lt;&lt;abstract&gt;&gt;\n        +calculate_trade_info() list\n        +analyze() dict\n        +display() Figure\n        +is_market_supported() bool\n    }\n\n    class LiquidityAnalysis {\n        +\u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c\n        +\u6f32\u8dcc\u505c\u3001\u6210\u4ea4\u91cf\n    }\n\n    class MaeMfeAnalysis {\n        +\u6ce2\u52d5\u5206\u6790\n        +MAE/MFE 12 \u5b50\u5716\n    }\n\n    class PeriodStatsAnalysis {\n        +\u6642\u671f\u7a69\u5b9a\u6027\n        +\u5e74\u5ea6\u3001\u6708\u5ea6\u8868\u73fe\n    }\n\n    class InequalityAnalysis {\n        +\u4e0d\u7b49\u5f0f\u56e0\u5b50\n        +\u57fa\u5c3c\u4fc2\u6578\n    }\n\n    class AlphaBetaAnalysis {\n        +Alpha/Beta \u5206\u6790\n    }\n\n    class DrawdownAnalysis {\n        +\u56de\u64a4\u5206\u6790\n    }\n\n    class CustomAnalysis {\n        +\u81ea\u8a02\u5206\u6790\u908f\u8f2f\n    }\n\n    Analysis &lt;|-- LiquidityAnalysis\n    Analysis &lt;|-- MaeMfeAnalysis\n    Analysis &lt;|-- PeriodStatsAnalysis\n    Analysis &lt;|-- InequalityAnalysis\n    Analysis &lt;|-- AlphaBetaAnalysis\n    Analysis &lt;|-- DrawdownAnalysis\n    Analysis &lt;|-- CustomAnalysis</code></pre>"}, {"location": "architecture/module_relationships/#finlabdataframe", "title": "FinlabDataFrame \u7e7c\u627f\u95dc\u4fc2", "text": "<pre><code>classDiagram\n    class DataFrame {\n        &lt;&lt;pandas&gt;&gt;\n        +\u57fa\u672c DataFrame \u529f\u80fd\n    }\n\n    class FinlabDataFrame {\n        +average() \u79fb\u52d5\u5e73\u5747\n        +is_largest() \u6392\u540d\n        +is_smallest() \u6392\u540d\n        +quantile() \u5206\u4f4d\u6578\n        +hold_until() \u9032\u51fa\u5834\u8a9e\u6cd5\u7cd6\n        +and_then() \u7d44\u5408\u908f\u8f2f\n    }\n\n    DataFrame &lt;|-- FinlabDataFrame</code></pre>"}, {"location": "architecture/module_relationships/#_6", "title": "\u4f7f\u7528\u5efa\u8b70", "text": ""}, {"location": "architecture/module_relationships/#_7", "title": "\u65b0\u624b\u5b78\u7fd2\u8def\u5f91", "text": "<pre><code>flowchart TD\n    A[\u958b\u59cb] --&gt; B[\u5b78\u7fd2 finlab.data&lt;br/&gt;\u8cc7\u6599\u5b58\u53d6]\n    B --&gt; C[\u5b78\u7fd2 FinlabDataFrame&lt;br/&gt;\u6307\u6a19\u8a08\u7b97]\n    C --&gt; D[\u5b78\u7fd2 finlab.backtest&lt;br/&gt;\u57fa\u790e\u56de\u6e2c]\n    D --&gt; E[\u5b78\u7fd2 Report \u7269\u4ef6&lt;br/&gt;\u7e3e\u6548\u5206\u6790]\n    E --&gt; F{\u60f3\u8981\u6df1\u5165?}\n    F --&gt;|\u662f| G[\u5b78\u7fd2 finlab.analysis&lt;br/&gt;\u6df1\u5ea6\u5206\u6790]\n    F --&gt;|\u5426| K[\u958b\u59cb\u5be6\u76e4\u4ea4\u6613&lt;br/&gt;finlab.online]\n    G --&gt; H[\u5b78\u7fd2 finlab.optimize&lt;br/&gt;\u53c3\u6578\u512a\u5316]\n    H --&gt; I[\u5b78\u7fd2\u5b8c\u6574\u5de5\u4f5c\u6d41\u7a0b]\n    I --&gt; J{\u60f3\u7528\u6a5f\u5668\u5b78\u7fd2?}\n    J --&gt;|\u662f| L[\u5b78\u7fd2 finlab.ml&lt;br/&gt;\u6a5f\u5668\u5b78\u7fd2\u6a21\u7d44]\n    J --&gt;|\u5426| K\n    L --&gt; K\n    K --&gt; M[\u7cbe\u901a!]\n\n    style A fill:#e1f5ff\n    style D fill:#fff4e1\n    style G fill:#e8f5e9\n    style K fill:#fce4ec\n    style M fill:#c8e6c9</code></pre>"}, {"location": "architecture/module_relationships/#_8", "title": "\u9032\u968e\u958b\u767c\u8def\u5f91", "text": "<pre><code>flowchart TD\n    A[\u719f\u6089\u57fa\u790e\u56de\u6e2c] --&gt; B{\u958b\u767c\u9700\u6c42?}\n    B --&gt;|\u591a\u7b56\u7565\u7d44\u5408| C[\u5b78\u7fd2 finlab.portfolio&lt;br/&gt;\u7d44\u5408\u7ba1\u7406]\n    B --&gt;|\u81ea\u8a02\u5e02\u5834| D[\u7e7c\u627f Market \u985e\u5225&lt;br/&gt;\u958b\u767c\u81ea\u8a02\u5e02\u5834]\n    B --&gt;|\u81ea\u8a02\u5206\u6790| E[\u7e7c\u627f Analysis \u985e\u5225&lt;br/&gt;\u958b\u767c\u5206\u6790\u6a21\u7d44]\n    B --&gt;|\u6a5f\u5668\u5b78\u7fd2| F[\u5b78\u7fd2 finlab.ml&lt;br/&gt;\u7279\u5fb5\u3001\u6a19\u7c64\u3001\u6a21\u578b]\n    C --&gt; G[\u591a\u7b56\u7565\u5be6\u76e4]\n    D --&gt; H[\u56de\u6e2c\u6d77\u5916\u5e02\u5834/\u52a0\u5bc6\u8ca8\u5e63]\n    E --&gt; I[\u5ba2\u88fd\u5316\u5206\u6790\u5831\u544a]\n    F --&gt; J[\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565]\n    G --&gt; K[\u9032\u968e\u61c9\u7528]\n    H --&gt; K\n    I --&gt; K\n    J --&gt; K\n\n    style A fill:#e1f5ff\n    style B fill:#fff4e1\n    style K fill:#c8e6c9</code></pre>"}, {"location": "architecture/module_relationships/#_9", "title": "\u6a21\u7d44\u9593\u7684\u8cc7\u6599\u4ea4\u63db\u683c\u5f0f", "text": ""}, {"location": "architecture/module_relationships/#_10", "title": "\u4e3b\u8981\u8cc7\u6599\u683c\u5f0f", "text": "\u8cc7\u6599\u985e\u578b \u683c\u5f0f \u8aaa\u660e \u7bc4\u4f8b \u50f9\u683c\u8cc7\u6599 <code>pd.DataFrame</code> index: \u65e5\u671f, columns: \u80a1\u7968\u4ee3\u865f <code>data.get('price:\u6536\u76e4\u50f9')</code> \u9078\u80a1\u8a0a\u865f <code>pd.DataFrame(bool)</code> True \u4ee3\u8868\u8cb7\u5165, False \u4ee3\u8868\u4e0d\u6301\u6709 <code>close &gt; ma20</code> \u6301\u5009\u6b0a\u91cd <code>pd.DataFrame(float)</code> 0-1 \u4e4b\u9593,\u4ee3\u8868\u6301\u5009\u6bd4\u4f8b ML \u6a21\u578b\u9810\u6e2c \u4ea4\u6613\u8a18\u9304 <code>pd.DataFrame</code> \u9010\u7b46\u4ea4\u6613\u7684\u8a73\u7d30\u8cc7\u8a0a <code>report.get_trades()</code> \u7e3e\u6548\u6307\u6a19 <code>dict</code> \u7b56\u7565\u7684\u5404\u7a2e\u7d71\u8a08\u6307\u6a19 <code>report.get_stats()</code> \u5c0d\u7167\u6307\u6578 <code>pd.Series</code> \u6642\u9593\u5e8f\u5217\u7684\u50f9\u683c\u8cc7\u6599 <code>TWMarket.get_benchmark()</code>"}, {"location": "architecture/module_relationships/#_11", "title": "\u8a0a\u865f\u8f49\u63db\u6d41\u7a0b", "text": "<pre><code>flowchart LR\n    A[\u689d\u4ef6\u5224\u65b7&lt;br/&gt;close &gt; ma20] --&gt; B[bool DataFrame&lt;br/&gt;True/False]\n    B --&gt; C{\u662f\u5426\u9700\u8981\u51fa\u5834\u908f\u8f2f?}\n    C --&gt;|\u662f| D[hold_until&lt;br/&gt;\u52a0\u5165\u51fa\u5834\u689d\u4ef6]\n    C --&gt;|\u5426| E[\u76f4\u63a5\u4f5c\u70ba position]\n    D --&gt; E\n    E --&gt; F[finlab.backtest.sim&lt;br/&gt;\u57f7\u884c\u56de\u6e2c]\n    F --&gt; G[Report \u7269\u4ef6&lt;br/&gt;\u5305\u542b\u7e3e\u6548\u8207\u4ea4\u6613]\n\n    style B fill:#e1f5ff\n    style D fill:#fff4e1\n    style F fill:#e8f5e9</code></pre>"}, {"location": "architecture/module_relationships/#_12", "title": "\u5e38\u898b\u4f7f\u7528\u6a21\u5f0f", "text": ""}, {"location": "architecture/module_relationships/#1_1", "title": "\u6a21\u5f0f 1: \u5feb\u901f\u9a57\u8b49\u7b56\u7565\u69cb\u60f3", "text": "<pre><code># \u6700\u7c21\u6d41\u7a0b\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\nreport = sim(position, resample='M')\nreport.display()\n</code></pre>"}, {"location": "architecture/module_relationships/#2_1", "title": "\u6a21\u5f0f 2: \u5b8c\u6574\u7b56\u7565\u958b\u767c", "text": "<pre><code># \u5b8c\u6574\u6d41\u7a0b\ndata \u2192 \u6307\u6a19\u8a08\u7b97 \u2192 \u7522\u751f\u8a0a\u865f \u2192 \u53c3\u6578\u512a\u5316 \u2192 \u6df1\u5ea6\u5206\u6790 \u2192 \u6a23\u672c\u5916\u6e2c\u8a66 \u2192 \u5be6\u76e4\u4ea4\u6613\n</code></pre>"}, {"location": "architecture/module_relationships/#3_1", "title": "\u6a21\u5f0f 3: \u6a5f\u5668\u5b78\u7fd2\u7b56\u7565", "text": "<pre><code># ML \u6d41\u7a0b\ndata \u2192 feature engineering \u2192 label generation \u2192 model training \u2192 \u9810\u6e2c \u2192 \u56de\u6e2c \u2192 \u5206\u6790\n</code></pre>"}, {"location": "architecture/module_relationships/#4_1", "title": "\u6a21\u5f0f 4: \u591a\u7b56\u7565\u7d44\u5408", "text": "<pre><code># \u7d44\u5408\u6d41\u7a0b\n\u7b56\u7565 A report \u2192\n\u7b56\u7565 B report \u2192  Portfolio \u2192 PortfolioSyncManager \u2192 \u5be6\u76e4\u591a\u7b56\u7565\n\u7b56\u7565 C report \u2192\n</code></pre>"}, {"location": "architecture/module_relationships/#_13", "title": "\u6548\u80fd\u512a\u5316\u5efa\u8b70", "text": ""}, {"location": "architecture/module_relationships/#_14", "title": "\u8cc7\u6599\u5b58\u53d6", "text": "<pre><code>flowchart TD\n    A[\u9700\u8981\u4f7f\u7528\u8cc7\u6599] --&gt; B{\u8cc7\u6599\u91cf\u5927\u5c0f?}\n    B --&gt;|\u5c0f&lt;br/&gt;\u55ae\u4e00\u80a1\u7968| C[\u76f4\u63a5\u4f7f\u7528 data.get]\n    B --&gt;|\u4e2d&lt;br/&gt;\u6578\u5341\u500b\u6307\u6a19| D[\u4e00\u6b21\u8f09\u5165&lt;br/&gt;\u907f\u514d\u91cd\u8907\u547c\u53eb]\n    B --&gt;|\u5927&lt;br/&gt;\u5927\u91cf\u56de\u6e2c| E[\u8003\u616e\u4f7f\u7528&lt;br/&gt;\u672c\u5730\u5feb\u53d6]\n\n    C --&gt; F[\u57f7\u884c\u7b56\u7565\u908f\u8f2f]\n    D --&gt; F\n    E --&gt; F\n\n    style C fill:#e8f5e9\n    style E fill:#fff4e1</code></pre>"}, {"location": "architecture/module_relationships/#_15", "title": "\u56de\u6e2c\u512a\u5316", "text": "\u74f6\u9838 \u512a\u5316\u65b9\u6cd5 \u689d\u4ef6\u7d44\u5408\u904e\u591a \u5148\u7528\u55ae\u4e00\u689d\u4ef6\u7be9\u9078,\u79fb\u9664\u5dee\u7684\u689d\u4ef6 \u8cc7\u6599\u7bc4\u570d\u904e\u5927 \u7e2e\u77ed\u56de\u6e2c\u5340\u9593\u6216\u589e\u52a0 resample \u9031\u671f \u8a08\u7b97\u8907\u96dc\u5ea6\u9ad8 \u4f7f\u7528\u5411\u91cf\u5316\u904b\u7b97,\u907f\u514d\u8ff4\u5708 \u8a18\u61b6\u9ad4\u4e0d\u8db3 \u5206\u6279\u8655\u7406\u6216\u4f7f\u7528\u66f4\u9577\u7684 resample"}, {"location": "architecture/module_relationships/#_16", "title": "\u53c3\u8003\u8cc7\u6e90", "text": ""}, {"location": "architecture/module_relationships/#_17", "title": "\u8a73\u7d30\u6587\u6a94", "text": "<ul> <li>\u7b56\u7565\u53c3\u6578\u512a\u5316\u5b8c\u6574\u6307\u5357</li> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44\u5b8c\u6574\u6307\u5357</li> <li>\u81ea\u8a02\u5e02\u5834\u7269\u4ef6\u5b8c\u6574\u6307\u5357</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> </ul>"}, {"location": "architecture/module_relationships/#api-reference", "title": "API Reference", "text": "<ul> <li>finlab.data API Reference</li> <li>finlab.backtest API Reference</li> <li>finlab.optimize API Reference</li> <li>finlab.analysis API Reference</li> <li>finlab.market API Reference</li> </ul>"}, {"location": "architecture/module_relationships/#_18", "title": "\u5be6\u7528\u7bc4\u4f8b", "text": "<ul> <li>\u53f0\u80a1\u5be6\u7528\u7bc4\u4f8b</li> <li>FinLab GitHub</li> </ul>"}, {"location": "details/analysis_modules/", "title": "\u7b56\u7565\u5206\u6790\u6a21\u7d44", "text": "<p>\u56de\u6e2c\u5b8c\u6210\u5f8c,\u50c5\u770b\u7d2f\u7a4d\u5831\u916c\u66f2\u7dda\u548c\u590f\u666e\u7387\u53ef\u80fd\u4e0d\u5920\u5168\u9762\u3002<code>finlab.analysis</code> \u6a21\u7d44\u63d0\u4f9b\u4e86 6 \u7a2e\u5167\u5efa\u5206\u6790\u5de5\u5177,\u5f9e\u6d41\u52d5\u6027\u98a8\u96aa\u3001\u6ce2\u52d5\u7279\u6027\u3001\u6642\u671f\u7a69\u5b9a\u6027\u7b49\u591a\u500b\u89d2\u5ea6\u6df1\u5165\u8a55\u4f30\u7b56\u7565\u54c1\u8cea,\u5e6b\u52a9\u4f60\u505a\u51fa\u66f4\u660e\u667a\u7684\u4ea4\u6613\u6c7a\u7b56\u3002</p>"}, {"location": "details/analysis_modules/#_2", "title": "\u6982\u8ff0", "text": "<p>FinLab \u5167\u5efa\u4ee5\u4e0b 6 \u7a2e\u5206\u6790\u6a21\u7d44:</p> \u6a21\u7d44 \u7528\u9014 \u9069\u7528\u5834\u666f LiquidityAnalysis \u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c \u5927\u8cc7\u91d1\u7b56\u7565\u3001\u4f4e\u6d41\u52d5\u6027\u6a19\u7684 MaeMfeAnalysis \u6ce2\u52d5\u5206\u6790(MAE/MFE) \u512a\u5316\u505c\u640d\u505c\u5229\u3001\u4e86\u89e3\u7b56\u7565\u7279\u6027 PeriodStatsAnalysis \u6642\u671f\u7a69\u5b9a\u6027\u5206\u6790 \u6aa2\u8996\u5e74\u5ea6\u3001\u6708\u5ea6\u3001\u8fd1\u671f\u8868\u73fe InequalityAnalysis \u4e0d\u7b49\u5f0f\u56e0\u5b50\u5206\u6790 \u6aa2\u67e5\u7b56\u7565\u662f\u5426\u4f9d\u8cf4\u7279\u5b9a\u80a1\u7968 AlphaBetaAnalysis Alpha/Beta \u5206\u6790 \u8861\u91cf\u8d85\u984d\u5831\u916c\u8207\u5e02\u5834\u76f8\u95dc\u6027 DrawdownAnalysis \u56de\u64a4\u5206\u6790 \u4e86\u89e3\u6700\u5927\u56de\u64a4\u7684\u6642\u9593\u8207\u5e45\u5ea6"}, {"location": "details/analysis_modules/#_3", "title": "\u57fa\u672c\u7528\u6cd5", "text": "<p>\u6240\u6709\u5206\u6790\u6a21\u7d44\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u547c\u53eb\u65b9\u5f0f:</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u5b8c\u6210\u56de\u6e2c\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\nreport = sim(position, resample='M')\n\n# \u57f7\u884c\u5206\u6790 - \u65b9\u6cd5 1: \u4f7f\u7528\u6a21\u7d44\u540d\u7a31(\u5b57\u4e32)\nreport.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# \u57f7\u884c\u5206\u6790 - \u65b9\u6cd5 2: \u4f7f\u7528\u6a21\u7d44\u5be6\u4f8b\nfrom finlab.analysis.liquidityAnalysis import LiquidityAnalysis\nreport.run_analysis(LiquidityAnalysis(required_volume=100000))\n</code></pre> <p>\u63a8\u85a6\u4f7f\u7528\u65b9\u6cd5 1</p> <p>\u76f4\u63a5\u50b3\u5165\u6a21\u7d44\u540d\u7a31(\u5b57\u4e32)\u66f4\u7c21\u6f54,\u4e14 FinLab \u6703\u81ea\u52d5\u8655\u7406\u6a21\u7d44\u8f09\u5165\u3002</p>"}, {"location": "details/analysis_modules/#1-liquidityanalysis-", "title": "1. LiquidityAnalysis - \u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c", "text": ""}, {"location": "details/analysis_modules/#_4", "title": "\u529f\u80fd\u8aaa\u660e", "text": "<p>\u6aa2\u6e2c\u7b56\u7565\u5728\u9032\u51fa\u5834\u6642\u662f\u5426\u6703\u9047\u5230\u6d41\u52d5\u6027\u554f\u984c,\u5305\u62ec:</p> <ul> <li>\u6210\u4ea4\u91cf\u4e0d\u8db3: \u55ae\u65e5\u6210\u4ea4\u80a1\u6578\u4f4e\u65bc\u8981\u6c42</li> <li>\u6210\u4ea4\u91d1\u984d\u4e0d\u8db3: \u55ae\u65e5\u6210\u4ea4\u91d1\u984d\u4f4e\u65bc\u8981\u6c42</li> <li>\u6f32\u8dcc\u505c\u677f: \u5728\u6f32\u505c\u8cb7\u5165\u6216\u8dcc\u505c\u8ce3\u51fa(\u7121\u6cd5\u6210\u4ea4)</li> <li>\u8b66\u793a\u80a1/\u8655\u7f6e\u80a1/\u5168\u984d\u4ea4\u5272\u80a1: \u4ea4\u6613\u53d7\u9650\u7684\u9ad8\u98a8\u96aa\u6a19\u7684</li> </ul>"}, {"location": "details/analysis_modules/#_5", "title": "\u53c3\u6578\u8aaa\u660e", "text": "<pre><code>LiquidityAnalysis(\n    required_volume=200000,      # \u8981\u6c42\u55ae\u65e5\u6210\u4ea4\u80a1\u6578(\u9810\u8a2d 20 \u842c\u80a1)\n    required_turnover=1000000    # \u8981\u6c42\u55ae\u65e5\u6210\u4ea4\u91d1\u984d(\u9810\u8a2d 100 \u842c\u5143)\n)\n</code></pre>"}, {"location": "details/analysis_modules/#_6", "title": "\u4f7f\u7528\u7bc4\u4f8b", "text": "<pre><code># \u6aa2\u6e2c\u7b56\u7565\u6d41\u52d5\u6027\u98a8\u96aa\nreport.run_analysis('LiquidityAnalysis', required_volume=100000)\n</code></pre>"}, {"location": "details/analysis_modules/#_7", "title": "\u8f38\u51fa\u89e3\u8b80", "text": "<p>\u8868\u683c\u986f\u793a\u5404\u98a8\u96aa\u9805\u76ee\u5728\u9032\u5834(entry)\u548c\u51fa\u5834(exit)\u6642\u767c\u751f\u7684\u6a5f\u7387:</p> \u98a8\u96aa\u9805\u76ee entry exit \u8aaa\u660e buy_high 5.2% 1.3% \u5728\u6f32\u505c\u677f(\u6216\u63a5\u8fd1\u6f32\u505c)\u8cb7\u5165\u7684\u6bd4\u4f8b sell_low 0.8% 4.5% \u5728\u8dcc\u505c\u677f(\u6216\u63a5\u8fd1\u8dcc\u505c)\u8ce3\u51fa\u7684\u6bd4\u4f8b low_volume_stocks 12.1% 10.3% \u6210\u4ea4\u80a1\u6578\u4e0d\u8db3\u8981\u6c42\u7684\u6bd4\u4f8b low_turnover_stocks 8.7% 7.2% \u6210\u4ea4\u91d1\u984d\u4e0d\u8db3\u8981\u6c42\u7684\u6bd4\u4f8b \u8b66\u793a\u80a1 2.1% 1.8% \u4ea4\u6613\u8b66\u793a\u80a1\u7684\u6bd4\u4f8b \u8655\u7f6e\u80a1 0.5% 0.3% \u4ea4\u6613\u8655\u7f6e\u80a1\u7684\u6bd4\u4f8b \u5168\u984d\u4ea4\u5272\u80a1 0.2% 0.1% \u4ea4\u6613\u5168\u984d\u4ea4\u5272\u80a1\u7684\u6bd4\u4f8b <p>\u98a8\u96aa\u95be\u503c\u5efa\u8b70</p> <ul> <li><code>buy_high</code> \u6216 <code>sell_low</code> &gt; 10%: \u53ef\u80fd\u7121\u6cd5\u9806\u5229\u6210\u4ea4</li> <li><code>low_volume_stocks</code> &gt; 20%: \u5927\u8cc7\u91d1\u53ef\u80fd\u7121\u6cd5\u5168\u90e8\u57f7\u884c</li> <li><code>\u8655\u7f6e\u80a1</code> &gt; 5%: \u7b56\u7565\u53ef\u80fd\u5c08\u6311\u9ad8\u98a8\u96aa\u6a19\u7684</li> </ul>"}, {"location": "details/analysis_modules/#_8", "title": "\u6c7a\u7b56\u5efa\u8b70", "text": "<ul> <li>\u6d41\u52d5\u6027\u4e0d\u8db3: \u8003\u616e\u589e\u52a0\u9078\u80a1\u689d\u4ef6(\u5982\u300c\u6210\u4ea4\u91cf &gt; 1000 \u5f35\u300d)</li> <li>\u983b\u7e41\u89f8\u53ca\u6f32\u8dcc\u505c: \u8abf\u6574\u9032\u51fa\u5834\u6642\u6a5f(\u5982\u4f7f\u7528\u958b\u76e4\u50f9\u800c\u975e\u6536\u76e4\u50f9)</li> <li>\u904e\u591a\u8b66\u793a/\u8655\u7f6e\u80a1: \u52a0\u5165\u98a8\u63a7\u689d\u4ef6\u6392\u9664\u9ad8\u98a8\u96aa\u6a19\u7684</li> </ul>"}, {"location": "details/analysis_modules/#2-maemfeanalysis-", "title": "2. MaeMfeAnalysis - \u6ce2\u52d5\u5206\u6790", "text": ""}, {"location": "details/analysis_modules/#_9", "title": "\u529f\u80fd\u8aaa\u660e", "text": "<p>MAE/MFE \u5206\u6790\u662f\u512a\u5316\u505c\u640d\u505c\u5229\u7684\u6838\u5fc3\u5de5\u5177:</p> <ul> <li>MAE (Maximum Adverse Excursion): \u6301\u6709\u671f\u9593\u6700\u5927\u4e0d\u5229\u65b9\u5411\u5e45\u5ea6(\u6700\u5927\u8667\u640d)</li> <li>BMFE (Before-MAE MFE): MAE \u767c\u751f\u524d\u7684\u6700\u5927\u6709\u5229\u65b9\u5411\u5e45\u5ea6</li> <li>GMFE (Global MFE): \u6301\u6709\u671f\u9593\u6700\u5927\u6709\u5229\u65b9\u5411\u5e45\u5ea6(\u6700\u5927\u7372\u5229)</li> <li>MDD (Maximum Drawdown): \u6301\u6709\u671f\u9593\u6700\u5927\u56de\u64a4</li> </ul> <p>\u900f\u904e 12 \u500b\u5b50\u5716,\u5168\u9762\u4e86\u89e3\u6bcf\u7b46\u4ea4\u6613\u7684\u6ce2\u52d5\u7279\u6027\u3002</p>"}, {"location": "details/analysis_modules/#_10", "title": "\u53c3\u6578\u8aaa\u660e", "text": "<pre><code>MaeMfeAnalysis(\n    violinmode='group',      # violin \u5716\u6a21\u5f0f: 'group' \u6216 'overlay'\n    mfe_scatter_x='mae'      # MFE \u6563\u9ede\u5716\u7684 X \u8ef8: 'mae' \u6216 'return'\n)\n</code></pre>"}, {"location": "details/analysis_modules/#_11", "title": "\u4f7f\u7528\u7bc4\u4f8b", "text": "<pre><code># \u65b9\u6cd5 1: \u4f7f\u7528 display_mae_mfe_analysis() \u5feb\u6377\u65b9\u6cd5\nreport.display_mae_mfe_analysis()\n\n# \u65b9\u6cd5 2: \u4f7f\u7528 run_analysis()\nreport.run_analysis('MaeMfeAnalysis', violinmode='group')\n</code></pre>"}, {"location": "details/analysis_modules/#12", "title": "12 \u500b\u5b50\u5716\u8aaa\u660e", "text": ""}, {"location": "details/analysis_modules/#_12", "title": "\u7b2c\u4e00\u6392", "text": "<ol> <li>Win Ratio: \u4ea4\u6613\u52dd\u7387\u5206\u5e03(profit vs loss \u76f4\u65b9\u5716)</li> <li>\u85cd\u8272:\u7372\u5229\u4ea4\u6613,\u7c89\u8272:\u8667\u640d\u4ea4\u6613</li> <li> <p>\u7da0\u8272\u865b\u7dda:\u5e73\u5747\u5831\u916c\u7387</p> </li> <li> <p>Edge Ratio: \u4e0d\u540c\u6301\u6709\u5929\u6578\u7684 MFE/MAE \u6bd4\u7387</p> </li> <li>\u6578\u503c &gt; 1 \u4ee3\u8868\u7372\u5229\u5e45\u5ea6\u5927\u65bc\u8667\u640d\u5e45\u5ea6</li> <li> <p>\u89c0\u5bdf\u7b56\u7565\u7684\u300c\u512a\u52e2\u6642\u9593\u5340\u9593\u300d</p> </li> <li> <p>MAE vs Return: MAE \u8207\u6700\u7d42\u5831\u916c\u7387\u7684\u95dc\u4fc2</p> </li> <li>\u6c34\u5e73\u865b\u7dda:MAE \u7684 75 \u5206\u4f4d\u6578(Q3)</li> <li>\u7528\u65bc\u8a2d\u5b9a\u505c\u640d\u9ede</li> </ol>"}, {"location": "details/analysis_modules/#_13", "title": "\u7b2c\u4e8c\u6392", "text": "<ol> <li>GMFE vs MAE: \u6700\u5927\u7372\u5229 vs \u6700\u5927\u8667\u640d</li> <li>Q3 \u865b\u7dda:75% \u4ea4\u6613\u7684 GMFE \u548c MAE \u7bc4\u570d</li> <li> <p>\u7528\u65bc\u8a55\u4f30\u505c\u5229\u7a7a\u9593</p> </li> <li> <p>BMFE vs MAE: MAE \u524d\u7684\u6700\u5927\u7372\u5229</p> </li> <li>\u6578\u503c\u8d8a\u9ad8,\u4ee3\u8868\u8d8a\u6709\u6a5f\u6703\u5728\u505c\u640d\u524d\u5148\u505c\u5229</li> <li> <p>\u7528\u65bc\u512a\u5316\u300c\u79fb\u52d5\u505c\u5229\u300d\u7b56\u7565</p> </li> <li> <p>MDD vs GMFE: \u6700\u5927\u56de\u64a4 vs \u6700\u5927\u7372\u5229</p> </li> <li>\u6a58\u7dda:MDD = GMFE \u7684\u57fa\u6e96\u7dda</li> <li>\u9ede\u5728\u7dda\u4e0b\u65b9:GMFE &gt; MDD(\u597d\u8a0a\u865f,\u53ef\u7528\u79fb\u52d5\u505c\u5229)</li> <li>\u9ede\u5728\u7dda\u4e0a\u65b9:MDD &gt; GMFE(\u58de\u8a0a\u865f,\u6703\u932f\u5931\u7372\u5229)</li> </ol>"}, {"location": "details/analysis_modules/#_14", "title": "\u7b2c\u4e09\u6392", "text": "<p>7-9. MAE/BMFE/GMFE Distribution: \u5404\u6307\u6a19\u7684\u5206\u5e03\u8207\u5bc6\u5ea6    - \u76f4\u65b9\u5716 + \u5bc6\u5ea6\u66f2\u7dda    - \u85cd\u8272:\u7372\u5229\u4ea4\u6613,\u7c89\u8272:\u8667\u640d\u4ea4\u6613    - Q3 \u865b\u7dda:75 \u5206\u4f4d\u6578</p>"}, {"location": "details/analysis_modules/#_15", "title": "\u7b2c\u56db\u6392", "text": "<ol> <li>Indices Stats (Violin Plot): 6 \u500b\u95dc\u9375\u6307\u6a19\u7684\u7d71\u8a08\u5206\u5e03</li> <li>return, mae, bmfe, gmfe, mdd, pdays_ratio</li> <li>group \u6a21\u5f0f: \u5206\u7fa4\u986f\u793a\u7372\u5229/\u8667\u640d\u4ea4\u6613\u7684\u5dee\u7570(\u63a8\u85a6)</li> <li>overlay \u6a21\u5f0f: \u758a\u52a0\u986f\u793a\u6240\u6709\u4ea4\u6613</li> </ol>"}, {"location": "details/analysis_modules/#_16", "title": "\u6c7a\u7b56\u5efa\u8b70", "text": "<p>\u6839\u64da MAE/MFE \u5206\u6790\u512a\u5316\u505c\u640d\u505c\u5229:</p>"}, {"location": "details/analysis_modules/#_17", "title": "\u505c\u640d\u9ede\u8a2d\u5b9a", "text": "<pre><code># 1. \u67e5\u770b MAE \u7684 75 \u5206\u4f4d\u6578(Q3)\ntrades = report.get_trades()\nmae_q3 = trades['mae'].quantile(0.75)  # \u4f8b\u5982 -8.5%\n\n# 2. \u8a2d\u5b9a\u505c\u640d\u7565\u5bec\u65bc Q3,\u907f\u514d\u904e\u5ea6\u505c\u640d\nstop_loss = abs(mae_q3) * 1.2  # \u8a2d\u70ba 10%\n</code></pre>"}, {"location": "details/analysis_modules/#_18", "title": "\u505c\u5229\u9ede\u8a2d\u5b9a", "text": "<pre><code># \u67e5\u770b GMFE \u7684 75 \u5206\u4f4d\u6578\ngmfe_q3 = trades['gmfe'].quantile(0.75)  # \u4f8b\u5982 15%\n\n# \u8a2d\u5b9a\u505c\u5229\ntake_profit = gmfe_q3 * 0.8  # \u8a2d\u70ba 12%,\u78ba\u4fdd\u5927\u90e8\u5206\u7372\u5229\u80fd\u5be6\u73fe\n</code></pre>"}, {"location": "details/analysis_modules/#_19", "title": "\u79fb\u52d5\u505c\u5229\u5224\u65b7", "text": "<p>\u82e5\u300cMDD vs GMFE\u300d\u5716\u4e2d\u986f\u793a:</p> <ul> <li>Missed Win-profits PCT &lt; 20%: \u9069\u5408\u4f7f\u7528\u79fb\u52d5\u505c\u5229</li> <li>Missed Win-profits PCT &gt; 40%: \u4e0d\u9069\u5408\u79fb\u52d5\u505c\u5229(\u6703\u63d0\u524d\u51fa\u5834\u932f\u5931\u66f4\u5927\u7372\u5229)</li> </ul> <pre><code># \u4f7f\u7528\u79fb\u52d5\u505c\u5229\uff08\u900f\u904e sim() \u7684 trail_stop \u53c3\u6578\uff09\nposition = position.hold_until(\n    exit=exits,\n    stop_loss=0.1\n)\nreport = sim(position, resample='M', trail_stop=0.08)  # \u56de\u6a94 8% \u5373\u51fa\u5834\n</code></pre>"}, {"location": "details/analysis_modules/#3-periodstatsanalysis-", "title": "3. PeriodStatsAnalysis - \u6642\u671f\u7a69\u5b9a\u6027\u5206\u6790", "text": ""}, {"location": "details/analysis_modules/#_20", "title": "\u529f\u80fd\u8aaa\u660e", "text": "<p>\u5206\u6790\u7b56\u7565\u5728\u4e0d\u540c\u6642\u671f(\u5e74\u5ea6\u3001\u6708\u5ea6\u3001\u8fd1\u671f)\u7684\u8868\u73fe,\u4e26\u8207\u5c0d\u7167\u6307\u6578(benchmark)\u6bd4\u8f03,\u6aa2\u9a57\u7b56\u7565\u662f\u5426\u7a69\u5b9a\u3002</p>"}, {"location": "details/analysis_modules/#_21", "title": "\u4f7f\u7528\u7bc4\u4f8b", "text": "<pre><code>report.run_analysis('PeriodStatsAnalysis')\n</code></pre>"}, {"location": "details/analysis_modules/#_22", "title": "\u8f38\u51fa\u89e3\u8b80", "text": "<p>\u6703\u7522\u751f\u591a\u500b\u8868\u683c,\u5305\u542b:</p>"}, {"location": "details/analysis_modules/#1-overall-stats", "title": "1. Overall Stats(\u6574\u9ad4\u8868\u73fe)", "text": "<p>\u6bd4\u8f03\u7b56\u7565\u8207 benchmark \u5728\u65e5\u5ea6\u3001\u6708\u5ea6\u3001\u5e74\u5ea6\u7684\u6574\u9ad4\u6307\u6a19:</p> \u6307\u6a19 benchmark strategy <code>overall_daily</code> / <code>calmar_ratio</code> 0.149 0.066 <code>overall_daily</code> / <code>sharpe_ratio</code> 0.532 0.306 <code>overall_monthly</code> / <code>return</code> 0.084 0.048"}, {"location": "details/analysis_modules/#2-yearly-stats", "title": "2. Yearly Stats(\u5e74\u5ea6\u8868\u73fe)", "text": "<p>\u71b1\u529b\u5716\u986f\u793a\u6bcf\u5e74\u7684 7 \u7a2e\u6307\u6a19(calmar_ratio, sharpe_ratio, return, volatility \u7b49)\u3002</p>"}, {"location": "details/analysis_modules/#3-recent-stats", "title": "3. Recent Stats(\u8fd1\u671f\u8868\u73fe)", "text": "<p>\u986f\u793a\u6700\u8fd1 M(\u6708)\u3001Q(\u5b63)\u3001HY(\u534a\u5e74)\u3001Y(\u5e74)\u30013Y(\u4e09\u5e74)\u7684\u8868\u73fe\u3002</p>"}, {"location": "details/analysis_modules/#_23", "title": "\u6c7a\u7b56\u5efa\u8b70", "text": "<ul> <li>\u7b56\u7565 sharpe_ratio &lt; benchmark: \u7b56\u7565\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c\u4e0d\u5982\u5927\u76e4,\u9700\u6539\u9032</li> <li>\u67d0\u4e9b\u5e74\u5ea6\u8868\u73fe\u7279\u5225\u5dee: \u6aa2\u67e5\u662f\u5426\u9047\u5230\u7279\u5b9a\u5e02\u5834\u74b0\u5883(\u5982\u7a7a\u982d)</li> <li>\u8fd1\u671f\u8868\u73fe\u5927\u5e45\u8870\u9000: \u7b56\u7565\u53ef\u80fd\u5931\u6548,\u9700\u91cd\u65b0\u512a\u5316</li> </ul>"}, {"location": "details/analysis_modules/#4-inequalityanalysis-", "title": "4. InequalityAnalysis - \u4e0d\u7b49\u5f0f\u56e0\u5b50\u5206\u6790", "text": ""}, {"location": "details/analysis_modules/#_24", "title": "\u529f\u80fd\u8aaa\u660e", "text": "<p>\u6aa2\u67e5\u7b56\u7565\u7684\u5831\u916c\u662f\u5426\u904e\u5ea6\u96c6\u4e2d\u5728\u5c11\u6578\u80a1\u7968,\u8a55\u4f30\u7b56\u7565\u7684\u7a69\u5065\u6027\u3002</p> <p></p>"}, {"location": "details/analysis_modules/#_25", "title": "\u4f7f\u7528\u7bc4\u4f8b", "text": "<pre><code>report.run_analysis('InequalityAnalysis')\n</code></pre>"}, {"location": "details/analysis_modules/#_26", "title": "\u8f38\u51fa\u89e3\u8b80", "text": "<p>\u7522\u751f\u5169\u500b\u5716\u8868:</p> <ol> <li>Cumulative Returns by Stock: \u5404\u80a1\u7968\u7684\u7d2f\u7a4d\u8ca2\u737b\u66f2\u7dda</li> <li> <p>\u82e5\u66f2\u7dda\u5728\u524d 10% \u80a1\u7968\u5c31\u9054\u5230 80%,\u4ee3\u8868\u5831\u916c\u904e\u5ea6\u96c6\u4e2d</p> </li> <li> <p>Gini Coefficient: \u57fa\u5c3c\u4fc2\u6578(0-1)</p> </li> <li>\u63a5\u8fd1 0: \u5831\u916c\u5747\u52fb\u5206\u5e03(\u597d)</li> <li>\u63a5\u8fd1 1: \u5831\u916c\u6975\u5ea6\u96c6\u4e2d(\u98a8\u96aa\u9ad8)</li> </ol>"}, {"location": "details/analysis_modules/#_27", "title": "\u6c7a\u7b56\u5efa\u8b70", "text": "<ul> <li>Gini &gt; 0.7: \u7b56\u7565\u904e\u5ea6\u4f9d\u8cf4\u5c11\u6578\u80a1\u7968,\u9700\u5206\u6563\u98a8\u96aa</li> <li>\u524d 5% \u80a1\u7968\u8ca2\u737b &gt; 50% \u5831\u916c: \u79fb\u9664\u9019\u4e9b\u80a1\u7968\u6e2c\u8a66\u7b56\u7565\u7a69\u5065\u6027</li> </ul>"}, {"location": "details/analysis_modules/#5-alphabetaanalysis-alphabeta", "title": "5. AlphaBetaAnalysis - Alpha/Beta \u5206\u6790", "text": ""}, {"location": "details/analysis_modules/#_28", "title": "\u529f\u80fd\u8aaa\u660e", "text": "<p>\u8861\u91cf\u7b56\u7565\u76f8\u5c0d\u65bc\u5c0d\u7167\u6307\u6578\u7684:</p> <ul> <li>Alpha (\u03b1): \u8d85\u984d\u5831\u916c(\u7b56\u7565\u7368\u7279\u7684\u50f9\u503c)</li> <li>Beta (\u03b2): \u5e02\u5834\u654f\u611f\u5ea6(\u8207\u5927\u76e4\u7684\u76f8\u95dc\u6027)</li> </ul>"}, {"location": "details/analysis_modules/#_29", "title": "\u4f7f\u7528\u7bc4\u4f8b", "text": "<pre><code>report.run_analysis('AlphaBetaAnalysis')\n</code></pre>"}, {"location": "details/analysis_modules/#_30", "title": "\u8f38\u51fa\u89e3\u8b80", "text": "\u6307\u6a19 \u6578\u503c \u8aaa\u660e Alpha 0.05 \u5e74\u5316\u8d85\u984d\u5831\u916c 5%(\u6263\u9664\u5e02\u5834\u98a8\u96aa\u5f8c\u7684\u771f\u5be6\u8ca2\u737b) Beta 0.8 \u5e02\u5834\u4e0a\u6f32 1%,\u7b56\u7565\u9810\u671f\u4e0a\u6f32 0.8%"}, {"location": "details/analysis_modules/#_31", "title": "\u6c7a\u7b56\u5efa\u8b70", "text": "<ul> <li>Alpha &gt; 0: \u7b56\u7565\u6709\u8d85\u984d\u5831\u916c,\u503c\u5f97\u57f7\u884c</li> <li>Alpha &lt; 0: \u7b56\u7565\u4e0d\u5982\u5c0d\u7167\u6307\u6578,\u9700\u6539\u9032</li> <li>Beta &gt; 1.5: \u7b56\u7565\u6ce2\u52d5\u6975\u5927,\u98a8\u96aa\u9ad8</li> <li>Beta &lt; 0: \u7b56\u7565\u8207\u5e02\u5834\u8ca0\u76f8\u95dc(\u9069\u5408\u907f\u96aa)</li> </ul>"}, {"location": "details/analysis_modules/#6-drawdownanalysis-", "title": "6. DrawdownAnalysis - \u56de\u64a4\u5206\u6790", "text": ""}, {"location": "details/analysis_modules/#_32", "title": "\u529f\u80fd\u8aaa\u660e", "text": "<p>\u8a73\u7d30\u5206\u6790\u7b56\u7565\u7684\u6240\u6709\u56de\u64a4\u4e8b\u4ef6,\u4e86\u89e3:</p> <ul> <li>\u6700\u5927\u56de\u64a4\u5e45\u5ea6\u8207\u767c\u751f\u6642\u9593</li> <li>\u5e73\u5747\u56de\u64a4\u5e45\u5ea6</li> <li>\u56de\u64a4\u6301\u7e8c\u6642\u9593</li> </ul>"}, {"location": "details/analysis_modules/#_33", "title": "\u4f7f\u7528\u7bc4\u4f8b", "text": "<pre><code>report.run_analysis('DrawdownAnalysis')\n</code></pre>"}, {"location": "details/analysis_modules/#_34", "title": "\u8f38\u51fa\u89e3\u8b80", "text": "<p>\u7522\u751f\u8868\u683c\u8207\u5716\u8868:</p> <ol> <li>Drawdown Events Table: \u6240\u6709\u56de\u64a4\u4e8b\u4ef6\u7684\u8a73\u7d30\u8cc7\u8a0a</li> <li>start_date: \u56de\u64a4\u958b\u59cb\u65e5\u671f</li> <li>end_date: \u56de\u64a4\u7d50\u675f\u65e5\u671f</li> <li>duration: \u6301\u7e8c\u5929\u6578</li> <li> <p>max_dd: \u6700\u5927\u56de\u64a4\u5e45\u5ea6</p> </li> <li> <p>Drawdown Plot: \u56de\u64a4\u6642\u5e8f\u5716</p> </li> </ol>"}, {"location": "details/analysis_modules/#_35", "title": "\u6c7a\u7b56\u5efa\u8b70", "text": "<ul> <li>\u6700\u5927\u56de\u64a4 &gt; -50%: \u98a8\u96aa\u904e\u9ad8,\u9700\u589e\u52a0\u98a8\u63a7\u63aa\u65bd</li> <li>\u56de\u64a4\u6301\u7e8c\u6642\u9593 &gt; 1 \u5e74: \u7b56\u7565\u53ef\u80fd\u9577\u671f\u5931\u6548</li> <li>\u8fd1\u671f\u56de\u64a4\u983b\u7e41: \u5e02\u5834\u74b0\u5883\u6539\u8b8a,\u9700\u91cd\u65b0\u8a55\u4f30\u7b56\u7565</li> </ul>"}, {"location": "details/analysis_modules/#_36", "title": "\u81ea\u8a02\u5206\u6790\u6a21\u7d44", "text": "<p>\u5982\u679c\u5167\u5efa\u5206\u6790\u7121\u6cd5\u6eff\u8db3\u9700\u6c42,\u53ef\u7e7c\u627f <code>Analysis</code> \u985e\u5225\u958b\u767c\u81ea\u8a02\u5206\u6790\u3002</p>"}, {"location": "details/analysis_modules/#_37", "title": "\u57fa\u790e\u7bc4\u4f8b:\u7522\u696d\u5206\u6790", "text": "<p>\u5206\u6790\u6bcf\u7b46\u4ea4\u6613\u6240\u5c6c\u7684\u7522\u696d:</p> <pre><code>from finlab import data\nfrom finlab.analysis import Analysis\n\nclass IndustryAnalysis(Analysis):\n\n    def calculate_trade_info(self, report):\n        \"\"\"\u8a08\u7b97\u6bcf\u7b46\u4ea4\u6613\u7684\u7522\u696d\u8cc7\u8a0a\"\"\"\n        industry = data.get('etl:industry')\n        return [\n            ['\u7522\u696d', industry, 'entry_sig_date']\n        ]\n\n    def analyze(self, report):\n        \"\"\"\u5206\u6790\u7522\u696d\u5206\u5e03\"\"\"\n        trades = report.get_trades()\n        industry_return = trades.groupby('\u7522\u696d@entry_sig_date')['return'].agg(['count', 'mean'])\n        self.result = industry_return.sort_values('mean', ascending=False)\n        return self.result.to_dict()\n\n    def display(self):\n        \"\"\"\u986f\u793a\u5206\u6790\u7d50\u679c\"\"\"\n        return self.result\n\n# \u4f7f\u7528\u81ea\u8a02\u5206\u6790\nreport.run_analysis(IndustryAnalysis())\n</code></pre>"}, {"location": "details/analysis_modules/#_38", "title": "\u9032\u968e\u7bc4\u4f8b:\u6708\u5ea6\u52dd\u7387\u5206\u6790", "text": "<p>\u5206\u6790\u6bcf\u500b\u6708\u4efd\u7684\u52dd\u7387\u662f\u5426\u6709\u5dee\u7570:</p> <pre><code>class MonthlyWinRateAnalysis(Analysis):\n\n    def analyze(self, report):\n        trades = report.get_trades()\n        trades['entry_month'] = pd.to_datetime(trades['entry_date']).dt.month\n\n        monthly_stats = trades.groupby('entry_month').agg({\n            'return': ['count', lambda x: (x &gt; 0).mean(), 'mean']\n        }).round(3)\n\n        monthly_stats.columns = ['\u4ea4\u6613\u6b21\u6578', '\u52dd\u7387', '\u5e73\u5747\u5831\u916c']\n        self.result = monthly_stats\n        return self.result.to_dict()\n\n    def display(self):\n        import plotly.express as px\n        fig = px.bar(self.result, y='\u52dd\u7387', title='\u6708\u5ea6\u52dd\u7387\u5206\u6790')\n        return fig\n\n# \u4f7f\u7528\nreport.run_analysis(MonthlyWinRateAnalysis())\n</code></pre>"}, {"location": "details/analysis_modules/#analysis-api", "title": "Analysis \u985e\u5225 API", "text": "<p>\u7e7c\u627f <code>Analysis</code> \u985e\u5225\u6642,\u53ef\u8986\u5beb\u4ee5\u4e0b\u65b9\u6cd5:</p> <pre><code>class Analysis:\n\n    def is_market_supported(self, market):\n        \"\"\"\u6aa2\u67e5\u662f\u5426\u652f\u63f4\u8a72\u5e02\u5834\n\n        Returns:\n            bool: True \u8868\u793a\u652f\u63f4,False \u8868\u793a\u4e0d\u652f\u63f4\n        \"\"\"\n        return True\n\n    def calculate_trade_info(self, report):\n        \"\"\"\u8a08\u7b97\u984d\u5916\u7684\u4ea4\u6613\u8cc7\u8a0a\n\n        Returns:\n            list: \u683c\u5f0f\u70ba [[\u6b04\u4f4d\u540d, \u8cc7\u6599 DataFrame, \u4f7f\u7528\u7684\u65e5\u671f\u6b04\u4f4d], ...]\n\n        Examples:\n            return [\n                ['\u7522\u696d', industry_data, 'entry_sig_date'],\n                ['\u5e02\u503c', market_cap, 'entry_date']\n            ]\n        \"\"\"\n        return []\n\n    def analyze(self, report):\n        \"\"\"\u57f7\u884c\u5206\u6790\u908f\u8f2f\n\n        Args:\n            report: \u56de\u6e2c\u5831\u544a\u7269\u4ef6\n\n        Returns:\n            dict: \u5206\u6790\u7d50\u679c(\u7528\u65bc\u4e0a\u50b3\u81f3\u96f2\u7aef)\n        \"\"\"\n        pass\n\n    def display(self):\n        \"\"\"\u986f\u793a\u5206\u6790\u7d50\u679c\n\n        Returns:\n            \u53ef\u8996\u5316\u7269\u4ef6(\u63a8\u85a6\u4f7f\u7528 Plotly Figure \u6216 Pandas Styler)\n        \"\"\"\n        pass\n</code></pre> <p>calculate_trade_info \u7684\u4f5c\u7528</p> <p><code>calculate_trade_info()</code> \u6703\u5728 <code>analyze()</code> \u4e4b\u524d\u57f7\u884c,\u81ea\u52d5\u5c07\u984d\u5916\u8cc7\u8a0a\u52a0\u5165 <code>report.get_trades()</code> \u7684 DataFrame\u3002</p> <p>\u4f8b\u5982\u56de\u50b3 <code>[['\u7522\u696d', industry, 'entry_sig_date']]</code>,\u5247 <code>trades</code> \u6703\u65b0\u589e <code>'\u7522\u696d@entry_sig_date'</code> \u6b04\u4f4d\u3002</p>"}, {"location": "details/analysis_modules/#_39", "title": "\u7d44\u5408\u4f7f\u7528\u591a\u500b\u5206\u6790\u6a21\u7d44", "text": "<p>\u5be6\u52d9\u4e0a,\u5efa\u8b70\u540c\u6642\u57f7\u884c\u591a\u500b\u5206\u6790:</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u5b8c\u6210\u56de\u6e2c\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\nreport = sim(position, resample='M')\n\n# 1. \u6d41\u52d5\u6027\u6aa2\u6e2c\nreport.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# 2. \u6ce2\u52d5\u5206\u6790\nreport.display_mae_mfe_analysis()\n\n# 3. \u6642\u671f\u7a69\u5b9a\u6027\u5206\u6790\nreport.run_analysis('PeriodStatsAnalysis')\n\n# 4. Alpha/Beta \u5206\u6790\nreport.run_analysis('AlphaBetaAnalysis')\n\n# 5. \u81ea\u8a02\u7522\u696d\u5206\u6790\nreport.run_analysis(IndustryAnalysis())\n</code></pre>"}, {"location": "details/analysis_modules/#_40", "title": "\u6700\u4f73\u5be6\u8e10", "text": ""}, {"location": "details/analysis_modules/#1", "title": "1. \u6a19\u6e96\u5206\u6790\u6d41\u7a0b", "text": "<p>\u6bcf\u500b\u7b56\u7565\u56de\u6e2c\u5f8c,\u5efa\u8b70\u57f7\u884c\u4ee5\u4e0b\u6aa2\u67e5:</p> <pre><code># Step 1: \u57fa\u672c\u7e3e\u6548\u6aa2\u8996\nreport.display()\n\n# Step 2: \u6d41\u52d5\u6027\u98a8\u96aa(\u5927\u8cc7\u91d1\u5fc5\u6aa2)\nif capital &gt; 1000000:\n    report.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# Step 3: \u6ce2\u52d5\u5206\u6790(\u5fc5\u505a,\u7528\u65bc\u512a\u5316\u505c\u640d\u505c\u5229)\nreport.display_mae_mfe_analysis()\n\n# Step 4: \u6642\u671f\u7a69\u5b9a\u6027(\u6aa2\u8996\u9577\u671f\u7a69\u5b9a\u6027)\nreport.run_analysis('PeriodStatsAnalysis')\n\n# Step 5: Alpha/Beta(\u6aa2\u8996\u662f\u5426\u6709\u8d85\u984d\u5831\u916c)\nreport.run_analysis('AlphaBetaAnalysis')\n</code></pre>"}, {"location": "details/analysis_modules/#2", "title": "2. \u91dd\u5c0d\u4e0d\u540c\u7b56\u7565\u985e\u578b\u7684\u5206\u6790\u91cd\u9ede", "text": "\u7b56\u7565\u985e\u578b \u91cd\u9ede\u5206\u6790\u6a21\u7d44 \u77ed\u7dda\u4ea4\u6613(\u65e5\u5167\u3001\u9031\u7dda) MaeMfeAnalysis(\u512a\u5316\u505c\u640d\u505c\u5229) \u9577\u7dda\u6295\u8cc7(\u6708\u7dda\u3001\u5b63\u7dda) PeriodStatsAnalysis(\u6aa2\u8996\u9577\u671f\u7a69\u5b9a\u6027) \u5927\u8cc7\u91d1\u7b56\u7565(&gt; 1000 \u842c) LiquidityAnalysis(\u907f\u514d\u6d41\u52d5\u6027\u98a8\u96aa) \u5e02\u5834\u4e2d\u6027\u7b56\u7565 AlphaBetaAnalysis(\u78ba\u8a8d Beta \u63a5\u8fd1 0) \u9ad8\u983b\u4ea4\u6613 DrawdownAnalysis(\u78ba\u8a8d\u56de\u64a4\u53ef\u63a7)"}, {"location": "details/analysis_modules/#3", "title": "3. \u5206\u6790\u7d50\u679c\u7684\u6c7a\u7b56\u6a39", "text": "<pre><code>\u56de\u6e2c\u5b8c\u6210\n  \u251c\u2500 \u6d41\u52d5\u6027\u98a8\u96aa &gt; 20%?\n  \u2502   \u251c\u2500 \u662f \u2192 \u589e\u52a0\u6210\u4ea4\u91cf\u7be9\u9078\u689d\u4ef6\n  \u2502   \u2514\u2500 \u5426 \u2192 \u7e7c\u7e8c\n  \u251c\u2500 \u590f\u666e\u7387 &lt; 1?\n  \u2502   \u251c\u2500 \u662f \u2192 \u512a\u5316\u9078\u80a1\u689d\u4ef6\u6216\u505c\u640d\u505c\u5229\n  \u2502   \u2514\u2500 \u5426 \u2192 \u7e7c\u7e8c\n  \u251c\u2500 \u6700\u5927\u56de\u64a4 &gt; -30%?\n  \u2502   \u251c\u2500 \u662f \u2192 \u589e\u52a0\u98a8\u63a7\u63aa\u65bd(\u505c\u640d\u3001\u90e8\u4f4d\u63a7\u5236)\n  \u2502   \u2514\u2500 \u5426 \u2192 \u7e7c\u7e8c\n  \u251c\u2500 Alpha &lt; 0?\n  \u2502   \u251c\u2500 \u662f \u2192 \u7b56\u7565\u7121\u8d85\u984d\u5831\u916c,\u9700\u91cd\u65b0\u8a2d\u8a08\n  \u2502   \u2514\u2500 \u5426 \u2192 \u7e7c\u7e8c\n  \u2514\u2500 \u6240\u6709\u6aa2\u67e5\u901a\u904e \u2192 \u9032\u884c\u6a23\u672c\u5916\u6e2c\u8a66\n</code></pre>"}, {"location": "details/analysis_modules/#_41", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>finlab.analysis API Reference</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>MAE/MFE \u5206\u6790\u6587\u7ae0</li> <li>\u6d41\u52d5\u6027\u6aa2\u6e2c\u6587\u7ae0</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> </ul>"}, {"location": "details/backtest/", "title": "\u6b77\u53f2\u56de\u6e2c", "text": "<p>\u4ee5\u6bcf\u65e5 <code>position</code> \u8a0a\u865f\u642d\u914d <code>finlab.backtest.sim</code>\uff0c\u5373\u53ef\u5feb\u901f\u5b8c\u6210\u56de\u6e2c\u4e26\u7522\u751f\u9078\u80a1\u6e05\u55ae\u8207\u98a8\u96aa/\u5831\u916c\u5206\u6790\u3002</p>"}, {"location": "details/backtest/#_1", "title": "\u5feb\u901f\u4e0a\u624b", "text": "<p>\u4ee5\u4e0b\u793a\u7bc4\u4ee5\u300c\u80a1\u50f9 &lt; 6 \u5143\u300d\u70ba\u689d\u4ef6\uff0c\u6bcf\u6708\u8abf\u6574\u90e8\u4f4d\uff1a</p> <pre><code>from finlab import data\nfrom finlab import backtest\n\n# \u53ea\u8cb7\u5165\u50f9\u683c\u5c0f\u65bc 6 \u5143\u7684\u80a1\u7968\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &lt; 6\n\n# \u56de\u6e2c\uff0c\u6bcf\u6708\u5e95(M)\u91cd\u65b0\u8abf\u6574\u80a1\u7968\u6b0a\u91cd\nreport = backtest.sim(position, resample='M', name=\"\u50f9\u683c\u5c0f\u65bc6\u7684\u80a1\u7968\")\n</code></pre> <p></p> <p>\u8b93 AI \u5e6b\u4f60\u5beb\u7b56\u7565</p> <p>\u60f3\u5617\u8a66\u66f4\u591a\u7b56\u7565\u4f46\u4e0d\u78ba\u5b9a\u8a9e\u6cd5\uff1f\u5b89\u88dd FinLab Skill \u5f8c\uff0cAI \u7de8\u7a0b\u52a9\u624b\u53ef\u5e6b\u4f60\u64b0\u5beb\u9032\u51fa\u5834\u689d\u4ef6\u3001\u9078\u64c7\u8abf\u5009\u983b\u7387\u3001\u8a2d\u5b9a\u505c\u640d\u505c\u5229\u3002</p> <p>\u4e0a\u50b3\u56de\u6e2c\u81f3\u96f2\u7aef\u5f8c\uff0c\u53ef\u65bc\u300c\u9078\u80a1\u6e05\u55ae\u300d\u6aa2\u8996\u6301\u80a1\u8207\u7570\u52d5\uff0c\u4e26\u624b\u52d5\u8ddf\u55ae\u3002</p> <p></p>"}, {"location": "details/backtest/#_2", "title": "\u986f\u793a\u7b56\u7565\u56de\u6e2c\u7d50\u679c", "text": "<p><pre><code>report.display()\n</code></pre> </p>"}, {"location": "details/backtest/#_3", "title": "\u53d6\u5f97\u7b56\u7565\u4ea4\u6613\u7d00\u9304", "text": ""}, {"location": "details/backtest/#_4", "title": "\u4ea4\u6613\u7d00\u9304\u91cd\u9ede\u6b04\u4f4d", "text": "<p><pre><code>report.get_trades()\n</code></pre> * exit_sig_date:\u51fa\u5834\u8a0a\u865f\u7522\u751f\u65e5\u3002 * entry_sig_date:\u9032\u5834\u8a0a\u865f\u7522\u751f\u65e5\u3002 * entry_date:\u9032\u5834\u65e5\u3002 * exit_date:\u51fa\u5834\u65e5\u3002 * period:\u6301\u6709\u5929\u6578\u3002 * position: \u6301\u6709\u4f54\u6bd4\u3002 * return:\u5831\u916c\u7387\u3002 * mdd:\u6301\u6709\u671f\u9593\u6700\u5927\u56de\u64a4\u3002 * mae:\u6301\u6709\u671f\u9593\u6700\u5927\u4e0d\u5229\u5e45\u5ea6\u3002 * g_mfe:\u6301\u6709\u671f\u9593\u6700\u5927\u6709\u5229\u5e45\u5ea6\u3002 * b_mfe:mae\u767c\u751f\u524d\u7684\u6700\u5927\u6709\u5229\u5e45\u5ea6\u3002</p>"}, {"location": "details/backtest/#_5", "title": "\u986f\u793a\u6ce2\u52d5\u5206\u6790\u5716", "text": "<p><pre><code>report.display_mae_mfe_analysis()\n</code></pre> </p>"}, {"location": "details/backtest/#_6", "title": "\u7b56\u7565\u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c", "text": "<p><pre><code>from finlab.analysis.liquidityAnalysis import LiquidityAnalysis\n\n# \u4ea4\u6613\u7d00\u9304\u9032\u51fa\u5834\u6210\u4ea4\u5f35\u6578\u5927\u65bc1000\u5f35\u7684\u6bd4\u4f8b, \u6210\u4ea4\u91d1\u984d\u5927\u65bc1000000\u5143\u7684\u6bd4\u4f8b\uff0c\u6aa2\u6e2c\u8cc7\u91d1\u90e8\u4f4d\u80c3\u7d0d\u91cf\nreport.run_analysis(LiquidityAnalysis(required_volume=100000, required_turnover=1000000))\n</code></pre> </p>"}, {"location": "details/backtest/#_7", "title": "\u66f4\u591a\u7bc4\u4f8b", "text": ""}, {"location": "details/backtest/#_8", "title": "\u5275\u65b0\u9ad8\u7b56\u7565", "text": "<p>\u4ee5 250 \u65e5\u9ad8\u9ede\u5224\u65b7\u5275\u65b0\u9ad8\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u5275 250 \u5929\u65b0\u9ad8\u7684\u80a1\u7968\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = (close == close.rolling(250).max())\n\n# \u56de\u6e2c\uff0c\u6bcf\u6708(M)\u8abf\u6574\u4e00\u6b21\uff0c\u9078\u51fa\u7576\u5929\u5275\u65b0\u9ad8\u80a1\u7968\nsim(position, resample='M', name=\"\u5275\u5e74\u65b0\u9ad8\u7b56\u7565\")\n</code></pre> <p></p>"}, {"location": "details/backtest/#rsi", "title": "\u9ad8 RSI \u6280\u8853\u6307\u6a19\u7b56\u7565", "text": "<p>\u53d6 RSI \u6700\u5927\u7684 20 \u6a94\u4e26\u6301\u6709\u4e00\u9031\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u9078\u51fa RSI \u6700\u5927\u7684 20 \u6a94\u80a1\u7968\nrsi = data.indicator('RSI')\nposition = rsi.is_largest(20)\n\n# \u56de\u6e2c\uff0c\u6bcf\u6708(M)\u8abf\u6574\u4e00\u6b21\nreport = sim(position, resample='W', name=\"\u9ad8RSI\u7b56\u7565\")\n</code></pre> <p></p>"}, {"location": "details/backtest/#_9", "title": "\u4e56\u96e2\u7387 + \u8ca1\u5831\u6ffe\u7db2", "text": "<p>\u4ee5 60 \u65e5\u4e56\u96e2\u7387\u53d6\u524d 30 \u540d\uff0c\u518d\u7528 ROE &gt; 0 \u6ffe\u7db2\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u4e0b\u8f09 ROE \u8ddf\u6536\u76e4\u50f9\nroe = data.get(\"fundamental_features:ROE\u7a05\u5f8c\")\nclose = data.get('price:\u6536\u76e4\u50f9')\n\nposition = (\n      (close / close.shift(60)).is_largest(30) # \u9078\u51fa\u4e56\u96e2\u7387\u524d 30 \u540d\u7684\u80a1\u7968\n    &amp; (roe &gt; 0) # \u9078\u51fa ROE \u5927\u65bc 0 \u7684\u80a1\u7968\n)\n\n# \u56de\u6e2c\uff0c\u6bcf\u6708(M)\u8abf\u6574\u4e00\u6b21\nreport = sim(position, resample='M', name=\"\u4e56\u96e2\u7387\u548cROE\u6ffe\u7db2\u7b56\u7565\")\n</code></pre> <p></p>"}, {"location": "details/backtest/#_10", "title": "\u5e38\u898b\u932f\u8aa4\u8207\u89e3\u6c7a\u65b9\u6cd5", "text": ""}, {"location": "details/backtest/#1", "title": "\u932f\u8aa4 1\uff1a\u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304", "text": "<p>\u73fe\u8c61\uff1a\u56de\u6e2c\u5b8c\u6210\u4f46\u7121\u4efb\u4f55\u4ea4\u6613\uff0c<code>get_trades()</code> \u56de\u50b3\u7a7a DataFrame</p> <pre><code>close = data.get('price:\u6536\u76e4\u50f9')\nposition = (close &gt; 100) &amp; (close &lt; 110)  # \u689d\u4ef6\u904e\u56b4\nreport = sim(position, resample='M')\n\ntrades = report.get_trades()\nprint(len(trades))  # 0\n</code></pre> <p>\u539f\u56e0\uff1a - \u9032\u5834\u689d\u4ef6\u904e\u65bc\u56b4\u683c\uff0c\u5c0e\u81f4 <code>position</code> \u5e7e\u4e4e\u5168\u70ba <code>False</code> - \u8cc7\u6599\u65e5\u671f\u7bc4\u570d\u904e\u77ed\uff0c\u7121\u8db3\u5920\u4ea4\u6613\u65e5\u89f8\u767c\u9032\u5834 - \u7be9\u9078\u5f8c\u7684\u80a1\u7968\u6c60\u904e\u5c0f\u6216\u4e0d\u5b58\u5728</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = (close &gt; 100) &amp; (close &lt; 110)\n\n# \u6aa2\u67e5\u9032\u5834\u8a0a\u865f\u7d71\u8a08\nentry_stats = position.sum(axis=1)  # \u6bcf\u65e5\u9032\u5834\u80a1\u7968\u6578\nprint(\"=== \u9032\u5834\u8a0a\u865f\u7d71\u8a08 ===\")\nprint(f\"\u5e73\u5747\u6bcf\u65e5\u9032\u5834\u80a1\u7968\u6578\uff1a{entry_stats.mean():.2f}\")\nprint(f\"\u6700\u5927\u9032\u5834\u80a1\u7968\u6578\uff1a{entry_stats.max()}\")\nprint(f\"\u6700\u5c0f\u9032\u5834\u80a1\u7968\u6578\uff1a{entry_stats.min()}\")\nprint(f\"\u6709\u9032\u5834\u8a0a\u865f\u7684\u4ea4\u6613\u65e5\u6578\uff1a{(entry_stats &gt; 0).sum()} / {len(entry_stats)}\")\n\n# \u5982\u679c\u5e73\u5747\u9032\u5834\u6578 &lt; 1\uff0c\u8868\u793a\u689d\u4ef6\u904e\u56b4\nif entry_stats.mean() &lt; 1:\n    print(\"\\n\u26a0\ufe0f \u8b66\u544a\uff1a\u9032\u5834\u689d\u4ef6\u904e\u56b4\uff0c\u5e73\u5747\u6bcf\u65e5\u4e0d\u5230 1 \u6a94\u80a1\u7968\")\n    print(\"\u5efa\u8b70\uff1a\")\n    print(\"1. \u653e\u5bec\u50f9\u683c\u5340\u9593\uff08\u5982 80-120 \u5143\uff09\")\n    print(\"2. \u4f7f\u7528 .is_largest(N) \u78ba\u4fdd\u56fa\u5b9a\u6a94\u6578\")\n    print(\"3. \u6aa2\u67e5\u8cc7\u6599\u5b8c\u6574\u6027\uff08data.get() \u662f\u5426\u6b63\u5e38\uff09\")\n\n    # \u4fee\u6b63\u7bc4\u4f8b\uff1a\u4f7f\u7528 is_largest() \u78ba\u4fdd\u56fa\u5b9a\u6a94\u6578\n    ma20 = close.average(20)\n    position_fixed = (close &gt; ma20).is_largest(30)  # \u56fa\u5b9a\u9078\u51fa 30 \u6a94\n    print(\"\\n\u2705 \u6539\u7528\u56fa\u5b9a\u6a94\u6578\u7b56\u7565\uff1a\")\n    print(f\"   \u5e73\u5747\u6bcf\u65e5\u9032\u5834\u80a1\u7968\u6578\uff1a{position_fixed.sum(axis=1).mean():.2f}\")\n\n# \u57f7\u884c\u56de\u6e2c\u4e26\u6aa2\u67e5\u7d50\u679c\nreport = sim(position, resample='M', name=\"\u6e2c\u8a66\u7b56\u7565\")\ntrades = report.get_trades()\n\nif len(trades) == 0:\n    print(\"\\n\u274c \u932f\u8aa4\uff1a\u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304\")\n    print(\"\u8acb\u6aa2\u67e5\u4e0a\u65b9\u7684\u9032\u5834\u8a0a\u865f\u7d71\u8a08\uff0c\u78ba\u8a8d\u689d\u4ef6\u662f\u5426\u904e\u56b4\")\nelse:\n    print(f\"\\n\u2705 \u56de\u6e2c\u6210\u529f\uff0c\u5171 {len(trades)} \u7b46\u4ea4\u6613\")\n    print(f\"   \u6301\u6709\u671f\u9593\uff1a{trades['entry_date'].min()} ~ {trades['exit_date'].max()}\")\n</code></pre> <p>\u9032\u968e\u8a3a\u65b7\uff1a</p> <pre><code># \u6aa2\u67e5\u7279\u5b9a\u6642\u9593\u9ede\u7684\u6301\u5009\u72c0\u614b\nimport pandas as pd\n\n# \u96a8\u6a5f\u62bd\u6a23 10 \u500b\u4ea4\u6613\u65e5\u6aa2\u67e5\nsample_dates = position.index[::len(position)//10][:10]\nfor date in sample_dates:\n    stocks = position.loc[date][position.loc[date]].index.tolist()\n    print(f\"{date}: {len(stocks)} \u6a94\u80a1\u7968 - {stocks[:5]}...\")\n\n# \u6aa2\u67e5\u662f\u5426\u6709\u80a1\u7968\u300c\u5f9e\u672a\u300d\u9032\u5834\nnever_entered = (position.sum(axis=0) == 0)\nprint(f\"\\n\u5f9e\u672a\u9032\u5834\u7684\u80a1\u7968\u6578\u91cf\uff1a{never_entered.sum()} / {len(position.columns)}\")\n</code></pre>"}, {"location": "details/backtest/#2keyerror-", "title": "\u932f\u8aa4 2\uff1aKeyError - \u65e5\u671f\u7d22\u5f15\u932f\u8aa4", "text": "<p>\u73fe\u8c61\uff1a\u57f7\u884c\u56de\u6e2c\u6642\u62cb\u51fa <code>KeyError</code>\uff0c\u932f\u8aa4\u8a0a\u606f\u986f\u793a\u67d0\u500b\u65e5\u671f\u4e0d\u5b58\u5728</p> <pre><code>report = sim(position, resample='M')\n# KeyError: Timestamp('2023-05-01 00:00:00')\n</code></pre> <p>\u539f\u56e0\uff1a - \u4f7f\u7528\u591a\u500b\u8cc7\u6599\u6e90\u6642\uff0c\u65e5\u671f\u7d22\u5f15\u7bc4\u570d\u4e0d\u4e00\u81f4 - <code>position</code> \u7684\u65e5\u671f\u7bc4\u570d\u8d85\u51fa\u8cc7\u6599\u53ef\u7528\u7bc4\u570d - \u4f7f\u7528 <code>shift()</code> \u6216 <code>rolling()</code> \u5c0e\u81f4\u524d\u671f\u8cc7\u6599\u7f3a\u5931</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\nimport finlab\n\n# \u65b9\u6cd5 1\uff1a\u4f7f\u7528 truncate_start \u5c0d\u9f4a\u8d77\u59cb\u65e5\u671f\nfinlab.truncate_start = '2020-01-01'  # \u53ea\u56de\u6e2c 2020 \u5e74\u5f8c\u7684\u8cc7\u6599\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nvolume = data.get('price:\u6210\u4ea4\u80a1\u6578')\n\n# \u6aa2\u67e5\u65e5\u671f\u7bc4\u570d\nprint(f\"\u6536\u76e4\u50f9\u65e5\u671f\u7bc4\u570d\uff1a{close.index[0]} ~ {close.index[-1]}\")\nprint(f\"\u6210\u4ea4\u91cf\u65e5\u671f\u7bc4\u570d\uff1a{volume.index[0]} ~ {volume.index[-1]}\")\n\n# \u65b9\u6cd5 2\uff1a\u624b\u52d5\u5c0d\u9f4a\u65e5\u671f\u7d22\u5f15\ncommon_dates = close.index.intersection(volume.index)\nclose_aligned = close.loc[common_dates]\nvolume_aligned = volume.loc[common_dates]\n\nprint(f\"\u5c0d\u9f4a\u5f8c\u65e5\u671f\u7bc4\u570d\uff1a{common_dates[0]} ~ {common_dates[-1]}\")\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 try-except \u6355\u6349\u932f\u8aa4\ntry:\n    position = (close &gt; close.average(20)) &amp; (volume &gt; 1000)\n    report = sim(position, resample='M')\n    print(\"\u2705 \u56de\u6e2c\u6210\u529f\")\n\nexcept KeyError as e:\n    print(f\"\u274c \u65e5\u671f\u7d22\u5f15\u932f\u8aa4\uff1a{e}\")\n    print(\"\\n\u53ef\u80fd\u539f\u56e0\uff1a\")\n    print(\"1. \u4f7f\u7528 rolling() \u6216 average() \u5c0e\u81f4\u524d\u671f\u8cc7\u6599\u7f3a\u5931\")\n    print(\"2. \u591a\u500b\u8cc7\u6599\u6e90\u7684\u65e5\u671f\u7bc4\u570d\u4e0d\u4e00\u81f4\")\n    print(\"\\n\u89e3\u6c7a\u65b9\u6cd5\uff1a\")\n    print(\"1. \u8a2d\u5b9a finlab.truncate_start \u7d71\u4e00\u8d77\u59cb\u65e5\u671f\")\n    print(\"2. \u4f7f\u7528 .dropna() \u79fb\u9664\u7f3a\u5931\u503c\")\n\n    # \u81ea\u52d5\u4fee\u6b63\uff1a\u79fb\u9664\u7f3a\u5931\u503c\n    position_cleaned = position.dropna(how='all', axis=0)  # \u79fb\u9664\u5168\u70ba NaN \u7684\u5217\n    position_cleaned = position_cleaned.fillna(False)       # \u5c07 NaN \u586b\u5145\u70ba False\n\n    print(f\"\\n\u2705 \u5df2\u81ea\u52d5\u79fb\u9664\u7f3a\u5931\u503c\uff0c\u91cd\u65b0\u56de\u6e2c...\")\n    report = sim(position_cleaned, resample='M')\n    print(f\"   \u56de\u6e2c\u671f\u9593\uff1a{position_cleaned.index[0]} ~ {position_cleaned.index[-1]}\")\n</code></pre> <p>\u9032\u968e\u8a3a\u65b7\uff1a\u6aa2\u67e5 position \u5b8c\u6574\u6027</p> <pre><code>import pandas as pd\n\n# \u6aa2\u67e5 position \u7684\u7f3a\u5931\u503c\nmissing_info = position.isna()\nprint(\"=== Position \u7f3a\u5931\u503c\u7d71\u8a08 ===\")\nprint(f\"\u7e3d\u7f3a\u5931\u503c\u6578\u91cf\uff1a{missing_info.sum().sum()}\")\nprint(f\"\u5168\u90e8\u70ba NaN \u7684\u5217\uff08\u65e5\u671f\uff09\u6578\u91cf\uff1a{missing_info.all(axis=1).sum()}\")\nprint(f\"\u5168\u90e8\u70ba NaN \u7684\u6b04\uff08\u80a1\u7968\uff09\u6578\u91cf\uff1a{missing_info.all(axis=0).sum()}\")\n\n# \u986f\u793a\u524d\u5e7e\u500b\u6709\u7f3a\u5931\u503c\u7684\u65e5\u671f\nmissing_dates = missing_info.any(axis=1)\nif missing_dates.sum() &gt; 0:\n    print(f\"\\n\u524d 5 \u500b\u6709\u7f3a\u5931\u503c\u7684\u65e5\u671f\uff1a\")\n    for date in position.index[missing_dates][:5]:\n        na_count = position.loc[date].isna().sum()\n        print(f\"  {date}: {na_count} \u6a94\u80a1\u7968\u7f3a\u5931\")\n</code></pre>"}, {"location": "details/backtest/#3-resample", "title": "\u932f\u8aa4 3\uff1a\u5fd8\u8a18\u8a2d\u5b9a resample \u5c0e\u81f4\u6bcf\u65e5\u8abf\u5009", "text": "<p>\u73fe\u8c61\uff1a\u56de\u6e2c\u7d50\u679c\u5831\u916c\u7387\u6975\u4f4e\uff0c\u4ea4\u6613\u6b21\u6578\u7570\u5e38\u591a</p> <pre><code>report = sim(position)  # \u274c \u672a\u8a2d\u5b9a resample\ntrades = report.get_trades()\nprint(len(trades))  # \u6578\u5343\u7b46\u4ea4\u6613\n</code></pre> <p>\u539f\u56e0\uff1a - \u672a\u8a2d\u5b9a <code>resample</code> \u53c3\u6578\uff0c\u9810\u8a2d\u70ba\u6bcf\u65e5\u8abf\u5009 - \u6bcf\u65e5\u8abf\u5009\u6703\u7522\u751f\u5927\u91cf\u4ea4\u6613\u6210\u672c\uff08\u624b\u7e8c\u8cbb + \u8b49\u4ea4\u7a05\uff09 - \u5be6\u969b\u4e0a\u5927\u591a\u6578\u7b56\u7565\u4e0d\u61c9\u8a72\u6bcf\u65e5\u983b\u7e41\u8abf\u5009</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\n\n# \u274c \u932f\u8aa4\uff1a\u672a\u8a2d\u5b9a resample\uff08\u6bcf\u65e5\u8abf\u5009\uff09\nreport_daily = sim(position, name=\"\u6bcf\u65e5\u8abf\u5009\")\ntrades_daily = report_daily.get_trades()\n\n# \u2705 \u6b63\u78ba\uff1a\u8a2d\u5b9a\u5408\u7406\u7684\u8abf\u5009\u983b\u7387\nreport_monthly = sim(position, resample='M', name=\"\u6bcf\u6708\u8abf\u5009\")\ntrades_monthly = report_monthly.get_trades()\n\n# \u5c0d\u6bd4\u4ea4\u6613\u6b21\u6578\u8207\u7e3e\u6548\nprint(\"=== \u8abf\u5009\u983b\u7387\u5c0d\u6bd4 ===\")\nprint(f\"\u6bcf\u65e5\u8abf\u5009\uff1a{len(trades_daily)} \u7b46\u4ea4\u6613\uff0c\u5e74\u5316\u5831\u916c {report_daily.stats['annual_return']:.2%}\")\nprint(f\"\u6bcf\u6708\u8abf\u5009\uff1a{len(trades_monthly)} \u7b46\u4ea4\u6613\uff0c\u5e74\u5316\u5831\u916c {report_monthly.stats['annual_return']:.2%}\")\n\n# \u901a\u5e38\u6bcf\u6708\u8abf\u5009\u7684\u7e3e\u6548\u6703\u6bd4\u6bcf\u65e5\u8abf\u5009\u597d\uff08\u4ea4\u6613\u6210\u672c\u8f03\u4f4e\uff09\nif report_monthly.stats['annual_return'] &gt; report_daily.stats['annual_return']:\n    print(\"\\n\u2705 \u5efa\u8b70\u4f7f\u7528\u300c\u6bcf\u6708\u8abf\u5009\u300d\uff0c\u53ef\u5927\u5e45\u964d\u4f4e\u4ea4\u6613\u6210\u672c\")\n</code></pre> <p>\u5e38\u7528\u8abf\u5009\u983b\u7387\uff1a</p> <pre><code># \u9031\u7dda\u7b56\u7565\uff08\u9069\u5408\u77ed\u7dda\uff09\nreport = sim(position, resample='W', name=\"\u6bcf\u9031\u8abf\u5009\")\n\n# \u6708\u7dda\u7b56\u7565\uff08\u6700\u5e38\u7528\uff0c\u9069\u5408\u4e0a\u73ed\u65cf\uff09\nreport = sim(position, resample='M', name=\"\u6bcf\u6708\u8abf\u5009\")\n\n# \u5b63\u7dda\u7b56\u7565\uff08\u9069\u5408\u9577\u7dda\uff09\nreport = sim(position, resample='Q', name=\"\u6bcf\u5b63\u8abf\u5009\")\n\n# \u81ea\u8a02\u8abf\u5009\u983b\u7387\uff08\u5982\u6bcf 20 \u500b\u4ea4\u6613\u65e5\uff09\nreport = sim(position, resample='20D', name=\"\u6bcf 20 \u65e5\u8abf\u5009\")\n</code></pre>"}, {"location": "details/backtest/#_11", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>API Reference - backtest - sim() \u5b8c\u6574\u53c3\u6578\u8aaa\u660e</li> <li>\u7b56\u7565\u512a\u5316\u6307\u5357 - \u627e\u51fa\u6700\u4f73\u8abf\u5009\u983b\u7387\u8207\u505c\u640d\u505c\u5229\u53c3\u6578</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5f9e\u7814\u7a76\u5230\u5be6\u76e4\u7684\u5b8c\u6574\u6d41\u7a0b</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357 - \u505c\u640d\u505c\u5229\u5be6\u6230\u6280\u5de7</li> <li>\u5e38\u898b\u554f\u984c FAQ - \u66f4\u591a\u7591\u96e3\u6392\u89e3</li> </ul>"}, {"location": "details/backtest_decorator/", "title": "\u8a08\u7b97\u9078\u80a1\u689d\u4ef6", "text": "<p><code>FinlabDataFrame</code> \u662f Finlab \u5728 Pandas DataFrame \u57fa\u790e\u4e0a\u64f4\u5c55\u7684\u9078\u80a1\u5c08\u7528\u5de5\u5177\uff0c\u8b93\u60a8\u7528\u7c21\u77ed\u8a9e\u6cd5\u5b8c\u6210\u8907\u96dc\u7684\u9078\u80a1\u7b56\u7565\u3002\u5982\u679c\u60a8\u4e0d\u719f\u6089 Pandas\uff0c\u5efa\u8b70\u5148\u53c3\u800310\u5206\u9418\u5b78\u6703Pandas\u6559\u5b78\u3002</p>"}, {"location": "details/backtest_decorator/#_2", "title": "\u5feb\u901f\u7d22\u5f15", "text": "\u985e\u5225 \u51fd\u5f0f \u529f\u80fd\u8aaa\u660e \u57fa\u672c\u904b\u7b97 <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&amp;</code>, <code>\\|</code>, <code>~</code> \u7b97\u8853\u3001\u6bd4\u8f03\u3001\u908f\u8f2f\u904b\u7b97 \u9078\u80a1 <code>is_largest(n)</code> \u9078\u51fa\u6578\u503c\u6700\u5927\u7684 n \u6a94 <code>is_smallest(n)</code> \u9078\u51fa\u6578\u503c\u6700\u5c0f\u7684 n \u6a94 <code>average(n)</code> \u8a08\u7b97 n \u671f\u79fb\u52d5\u5e73\u5747 \u9032\u51fa\u5834 <code>hold_until(exit)</code> \u8a2d\u5b9a\u9032\u51fa\u5834\u8a0a\u865f <code>is_entry()</code> \u63d0\u53d6\u9032\u5834\u6642\u9ede <code>is_exit()</code> \u63d0\u53d6\u51fa\u5834\u6642\u9ede \u8da8\u52e2 <code>rise(n)</code> \u662f\u5426\u9ad8\u65bc n \u671f\u524d <code>fall(n)</code> \u662f\u5426\u4f4e\u65bc n \u671f\u524d <code>sustain(window, count)</code> \u6301\u7e8c\u6eff\u8db3\u689d\u4ef6 \u4e2d\u6027\u5316 <code>neutralize(factors)</code> \u56e0\u5b50\u4e2d\u6027\u5316\uff08\u8ff4\u6b78\u6b98\u5dee\uff09 <code>neutralize_industry()</code> \u7522\u696d\u4e2d\u6027\u5316 \u5176\u4ed6 <code>quantile_row(q)</code> \u6a6b\u5411\u5206\u4f4d\u6578 <code>groupby_category()</code> \u7522\u696d\u5206\u7fa4 <code>index_str_to_date()</code> \u7d22\u5f15\u683c\u5f0f\u8f49\u63db"}, {"location": "details/backtest_decorator/#pandas-dataframe", "title": "\u8207 Pandas DataFrame \u7684\u5dee\u7570", "text": "\u5dee\u7570\u9805\u76ee \u8aaa\u660e \u984d\u5916\u51fd\u5f0f \u63d0\u4f9b\u9078\u80a1\u5c08\u7528\u51fd\u5f0f\u5982 <code>is_largest()</code>, <code>sustain()</code>, <code>hold_until()</code> \u7b49 \u81ea\u52d5\u5c0d\u9f4a \u904b\u7b97\u524d\u81ea\u52d5\u5c0d\u9f4a\u4e0d\u540c\u983b\u7387\u8cc7\u6599\uff08\u65e5\u3001\u6708\u3001\u5b63\uff09\uff0c\u7121\u9700\u624b\u52d5 <code>reindex</code>"}, {"location": "details/backtest_decorator/#finlabdataframe", "title": "\u5275\u5efa FinlabDataFrame", "text": "<p>\u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528 finlab.data.get()</p> <p>\u4f7f\u7528 <code>finlab.data.get()</code> \u7372\u5f97\u7684\u8cc7\u6599\uff0c\u81ea\u52d5\u70ba <code>FinlabDataFrame</code> \u683c\u5f0f\u3002</p> <p>\u65b9\u6cd5\u4e8c\uff1a\u8f49\u63db Pandas DataFrame</p> <pre><code>import pandas as pd\nfrom finlab.dataframe import FinlabDataFrame\n\ndf = pd.DataFrame()\ndf_finlab = FinlabDataFrame(df)\n</code></pre>"}, {"location": "details/backtest_decorator/#_3", "title": "\u904b\u7b97\u7b26\u865f", "text": "<p>\u8207 <code>pd.DataFrame</code> \u985e\u4f3c\uff0c\u5c0d\u76f8\u540c\u4f4d\u7f6e\u7684\u5143\u7d20\u9032\u884c\u904b\u7b97\u3002\u652f\u63f4\u4ee5\u4e0b\u904b\u7b97\u7b26\u865f\uff1a</p> \u985e\u578b \u904b\u7b97\u7b26 \u8aaa\u660e \u7b97\u8853\u904b\u7b97 <code>+</code> \u76f8\u52a0 <code>-</code> \u76f8\u6e1b <code>*</code> \u76f8\u4e58 <code>/</code> \u76f8\u9664 \u6bd4\u8f03\u904b\u7b97 <code>&gt;</code> \u5927\u65bc <code>&gt;=</code> \u5927\u65bc\u7b49\u65bc <code>==</code> \u7b49\u65bc <code>&lt;</code> \u5c0f\u65bc <code>&lt;=</code> \u5c0f\u65bc\u7b49\u65bc \u908f\u8f2f\u904b\u7b97 <code>&amp;</code> \u4e14\uff08AND\uff09 <code>\\|</code> \u6216\uff08OR\uff09 <code>~</code> \u975e\uff08NOT\uff09 <p>\u7bc4\u4f8b\uff1a\u9078\u51fa\u6536\u76e4\u50f9\u4ecb\u65bc 10 ~ 100 \u7684\u80a1\u7968 <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u6536\u76e4\u50f9\u4f4d\u65bc 10 ~ 100 \u4e4b\u9593\nbetween_10_100 = (close &gt; 10) &amp; (close &lt; 100)\n</code></pre></p> <p>\u8cc7\u6599\u983b\u7387\u81ea\u52d5\u5c0d\u9f4a</p> <p>\u7576\u4e0d\u540c\u983b\u7387\u8cc7\u6599\uff08\u65e5\u3001\u6708\u3001\u5b63\uff09\u9032\u884c\u904b\u7b97\u6642\uff0c<code>FinlabDataFrame</code> \u6703\u81ea\u52d5\u8655\u7406\u5c0d\u9f4a\uff1a</p> \u5c0d\u9f4a\u6b65\u9a5f \u8655\u7406\u65b9\u5f0f \u65e5\u671f\uff08index\uff09 \u53d6\u806f\u96c6\uff0c\u7f3a\u503c\u4ee5\u6700\u8fd1\u6578\u64da\u586b\u88dc\uff08forward fill\uff09 \u80a1\u7968\uff08column\uff09 \u53d6\u4ea4\u96c6\uff0c\u7121\u5c0d\u61c9\u8cc7\u6599\u7684\u80a1\u7968\u6703\u88ab\u5254\u9664 <p>\u7bc4\u4f8b\uff1a\u7d50\u5408\u6bcf\u65e5\u80a1\u50f9\u8207\u6bcf\u5b63\u8ca1\u5831\u8cc7\u6599</p> <pre><code>from finlab import data\n\n# \u53d6\u5f97 FinlabDataFrame\nclose = data.get('price:\u6536\u76e4\u50f9')\nroa = data.get('fundamental_features:ROA\u7a05\u5f8c\u606f\u524d')\n\n# \u904b\u7b97\u5169\u500b\u9078\u80a1\u689d\u4ef6\u4ea4\u96c6\ncond1 = close &gt; 37\ncond2 = roa &gt; 0\ncond_1_2 = cond1 &amp; cond2\n</code></pre> <p>\u4e0b\u5716\u70ba 1101 \u53f0\u6ce5\u7684\u8a0a\u865f\u793a\u610f\u3002\u53ef\u4ee5\u770b\u5230\u5373\u4f7f <code>cond1</code>\uff08\u65e5\uff09\u8207 <code>cond2</code>\uff08\u5b63\uff09\u983b\u7387\u4e0d\u540c\uff0c\u4e5f\u80fd\u76f4\u63a5\u904b\u7b97\uff1a</p> <p></p> <p>\u70ba\u4f55\u5408\u4f75\u5f8c\u7684\u8cc7\u6599\u884c\u6578\u8b8a\u5c11\uff1f</p> <p>\u96d6\u7136\u65e5\u671f\u53d6\u806f\u96c6\uff0c\u4f46\u5be6\u969b\u8cc7\u6599\u53ea\u6703\u4fdd\u7559\u5169\u8005\u7684\u91cd\u758a\u6642\u9593\u5340\u9593\u3002\u4f8b\u5982\uff1acond1 \u5f9e 2010 \u958b\u59cb\uff0ccond2 \u5f9e 2013 \u958b\u59cb\uff0c\u5408\u4f75\u5f8c\u7684\u8cc7\u6599\u5f9e 2013 \u958b\u59cb\u3002</p>"}, {"location": "details/backtest_decorator/#_4", "title": "\u9078\u80a1\u51fd\u5f0f", "text": ""}, {"location": "details/backtest_decorator/#averagen-", "title": "average(n) - \u79fb\u52d5\u5e73\u5747", "text": "<p>\u8a08\u7b97 n \u671f\u79fb\u52d5\u5e73\u5747\u503c\u3002</p> <pre><code>from finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\nsma = close.average(10)\ncond = close &gt; sma  # \u80a1\u50f9\u572810\u65e5\u5747\u7dda\u4e4b\u4e0a\n</code></pre> <p>\u8996\u89ba\u5316\u6aa2\u67e5\uff1a</p> <pre><code>import matplotlib.pyplot as plt\n\nclose.loc['2021', '2330'].plot()\nsma.loc['2021', '2330'].plot()\ncond.loc['2021', '2330'].mul(20).add(500).plot()\nplt.legend(['close', 'sma', 'cond'])\n</code></pre> <p></p>"}, {"location": "details/backtest_decorator/#is_largestn-", "title": "is_largest(n) - \u6578\u503c\u6700\u5927\u80a1\u7968", "text": "<p>\u7be9\u9078\u6bcf\u65e5\u6578\u503c\u6700\u5927\u7684\u524d n \u6a94\u80a1\u7968\u3002</p> <p></p> <pre><code>from finlab import data\n\nroa = data.get('fundamental_features:ROA\u7a05\u5f8c\u606f\u524d')\ngood_stocks = roa.is_largest(10)  # \u6bcf\u65e5 ROA \u524d 10 \u540d\n</code></pre> <p>\u8f38\u51fa\u7bc4\u4f8b\uff1a</p> date 000116 000538 000616 000700 000779 2013-Q1 False False True False False 2013-Q2 False False False False True 2013-Q3 False True False False False 2013-Q4 False False False True False 2014-Q1 True False False False False"}, {"location": "details/backtest_decorator/#is_smallestn-", "title": "is_smallest(n) - \u6578\u503c\u6700\u5c0f\u80a1\u7968", "text": "<p>\u7be9\u9078\u6bcf\u65e5\u6578\u503c\u6700\u5c0f\u7684\u524d n \u6a94\u80a1\u7968\u3002</p> <pre><code>from finlab import data\n\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\ncheap_stocks = pb.is_smallest(10)  # \u80a1\u50f9\u6de8\u503c\u6bd4\u6700\u5c0f\u7684 10 \u6a94\n</code></pre>"}, {"location": "details/backtest_decorator/#hold_until", "title": "\u8a0a\u865f\u9032\u51fa\u5834(hold_until)", "text": "<p>\u6700\u91cd\u8981\u7684\u7b56\u7565\u8a9e\u6cd5\uff0c\u7528\u65bc\u8a2d\u5b9a\u9032\u51fa\u5834\u908f\u8f2f\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nbuy = close &gt; close.average(5)\nsell = close &lt; close.average(20)\n\nposition = buy.hold_until(sell)\n</code></pre> <p>\u7576 <code>buy</code> \u8a0a\u865f\u70ba <code>True</code> \u6642\u8cb7\u5165\u4e26\u6301\u6709\uff0c\u76f4\u5230 <code>sell</code> \u8a0a\u865f\u70ba <code>True</code> \u6642\u8ce3\u51fa\u3002</p> <p></p>"}, {"location": "details/backtest_decorator/#_5", "title": "\u9032\u968e\u53c3\u6578", "text": "\u53c3\u6578 \u8aaa\u660e \u7bc4\u4f8b stop_loss \u505c\u640d\u6bd4\u4f8b <code>buy.hold_until(sell, stop_loss=0.1)</code> take_profit \u505c\u5229\u6bd4\u4f8b <code>buy.hold_until(sell, take_profit=0.2)</code> nstocks_limit \u6700\u591a\u6301\u6709\u80a1\u7968\u6578\uff08\u985e\u80a1\u8f2a\u52d5\uff09 <code>buy.hold_until(sell, nstocks_limit=5)</code> rank \u9078\u80a1\u512a\u5148\u9806\u5e8f\uff08\u6b63\u503c\u70ba\u7531\u5927\u5230\u5c0f\uff09 <code>buy.hold_until(sell, rank=-pb)</code>"}, {"location": "details/backtest_decorator/#_6", "title": "\u5b8c\u6574\u7b56\u7565\u7bc4\u4f8b", "text": "<p>\u50f9\u683c &gt; 20 \u65e5\u5747\u7dda\u5165\u5834\uff0c\u50f9\u683c &lt; 60 \u65e5\u5747\u7dda\u51fa\u5834\uff0c\u6700\u591a\u6301\u6709 10 \u6a94\uff0c\u4ee5\u80a1\u50f9\u6de8\u503c\u6bd4\u5c0f\u7684\u80a1\u7968\u512a\u5148\u3002</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\n\nentries = close &gt; close.average(20)\nexits = close &lt; close.average(60)\n\nposition = entries.hold_until(exits, nstocks_limit=10, rank=-pb)\nsim(position)\n</code></pre>"}, {"location": "details/backtest_decorator/#_7", "title": "\u6578\u503c\u8b8a\u5316\u8da8\u52e2", "text": ""}, {"location": "details/backtest_decorator/#risen-", "title": "rise(n) - \u6578\u503c\u4e0a\u5347\u4e2d", "text": "<p>\u5224\u65b7\u7576\u524d\u503c\u662f\u5426\u9ad8\u65bc n \u671f\u524d\u7684\u503c\u3002</p> <p></p> <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').rise(10)  # \u662f\u5426\u9ad8\u65bc10\u65e5\u524d\n</code></pre>"}, {"location": "details/backtest_decorator/#falln-", "title": "fall(n) - \u6578\u503c\u4e0b\u964d\u4e2d", "text": "<p>\u5224\u65b7\u7576\u524d\u503c\u662f\u5426\u4f4e\u65bc n \u671f\u524d\u7684\u503c\u3002</p> <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').fall(10)  # \u662f\u5426\u4f4e\u65bc10\u65e5\u524d\n</code></pre>"}, {"location": "details/backtest_decorator/#sustainwindow-count-", "title": "sustain(window, count) - \u6301\u7e8c\u6eff\u8db3\u689d\u4ef6", "text": "<p>\u5224\u65b7\u5728 window \u671f\u9593\u5167\uff0c\u81f3\u5c11\u6709 count \u671f\u6eff\u8db3\u689d\u4ef6\u3002</p> <pre><code>from finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\n\nclose.rise().sustain(2)      # \u9023\u7e8c2\u65e5\u4e0a\u6f32\nclose.rise().sustain(3, 2)   # 3\u65e5\u4e2d\u67092\u65e5\u4e0a\u6f32\n</code></pre>"}, {"location": "details/backtest_decorator/#_8", "title": "\u56e0\u5b50\u4e2d\u6027\u5316", "text": "<p>\u5728\u591a\u56e0\u5b50\u9078\u80a1\u4e2d\uff0c\u56e0\u5b50\u4e4b\u9593\u53ef\u80fd\u5b58\u5728\u76f8\u95dc\u6027\u3002\u4f8b\u5982\u5c0f\u578b\u80a1\u901a\u5e38\u672c\u76ca\u6bd4\u8f03\u4f4e\uff0c\u56e0\u6b64\u300c\u4f4e\u672c\u76ca\u6bd4\u300d\u56e0\u5b50\u53ef\u80fd\u53ea\u662f\u5728\u9078\u5c0f\u578b\u80a1\u3002\u4e2d\u6027\u5316\u900f\u904e\u6a6b\u622a\u9762\u8ff4\u6b78\uff0c\u79fb\u9664\u6307\u5b9a\u56e0\u5b50\u7684\u5f71\u97ff\uff0c\u7559\u4e0b\u7d14\u7cb9\u7684 alpha \u8a0a\u865f\u3002</p>"}, {"location": "details/backtest_decorator/#neutralizefactors-", "title": "neutralize(factors) - \u56e0\u5b50\u4e2d\u6027\u5316", "text": "<p>\u5c0d\u6307\u5b9a\u56e0\u5b50\u505a\u6a6b\u622a\u9762\u8ff4\u6b78\uff0c\u56de\u50b3\u6b98\u5dee\uff08\u53bb\u9664\u8a72\u56e0\u5b50\u5f71\u97ff\u5f8c\u7684\u503c\uff09\u3002</p> <pre><code>from finlab import data\n\nfactor = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nsize = data.get('etl:market_value')\n\n# \u53bb\u9664\u5e02\u503c\u5f71\u97ff\nneutralized = factor.neutralize(size)\n</code></pre> <p>\u652f\u63f4\u540c\u6642\u4e2d\u6027\u5316\u591a\u500b\u56e0\u5b50\uff1a</p> <pre><code>beta = data.get('fundamental_features:Beta')\n\n# \u7528 list \u50b3\u5165\u591a\u500b\u56e0\u5b50\nneutralized = factor.neutralize([size, beta])\n\n# \u6216\u7528 dict \u547d\u540d\uff08\u65b9\u4fbf\u9664\u932f\uff09\nneutralized = factor.neutralize({\n    'size': size,\n    'size2': size ** 2,\n    'beta': beta,\n})\n</code></pre>"}, {"location": "details/backtest_decorator/#neutralize_industry-", "title": "neutralize_industry() - \u7522\u696d\u4e2d\u6027\u5316", "text": "<p>\u4ee5\u7522\u696d\u5225\u865b\u64ec\u8b8a\u6578\u505a\u6a6b\u622a\u9762\u8ff4\u6b78\uff0c\u56de\u50b3\u6b98\u5dee\u3002\u81ea\u52d5\u4f7f\u7528 <code>security_categories</code> \u7684\u7522\u696d\u5206\u985e\u3002</p> <pre><code>from finlab import data\n\nfactor = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\n\n# \u53bb\u9664\u7522\u696d\u6548\u61c9\nneutralized = factor.neutralize_industry()\n</code></pre> <p>\u4e5f\u53ef\u81ea\u8a02\u7522\u696d\u5206\u985e\uff1a</p> <pre><code>import pandas as pd\n\ncustom_cats = pd.DataFrame({\n    'stock_id': ['2330', '2317', '1101'],\n    'category': ['\u534a\u5c0e\u9ad4', '\u96fb\u5b50', '\u6c34\u6ce5']\n})\nneutralized = factor.neutralize_industry(categories=custom_cats)\n</code></pre> <p>Tip</p> <p>\u4e2d\u6027\u5316\u5f8c\u7684\u56e0\u5b50\u53ef\u4ee5\u76f4\u63a5\u7528\u65bc <code>rank()</code>\u3001<code>is_largest()</code> \u7b49\u9078\u80a1\u51fd\u5f0f\uff0c\u7be9\u9078\u51fa\u7684\u80a1\u7968\u66f4\u80fd\u53cd\u6620\u56e0\u5b50\u672c\u8eab\u7684\u6548\u679c\uff0c\u800c\u975e\u88ab\u5e02\u503c\u6216\u7522\u696d\u6240\u4e3b\u5c0e\u3002</p>"}, {"location": "details/backtest_decorator/#_9", "title": "\u5176\u4ed6\u5be6\u7528\u51fd\u5f0f", "text": ""}, {"location": "details/backtest_decorator/#quantile_rowq-", "title": "quantile_row(q) - \u80a1\u7968\u7576\u5929\u5206\u4f4d\u6578", "text": "<p>\u53d6\u5f97\u6bcf\u65e5\u6a6b\u5411\u7684\u5206\u4f4d\u6578\u503c\u3002</p> <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').quantile_row(0.9)  # \u6bcf\u65e5\u80a1\u50f9\u524d90%\u5206\u4f4d\u6578\n</code></pre>"}, {"location": "details/backtest_decorator/#index_str_to_date-", "title": "index_str_to_date() - \u7d22\u5f15\u683c\u5f0f\u8f49\u63db", "text": "<p>\u5c07\u6708\u5b63\u5831\u7d22\u5f15\u5f9e\u5b57\u4e32\u8f49\u70ba\u516c\u544a\u622a\u6b62\u65e5\u3002</p> \u8f49\u63db\u524d \u8f49\u63db\u5f8c 2022-M1\uff08\u6708\u71df\u6536\uff09 2022-01-10 2022-Q1\uff08\u8ca1\u52d9\u5b63\u5831\uff09 2022-05-15 <pre><code>from finlab import data\n\ndata.get('monthly_revenue:\u7576\u6708\u71df\u6536').index_str_to_date()\ndata.get('financial_statement:\u73fe\u91d1\u53ca\u7d04\u7576\u73fe\u91d1').index_str_to_date()\n</code></pre>"}, {"location": "details/backtest_decorator/#groupby_category-", "title": "groupby_category() - \u7522\u696d\u5206\u7fa4", "text": "<p>\u6309\u7522\u696d\u5225\u5206\u7fa4\u8cc7\u6599\uff0c\u985e\u4f3c <code>pd.DataFrame.groupby()</code>\u3002</p> <p><pre><code>from finlab import data\npe = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\npe.groupby_category().mean()['\u534a\u5c0e\u9ad4'].plot()  # \u534a\u5c0e\u9ad4\u5e73\u5747\u80a1\u50f9\u6de8\u503c\u6bd4\n</code></pre> </p>"}, {"location": "details/backtest_decorator/#is_entry-", "title": "is_entry() - \u53d6\u9032\u5834\u9ede", "text": "<p>\u5f9e\u6301\u5009\u8a0a\u865f\u4e2d\u63d0\u53d6\u9032\u5834\u6642\u9ede\u3002</p> <pre><code>from finlab import data\n\nposition = data.get('price:\u6536\u76e4\u50f9').is_largest(10)\nentry_signals = position.is_entry()\n</code></pre>"}, {"location": "details/backtest_decorator/#is_exit-", "title": "is_exit() - \u53d6\u51fa\u5834\u9ede", "text": "<p>\u5f9e\u6301\u5009\u8a0a\u865f\u4e2d\u63d0\u53d6\u51fa\u5834\u6642\u9ede\u3002</p> <pre><code>from finlab import data\n\nposition = data.get('price:\u6536\u76e4\u50f9').is_largest(10)\nexit_signals = position.is_exit()\n</code></pre>"}, {"location": "details/factor_analysis/", "title": "\u5206\u6790\u7b56\u7565\u56e0\u5b50", "text": "<p>\u7814\u7a76\u56e0\u5b50\u5206\u6790\uff0c\u589e\u6e1b\u4fee\u6539\u56e0\u5b50\uff0c\u4e0d\u518d\u9760\u611f\u89ba\uff0c\u77ad\u89e3\u56e0\u5b50\u8207\u7b56\u7565\u5831\u916c\u7684\u95dc\u4fc2\u3002</p>"}, {"location": "details/factor_analysis/#finlab-package", "title": "FinLab Package \u63d0\u4f9b\u7684\u56e0\u5b50\u5206\u6790\u6d41\u7a0b\uff1a", "text": "<pre><code>\u7bc4\u4f8b\u7b56\u7565\n    \u2502\n    \u251c\u2500\u2500\u2500 \u7279\u5fb5\u5de5\u7a0b \u2500\u2500\u2500\u2500\u2192 \u56e0\u5b50\u7279\u5fb5 (Features)\n    \u2502\n    \u2514\u2500\u2500\u2500 \u6a19\u7c64\u5de5\u7a0b \u2500\u2500\u2500\u2500\u2192 \u8d85\u984d\u5831\u916c (Labels)\n                \u2502\n                \u251c\u2500\u2500\u2500 calc_factor_return() \u2500\u2500\u2500\u2500\u2192 \u56e0\u5b50\u5831\u916c\n                \u2502      \u2502\n                |      \u2514\u2500\u2500 calc_centrality() \u2500\u2192 \u56e0\u5b50\u96c6\u4e2d\u5ea6\n                \u2502\n                \u251c\u2500\u2500\u2500 calc_shapley_values() \u2500\u2500\u2500\u2192 \u56e0\u5b50\u8ca2\u737b\u5ea6\n                \u2502\n                \u2514\u2500\u2500\u2500 calc_ic() \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 \u56e0\u5b50\u76f8\u95dc\u6027(IC)\n</code></pre> <p>\u6211\u5011\u5c07\u793a\u7bc4\u5c07</p> <ol> <li>\u300c\u7bc4\u4f8b\u7b56\u7565\u300d\u8f49\u63db\u6210\u300c\u7279\u5fb5\u300d\u8207\u300c\u6a19\u7c64\u300d</li> <li>\u7528\u4e0a\u8ff0\u8cc7\u6599\u5206\u6790\u56e0\u5b50\u7684\u6548\u80fd</li> </ol>"}, {"location": "details/factor_analysis/#_2", "title": "\u7bc4\u4f8b\u7b56\u7565", "text": "<p>\u6b64\u7b56\u7565\u662f\u7531\u975e\u5e38\u57fa\u672c\u7684\u4e09\u500b\u56e0\u5b50\u7d44\u6210: 1. \u5e02\u503c 2. \u71df\u6536 3. \u52d5\u80fd</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nprice = data.get('etl:adj_close')\n\ncond1 = marketcap.rank(pct=True, axis=1) &lt; 0.3\ncond2 = (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &gt; 0.7\ncond3 = (price / price.shift(20)).rank(pct=True, axis=1) &gt; 0.7\n\npos = cond1 &amp; cond2 &amp; cond3\n\nreport = sim(pos, resample='ME', upload=False)\nreport.creturn.plot()\n</code></pre>"}, {"location": "details/factor_analysis/#_3", "title": "\u88fd\u4f5c\u7279\u5fb5\u8207\u6a19\u7c64", "text": "<pre><code>from finlab import data\nimport finlab.ml.feature as feature\nimport finlab.ml.label as label\n\nfeatures =  feature.combine({\n    'marketcap': cond1,\n    'revenue': cond2,\n    'momentum': cond3\n}, resample='ME')\n\n# \u8a08\u7b97\u672a\u4f86 1M \u7684\u6a19\u7c64\nlabels = label.excess_over_mean(index=features.index, resample='ME')\n\nfeatures.dropna().head()\n</code></pre> datetime instrument marketcap revenue momentum 2013-04-30 1101 False True True 2013-04-30 1102 False True True 2013-04-30 1103 False True False 2013-04-30 1104 False True False 2013-04-30 1108 False True False <pre><code>labels.dropna().head()\n</code></pre> <pre><code>datetime    instrument\n2007-04-30  1101          0.042548\n            1102          0.081764\n            1103         -0.016863\n            1104         -0.047492\n            1108         -0.002247\ndtype: float64\n</code></pre>"}, {"location": "details/factor_analysis/#factor-return", "title": "\u56e0\u5b50\u5831\u916c (Factor Return)", "text": "<p>\u56e0\u5b50\u5831\u916c\uff08Factor Return\uff09\u662f\u8861\u91cf\u67d0\u56e0\u5b50\u5728\u4e00\u6bb5\u6642\u9593\u5167\u6240\u5e36\u4f86\u8d85\u984d\u5831\u916c\u7684\u6307\u6a19\uff0c\u5e38\u7528\u65bc\u8a55\u4f30\u56e0\u5b50\u7684\u6709\u6548\u6027\u8207\u6295\u8cc7\u50f9\u503c\u3002</p> <p>\u5728\u672c\u5206\u6790\u6d41\u7a0b\u4e2d\uff0c\u6703\u5148\u6839\u64da\u4e0d\u540c\u7684\u56e0\u5b50\uff08\u5982\u5e02\u503c\u3001\u71df\u6536\u6210\u9577\u3001\u52d5\u80fd\u7b49\uff09\u5efa\u7acb\u7279\u5fb5\uff0c\u4e26\u8a08\u7b97\u6bcf\u500b\u56e0\u5b50\u7684\u56e0\u5b50\u5831\u916c\u3002\u900f\u904e\u7d2f\u7a4d\u56e0\u5b50\u5831\u916c\u7684\u8d70\u52e2\uff0c\u53ef\u4ee5\u89c0\u5bdf\u8a72\u56e0\u5b50\u7684\u9577\u671f\u8868\u73fe\u8207\u7a69\u5b9a\u6027\uff0c\u9032\u4e00\u6b65\u4f5c\u70ba\u56e0\u5b50\u7be9\u9078\u8207\u7d44\u5408\u7684\u91cd\u8981\u4f9d\u64da\u3002</p> <p>\u4e0b\u65b9\u5c07\u4ee5\u5716\u8868\u65b9\u5f0f\u5c55\u793a\u5404\u56e0\u5b50\u7684\u7d2f\u7a4d\u5831\u916c\u8868\u73fe\u3002</p> <pre><code>from finlab.tools.factor_analysis import calc_factor_return\nfrom finlab.plot import plot_line\n\nplot_line(calc_factor_return(features, labels).cumsum(), unit='.0%', title='Factor Cumulative Return')\n</code></pre> <p></p> <p>\u5716\u4e2d\uff0c\u53ef\u4ee5\u89c0\u5bdf\u6708\u71df\u6536\u56e0\u5b50\u6548\u679c\u986f\u8457\u6bd4\u8f03\u597d\uff0c\u4f46\u5e02\u503c\u56e0\u5b50\u6548\u679c\u8f03\u5dee\u3002</p>"}, {"location": "details/factor_analysis/#factor-centrality", "title": "\u56e0\u5b50\u96c6\u4e2d\u5ea6\uff08Factor Centrality\uff09", "text": "<p>\u56e0\u5b50\u96c6\u4e2d\u5ea6\uff08Factor Centrality\uff09\uff0c\u662f\u7528\u4f86\u91cf\u5316\u300c\u5171\u540c\u6027\u300d\u7684\u6307\u6a19\u3002</p> <p>\u56e0\u5b50\u96c6\u4e2d\u5ea6\uff08Centrality\uff09\u5b9a\u7fa9\u5982\u4e0b\uff1a</p> \\[ \\text{Centrality}_i = \\frac{\\lambda_i}{ \\sum_{j=1}^{k}\\lambda_j} \\] <p>\u5176\u4e2d\uff0c\\(\\lambda_j\\) \u70ba\u56e0\u5b50\u5c0d\u65bc\u7b2c\u4e00\u4e3b\u6210\u5206\u7684\u4f54\u6bd4\uff0c\\(k\\) \u70ba\u56e0\u5b50\u7e3d\u6578\u3002</p> <p>\u6b64\u6307\u6a19\u53cd\u6620\u4e86\u56e0\u5b50\u5831\u916c\u7684\u5171\u540c\u6027\uff0c</p> <ul> <li>\u6578\u503c\u8d8a\u5927\u8868\u793a<ul> <li>\u5229\u7528\u6b64\u56e0\u5b50\u9078\u80a1\uff0c\u5728\u8fd1\u671f\u7e3e\u6548\u6bd4\u8f03\u597d\u3002</li> <li>\u96c6\u4e2d\u5ea6\u8d8a\u9ad8\uff0c\u8fd1\u800c\u589e\u52a0\u672a\u4f86\u56de\u6a94\u7684\u98a8\u96aa\uff0c\u9700\u5bc6\u5207\u89c0\u5bdf\u3002</li> </ul> </li> <li>\u6578\u503c\u8d8a\u5c0f\u8868\u793a<ul> <li>\u5229\u7528\u6b64\u56e0\u5b50\u9078\u80a1\uff0c\u5728\u8fd1\u671f\u7e3e\u6548\u8f03\u5dee\u3002</li> <li>\u96c6\u4e2d\u5ea6\u8d8a\u4f4e\uff0c\u672a\u4f86\u56de\u6a94\u7684\u98a8\u96aa\u8f03\u4f4e\u3002</li> <li>\u53ef\u4ee5\u5728\u56e0\u5b50\u64c1\u64e0\u5ea6\u8f03\u4f4e\u7684\u6642\u5019\uff0c\u5bc6\u5207\u89c0\u5bdf\uff0c\u7b49\u64c1\u64e0\u5ea6\u4e0a\u5347\u521d\u671f\uff0c\u5229\u7528\u6b64\u56e0\u5b50\u9078\u80a1\u3002</li> </ul> </li> </ul> <pre><code>from finlab.tools.factor_analysis import calc_centrality\n\n\n\nplot_line(calc_centrality(calc_factor_return(features, labels), 12), title='Centrality')\n</code></pre> <p></p> <p>\u4e0a\u5716\u4e2d\uff0c\u7576\u5e02\u503c\u56e0\u5b50\u76ee\u524d\u64c1\u64e0\u5ea6\u8f03\u4f4e\uff0c\u53ef\u4ee5\u63db\u4e00\u500b\u56e0\u5b50\uff0c\u8b93\u7b56\u7565\u66f4\u7a69\u5b9a\u3002</p> <p>\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u5bc6\u5207\u89c0\u5bdf\u5e02\u503c\u56e0\u5b50\uff0c\u7b49\u64c1\u64e0\u5ea6\u4e0a\u5347\u521d\u671f\uff0c\u5229\u7528\u6b64\u56e0\u5b50\u9078\u80a1\uff08\u56e0\u5b50\u56de\u6b78\u6548\u61c9\uff09\u3002</p>"}, {"location": "details/factor_analysis/#shapley-values", "title": "\u56e0\u5b50\u8ca2\u737b\u5ea6\uff08Shapley Values\uff09", "text": "<p>Shapley Values \u662f\u4e00\u7a2e\u7528\u65bc\u91cf\u5316\u5404\u500b\u56e0\u5b50\u5c0d\u6295\u8cc7\u7d44\u5408\u5831\u916c\u7684\u8ca2\u737b\u5ea6\uff0c\u662f\u4e00\u7a2e\u516c\u5e73\u5206\u914d\u7684\u6578\u5b78\u65b9\u6cd5\u3002</p> <p>\u6211\u5011\u679a\u8209\u6240\u6709\u53ef\u80fd\u7684\u56e0\u5b50\u7d44\u5408\uff0c\u8a08\u7b97\u6bcf\u500b\u56e0\u5b50\u7d44\u5408\u7684\u5831\u916c\uff0c\u4e26\u8a08\u7b97\u6bcf\u500b\u56e0\u5b50\u5c0d\u5831\u916c\u7684\u8ca2\u737b\u5ea6\u3002</p> <p>\u6211\u5011\u751a\u81f3\u53ef\u4ee5\u8a08\u7b97\u51fa\uff0c\u6bcf\u500b\u56e0\u5b50\u3001\u6bcf\u500b\u6642\u9593\u9ede\uff0c\u5c0d\u5831\u916c\u7684\u8ca2\u737b\u5ea6\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0cShapley Values \u7684\u8a08\u7b97\u6642\u9593\u8907\u96dc\u5ea6\u70ba \\(O(2^n)\\)\uff0c\u5176\u4e2d \\(n\\) \u70ba\u56e0\u5b50\u500b\u6578\uff0c\u56e0\u6b64\u8a08\u7b97\u6642\u9593\u8f03\u9577\uff0c\u5728\u56e0\u5b50\u500b\u6578\u8f03\u591a\u6642\uff0c\u5efa\u8b70\u4f7f\u7528\u5176\u4ed6\u65b9\u6cd5\u3002</p> <pre><code>from finlab.tools.factor_analysis import calc_shapley_values\n\n\nplot_line(calc_shapley_values(features, labels))\n</code></pre> <p></p>"}, {"location": "details/factor_analysis/#information-coefficient", "title": "\u56e0\u5b50\u76f8\u95dc\u6027\uff08Information Coefficient\uff09", "text": "<p>\u56e0\u5b50 IC\uff08Information Coefficient\uff09\u662f\u8861\u91cf\u56e0\u5b50\u9810\u6e2c\u80fd\u529b\u7684\u91cd\u8981\u6307\u6a19\uff0c\u5e38\u7528\u65bc\u8a55\u4f30\u56e0\u5b50\u8207\u672a\u4f86\u5831\u916c\u4e4b\u9593\u7684\u76f8\u95dc\u6027\u3002</p> <p>IC \u7684\u8a08\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a</p> \\[ IC = \\text{corr}(\\text{Factor Score}, \\text{Future Return}) \\] <p>\u5176\u4e2d\uff0c\\(\\text{corr}\\) \u8868\u793a\u76f8\u95dc\u4fc2\u6578\uff08\u901a\u5e38\u70ba\u76ae\u723e\u68ee\u76f8\u95dc\uff09\uff0c\\(\\text{Factor Score}\\) \u70ba\u56e0\u5b50\u5206\u6578\uff0c\\(\\text{Future Return}\\) \u70ba\u672a\u4f86\u4e00\u6bb5\u671f\u9593\u7684\u8cc7\u7522\u5831\u916c\u3002</p> <p>IC \u6578\u503c\u7bc4\u570d\u901a\u5e38\u5728 -1 \u5230 1 \u4e4b\u9593\uff1a</p> <ul> <li>IC \u8d8a\u63a5\u8fd1 1\uff0c\u8868\u793a\u56e0\u5b50\u5c0d\u672a\u4f86\u5831\u916c\u6709\u5f88\u5f37\u7684\u6b63\u5411\u9810\u6e2c\u80fd\u529b\u3002</li> <li>IC \u8d8a\u63a5\u8fd1 -1\uff0c\u8868\u793a\u56e0\u5b50\u5c0d\u672a\u4f86\u5831\u916c\u6709\u5f88\u5f37\u7684\u53cd\u5411\u9810\u6e2c\u80fd\u529b\u3002</li> <li>IC \u63a5\u8fd1 0\uff0c\u8868\u793a\u56e0\u5b50\u5c0d\u672a\u4f86\u5831\u916c\u5e7e\u4e4e\u6c92\u6709\u9810\u6e2c\u80fd\u529b\u3002</li> </ul> <p>\u5728\u91cf\u5316\u9078\u80a1\u4e2d\uff0cIC \u662f\u5224\u65b7\u56e0\u5b50\u6709\u6548\u6027\u7684\u91cd\u8981\u4f9d\u64da\uff0cIC \u8d8a\u9ad8\u7684\u56e0\u5b50\u901a\u5e38\u66f4\u503c\u5f97\u7d0d\u5165\u6295\u8cc7\u7d44\u5408\u3002</p> <pre><code>from finlab.tools.factor_analysis import calc_ic\n\nfeatures_raw =  feature.combine({\n    'marketcap': -marketcap, # \u5c0f\u5e02\u503c\n    'revenue': revenue.average(3) / revenue.average(12),\n    'momentum': price / price.shift(20)\n}, resample='ME')\n\nplot_line(calc_ic(features_raw, labels, rank=True))\n</code></pre> <p></p>"}, {"location": "details/factor_analysis/#_4", "title": "\u56e0\u5b50\u8da8\u52e2\u5206\u6790", "text": ""}, {"location": "details/factor_analysis/#_5", "title": "\u6982\u8ff0", "text": "<p>\u4e0a\u8ff0\u300c\u96c6\u4e2d\u5ea6\u300d\u300c\u8ca2\u737b\u5ea6\u300d\u300c\u76f8\u95dc\u6027\u300d\u96a8\u6642\u9593\u8b8a\u5316\u6578\u503c\uff0c\u53ef\u4ee5\u5229\u7528 <code>calc_regression_stats</code> \u4f86\u8a08\u7b97\u8da8\u52e2\uff1a</p> <pre><code>from finlab.tools.factor_analysis import calc_regression_stats\n\ncentrality_df = calc_centrality(features, labels)\ncentrality_trend = calc_regression_stats(centrality_df)\n</code></pre> slope p_value r_squared tail_estimate trend marketcap -0.000111 3.102740e-17 0.404468 0.0123 down revenue 0.000018 4.861743e-03 0.056041 0.0087 flat momentum 0.000093 1.146515e-17 0.412914 0.0215 up"}, {"location": "details/factor_analysis/#_6", "title": "\u6838\u5fc3\u6b04\u4f4d", "text": "\u6b04\u4f4d \u8aaa\u660e \u6578\u503c\u7bc4\u570d \u542b\u7fa9 slope \u7dda\u6027\u56de\u6b78\u659c\u7387 (-\u221e, +\u221e) \u8da8\u52e2\u65b9\u5411\u548c\u5f37\u5ea6 p_value \u7d71\u8a08\u986f\u8457\u6027 [0, 1] \u8da8\u52e2\u7684\u53ef\u4fe1\u5ea6 r_squared \u6c7a\u5b9a\u4fc2\u6578 [0, 1] \u7dda\u6027\u6a21\u578b\u7684\u89e3\u91cb\u529b tail_estimate \u5c3e\u90e8\u4f30\u8a08\u503c (-\u221e, +\u221e) \u6642\u9593\u5e8f\u5217\u672b\u7aef\u7684\u9810\u6e2c\u503c trend \u8da8\u52e2\u5206\u985e \"up\"/\"down\"/\"flat\" \u7c21\u5316\u7684\u8da8\u52e2\u5224\u65b7"}, {"location": "details/factor_analysis/#_7", "title": "\u6578\u503c\u7bc4\u570d\u8207\u542b\u7fa9", "text": ""}, {"location": "details/factor_analysis/#slope", "title": "slope (\u659c\u7387)", "text": "<ul> <li>\u6b63\u503c: \u4e0a\u5347\u8da8\u52e2\uff0c\u64c1\u64e0\u5ea6\u589e\u52a0</li> <li>\u8ca0\u503c: \u4e0b\u964d\u8da8\u52e2\uff0c\u64c1\u64e0\u5ea6\u6e1b\u5c11</li> <li>\u7d55\u5c0d\u503c\u5927\u5c0f: \u8da8\u52e2\u5f37\u5ea6\uff08\u8d8a\u5927\u8d8a\u5f37\uff09</li> </ul>"}, {"location": "details/factor_analysis/#p_value", "title": "p_value (\u7d71\u8a08\u986f\u8457\u6027)", "text": "<ul> <li>[0, 0.01]: \u6975\u5ea6\u986f\u8457 (***)</li> <li>[0.01, 0.05]: \u9ad8\u5ea6\u986f\u8457 (**)</li> <li>[0.05, 0.1]: \u908a\u969b\u986f\u8457 (*)</li> <li>[0.1, 1]: \u4e0d\u986f\u8457</li> </ul>"}, {"location": "details/factor_analysis/#r_squared", "title": "r_squared (\u6c7a\u5b9a\u4fc2\u6578)", "text": "<ul> <li>[0.8, 1.0]: \u6975\u5f37\u89e3\u91cb\u529b</li> <li>[0.6, 0.8): \u5f37\u89e3\u91cb\u529b</li> <li>[0.4, 0.6): \u4e2d\u7b49\u89e3\u91cb\u529b</li> <li>[0.2, 0.4): \u5f31\u89e3\u91cb\u529b</li> <li>[0, 0.2): \u5f88\u5f31\u89e3\u91cb\u529b</li> </ul>"}, {"location": "details/factor_analysis/#_8", "title": "\u8da8\u52e2\u7d44\u5408\u5206\u6790", "text": "p_value r_squared slope trend \u542b\u7fa9 \u5c0f \u9ad8 \u6b63 up \u5f37\u70c8\u4e14\u7a69\u5b9a\u7684\u4e0a\u5347\u8da8\u52e2 \u5c0f \u9ad8 \u8ca0 down \u5f37\u70c8\u4e14\u7a69\u5b9a\u7684\u4e0b\u964d\u8da8\u52e2 \u5c0f \u4f4e \u4efb\u610f flat \u8da8\u52e2\u5b58\u5728\u4f46\u6548\u679c\u5c0f/\u96dc\u8a0a\u5927 \u5927 \u9ad8 \u4efb\u610f flat \u6a23\u672c\u5c11\uff0c\u96dc\u8a0a\u9ad8\uff0c\u7121\u6cd5\u5224\u65b7 \u5927 \u4f4e \u4efb\u610f flat \u57fa\u672c\u7121\u8da8\u52e2\u4e14\u6a21\u578b\u7121\u89e3\u91cb\u529b"}, {"location": "details/factor_analysis/#_9", "title": "\u5be6\u4f8b\u5206\u6790", "text": ""}, {"location": "details/factor_analysis/#marketcap", "title": "Marketcap (\u5e02\u503c\u56e0\u5b50)", "text": "<pre><code>slope: -0.000111 (\u8ca0\u503c)\np_value: 3.10e-17 (\u6975\u5ea6\u986f\u8457)\nr_squared: 0.40 (\u4e2d\u7b49\u504f\u5f37\u89e3\u91cb\u529b)\ntrend: down\n</code></pre> <p>\u89e3\u8b80: \u5e02\u503c\u56e0\u5b50\u7684\u96c6\u4e2d\u5ea6\u5448\u73fe\u975e\u5e38\u5f37\u70c8\u4e14\u7d71\u8a08\u4e0a\u6975\u5ea6\u986f\u8457\u7684\u4e0b\u964d\u8da8\u52e2\u3002</p>"}, {"location": "details/factor_analysis/#revenue", "title": "Revenue (\u71df\u6536\u56e0\u5b50)", "text": "<pre><code>slope: 0.000018 (\u6b63\u503c)\np_value: 0.0048 (\u986f\u8457)\nr_squared: 0.056 (\u89e3\u91cb\u529b\u8f03\u5f31)\ntrend: flat (\u56e0 r_squared &lt; 0.1)\n</code></pre> <p>\u89e3\u8b80: \u71df\u6536\u56e0\u5b50\u6709\u7d71\u8a08\u4e0a\u986f\u8457\u7684\u4e0a\u5347\u8da8\u52e2\uff0c\u4f46\u7531\u65bc\u89e3\u91cb\u529b\u4e0d\u8db3 (r_squared &lt; 0.1)\uff0c\u88ab\u6b78\u985e\u70ba flat\u3002</p>"}, {"location": "details/factor_analysis/#momentum", "title": "Momentum (\u52d5\u80fd\u56e0\u5b50)", "text": "<pre><code>slope: 0.000093 (\u986f\u8457\u6b63\u503c)\np_value: 1.14e-17 (\u6975\u5ea6\u986f\u8457)\nr_squared: 0.41 (\u4e2d\u7b49\u504f\u5f37\u89e3\u91cb\u529b)\ntrend: up\n</code></pre> <p>\u89e3\u8b80: \u52d5\u80fd\u56e0\u5b50\u7684\u96c6\u4e2d\u5ea6\u5448\u73fe\u975e\u5e38\u5f37\u70c8\u4e14\u7d71\u8a08\u4e0a\u6975\u5ea6\u986f\u8457\u7684\u4e0a\u5347\u8da8\u52e2\u3002\u9019\u662f\u4e00\u500b\u660e\u78ba\u7684\u4fe1\u865f\uff0c\u8868\u660e\u52d5\u80fd\u56e0\u5b50\u975e\u5e38\u300c\u71b1\u9580\u300d\uff0c\u5927\u91cf\u8cc7\u91d1\u6b63\u5728\u8ffd\u9010\u9019\u500b\u7b56\u7565\u3002</p>"}, {"location": "details/get_data/", "title": "\u6578\u64da", "text": "<p>\u4e00\u884c\u7a0b\u5f0f\u6293\u53d6\u53f0\u80a1\u95dc\u9375\u8cc7\u6599\u3002\u5927\u591a\u6578\u5e38\u7528\u8ca1\u5831\u8207\u884c\u60c5\u90fd\u53ef\u76f4\u63a5\u53d6\u5f97\u3002</p>"}, {"location": "details/get_data/#_1", "title": "\u4e0b\u8f09\u8cc7\u6599", "text": "<p>\u8cc7\u6599\u7372\u53d6\u65b9\u6cd5\uff0c\u5c31\u662f\u4f7f\u7528 <code>data.get</code> \u51fd\u5f0f\uff0c\u4e00\u6b21\u641e\u5b9a\u4e0b\u8f09 2000 \u6a94\u80a1\u7968 10 \u5e74\u4ee5\u4e0a\u7684\u6b77\u53f2\u7d00\u9304\uff1a</p> <pre><code>from finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> date 1001 ... 2330 2007-04-23 39.65 ... 38.3 ... ... ... ... 2023-05-02 39.85 ... 38.85 <p>\u56de\u50b3\u578b\u5225\u70ba <code>FinlabDataFrame</code>\uff08\u64f4\u5145\u7248 Pandas DataFrame\uff09\u3002\u719f\u6089 Pandas \u53ef\u76f4\u63a5\u4e0a\u624b\uff1b\u521d\u5b78\u8005\u53ef\u5148\u8b80 Pandas 10 \u5206\u9418\u4e0a\u624b\u3002</p> <ul> <li>\u7e31\u8ef8(row): \u662f\u5e02\u5834\u6709\u4ea4\u6613\u7684\u65e5\u671f\u7684\u6536\u76e4\u50f9\u3002</li> <li>\u6a6b\u8ef8(column): \u70ba\u80a1\u7968\u4ee3\u865f\uff0c\u88fd\u4f5c\u9078\u80a1\u7b56\u7565\u975e\u5e38\u65b9\u4fbf\u3002</li> </ul> <p>\u5982\u4f55\u8df3\u904e\u8981\u6c42\u767b\u5165?</p> <p>\u53ef\u4f7f\u7528\u7a0b\u5f0f\u767b\u5165\uff08\u4e0b\u65b9\u6709\u7bc4\u4f8b\uff09\uff0c\u514d\u53bb GUI \u9a57\u8b49\u3002</p> <p>\u9084\u6709\u63d0\u4f9b\u54ea\u4e9b\u8cc7\u6599\u5462\uff1f</p> <p>\u81f3\u8cc7\u6599\u5eab\u76ee\u9304\u67e5\u627e\u53ef\u7528\u8cc7\u6599\u8207\u9375\u540d\u3002</p> <p>\u514d\u8cbb\u8cc7\u6599\u6bd4\u8f03\u77ed\u4e00\u9ede\u5594</p> <p>\u514d\u8cbb\u7528\u6236\u53ef\u4e0b\u8f09\u591a\u6578\u8cc7\u6599\u4f9b\u56de\u6e2c\uff0c\u4f46\u4e0d\u542b\u8fd1\u5e74\u8cc7\u6599\u3002\u5347\u7d1a VIP \u4ee5\u4f7f\u7528\u6700\u65b0\u8cc7\u6599\u3002</p> <p>\u7528 AI \u52a9\u624b\u67e5\u627e\u8cc7\u6599</p> <p>\u4e0d\u78ba\u5b9a\u8cc7\u6599\u8868\u540d\u7a31\uff1f\u5728 AI \u7de8\u7a0b\u52a9\u624b\u4e2d\u5b89\u88dd FinLab Skill \u5f8c\uff0c\u76f4\u63a5\u8a62\u554f\u300c\u71df\u6536\u76f8\u95dc\u7684\u8cc7\u6599\u8868\u6709\u54ea\u4e9b\uff1f\u300d\u5373\u53ef\u53d6\u5f97\u6b63\u78ba\u7684 <code>data.get()</code> \u53c3\u6578\u8207\u7528\u6cd5\u7bc4\u4f8b\u3002</p>"}, {"location": "details/get_data/#datasearch", "title": "\u641c\u5c0b\u53ef\u7528\u6b04\u4f4d\uff08data.search\uff09", "text": "<p>\u4f7f\u7528 <code>data.search(keyword=None, market='tw')</code> \u641c\u5c0b\u53ef\u7528\u7684\u6b04\u4f4d\u540d\u7a31\uff0c\u56de\u50b3\u683c\u5f0f\u70ba <code>table:column</code>\u3002</p> <ul> <li><code>keyword</code>\uff1a\u95dc\u9375\u5b57\uff08\u4e0d\u5206\u5927\u5c0f\u5beb\uff09\uff1b\u70ba <code>None</code> \u6642\u5217\u51fa\u5168\u90e8</li> <li><code>market</code>\uff1a<code>'tw'</code>\uff08\u9810\u8a2d\uff0c\u53f0\u80a1\uff09\u3001<code>'us'</code>\uff08\u7f8e\u80a1\uff09\u3001<code>'all'</code>\uff08\u53f0\u80a1+\u7f8e\u80a1\uff09</li> <li>\u7121\u6548\u7684 <code>market</code> \u6703\u62cb\u51fa <code>ValueError</code></li> </ul> <pre><code>from finlab import data\n\n# \u5217\u51fa\u53f0\u80a1\u6240\u6709\u6b04\u4f4d\uff08\u9810\u8a2d\uff09\nall_tw = data.search()\n\n# \u53f0\u80a1\u95dc\u9375\u5b57\u641c\u5c0b\nclose_tw = data.search('\u6536\u76e4')\n\n# \u7f8e\u80a1\u95dc\u9375\u5b57\u641c\u5c0b\nclose_us = data.search('close', market='us')\n\n# \u5168\u5e02\u5834\u641c\u5c0b\nprice_all = data.search('price', market='all')\n</code></pre> <p>Catalog \u4f86\u6e90\uff1aFirestore <code>data_categories/finlab_tw_stock</code>\uff08\u53f0\u80a1\uff09\u3001<code>data_categories/finlab_us_stock</code>\uff08\u7f8e\u80a1\uff09\uff0c\u4e26\u4f7f\u7528 LRU \u5feb\u53d6\u3002</p>"}, {"location": "details/get_data/#_2", "title": "\u81ea\u52d5\u767b\u5165\u53d6\u5f97\u6b77\u53f2\u8cc7\u6599", "text": "<p>\u4e0b\u8f09\u524d\u8acb\u5148\u767b\u5165\u3002Jupyter/Colab \u6703\u81ea\u52d5\u8df3\u51fa\u767b\u5165\u8996\u7a97\uff1bVSCode/\u7d14\u8173\u672c\u5efa\u8b70\u4ee5\u7a0b\u5f0f\u767b\u5165\uff1a</p> <p>\u81f3 \u6703\u54e1\u5c08\u5340 \u53d6\u5f97 API token \u5f8c\u767b\u5165\uff1a</p> <pre><code>import finlab\nfinlab.login('YOUR_API_TOKEN')\n</code></pre> <p>\u66f4\u5b89\u5168\u7684\u5beb\u6cd5</p> <p>\u53ef\u4ee5\u5229\u7528\u74b0\u5883\u8b8a\u6578\u8a2d\u5b9a\uff0c\u907f\u514d\u60a8\u7684 API_TOKEN \u5916\u6d41\uff0c\u4ee5\u4e0b\u8a2d\u5b9a\u65b9\u5f0f\u9700\u8981\u6bcf\u6b21\u958b\u555f Terminal \u91cd\u65b0\u8a2d\u5b9a\uff0c\u5047\u5982\u60a8\u4e26\u975e\u8edf\u9ad4\u5de5\u7a0b\u80cc\u666f\uff0c\u53ef\u8df3\u904e\u6b64\u6b65\u9a5f\u3002</p> WindowsMacOS / Linux <p>\u6253\u958b\u547d\u4ee4\u63d0\u793a\u8996\u7a97\uff0c\u4e26\u8f38\u5165 <pre><code>set FINLAB_API_TOKEN=&lt;YOUR_API_TOKEN&gt;\n</code></pre></p> <p>\u6253\u958b terminal <pre><code>export FINLAB_API_TOKEN=&lt;YOUR_API_TOKEN&gt;\n</code></pre></p>"}, {"location": "details/get_data/#_3", "title": "\u5e02\u5834\u8207\u985e\u80a1\u7bc4\u570d", "text": "<p>\u9650\u5b9a\u7bc4\u570d\u53ef\u7528 <code>data.universe</code> \u8a2d\u5b9a\u3002\u4f8b\u5982\u53d6\u4e0a\u5e02\u6ac3\u300c\u6c34\u6ce5\u5de5\u696d\u300d\u7684\u6536\u76e4\u50f9\uff1a</p> <pre><code>from finlab import data\n\nwith data.universe(market='TSE_OTC', category=['\u6c34\u6ce5\u5de5\u696d']):\n\n    price = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u9019\u6a23\u5c31\u6703\u53d6\u5f97\u5728\u4e0a\u5e02\u6ac3\u4e2d\u7684\u6c34\u6ce5\u7522\u696d\u80a1\u7968\u6536\u76e4\u50f9\u7684\u8cc7\u6599:</p> <p></p>"}, {"location": "details/get_data/#market", "title": "\u5e02\u5834\u7bc4\u570d (market)", "text": "<p>\u5728\u53f0\u7063\u80a1\u5e02\uff0c\u5e02\u5834\u7bc4\u570d (market) \u53ef\u9078\uff1a</p> \u5e02\u5834\u4ee3\u78bc \u8aaa\u660e <code>ALL</code> \u5168\u5e02\u5834\uff0c\u5305\u62ec\u4e0a\u5e02\u3001\u4e0a\u6ac3\u3001\u8208\u6ac3\u3001\u516c\u958b\u767c\u884c\u7b49\u6240\u6709\u80a1\u7968 <code>TSE</code> \u4e0a\u5e02\u516c\u53f8\u80a1\u7968\uff08\u5728\u53f0\u7063\u8b49\u5238\u4ea4\u6613\u6240\u4e0a\u5e02\uff09 <code>OTC</code> \u4e0a\u6ac3\u516c\u53f8\u80a1\u7968\uff08\u5728\u53f0\u7063\u8b49\u5238\u6ac3\u6aaf\u8cb7\u8ce3\u4e2d\u5fc3\u4e0a\u5e02\uff09 <code>TSE_OTC</code> \u4e0a\u5e02\u6ac3\u516c\u53f8\u80a1\u7968\uff08\u5305\u542b\u4e0a\u5e02\u53ca\u4e0a\u6ac3\u516c\u53f8\uff09 <code>ETF</code> \u4ea4\u6613\u578b\u57fa\u91d1\uff0c\u53ef\u4ee5\u50cf\u80a1\u7968\u4e00\u6a23\u4ea4\u6613\u7684\u57fa\u91d1 <p>ETF \u76f8\u95dc\u985e\u80a1\uff0c\u53ef\u4ee5\u4f7f\u7528</p> \u985e\u5225 \u63cf\u8ff0 <code>domestic_etf</code> \u4ee5\u53f0\u80a1\u70ba\u6210\u5206\u80a1\u4e4b ETF <code>foreign_etf</code> \u4ee5\u570b\u5916\u5546\u54c1\u70ba\u6210\u5206\u80a1\u4e4b ETF <code>leveraged_etf</code> \u69d3\u687f\u578b ETF <code>vanilla_futures_etf</code> \u7121\u69d3\u687f\u671f\u8ca8 ETF <code>leveraged_futures_etf</code> \u69d3\u687f\u578b\u671f\u8ca8 ETF"}, {"location": "details/get_data/#category", "title": "\u985e\u80a1\u7bc4\u570d (category)", "text": "<p>\u985e\u80a1\u7bc4\u570d (category) \u4f9d\u884c\u696d\u5206\u985e\uff0c\u53ef\u9078\u4ee5\u4e0b\u7522\u696d\uff1a</p> <p><code>\u5149\u96fb\u696d</code> <code>\u5176\u4ed6\u96fb\u5b50\u696d</code> <code>\u5316\u5b78\u5de5\u696d</code> <code>\u534a\u5c0e\u9ad4</code> <code>\u5851\u81a0\u5de5\u696d</code> <code>\u5b58\u8a17\u6191\u8b49</code> <code>\u5efa\u6750\u71df\u9020</code> <code>\u6587\u5316\u5275\u610f\u696d</code> <code>\u6a61\u81a0\u5de5\u696d</code> <code>\u6c34\u6ce5\u5de5\u696d</code> <code>\u6c7d\u8eca\u5de5\u696d</code> <code>\u6cb9\u96fb\u71c3\u6c23\u696d</code> <code>\u73bb\u7483\u9676\u74f7</code> <code>\u751f\u6280\u91ab\u7642</code> <code>\u751f\u6280\u91ab\u7642\u696d</code> <code>\u7d21\u7e54\u7e96\u7dad</code> <code>\u822a\u904b\u696d</code> <code>\u89c0\u5149\u4e8b\u696d</code> <code>\u8cbf\u6613\u767e\u8ca8</code> <code>\u8cc7\u8a0a\u670d\u52d9\u696d</code> <code>\u8fb2\u696d\u79d1\u6280</code> <code>\u901a\u4fe1\u7db2\u8def\u696d</code> <code>\u9020\u7d19\u5de5\u696d</code> <code>\u91d1\u878d</code> <code>\u92fc\u9435\u5de5\u696d</code> <code>\u96fb\u5668\u96fb\u7e9c</code> <code>\u96fb\u5b50\u5546\u52d9</code> <code>\u96fb\u5b50\u901a\u8def\u696d</code> <code>\u96fb\u5b50\u96f6\u7d44\u4ef6</code> <code>\u96fb\u6a5f\u6a5f\u68b0</code> <code>\u96fb\u8166\u53ca\u9031\u908a</code> <code>\u98df\u54c1\u5de5\u696d</code></p> <p>\u53d6\u6d88\u6a21\u7cca\u6bd4\u5c0d</p> <p>\u4f7f\u7528\u6b63\u898f\u8868\u9054\u5f0f\u9078\u53d6\uff1a\u7531\u65bc\u7a0b\u5f0f\u662f\u4f7f\u7528 regex \u4f86\u9032\u884c\u6bd4\u5c0d\uff0c\u6240\u4ee5\u6703\u8b8a\u6210\u6a21\u7cca\u6bd4\u5c0d\uff0c\u7576 categories \u662f\u300c\u5176\u4ed6\u300d\uff0c\u5247\u6703\u9078\u51fa\u6240\u6709\u7684\u300c\u5176\u4ed6\u300d\u985e\u80a1\uff0c\u5305\u542b\u300c\u5176\u4ed6\u8b49\u5238\u300d\u3002\u5982\u679c\u4f7f\u7528\u8005\u5982\u679c\u5e0c\u671b\u9078\u51fa\u300c\u5176\u4ed6\u300d\u4f46\u4e0d\u60f3\u8981\u9078\u51fa\u300c\u5176\u4ed6\u8b49\u5238\u300d\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\uff1a</p> <pre><code>with universe('TSE_OTC', ['^\u5176\u4ed6$']):\n    close_subset = data.get('price:\u6536\u76e4\u50f9')\n    print(close_subset)\n</code></pre> <p>\u9019\u6a23\u5c31\u6703\u660e\u78ba\u6307\u660e\u958b\u982d\u8ddf\u7d50\u5c3e\u4e2d\u9593\uff0c\u53ea\u6709\u300c\u5176\u4ed6\u300d\u7684\u985e\u80a1\u6703\u88ab\u9078\u51fa\u4f86\u3002</p>"}, {"location": "details/get_data/#exclude_category", "title": "\u6392\u9664\u985e\u80a1\uff08exclude_category\uff09", "text": "<p>\u82e5\u60f3\u8981\u5728\u7bc4\u570d\u5167\u6392\u9664\u7279\u5b9a\u985e\u80a1\uff0c\u53ef\u4f7f\u7528 <code>exclude_category</code> \u53c3\u6578\u3002\u6b64\u53c3\u6578\u652f\u63f4\u5b57\u4e32\u6216\u6e05\u55ae\uff0c\u4e26\u540c\u6a23\u63a1\u7528\u6b63\u898f\u8868\u793a\u5f0f\uff08regex\uff09\u9032\u884c\u6a21\u7cca\u6bd4\u5c0d\u3002</p> <pre><code>from finlab import data\n\n# \u50c5\u9078\u53d6\u4e0a\u5e02\u6ac3\u7684\u300c\u6c34\u6ce5\u5de5\u696d\u300d\u76f8\u95dc\u985e\u80a1\uff0c\u4e14\u6392\u9664\u300c\u91d1\u878d\u300d\u76f8\u95dc\u985e\u80a1\nwith data.universe(market='TSE_OTC', category=['\u6c34\u6ce5\u5de5\u696d'], exclude_category=['\u91d1\u878d']):\n    price = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u5148\u5f8c\u9806\u5e8f</p> <p><code>exclude_category</code> \u9810\u8a2d\u70ba <code>None</code>\u3002\u82e5\u540c\u6642\u8a2d\u6709 <code>category</code> \u8207 <code>exclude_category</code>\uff0c\u7cfb\u7d71\u6703\u5148\u9078\u51fa\u7b26\u5408 <code>category</code> \u689d\u4ef6\u7684\u96c6\u5408\uff0c\u518d\u9032\u884c <code>exclude_category</code> \u7684\u6392\u9664\u3002</p>"}, {"location": "details/get_data/#_4", "title": "\u5e38\u898b\u932f\u8aa4\u8207\u89e3\u6c7a\u65b9\u6cd5", "text": ""}, {"location": "details/get_data/#1keyerror-", "title": "\u932f\u8aa4 1\uff1aKeyError - \u627e\u4e0d\u5230\u8cc7\u6599\u8868", "text": "<p>\u73fe\u8c61\uff1a\u57f7\u884c <code>data.get()</code> \u6642\u62cb\u51fa <code>KeyError</code></p> <pre><code>close = data.get('price:\u6536\u76e4')  # \u274c \u932f\u8aa4\uff1a\u6b04\u4f4d\u540d\u7a31\u4e0d\u6b63\u78ba\n# KeyError: 'price:\u6536\u76e4'\n</code></pre> <p>\u539f\u56e0\uff1a - \u8cc7\u6599\u8868\u540d\u7a31\u62fc\u5beb\u932f\u8aa4\uff08\u6b63\u78ba\u70ba\u300c\u6536\u76e4\u50f9\u300d\u800c\u975e\u300c\u6536\u76e4\u300d\uff09 - \u8a72\u8cc7\u6599\u8868\u4e0d\u5b58\u5728\u65bc\u8cc7\u6599\u5eab\u4e2d - API Token \u672a\u8a2d\u5b9a\u6216\u7121\u6548\uff0c\u5c0e\u81f4\u7121\u6cd5\u5b58\u53d6\u8cc7\u6599</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab import data\n\n# \u65b9\u6cd5 1\uff1a\u5148\u641c\u5c0b\u6b63\u78ba\u7684\u6b04\u4f4d\u540d\u7a31\nmatching_fields = data.search('\u6536\u76e4')\nprint(matching_fields)\n# \u8f38\u51fa\uff1a['price:\u6536\u76e4\u50f9', 'price:\u6210\u4ea4\u80a1\u6578', ...]\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 try-except \u8655\u7406\u932f\u8aa4\ntry:\n    close = data.get('price:\u6536\u76e4\u50f9')\n    print(f\"\u2705 \u8cc7\u6599\u4e0b\u8f09\u6210\u529f\uff0c\u7bc4\u570d\uff1a{close.index[0]} ~ {close.index[-1]}\")\nexcept KeyError as e:\n    print(f\"\u274c \u627e\u4e0d\u5230\u8cc7\u6599\u8868\uff1a{e}\")\n    print(\"\u8acb\u4f7f\u7528 data.search('\u95dc\u9375\u5b57') \u641c\u5c0b\u6b63\u78ba\u7684\u6b04\u4f4d\u540d\u7a31\")\n    print(\"\u6216\u81f3 https://ai.finlab.tw/database \u67e5\u8a62\u53ef\u7528\u8cc7\u6599\")\nexcept Exception as e:\n    print(f\"\u274c \u4e0b\u8f09\u5931\u6557\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5\uff1a\")\n    print(\"1. API Token \u662f\u5426\u5df2\u8a2d\u5b9a\uff08finlab.login('YOUR_TOKEN')\uff09\")\n    print(\"2. \u7db2\u8def\u9023\u7dda\u662f\u5426\u6b63\u5e38\")\n    print(\"3. \u662f\u5426\u70ba\u6709\u6548\u7684 VIP \u6703\u54e1\")\n</code></pre>"}, {"location": "details/get_data/#2empty-dataframe", "title": "\u932f\u8aa4 2\uff1a\u8cc7\u6599\u70ba\u7a7a\uff08Empty DataFrame\uff09", "text": "<p>\u73fe\u8c61\uff1a\u6210\u529f\u4e0b\u8f09\u4f46 DataFrame \u6c92\u6709\u4efb\u4f55\u8cc7\u6599</p> <pre><code>close = data.get('price:\u6536\u76e4\u50f9')\nprint(close)\n# Empty DataFrame\n# Columns: []\n# Index: []\n</code></pre> <p>\u539f\u56e0\uff1a - \u4f7f\u7528 <code>data.universe()</code> \u6642\uff0c\u7be9\u9078\u689d\u4ef6\u904e\u65bc\u56b4\u683c\uff08\u5982\u985e\u80a1\u4e0d\u5b58\u5728\uff09 - \u514d\u8cbb\u7528\u6236\u4e0b\u8f09\u7684\u8cc7\u6599\u4e0d\u5728\u53ef\u7528\u7bc4\u570d\u5167 - \u8cc7\u6599\u4f86\u6e90\u66ab\u6642\u7121\u8cc7\u6599</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab import data\n\n# \u6aa2\u67e5\u4e0b\u8f09\u7d50\u679c\u662f\u5426\u70ba\u7a7a\ntry:\n    with data.universe(market='TSE', category=['\u4e0d\u5b58\u5728\u7684\u985e\u80a1']):\n        close = data.get('price:\u6536\u76e4\u50f9')\n\n    # \u6aa2\u67e5\u8cc7\u6599\u5b8c\u6574\u6027\n    if close.empty:\n        print(\"\u26a0\ufe0f \u8b66\u544a\uff1a\u4e0b\u8f09\u7684\u8cc7\u6599\u70ba\u7a7a\")\n        print(\"\u53ef\u80fd\u539f\u56e0\uff1a\")\n        print(\"1. universe \u7be9\u9078\u689d\u4ef6\u904e\u56b4\uff08\u985e\u80a1\u540d\u7a31\u4e0d\u5b58\u5728\uff09\")\n        print(\"2. \u8cc7\u6599\u8868\u672c\u8eab\u7121\u8cc7\u6599\")\n        raise ValueError(\"\u4e0b\u8f09\u7684\u8cc7\u6599\u70ba\u7a7a\uff0c\u8acb\u6aa2\u67e5\u7be9\u9078\u689d\u4ef6\")\n\n    if close.shape[0] &lt; 10:\n        print(f\"\u26a0\ufe0f \u8b66\u544a\uff1a\u8cc7\u6599\u7b46\u6578\u904e\u5c11\uff08\u50c5 {close.shape[0]} \u7b46\uff09\")\n\n    if close.shape[1] &lt; 10:\n        print(f\"\u26a0\ufe0f \u8b66\u544a\uff1a\u80a1\u7968\u6578\u91cf\u904e\u5c11\uff08\u50c5 {close.shape[1]} \u6a94\uff09\")\n\n    print(f\"\u2705 \u8cc7\u6599\u6b63\u5e38\uff1a{close.shape[0]} \u500b\u4ea4\u6613\u65e5\uff0c{close.shape[1]} \u6a94\u80a1\u7968\")\n\nexcept ValueError as e:\n    print(f\"\u274c {e}\")\n    # \u6aa2\u67e5\u53ef\u7528\u7684\u985e\u80a1\u6e05\u55ae\n    print(\"\\n\u53ef\u7528\u985e\u80a1\u7bc4\u570d\uff1a\")\n    print(\"\u6c34\u6ce5\u5de5\u696d\u3001\u5851\u81a0\u5de5\u696d\u3001\u534a\u5c0e\u9ad4\u3001\u96fb\u8166\u53ca\u9031\u908a...\")\n    print(\"\u5b8c\u6574\u6e05\u55ae\u8acb\u53c3\u8003\u6587\u4ef6\uff1a\u985e\u80a1\u7bc4\u570d (category)\")\n</code></pre>"}, {"location": "details/get_data/#3timeout", "title": "\u932f\u8aa4 3\uff1a\u7db2\u8def\u903e\u6642\uff08Timeout\uff09", "text": "<p>\u73fe\u8c61\uff1a\u4e0b\u8f09\u8cc7\u6599\u6642\u9577\u6642\u9593\u7121\u56de\u61c9\uff0c\u6700\u7d42\u62cb\u51fa <code>Timeout</code> \u6216\u9023\u7dda\u932f\u8aa4</p> <pre><code>close = data.get('price:\u6536\u76e4\u50f9')\n# requests.exceptions.ReadTimeout: HTTPSConnectionPool(host='...', port=443): Read timed out.\n</code></pre> <p>\u539f\u56e0\uff1a - \u7db2\u8def\u9023\u7dda\u4e0d\u7a69\u5b9a - \u4e0b\u8f09\u7684\u8cc7\u6599\u91cf\u904e\u5927\uff08\u5982\u5168\u5e02\u5834 10 \u5e74\u4ee5\u4e0a\u8cc7\u6599\uff09 - \u4f3a\u670d\u5668\u66ab\u6642\u7121\u6cd5\u56de\u61c9</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab import data\nimport time\n\n# \u65b9\u6cd5 1\uff1a\u7e2e\u77ed\u8cc7\u6599\u7bc4\u570d\nimport finlab\nfinlab.truncate_start = '2020-01-01'  # \u53ea\u4e0b\u8f09 2020 \u5e74\u5f8c\u7684\u8cc7\u6599\n\ntry:\n    close = data.get('price:\u6536\u76e4\u50f9')\nexcept Exception as e:\n    if \"timeout\" in str(e).lower() or \"timed out\" in str(e).lower():\n        print(\"\u26a0\ufe0f \u7db2\u8def\u903e\u6642\uff0c\u5617\u8a66\u91cd\u8a66...\")\n        time.sleep(5)  # \u7b49\u5f85 5 \u79d2\n        try:\n            close = data.get('price:\u6536\u76e4\u50f9')\n            print(\"\u2705 \u91cd\u8a66\u6210\u529f\")\n        except Exception as retry_error:\n            print(f\"\u274c \u91cd\u8a66\u5931\u6557\uff1a{retry_error}\")\n            print(\"\u5efa\u8b70\uff1a\")\n            print(\"1. \u6aa2\u67e5\u7db2\u8def\u9023\u7dda\")\n            print(\"2. \u4f7f\u7528 finlab.truncate_start \u7e2e\u77ed\u8cc7\u6599\u7bc4\u570d\")\n            print(\"3. \u7a0d\u5f8c\u518d\u8a66\")\n            raise\n    else:\n        raise\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528\u672c\u5730\u5feb\u53d6\uff08\u5982\u5df2\u4e0b\u8f09\u904e\uff09\n# finlab \u6703\u81ea\u52d5\u5feb\u53d6\u4e0b\u8f09\u7684\u8cc7\u6599\uff0c\u7b2c\u4e8c\u6b21\u57f7\u884c\u6642\u6703\u8b80\u53d6\u5feb\u53d6\n</code></pre>"}, {"location": "details/get_data/#4api-token", "title": "\u932f\u8aa4 4\uff1aAPI Token \u9a57\u8b49\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u7121\u6cd5\u767b\u5165\u6216\u4e0b\u8f09\u8cc7\u6599\u6642\u63d0\u793a\u6b0a\u9650\u932f\u8aa4</p> <pre><code>import finlab\nfinlab.login('INVALID_TOKEN')\n# AuthenticationError: Invalid API token\n</code></pre> <p>\u539f\u56e0\uff1a - API Token \u932f\u8aa4\u6216\u5df2\u904e\u671f - Token \u5c1a\u672a\u555f\u7528\uff08\u65b0\u8a3b\u518a\u4f46\u672a\u9a57\u8b49\uff09 - \u5e33\u6236\u6b0a\u9650\u4e0d\u8db3\uff08\u514d\u8cbb\u7528\u6236\u5b58\u53d6 VIP \u5c08\u5c6c\u8cc7\u6599\uff09</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>import finlab\nimport os\n\n# \u65b9\u6cd5 1\uff1a\u74b0\u5883\u8b8a\u6578\u65b9\u5f0f\uff08\u63a8\u85a6\uff0c\u907f\u514d\u5916\u6d41\uff09\ntoken = os.environ.get('FINLAB_API_TOKEN')\nif not token:\n    print(\"\u274c \u74b0\u5883\u8b8a\u6578\u672a\u8a2d\u5b9a FINLAB_API_TOKEN\")\n    print(\"\u8acb\u5148\u57f7\u884c\uff1a\")\n    print(\"  MacOS/Linux: export FINLAB_API_TOKEN='YOUR_TOKEN'\")\n    print(\"  Windows: set FINLAB_API_TOKEN=YOUR_TOKEN\")\n    exit(1)\n\ntry:\n    finlab.login(token)\n    print(\"\u2705 \u767b\u5165\u6210\u529f\")\n\n    # \u9a57\u8b49\u662f\u5426\u53ef\u6b63\u5e38\u4e0b\u8f09\u8cc7\u6599\n    from finlab import data\n    close = data.get('price:\u6536\u76e4\u50f9')\n    print(f\"\u2705 \u8cc7\u6599\u5b58\u53d6\u6b63\u5e38\uff0c\u6700\u65b0\u65e5\u671f\uff1a{close.index[-1]}\")\n\nexcept Exception as e:\n    print(f\"\u274c \u767b\u5165\u5931\u6557\uff1a{e}\")\n    print(\"\\n\u8acb\u6aa2\u67e5\uff1a\")\n    print(\"1. API Token \u662f\u5426\u6b63\u78ba\uff08\u81f3 https://ai.finlab.tw/member_info \u53d6\u5f97\uff09\")\n    print(\"2. \u5e33\u6236\u662f\u5426\u70ba\u6709\u6548\u7684 VIP \u6703\u54e1\")\n    print(\"3. Token \u662f\u5426\u5df2\u555f\u7528\uff08\u65b0\u8a3b\u518a\u9700\u5148\u9a57\u8b49 email\uff09\")\n    print(\"4. \u7db2\u8def\u9023\u7dda\u662f\u5426\u6b63\u5e38\")\n\n# \u65b9\u6cd5 2\uff1a\u6aa2\u67e5\u6703\u54e1\u7b49\u7d1a\uff08\u5224\u65b7\u662f\u5426\u6709\u6b0a\u9650\u4e0b\u8f09\u6700\u65b0\u8cc7\u6599\uff09\nclose = data.get('price:\u6536\u76e4\u50f9')\nif close.index[-1].year &lt; 2024:\n    print(\"\u26a0\ufe0f \u60a8\u76ee\u524d\u4f7f\u7528\u7684\u662f\u514d\u8cbb\u7248\uff0c\u50c5\u80fd\u5b58\u53d6\u8f03\u820a\u7684\u8cc7\u6599\")\n    print(\"\u5347\u7d1a VIP \u4ee5\u4f7f\u7528\u6700\u65b0\u8cc7\u6599\uff1ahttps://ai.finlab.tw/pricing\")\n</code></pre>"}, {"location": "details/get_data/#_5", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u5feb\u901f\u4e0a\u624b\u6307\u5357 - \u5f9e\u96f6\u958b\u59cb\u4f7f\u7528 FinLab</li> <li>\u8cc7\u6599\u5eab\u76ee\u9304 - \u67e5\u8a62\u6240\u6709\u53ef\u7528\u8cc7\u6599\u8868</li> <li>\u6703\u54e1\u5c08\u5340 - \u53d6\u5f97 API Token</li> <li>\u6b77\u53f2\u56de\u6e2c\u6559\u5b78 - \u4f7f\u7528\u4e0b\u8f09\u7684\u8cc7\u6599\u9032\u884c\u56de\u6e2c</li> <li>\u5e38\u898b\u554f\u984c FAQ - \u66f4\u591a\u7591\u96e3\u6392\u89e3</li> </ul>"}, {"location": "details/machine_learning/", "title": "\u6a5f\u5668\u5b78\u7fd2", "text": ""}, {"location": "details/machine_learning/#_1", "title": "\u76f8\u95dc\u51fd\u5f0f\u5eab\u5b89\u88dd", "text": ""}, {"location": "details/machine_learning/#_2", "title": "\u5fc5\u8981\u5b89\u88dd", "text": "<p>\u5b89\u88dd\u6838\u5fc3\u5957\u4ef6\uff08finlab\u3001TA-Lib\uff09\uff1a</p> <pre><code>pip install finlab\npip install ta-lib\n</code></pre>"}, {"location": "details/machine_learning/#_3", "title": "\u6a21\u578b\u51fd\u5f0f\u5eab\uff08\u9078\u7528\uff09", "text": "<p><code>finlab.ml.qlib</code> \u53ef\u642d\u914d\u591a\u7a2e\u6a21\u578b\uff08LightGBM\u3001XGBoost\u3001CatBoost\u3001PyTorch\u3001TensorFlow \u7b49\uff09\u3002\u9700\u8981\u6642\u4f9d\u5b98\u65b9\u6587\u4ef6\u5b89\u88dd\uff1bColab \u591a\u6578\u5df2\u9810\u88dd\u3002</p> <ol> <li>\u5b89\u88dd LightGBM</li> <li>\u5b89\u88dd XGBoost</li> <li>\u5b89\u88dd CatBoost</li> <li>\u5b89\u88dd Pytorch</li> <li>\u5b89\u88dd Tensorflow</li> </ol> <p>\u6a5f\u5668\u5b78\u7fd2\u6d41\u7a0b\u8f03\u8907\u96dc\uff0c\u63a8\u85a6\u642d\u914d AI \u52a9\u624b</p> <p>\u5f9e\u7279\u5fb5\u5de5\u7a0b\u5230\u6a21\u578b\u8a13\u7df4\uff0cML \u7b56\u7565\u6d89\u53ca\u591a\u500b\u6b65\u9a5f\u3002\u5b89\u88dd FinLab Skill \u5f8c\uff0cAI \u7de8\u7a0b\u52a9\u624b\u53ef\u5354\u52a9\u9078\u64c7\u7279\u5fb5\u3001\u5207\u5206\u8cc7\u6599\u96c6\u3001\u8a13\u7df4\u6a21\u578b\u8207\u89e3\u8b80\u56de\u6e2c\u7d50\u679c\u3002</p>"}, {"location": "details/machine_learning/#_4", "title": "\u7279\u5fb5\u8655\u7406", "text": ""}, {"location": "details/machine_learning/#combine", "title": "\u4f7f\u7528 Combine \u51fd\u6578\u5408\u4f75\u7279\u5fb5", "text": "<p><code>finlab.ml.feature.combine</code> \u53ef\u5408\u4f75\u591a\u4f86\u6e90\u7279\u5fb5\uff08\u6280\u8853\u3001\u57fa\u672c\u9762\u3001\u81ea\u5b9a\u7fa9\uff09\uff0c\u4e26\u652f\u63f4\u91cd\u63a1\u6a23\u3002\u7bc4\u4f8b\u5982\u4e0b\uff1a</p> <ol> <li>\u5408\u4f75\u80a1\u50f9\u6de8\u503c\u6bd4\u548c\u672c\u76ca\u6bd4\u70ba\u4e00\u500b\u7279\u5fb5\u96c6 \uff1a</li> </ol> <pre><code>from finlab import data\nfrom finlab.ml import feature as mlf\nfeatures = mlf.combine({\n  'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n  'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4')  \n}, resample='W')\n\nfeatures.head()\n</code></pre> pb pe (Timestamp('2010-01-04 00:00:00'), '1101') 1.47 18.85 (Timestamp('2010-01-04 00:00:00'), '1102') 1.44 14.58 (Timestamp('2010-01-04 00:00:00'), '1103') 0.79 40.89 (Timestamp('2010-01-04 00:00:00'), '1104') 0.92 73.6 <p>\u5c07 pb \u8207 pe \u5408\u4f75\u70ba\u4e00\u500b\u7279\u5fb5\u96c6\u3002</p> <ol> <li>\u5408\u4f75\u6280\u8853\u6307\u6a19\u70ba\u4e00\u500b\u7279\u5fb5\u96c6 \uff1a</li> </ol> <pre><code>from finlab.ml import feature as mlf\nmlf.combine({\n  'talib': mlf.ta(mlf.ta_names(n=1))\n})\n</code></pre> talib.HT_DCPERIOD__real__ talib.HT_DCPHASE__real__ talib.HT_PHASOR__quadrature__ (Timestamp('2024-04-01 00:00:00'), '9951') 23.4372 122.135 -0.0107087 (Timestamp('2024-04-01 00:00:00'), '9955') 18.4416 68.0654 -0.0168584 (Timestamp('2024-04-01 00:00:00'), '9958') 30.1035 -10.7866 0.159777 (Timestamp('2024-04-01 00:00:00'), '9960') 17.5025 94.0009 0.00310615 (Timestamp('2024-04-01 00:00:00'), '9962') 23.2931 90.0781 -0.0145453 <p>\u5728\u9019\u500b\u7bc4\u4f8b\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 <code>mlf.ta</code> \u51fd\u6578\u548c <code>mlf.ta_names</code> \u51fd\u6578\u4f86\u751f\u6210\u4e00\u7d44\u6280\u8853\u6307\u6a19\u7279\u5fb5\u3002\u9019\u500b\u904e\u7a0b\u9996\u5148\u901a\u904e <code>mlf.ta_names(n=1)</code> \u751f\u6210\u96a8\u6a5f\u7684\u6280\u8853\u6307\u6a19\uff0c\u7136\u5f8c <code>mlf.ta</code> \u51fd\u6578\u6839\u64da\u9019\u500b\u5217\u8868\u8a08\u7b97\u51fa\u76f8\u61c9\u7684\u6307\u6a19\u503c\u3002\u6700\u5f8c\uff0c<code>combine</code> \u51fd\u6578\u5c07\u9019\u4e9b\u6280\u8853\u6307\u6a19\u5408\u4f75\u6210\u4e00\u500b DataFrame\uff0c\u70ba\u91cf\u5316\u7b56\u7565\u7684\u958b\u767c\u63d0\u4f9b\u4e86\u4e00\u7d44\u8c50\u5bcc\u7684\u7279\u5fb5\u3002</p> <p>\u9019\u5169\u500b\u7bc4\u4f8b\u5c55\u793a\u4e86 <code>combine</code> \u51fd\u6578\u7684\u591a\u6a23\u6027\u548c\u9748\u6d3b\u6027\uff0c\u7121\u8ad6\u662f\u5c0d\u65bc\u57fa\u672c\u9762\u5206\u6790\u9084\u662f\u6280\u8853\u5206\u6790\uff0c\u5b83\u90fd\u80fd\u63d0\u4f9b\u5f37\u5927\u7684\u6578\u64da\u652f\u6301\uff0c\u5e6b\u52a9\u6295\u8cc7\u8005\u548c\u5206\u6790\u5e2b\u5728\u8907\u96dc\u7684\u91d1\u878d\u5e02\u5834\u4e2d\u505a\u51fa\u66f4\u52a0\u7cbe\u6e96\u7684\u6c7a\u7b56\u3002</p>"}, {"location": "details/machine_learning/#talib", "title": "\u4f7f\u7528 Talib \u7522\u751f\u6280\u8853\u6307\u6a19", "text": "<ul> <li>\u7576\u6211\u5011\u5728\u4f7f\u7528 <code>finlab</code> \u51fd\u5f0f\u5eab\u4f86\u958b\u767c\u91cf\u5316\u4ea4\u6613\u7b56\u7565\u6642\uff0c\u6280\u8853\u6307\u6a19\u626e\u6f14\u8457\u6975\u5176\u91cd\u8981\u7684\u89d2\u8272\u3002<code>finlab</code> \u63d0\u4f9b\u4e86\u4e00\u5957\u529f\u80fd\u5f37\u5927\u7684\u5de5\u5177\u4f86\u5e6b\u52a9\u6211\u5011\u751f\u6210\u548c\u5229\u7528\u9019\u4e9b\u6280\u8853\u6307\u6a19\u3002\u5176\u4e2d\uff0c<code>ta</code> \u548c <code>ta_names</code> \u5169\u500b\u51fd\u6578\u662f\u751f\u6210\u6280\u8853\u6307\u6a19\u7279\u5fb5\u7684\u95dc\u9375\u3002</li> </ul>"}, {"location": "details/machine_learning/#ta_names", "title": "ta_names \u51fd\u6578", "text": "<p><code>ta_names</code> \u51fd\u6578\u7684\u4f5c\u7528\u662f\u751f\u6210\u4e00\u7cfb\u5217 TALIB \u6280\u8853\u6307\u6a19\u7684\u540d\u7a31\u3002\u9019\u4e9b\u540d\u7a31\u53cd\u6620\u4e86\u6307\u6a19\u7684\u8a08\u7b97\u65b9\u6cd5\u53ca\u5176\u53c3\u6578\u3002\u9019\u500b\u51fd\u6578\u975e\u5e38\u6709\u7528\uff0c\u56e0\u70ba\u5b83\u5141\u8a31\u6211\u5011\u63a2\u7d22\u548c\u5be6\u9a57\u4e0d\u540c\u7684\u6307\u6a19\u914d\u7f6e\uff0c\u4ee5\u5c0b\u627e\u6700\u4f73\u7684\u7279\u5fb5\u7d44\u5408\u3002 </p> <ul> <li>n \u53c3\u6578 \uff1a\u5728 <code>ta_names</code> \u4e2d\uff0c<code>n</code> \u53c3\u6578\u6307\u5b9a\u4e86\u6bcf\u500b\u6307\u6a19\u96a8\u6a5f\u751f\u6210\u7684\u53c3\u6578\u8a2d\u7f6e\u6578\u91cf\u3002\u8209\u4f8b\u4f86\u8aaa\uff0c\u5982\u679c <code>n=10</code>\uff0c\u90a3\u9ebc\u5c0d\u65bc TALIB \u4e2d\u7684\u6bcf\u4e00\u500b\u6307\u6a19\uff0c<code>ta_names</code> \u5c07\u6703\u751f\u6210 10 \u7a2e\u4e0d\u540c\u53c3\u6578\u914d\u7f6e\u7684\u6307\u6a19\u540d\u7a31\u3002\u9019\u5141\u8a31\u6211\u5011\u5f9e\u591a\u7a2e\u4e0d\u540c\u7684\u53c3\u6578\u8a2d\u7f6e\u4e2d\u9078\u64c7\uff0c\u4ee5\u4fbf\u66f4\u6df1\u5165\u5730\u63a2\u7d22\u6578\u64da\u548c\u7b56\u7565\u6027\u80fd\u4e4b\u9593\u7684\u95dc\u4fc2\u3002</li> </ul> <p><pre><code>from finlab.ml import feature as mlf\nmlf.ta_names(n=1)\n</code></pre> <pre><code>['talib.HT_DCPERIOD__real__',\n 'talib.HT_DCPHASE__real__',\n 'talib.HT_PHASOR__quadrature__',\n 'talib.HT_PHASOR__inphase__',\n 'talib.HT_SINE__sine__',\n 'talib.HT_SINE__leadsine__'\n ...\n ]\n</code></pre></p>"}, {"location": "details/machine_learning/#ta", "title": "ta \u51fd\u6578", "text": "<p>\u4e00\u65e6\u6211\u5011\u6709\u4e86\u6307\u6a19\u540d\u7a31\u5217\u8868\uff08\u53ef\u4ee5\u901a\u904e <code>ta_names</code> \u51fd\u6578\u7372\u5f97\uff09\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>ta</code> \u51fd\u6578\u4f86\u8a08\u7b97\u9019\u4e9b\u6307\u6a19\u7684\u5be6\u969b\u503c\u3002<code>ta</code> \u51fd\u6578\u662f\u4e00\u500b\u5f37\u5927\u7684\u5de5\u5177\uff0c\u5b83\u6839\u64da\u6307\u5b9a\u7684\u6280\u8853\u6307\u6a19\u540d\u7a31\u548c\u53c3\u6578\u8a2d\u7f6e\u4f86\u8a08\u7b97\u9019\u4e9b\u6307\u6a19\u7684\u503c\u3002 </p> <ul> <li> <p>\u529f\u80fd \uff1a<code>ta</code> \u51fd\u6578\u63a5\u53d7\u4e00\u500b\u6216\u591a\u500b\u7531 <code>ta_names</code> \u751f\u6210\u7684\u6307\u6a19\u540d\u7a31\uff0c\u7136\u5f8c\u8a08\u7b97\u9019\u4e9b\u6307\u6a19\u7684\u503c\u3002\u9019\u5c0d\u65bc\u7279\u5fb5\u5de5\u7a0b\u4f86\u8aaa\u975e\u5e38\u91cd\u8981\uff0c\u56e0\u70ba\u5b83\u8b93\u6211\u5011\u53ef\u4ee5\u6839\u64da\u6307\u6a19\u7684\u8a08\u7b97\u7d50\u679c\u4f86\u69cb\u5efa\u9810\u6e2c\u6a21\u578b\u3002 </p> </li> <li> <p>\u9748\u6d3b\u6027 \uff1a\u9019\u5169\u500b\u51fd\u6578\u7684\u7d50\u5408\u4f7f\u7528\u63d0\u4f9b\u4e86\u6975\u5927\u7684\u9748\u6d3b\u6027\uff0c\u5141\u8a31\u91cf\u5316\u5206\u6790\u5e2b\u548c\u4ea4\u6613\u8005\u5728\u4e0d\u540c\u7684\u6642\u9593\u7bc4\u570d\u3001\u4e0d\u540c\u7684\u5e02\u5834\u689d\u4ef6\u4e0b\u6e2c\u8a66\u548c\u512a\u5316\u4ed6\u5011\u7684\u7b56\u7565\u3002</p> </li> <li> <p>resample \u53c3\u6578 : <code>ta</code> \u51fd\u6578\u9084\u652f\u6301 <code>resample</code> \u53c3\u6578\uff0c\u9019\u500b\u53c3\u6578\u53ef\u4ee5\u5c07\u8a08\u7b97\u51fa\u4f86\u7684\u6307\u6a19\u503c\u91cd\u65b0\u53d6\u6a23\u5230\u6307\u5b9a\u7684\u6642\u9593\u7bc4\u570d\u3002\u9019\u5c0d\u65bc\u6642\u9593\u5e8f\u5217\u6578\u64da\u7684\u8655\u7406\u975e\u5e38\u6709\u7528\uff0c\u53ef\u4ee5\u5e6b\u52a9\u6211\u5011\u66f4\u597d\u5730\u7406\u89e3\u548c\u5206\u6790\u6578\u64da\u3002</p> </li> </ul> <pre><code>from finlab.ml import feature as mlf\nmlf.ta(['talib.HT_DCPERIOD__real__',\n 'talib.HT_DCPHASE__real__',\n 'talib.HT_PHASOR__quadrature__'], resample='W')\n</code></pre> talib.HT_DCPERIOD__real__ talib.HT_DCPHASE__real__ (Timestamp('2024-04-07 00:00:00'), '9951') 23.4372 122.135 (Timestamp('2024-04-07 00:00:00'), '9955') 18.4416 68.0654 (Timestamp('2024-04-07 00:00:00'), '9958') 30.1035 -10.7866 (Timestamp('2024-04-07 00:00:00'), '9960') 17.5025 94.0009 (Timestamp('2024-04-07 00:00:00'), '9962') 23.2931 90.0781 <p>\u7e3d\u7d50\u4f86\u8aaa\uff0c<code>ta_names</code> \u548c <code>ta</code> \u51fd\u6578\u662f <code>finlab</code> \u51fd\u5f0f\u5eab\u4e2d\u7528\u65bc\u751f\u6210\u548c\u8a08\u7b97\u6280\u8853\u6307\u6a19\u7279\u5fb5\u7684\u5169\u500b\u6838\u5fc3\u5de5\u5177\u3002\u901a\u904e\u5be6\u9a57\u4e0d\u540c\u7684\u53c3\u6578\u8a2d\u7f6e\uff08\u4f7f\u7528 <code>ta_names</code> \u4e2d\u7684 <code>n</code> \u53c3\u6578\uff09\u548c\u8a08\u7b97\u9019\u4e9b\u8a2d\u7f6e\u4e0b\u7684\u6307\u6a19\u503c\uff08\u4f7f\u7528 <code>ta</code> \u51fd\u6578\uff09\uff0c\u91cf\u5316\u7b56\u7565\u958b\u767c\u8005\u53ef\u4ee5\u6df1\u5165\u6316\u6398\u6578\u64da\uff0c\u627e\u5230\u6700\u4f73\u7684\u6307\u6a19\u7d44\u5408\u4f86\u6307\u5c0e\u4ed6\u5011\u7684\u4ea4\u6613\u6c7a\u7b56\u3002\u9019\u7a2e\u65b9\u6cd5\u70ba\u91cf\u5316\u6295\u8cc7\u63d0\u4f9b\u4e86\u4e00\u500b\u5805\u5be6\u7684\u57fa\u790e\uff0c\u5e6b\u52a9\u6295\u8cc7\u8005\u5728\u8907\u96dc\u591a\u8b8a\u7684\u91d1\u878d\u5e02\u5834\u4e2d\u4fdd\u6301\u7af6\u722d\u529b\u3002</p>"}, {"location": "details/machine_learning/#_5", "title": "\u6a19\u7c64\u751f\u6210", "text": ""}, {"location": "details/machine_learning/#label", "title": "\u4f7f\u7528 Label \u51fd\u6578\u751f\u6210\u6a19\u7c64", "text": "<p><code>finlab.ml.label</code> \u63d0\u4f9b\u591a\u7a2e\u5831\u916c/\u98a8\u96aa\u6a19\u7c64\u8a08\u7b97\uff0c\u4fbf\u65bc\u8a13\u7df4\u9810\u6e2c\u6a21\u578b\u3002</p>"}, {"location": "details/machine_learning/#daytrading_percentage", "title": "\u9810\u6e2c daytrading_percentage", "text": "<p>\u6b64\u51fd\u6578\u8a08\u7b97\u7d66\u5b9a\u5468\u671f\u5167\u5e02\u5834\u50f9\u683c\u7684\u767e\u5206\u6bd4\u8b8a\u5316\uff0c\u7279\u5225\u662f\u5f9e\u958b\u76e4\u50f9\u5230\u6536\u76e4\u50f9\u7684\u8b8a\u5316\u3002</p> <ul> <li><code>resample</code>\uff1a\u9700\u8207 <code>combine</code> \u7684 <code>resample</code> \u4e00\u81f4\uff0c\u4ee5\u5c0d\u9f4a\u6642\u9593\u3002</li> <li><code>period</code>\uff1a\u8a08\u7b97\u672a\u4f86 N \u671f\uff08\u7531 <code>resample</code> \u5b9a\u7fa9\uff09\u7684\u8b8a\u5316\u3002</li> </ul> <pre><code>from finlab.ml import feature as mlf\nfrom finlab.ml import label as mll\nfeature = mlf.combine(...)\nlabel = mll.daytrading_percentage(feature.index)\n</code></pre> <pre><code>datetime    instrument\n2007-04-23  0015          0.000000\n            0050          0.003454\n            0051          0.004874\n            0052          0.006510\n            01001T        0.001509\ndtype: float64\n</code></pre>"}, {"location": "details/machine_learning/#n", "title": "\u9810\u6e2cN\u5929\u5f8c\u7684\u5831\u916c\u7387", "text": "<p>\u8a08\u7b97\u5728\u7d66\u5b9a\u5468\u671f\u5167\u7684\u767e\u5206\u6bd4\u8b8a\u5316\uff0c\u7528\u65bc\u5206\u6790\u4e2d\u9577\u671f\u8868\u73fe\u3002</p> <pre><code>label = mll.return_percentage(feature.index, resample='W', period=1)\n</code></pre>"}, {"location": "details/machine_learning/#maximum-adverse-excursion", "title": "Maximum Adverse Excursion", "text": "<p>MAE\uff1a\u6301\u6709\u671f\u5167\u7684\u6700\u5927\u4e0d\u5229\u8b8a\u52d5\uff08\u76ee\u524d\u4e0d\u652f\u63f4 <code>resample</code>\uff09\u3002</p> <pre><code>label = mll.maximum_adverse_excursion(feature.index, period=1)\n</code></pre>"}, {"location": "details/machine_learning/#maximum-favorable-excursion", "title": "Maximum Favorable Excursion", "text": "<p>MFE\uff1a\u6301\u6709\u671f\u5167\u7684\u6700\u5927\u6709\u5229\u8b8a\u52d5\uff08\u76ee\u524d\u4e0d\u652f\u63f4 <code>resample</code>\uff09\u3002</p> <pre><code>label = mll.maximum_favorable_excursion(feature.index, period=1)\n</code></pre>"}, {"location": "details/machine_learning/#excess-over-median", "title": "Excess Over Median", "text": "<p>\u76f8\u5c0d\u540c\u671f\u5168\u5e02\u5834\u6536\u76ca\u300c\u4e2d\u4f4d\u6578\u300d\u7684\u8d85\u984d\u6536\u76ca\u3002</p> <pre><code>label = mll.excess_over_median(feature.index, resample='M', period=1)\n</code></pre>"}, {"location": "details/machine_learning/#excess-over-mean", "title": "Excess Over Mean", "text": "<p>\u76f8\u5c0d\u540c\u671f\u5168\u5e02\u5834\u6536\u76ca\u300c\u5747\u503c\u300d\u7684\u8d85\u984d\u6536\u76ca\u3002</p> <pre><code>label = mll.excess_over_mean(feature.index, resample='M', period=1)\n</code></pre> <p>\u8acb\u78ba\u4fdd <code>index</code> \u8207\u5e02\u5834\u8a2d\u5b9a\u6b63\u78ba\uff1b\u6a19\u7c64\u53ef\u76f4\u63a5\u642d\u914d\u7279\u5fb5\u7528\u65bc\u6a21\u578b\u8a13\u7df4\u3002</p>"}, {"location": "details/machine_learning/#qlib", "title": "\u4f7f\u7528 Qlib \u5957\u4ef6\u6a21\u578b\u8a13\u7df4", "text": "<ul> <li>\u9019\u6bb5\u7a0b\u5f0f\u78bc\u793a\u7bc4\u4e86\u5982\u4f55\u5728 Qlib \u6846\u67b6\u4e2d\u4f7f\u7528\u5404\u7a2e\u6a5f\u5668\u5b78\u7fd2\u6a21\u578b\u9032\u884c\u91cf\u5316\u6295\u8cc7\u7b56\u7565\u7684\u958b\u767c\u3002<code>WrapperModel</code> \u662f\u4e00\u500b\u5c01\u88dd\u985e\u5225\uff0c\u7528\u65bc\u521d\u59cb\u5316\u548c\u9069\u914d\u4e0d\u540c\u7684\u6a5f\u5668\u5b78\u7fd2\u6a21\u578b\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u65bc LightGBM\u3001XGBoost\u3001CatBoost\u3001\u7dda\u6027\u6a21\u578b\u3001Tabnet \u548c\u6df1\u5ea6\u795e\u7d93\u7db2\u7d61\u7b49\u3002\u9019\u500b\u5c01\u88dd\u4f7f\u5f97\u5728 Qlib \u4e2d\u4f7f\u7528\u9019\u4e9b\u6a21\u578b\u8b8a\u5f97\u66f4\u52a0\u7c21\u55ae\u548c\u7d71\u4e00\u3002</li> </ul> <p>\u4ee5\u4e0b\u662f\u6bcf\u500b\u6a21\u578b\u5c01\u88dd\u985e\u5225\u7684\u7c21\u55ae\u4ecb\u7d39\u548c\u7bc4\u4f8b\u7528\u6cd5\uff1a</p>"}, {"location": "details/machine_learning/#lgbmodel", "title": "LGBModel", "text": "<p>\u5c01\u88dd LightGBM \u6a21\u578b\u3002</p> <pre><code>import finlab.ml.qlib as q\n\n# \u69cb\u5efa X_train, y_train, X_test\n\nmodel = q.LGBModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre> <p>\u5982\u4f55\u5efa\u69cb X_train, y_train, X_test?</p> <p>\u4ee5 2020 \u5e74\u524d\u70ba\u8a13\u7df4\u96c6\u7684\u7bc4\u4f8b\uff1a</p> <pre><code>is_train = features.index.get_level_values('datetime') &lt; '2020-01-01'\nX_train = features[is_train]\ny_train = labels[is_train]\nX_test = features[~is_train]\n</code></pre>"}, {"location": "details/machine_learning/#xgbmodel", "title": "XGBModel", "text": "<p>\u5c01\u88dd XGBoost \u6a21\u578b\u3002</p> <pre><code>model = q.XGBModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre>"}, {"location": "details/machine_learning/#densmblemodel", "title": "DEnsmbleModel", "text": "<p>\u5c01\u88dd\u96d9\u91cd\u96c6\u6210\u6a21\u578b\u3002</p> <pre><code>model = q.DEnsmbleModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre>"}, {"location": "details/machine_learning/#catboostmodel", "title": "CatBoostModel", "text": "<p>\u5c01\u88dd CatBoost \u6a21\u578b\u3002</p> <pre><code>model = q.CatBoostModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre>"}, {"location": "details/machine_learning/#linearmodel", "title": "LinearModel", "text": "<p>\u5c01\u88dd\u7dda\u6027\u6a21\u578b\u3002</p> <pre><code>model = q.LinearModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre>"}, {"location": "details/machine_learning/#tabnetmodel", "title": "TabnetModel", "text": "<p>\u5c01\u88dd TabNet \u6a21\u578b\u3002</p> <pre><code>model = q.TabnetModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre>"}, {"location": "details/machine_learning/#dnnmodel", "title": "DNNModel", "text": "<p>\u5c01\u88dd\u6df1\u5ea6\u795e\u7d93\u7db2\u7d61\u6a21\u578b\u3002</p> <pre><code>model = q.DNNModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre> <p>\u5c01\u88dd\u8b93\u4f60\u5c08\u6ce8\u5728\u7279\u5fb5\u8207\u7b56\u7565\uff0c\u4e0d\u5fc5\u9677\u5165\u6a21\u578b\u7d30\u7bc0\u3002</p>"}, {"location": "details/machine_learning/#get_models", "title": "get_models", "text": "<p><code>get_models</code> \u53ef\u5feb\u901f\u53d6\u5f97\u53ef\u7528\u6a21\u578b\u6e05\u55ae\u4e26\u521d\u59cb\u5316\uff0c\u65b9\u4fbf\u9032\u884c\u591a\u6a21\u578b\u8a66\u9a57\u3002</p> <pre><code>import finlab.ml.qlib as q\n\n# \u7372\u53d6\u6240\u6709\u53ef\u7528\u7684\u6a21\u578b\nmodels = q.get_models()\n\n# \u5217\u5370\u51fa\u6240\u6709\u6a21\u578b\u7684\u540d\u7a31\nprint(list(models.keys()))\n\n# \u9078\u64c7\u4e00\u500b\u6a21\u578b\u9032\u884c\u5be6\u4f8b\u5316\uff0c\u4f8b\u5982 LightGBM\nmodel = models['LGBModel']()\n\n# \u5047\u8a2d\u5df2\u7d93\u6e96\u5099\u597d\u4e86\u8a13\u7df4\u6578\u64da\u548c\u6e2c\u8a66\u6578\u64da X_train, y_train, X_test\n\n# model\nmodel.fit(X_train, y_train)\n\n# \u4f7f\u7528\u8a13\u7df4\u597d\u7684\u6a21\u578b\u9032\u884c\u9810\u6e2c\ny_pred = model.predict(X_test)\n</code></pre> <p>\u4ee5\u4e0a\u5c55\u793a\u5982\u4f55\u5217\u51fa\u6a21\u578b\u3001\u5efa\u7acb <code>LGBModel</code> \u4e26\u8a13\u7df4/\u9810\u6e2c\u3002</p>"}, {"location": "details/machine_learning/#_6", "title": "\u9032\u884c\u56de\u6e2c", "text": "<p>\u4f7f\u7528 <code>sim</code> \u9032\u884c\u56de\u6e2c\uff0c\u8a08\u7b97\u7b56\u7565\u6536\u76ca\u8207\u98a8\u96aa\u6307\u6a19\uff1a</p> <pre><code>from finlab.backtest import sim\n\nposition = y_pred.is_largest(50)\n\nsim(position, resample='4W')\n</code></pre> <p>\u4ee5\u4e0a\u7528\u6a21\u578b\u6392\u540d\u7522\u751f <code>position</code>\uff0c\u4ee5 <code>resample</code> \u6307\u5b9a\u56de\u6e2c\u983b\u7387\u4e26\u57f7\u884c\u56de\u6e2c\u3002</p>"}, {"location": "details/market_customization/", "title": "\u81ea\u8a02\u5e02\u5834\u7269\u4ef6", "text": "<p>FinLab \u9810\u8a2d\u652f\u63f4\u53f0\u80a1(TWMarket)\u3001\u7f8e\u80a1(USMarket)\u3001\u8208\u6ac3(ROTCMarket)\u7b49\u5e02\u5834\u3002\u82e5\u4f60\u60f3\u56de\u6e2c\u52a0\u5bc6\u8ca8\u5e63\u3001\u671f\u8ca8\u3001\u6d77\u5916\u80a1\u7968,\u6216\u4f7f\u7528\u81ea\u8a02\u7684\u50f9\u683c\u8cc7\u6599,\u53ef\u4ee5\u900f\u904e\u7e7c\u627f <code>Market</code> \u985e\u5225\u4f86\u5be6\u73fe\u3002</p>"}, {"location": "details/market_customization/#_2", "title": "\u70ba\u4ec0\u9ebc\u9700\u8981\u81ea\u8a02\u5e02\u5834?", "text": "<p>\u4e0d\u540c\u5e02\u5834\u6709\u4e0d\u540c\u7684\u7279\u6027:</p> <ul> <li>\u4ea4\u6613\u6642\u9593\u4e0d\u540c: \u7f8e\u80a1\u8207\u53f0\u80a1\u7684\u958b\u6536\u76e4\u6642\u9593\u4e0d\u540c</li> <li>\u50f9\u683c\u6b04\u4f4d\u4e0d\u540c: \u52a0\u5bc6\u8ca8\u5e63\u53ef\u80fd\u6c92\u6709\u300c\u958b\u76e4\u50f9\u300d\u7684\u6982\u5ff5</li> <li>\u8cc7\u6599\u4f86\u6e90\u4e0d\u540c: \u5f9e CSV\u3001API\u3001\u8cc7\u6599\u5eab\u8f09\u5165\u50f9\u683c</li> <li>\u4ea4\u6613\u898f\u5247\u4e0d\u540c: \u671f\u8ca8\u6709\u69d3\u687f\u3001\u52a0\u5bc6\u8ca8\u5e63\u6c92\u6709\u6f32\u8dcc\u5e45\u9650\u5236</li> <li>\u5c0d\u7167\u6307\u6578\u4e0d\u540c: \u53f0\u80a1\u5c0d\u7167\u52a0\u6b0a\u6307\u6578\u3001\u7f8e\u80a1\u5c0d\u7167 S&amp;P 500</li> </ul> <p>\u900f\u904e\u81ea\u8a02 Market \u7269\u4ef6,\u4f60\u53ef\u4ee5\u5c07\u4efb\u4f55\u5e02\u5834\u7684\u8cc7\u6599\u5957\u7528\u5230 FinLab \u7684\u56de\u6e2c\u5f15\u64ce\u3002</p>"}, {"location": "details/market_customization/#_3", "title": "\u5feb\u901f\u4e0a\u624b:\u4f7f\u7528\u5167\u5efa\u5e02\u5834", "text": "<p>FinLab \u63d0\u4f9b 3 \u500b\u5167\u5efa\u5e02\u5834:</p> <pre><code>from finlab import data, backtest\nfrom finlab.markets.tw import TWMarket\nfrom finlab.markets.us import USMarket\nfrom finlab.markets.rotc import ROTCMarket\n\n# \u53f0\u80a1\u5e02\u5834(\u9810\u8a2d)\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\nreport = backtest.sim(position, resample='M')\n# \u7b49\u540c\u65bc\nreport = backtest.sim(position, resample='M', market=TWMarket())\n\n# \u7f8e\u80a1\u5e02\u5834\nus_close = data.get('etl:us_adj_close')\nus_position = us_close &gt; us_close.average(50)\nreport = backtest.sim(us_position, resample='W', market=USMarket())\n\n# \u8208\u6ac3\u5e02\u5834\nrotc_close = data.get('rotc_price:\u6536\u76e4\u50f9')\nrotc_position = rotc_close &gt; 10\nreport = backtest.sim(rotc_position, resample='M', market=ROTCMarket())\n</code></pre>"}, {"location": "details/market_customization/#_4", "title": "\u5167\u5efa\u5e02\u5834\u7279\u6027\u5c0d\u6bd4", "text": "\u7279\u6027 TWMarket USMarket ROTCMarket \u5e02\u5834\u540d\u7a31 <code>'tw_stock'</code> <code>'us_stock'</code> <code>'rotc_stock'</code> \u8cc7\u6599\u983b\u7387 \u6bcf\u65e5(<code>'1d'</code>) \u6bcf\u65e5(<code>'1d'</code>) \u6bcf\u65e5(<code>'1d'</code>) \u5c0d\u7167\u6307\u6578 \u52a0\u6b0a\u6307\u6578 S&amp;P 500 (\u7121) \u6642\u5340 Asia/Taipei US/Eastern Asia/Taipei \u6536\u76e4\u6642\u9593 15:00 16:00 14:00 \u6f32\u8dcc\u5e45\u9650\u5236 10% \u7121 \u7121 \u7279\u6b8a\u80a1\u7968\u985e\u5225 \u8655\u7f6e\u80a1/\u5168\u984d\u4ea4\u5272 \u7121 \u7121"}, {"location": "details/market_customization/#_5", "title": "\u81ea\u8a02\u5e02\u5834\u985e\u5225", "text": ""}, {"location": "details/market_customization/#_6", "title": "\u57fa\u790e\u7bc4\u4f8b:\u52a0\u5bc6\u8ca8\u5e63\u5e02\u5834", "text": "<p>\u5047\u8a2d\u4f60\u6709\u6bd4\u7279\u5e63(BTC)\u548c\u4ee5\u592a\u5e63(ETH)\u7684\u6bcf\u65e5\u6536\u76e4\u50f9 CSV \u6a94\u6848:</p> <pre><code>from finlab.market import Market\nimport pandas as pd\n\nclass CryptoMarket(Market):\n\n    @staticmethod\n    def get_name():\n        \"\"\"\u56de\u50b3\u5e02\u5834\u540d\u7a31\"\"\"\n        return 'crypto'\n\n    @staticmethod\n    def get_freq():\n        \"\"\"\u56de\u50b3\u8cc7\u6599\u983b\u7387\"\"\"\n        return '1d'  # \u6bcf\u65e5\n\n    def get_price(self, trade_at_price='close', adj=True):\n        \"\"\"\u53d6\u5f97\u50f9\u683c\u8cc7\u6599\n\n        Args:\n            trade_at_price: 'open', 'close', 'high', 'low' \u4e4b\u4e00\n            adj: \u662f\u5426\u4f7f\u7528\u8abf\u6574\u5f8c\u50f9\u683c(\u52a0\u5bc6\u8ca8\u5e63\u901a\u5e38\u4e0d\u9700\u8981)\n\n        Returns:\n            pd.DataFrame: index \u70ba\u65e5\u671f,columns \u70ba\u5e63\u7a2e\u4ee3\u865f\n        \"\"\"\n        # \u5f9e CSV \u8f09\u5165\u50f9\u683c\n        df = pd.read_csv(f'crypto_{trade_at_price}.csv', index_col=0, parse_dates=True)\n        return df\n\n    @staticmethod\n    def get_benchmark():\n        \"\"\"\u5c0d\u7167\u6307\u6578(\u4f8b\u5982\u7528 BTC \u7576\u4f5c\u5c0d\u7167)\"\"\"\n        df = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\n        return df['BTC']\n\n# \u4f7f\u7528\u81ea\u8a02\u5e02\u5834\nfrom finlab.backtest import sim\n\n# \u5047\u8a2d CSV \u683c\u5f0f:\n# date,BTC,ETH,BNB\n# 2020-01-01,7200,130,15\n# 2020-01-02,7350,135,16\n\nclose = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\nposition = close &gt; close.rolling(20).mean()\n\nreport = sim(position, market=CryptoMarket(), resample='W')\nreport.display()\n</code></pre>"}, {"location": "details/market_customization/#_7", "title": "\u9032\u968e\u7bc4\u4f8b:\u671f\u8ca8\u5e02\u5834(\u542b\u69d3\u687f)", "text": "<p>\u671f\u8ca8\u6709\u69d3\u687f\u6548\u679c,\u53ef\u900f\u904e\u4fee\u6539\u50f9\u683c\u4f86\u6a21\u64ec:</p> <pre><code>class FuturesMarket(Market):\n\n    def __init__(self, leverage=10):\n        \"\"\"\n        Args:\n            leverage: \u69d3\u687f\u500d\u6578\n        \"\"\"\n        self.leverage = leverage\n        self.prices = pd.read_csv('futures_price.csv', index_col=0, parse_dates=True)\n\n    @staticmethod\n    def get_name():\n        return 'futures'\n\n    @staticmethod\n    def get_freq():\n        return '1d'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        \"\"\"\u56de\u50b3\u69d3\u687f\u5f8c\u7684\u5831\u916c\u7387\"\"\"\n        price = self.prices[trade_at_price]\n\n        # \u8a08\u7b97\u65e5\u5831\u916c\u7387,\u4e58\u4e0a\u69d3\u687f\u500d\u6578\n        daily_return = price.pct_change() * self.leverage\n\n        # \u9084\u539f\u6210\u50f9\u683c(\u5f9e 100 \u958b\u59cb\u7d2f\u7a4d)\n        leveraged_price = (1 + daily_return).fillna(1).cumprod() * 100\n\n        return leveraged_price\n\n    @staticmethod\n    def get_benchmark():\n        # \u4f7f\u7528 1 \u500d\u69d3\u687f\u7576\u5c0d\u7167\n        df = pd.read_csv('futures_price.csv', index_col=0, parse_dates=True)\n        return df['close'].iloc[:, 0]\n\n# \u4f7f\u7528 10 \u500d\u69d3\u687f\u56de\u6e2c\nreport = sim(position, market=FuturesMarket(leverage=10))\n</code></pre>"}, {"location": "details/market_customization/#market-api", "title": "Market \u985e\u5225\u5b8c\u6574 API", "text": "<p>\u7e7c\u627f <code>Market</code> \u985e\u5225\u6642,\u53ef\u8986\u5beb\u4ee5\u4e0b\u65b9\u6cd5:</p>"}, {"location": "details/market_customization/#_8", "title": "\u5fc5\u9808\u5be6\u4f5c\u7684\u65b9\u6cd5", "text": ""}, {"location": "details/market_customization/#get_pricetrade_at_price-adjtrue", "title": "<code>get_price(trade_at_price, adj=True)</code>", "text": "<p>\u6700\u91cd\u8981\u7684\u65b9\u6cd5,\u56de\u50b3\u50f9\u683c\u8cc7\u6599\u3002</p> <pre><code>def get_price(self, trade_at_price='close', adj=True) -&gt; pd.DataFrame:\n    \"\"\"\n    Args:\n        trade_at_price (str): 'open', 'close', 'high', 'low', 'volume' \u4e4b\u4e00\n        adj (bool): \u662f\u5426\u56de\u50b3\u8abf\u6574\u5f8c\u50f9\u683c(\u8003\u616e\u80a1\u7968\u5206\u5272\u3001\u914d\u606f\u7b49)\n\n    Returns:\n        pd.DataFrame:\n            - index: \u65e5\u671f(DatetimeIndex)\n            - columns: \u80a1\u7968\u4ee3\u865f\n            - values: \u50f9\u683c\n\n    Examples:\n        \u56de\u50b3\u683c\u5f0f\u7bc4\u4f8b:\n\n        | date       |   BTC  |   ETH  |   BNB  |\n        |:-----------|-------:|-------:|-------:|\n        | 2020-01-01 |  7200  |   130  |   15   |\n        | 2020-01-02 |  7350  |   135  |   16   |\n        | 2020-01-03 |  7100  |   128  |   14.5 |\n    \"\"\"\n    # \u5fc5\u9808\u5be6\u4f5c\n    raise NotImplementedError()\n</code></pre>"}, {"location": "details/market_customization/#_9", "title": "\u9078\u7528\u7684\u975c\u614b\u65b9\u6cd5", "text": ""}, {"location": "details/market_customization/#get_name", "title": "<code>get_name()</code>", "text": "<p>\u56de\u50b3\u5e02\u5834\u540d\u7a31,\u7528\u65bc\u8b58\u5225\u5e02\u5834\u985e\u578b\u3002</p> <pre><code>@staticmethod\ndef get_name() -&gt; str:\n    return 'crypto'  # \u9810\u8a2d\u70ba 'auto'\n</code></pre>"}, {"location": "details/market_customization/#get_freq", "title": "<code>get_freq()</code>", "text": "<p>\u56de\u50b3\u8cc7\u6599\u983b\u7387,\u5f71\u97ff\u5831\u916c\u7387\u8a08\u7b97\u3002</p> <pre><code>@staticmethod\ndef get_freq() -&gt; str:\n    return '1d'   # \u6bcf\u65e5\n    # \u5176\u4ed6\u5e38\u898b: '1h'(\u6bcf\u5c0f\u6642), '4h', '1w'(\u6bcf\u9031)\n</code></pre>"}, {"location": "details/market_customization/#get_benchmark", "title": "<code>get_benchmark()</code>", "text": "<p>\u56de\u50b3\u5c0d\u7167\u6307\u6578,\u7528\u65bc\u7e3e\u6548\u6bd4\u8f03\u3002</p> <pre><code>@staticmethod\ndef get_benchmark() -&gt; pd.Series:\n    \"\"\"\n    Returns:\n        pd.Series: \u5c0d\u7167\u6307\u6578\u7684\u50f9\u683c\u5e8f\u5217\n            - index: \u65e5\u671f\n            - values: \u6307\u6578\u50f9\u683c\n    \"\"\"\n    return pd.Series([])  # \u9810\u8a2d\u70ba\u7a7a(\u4e0d\u986f\u793a\u5c0d\u7167)\n</code></pre>"}, {"location": "details/market_customization/#get_asset_id_to_name", "title": "<code>get_asset_id_to_name()</code>", "text": "<p>\u56de\u50b3\u80a1\u865f\u8207\u80a1\u540d\u7684\u5c0d\u7167\u8868,\u7528\u65bc\u5831\u544a\u986f\u793a\u3002</p> <pre><code>@staticmethod\ndef get_asset_id_to_name() -&gt; dict:\n    \"\"\"\n    Returns:\n        dict: \u80a1\u865f -&gt; \u80a1\u540d\u7684\u5c0d\u7167\u8868\n\n    Examples:\n        {'BTC': 'Bitcoin', 'ETH': 'Ethereum'}\n    \"\"\"\n    return {}\n</code></pre>"}, {"location": "details/market_customization/#get_market_value", "title": "<code>get_market_value()</code>", "text": "<p>\u56de\u50b3\u5e02\u503c\u8cc7\u6599,\u7528\u65bc\u5e02\u503c\u52a0\u6b0a\u56de\u6e2c\u3002</p> <pre><code>@staticmethod\ndef get_market_value() -&gt; pd.DataFrame:\n    \"\"\"\n    Returns:\n        pd.DataFrame: \u5e02\u503c\u8cc7\u6599\n            - index: \u65e5\u671f\n            - columns: \u80a1\u7968\u4ee3\u865f\n            - values: \u5e02\u503c\n    \"\"\"\n    return pd.DataFrame()\n</code></pre>"}, {"location": "details/market_customization/#get_industry", "title": "<code>get_industry()</code>", "text": "<p>\u56de\u50b3\u7522\u696d\u5206\u985e,\u7528\u65bc\u7522\u696d\u5206\u6790\u3002</p> <pre><code>@staticmethod\ndef get_industry() -&gt; dict:\n    \"\"\"\n    Returns:\n        dict: \u80a1\u865f -&gt; \u7522\u696d\u7684\u5c0d\u7167\u8868\n\n    Examples:\n        {'BTC': 'Cryptocurrency', 'ETH': 'Cryptocurrency'}\n    \"\"\"\n    return {}\n</code></pre>"}, {"location": "details/market_customization/#market_close_at_timestamptimestamp", "title": "<code>market_close_at_timestamp(timestamp)</code>", "text": "<p>\u56de\u50b3\u7279\u5b9a\u6642\u9593\u7684\u5e02\u5834\u6536\u76e4\u6642\u9593,\u7528\u65bc\u5be6\u76e4\u4ea4\u6613\u3002</p> <pre><code>def market_close_at_timestamp(self, timestamp=None) -&gt; pd.Timestamp:\n    \"\"\"\n    Args:\n        timestamp: \u67e5\u8a62\u7684\u6642\u9593\u9ede(\u9810\u8a2d\u70ba\u6700\u65b0)\n\n    Returns:\n        pd.Timestamp: \u6700\u8fd1\u7684\u5e02\u5834\u6536\u76e4\u6642\u9593\n    \"\"\"\n    # \u52a0\u5bc6\u8ca8\u5e63 24 \u5c0f\u6642\u4ea4\u6613,\u53ef\u7528\u7576\u5929 23:59 \u7576\u6536\u76e4\n    if timestamp is None:\n        timestamp = pd.Timestamp.now()\n    return pd.Timestamp(timestamp.date()) + pd.Timedelta('23:59:00')\n</code></pre>"}, {"location": "details/market_customization/#_10", "title": "\u4f7f\u7528\u81ea\u8a02\u8cc7\u6599\u6e90", "text": ""}, {"location": "details/market_customization/#1-csv", "title": "1. \u5f9e CSV \u8f09\u5165", "text": "<p>\u6700\u7c21\u55ae\u7684\u65b9\u5f0f,\u9069\u5408\u4e00\u6b21\u6027\u8cc7\u6599:</p> <pre><code>class CSVMarket(Market):\n\n    def __init__(self, csv_path):\n        self.csv_path = csv_path\n\n    @staticmethod\n    def get_name():\n        return 'csv_market'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        df = pd.read_csv(self.csv_path, index_col=0, parse_dates=True)\n        return df\n\n# \u4f7f\u7528\nreport = sim(position, market=CSVMarket('my_prices.csv'))\n</code></pre>"}, {"location": "details/market_customization/#2-api", "title": "2. \u5f9e API \u52d5\u614b\u8f09\u5165", "text": "<p>\u9069\u5408\u9700\u8981\u5373\u6642\u66f4\u65b0\u7684\u8cc7\u6599:</p> <pre><code>import requests\n\nclass APIMarket(Market):\n\n    def __init__(self, api_url):\n        self.api_url = api_url\n\n    @staticmethod\n    def get_name():\n        return 'api_market'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u5f9e API \u53d6\u5f97 JSON \u8cc7\u6599\n        response = requests.get(f'{self.api_url}/{trade_at_price}')\n        data = response.json()\n\n        # \u8f49\u63db\u6210 DataFrame\n        df = pd.DataFrame(data)\n        df['date'] = pd.to_datetime(df['date'])\n        df = df.set_index('date')\n\n        return df\n\n# \u4f7f\u7528\nreport = sim(position, market=APIMarket('https://api.example.com/prices'))\n</code></pre>"}, {"location": "details/market_customization/#3-finlab", "title": "3. \u5f9e FinLab \u8cc7\u6599\u5eab\u6df7\u5408\u8f09\u5165", "text": "<p>\u7d50\u5408 FinLab \u8cc7\u6599\u8207\u81ea\u8a02\u8cc7\u6599:</p> <pre><code>from finlab import data\n\nclass HybridMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'hybrid'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u5f9e FinLab \u53d6\u5f97\u53f0\u80a1\u50f9\u683c\n        tw_close = data.get('price:\u6536\u76e4\u50f9')\n\n        # \u8f09\u5165\u81ea\u8a02\u7684\u52a0\u5bc6\u8ca8\u5e63\u50f9\u683c\n        crypto_close = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\n\n        # \u5408\u4f75\u5169\u500b DataFrame(\u5916\u9023\u63a5)\n        combined = pd.concat([tw_close, crypto_close], axis=1)\n\n        return combined\n\n# \u4f7f\u7528(\u53ef\u540c\u6642\u56de\u6e2c\u53f0\u80a1 + \u52a0\u5bc6\u8ca8\u5e63\u7d44\u5408)\nreport = sim(position, market=HybridMarket())\n</code></pre>"}, {"location": "details/market_customization/#_11", "title": "\u9032\u968e\u529f\u80fd", "text": ""}, {"location": "details/market_customization/#1", "title": "1. \u5ba2\u88fd\u5316\u4ea4\u6613\u50f9\u683c\u8a08\u7b97", "text": "<p>\u8986\u5beb <code>get_trading_price()</code> \u65b9\u6cd5\u81ea\u8a02\u6210\u4ea4\u50f9:</p> <pre><code>class CustomPriceMarket(Market):\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # ... \u56de\u50b3\u57fa\u672c\u50f9\u683c\n\n    def get_trading_price(self, name, adj=True):\n        \"\"\"\u81ea\u8a02\u6210\u4ea4\u50f9\u8a08\u7b97\"\"\"\n        if name == 'vwap':  # \u6210\u4ea4\u91cf\u52a0\u6b0a\u5747\u50f9\n            open_price = self.get_price('open', adj=adj)\n            close_price = self.get_price('close', adj=adj)\n            high_price = self.get_price('high', adj=adj)\n            low_price = self.get_price('low', adj=adj)\n            volume = self.get_price('volume', adj=False)\n\n            vwap = (open_price + close_price + high_price + low_price) / 4\n            return vwap\n        else:\n            # \u5176\u4ed6\u60c5\u6cc1\u4f7f\u7528\u9810\u8a2d\u908f\u8f2f\n            return super().get_trading_price(name, adj=adj)\n\n# \u4f7f\u7528 VWAP \u7576\u6210\u4ea4\u50f9\nreport = sim(position, market=CustomPriceMarket(), trade_at='vwap')\n</code></pre>"}, {"location": "details/market_customization/#2", "title": "2. \u652f\u63f4\u591a\u6642\u5340", "text": "<p>\u8655\u7406\u8de8\u6642\u5340\u7684\u5e02\u5834:</p> <pre><code>import datetime\n\nclass MultiTimezoneMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'multi_tz'\n\n    def market_close_at_timestamp(self, timestamp=None):\n        \"\"\"\u4e0d\u540c\u5e02\u5834\u6709\u4e0d\u540c\u6536\u76e4\u6642\u9593\"\"\"\n        if timestamp is None:\n            timestamp = pd.Timestamp.now()\n\n        # \u5047\u8a2d\u662f\u5168\u7403 24 \u5c0f\u6642\u5e02\u5834,\u7528 UTC \u6642\u9593\n        timestamp_utc = timestamp.tz_convert('UTC')\n        market_close = pd.Timestamp(timestamp_utc.date()) + pd.Timedelta('23:59:59')\n        return market_close.tz_localize('UTC')\n</code></pre>"}, {"location": "details/market_customization/#3", "title": "3. \u5be6\u4f5c\u5e02\u5834\u4f11\u5e02\u908f\u8f2f", "text": "<p>\u6392\u9664\u9031\u672b\u6216\u5047\u65e5:</p> <pre><code>class WithHolidaysMarket(Market):\n\n    def __init__(self):\n        # \u5b9a\u7fa9\u4f11\u5e02\u65e5(\u4f8b\u5982\u53f0\u7063\u570b\u5b9a\u5047\u65e5)\n        self.holidays = ['2024-01-01', '2024-02-08', '2024-02-09']\n        self.holidays = [pd.Timestamp(d) for d in self.holidays]\n\n    def get_price(self, trade_at_price='close', adj=True):\n        df = pd.read_csv('prices.csv', index_col=0, parse_dates=True)\n\n        # \u79fb\u9664\u9031\u672b\n        df = df[df.index.dayofweek &lt; 5]\n\n        # \u79fb\u9664\u5047\u65e5\n        df = df[~df.index.isin(self.holidays)]\n\n        return df\n</code></pre>"}, {"location": "details/market_customization/#_12", "title": "\u6e2c\u8a66\u81ea\u8a02\u5e02\u5834", "text": "<p>\u5efa\u7acb\u5e02\u5834\u7269\u4ef6\u5f8c,\u52d9\u5fc5\u9032\u884c\u6e2c\u8a66:</p> <pre><code># 1. \u6aa2\u67e5\u50f9\u683c\u8cc7\u6599\u683c\u5f0f\nmarket = CryptoMarket()\nclose = market.get_price('close')\nprint(close.head())\nprint(close.index)   # \u61c9\u70ba DatetimeIndex\nprint(close.shape)   # (\u65e5\u671f\u6578, \u80a1\u7968\u6578)\n\n# 2. \u6aa2\u67e5\u5c0d\u7167\u6307\u6578\nbenchmark = market.get_benchmark()\nprint(benchmark.head())\n\n# 3. \u57f7\u884c\u7c21\u55ae\u56de\u6e2c\nposition = close &gt; close.average(20)\nreport = sim(position, market=market, resample='M', upload=False)\nreport.display()\n\n# 4. \u6aa2\u67e5\u5831\u544a\u7684\u5e02\u5834\u540d\u7a31\nprint(report.market.get_name())  # \u61c9\u70ba 'crypto'\n</code></pre>"}, {"location": "details/market_customization/#_13", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "details/market_customization/#q1-adjtrue", "title": "Q1: \u70ba\u4ec0\u9ebc\u9700\u8981 <code>adj=True</code> \u53c3\u6578?", "text": "<p><code>adj=True</code> \u4ee3\u8868\u4f7f\u7528\u8abf\u6574\u5f8c\u50f9\u683c(\u8003\u616e\u80a1\u7968\u5206\u5272\u3001\u914d\u606f\u3001\u914d\u80a1\u7b49):</p> <ul> <li>\u53f0\u80a1: \u9664\u6b0a\u606f\u5f8c\u6703\u8abf\u6574\u6b77\u53f2\u50f9\u683c,\u78ba\u4fdd\u5831\u916c\u7387\u8a08\u7b97\u6b63\u78ba</li> <li>\u7f8e\u80a1: \u540c\u6a23\u9700\u8981\u8abf\u6574\u50f9\u683c</li> <li>\u52a0\u5bc6\u8ca8\u5e63: \u6c92\u6709\u9664\u6b0a\u606f,<code>adj</code> \u53c3\u6578\u53ef\u5ffd\u7565</li> </ul> <pre><code># \u53f0\u80a1\u7bc4\u4f8b\ntw_market = TWMarket()\nadj_close = tw_market.get_price('close', adj=True)    # \u9084\u539f\u80a1\u50f9\nraw_close = tw_market.get_price('close', adj=False)   # \u539f\u59cb\u6536\u76e4\u50f9\n</code></pre>"}, {"location": "details/market_customization/#q2-nan", "title": "Q2: \u5982\u4f55\u8655\u7406\u7f3a\u5931\u503c(NaN)?", "text": "<p>FinLab \u6703\u81ea\u52d5 forward fill \u7f3a\u5931\u503c,\u4f46\u5efa\u8b70\u5728 <code>get_price()</code> \u4e2d\u8655\u7406:</p> <pre><code>def get_price(self, trade_at_price='close', adj=True):\n    df = pd.read_csv('prices.csv', index_col=0, parse_dates=True)\n\n    # \u65b9\u6cd5 1: Forward fill\n    df = df.ffill()\n\n    # \u65b9\u6cd5 2: \u79fb\u9664\u6709\u7f3a\u5931\u503c\u7684\u80a1\u7968\n    df = df.dropna(axis=1, how='any')\n\n    # \u65b9\u6cd5 3: \u586b\u5145 0(\u4e0d\u63a8\u85a6)\n    df = df.fillna(0)\n\n    return df\n</code></pre>"}, {"location": "details/market_customization/#q3-get_price-finlabdataget", "title": "Q3: \u53ef\u4ee5\u5728 <code>get_price()</code> \u4e2d\u4f7f\u7528 <code>finlab.data.get()</code> \u55ce?", "text": "<p>\u53ef\u4ee5!\u9019\u662f\u6df7\u5408\u4f7f\u7528 FinLab \u8cc7\u6599\u7684\u6a19\u6e96\u505a\u6cd5:</p> <pre><code>from finlab import data\n\nclass MixedMarket(Market):\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u4f7f\u7528 FinLab \u53f0\u80a1\u8cc7\u6599\n        tw_close = data.get('price:\u6536\u76e4\u50f9')\n\n        # \u7be9\u9078\u7279\u5b9a\u80a1\u7968\n        tw_close = tw_close[['2330', '2317', '2454']]\n\n        return tw_close\n</code></pre>"}, {"location": "details/market_customization/#q4", "title": "Q4: \u5982\u4f55\u6a21\u64ec\u4ea4\u6613\u6210\u672c?", "text": "<p>\u4ea4\u6613\u6210\u672c\u5728 <code>sim()</code> \u51fd\u6578\u4e2d\u8a2d\u5b9a,\u4e0d\u5728 Market \u7269\u4ef6:</p> <pre><code># \u52a0\u5bc6\u8ca8\u5e63\u901a\u5e38\u624b\u7e8c\u8cbb\u8f03\u4f4e,\u7a05\u7387\u70ba 0\nreport = sim(\n    position,\n    market=CryptoMarket(),\n    fee_ratio=0.001,  # 0.1% \u624b\u7e8c\u8cbb\n    tax_ratio=0       # \u7121\u4ea4\u6613\u7a05\n)\n\n# \u53f0\u80a1\u9810\u8a2d fee_ratio=0.001425, tax_ratio=0.003\n</code></pre>"}, {"location": "details/market_customization/#q5-get_benchmark", "title": "Q5: \u70ba\u4ec0\u9ebc <code>get_benchmark()</code> \u662f\u975c\u614b\u65b9\u6cd5?", "text": "<p>\u56e0\u70ba\u5c0d\u7167\u6307\u6578\u901a\u5e38\u662f\u56fa\u5b9a\u7684,\u4e0d\u4f9d\u8cf4\u5be6\u4f8b\u8b8a\u6578\u3002\u4f46\u82e5\u9700\u8981\u52d5\u614b\u5c0d\u7167\u6307\u6578:</p> <pre><code>class DynamicBenchmarkMarket(Market):\n\n    def __init__(self, benchmark_ticker):\n        self.benchmark_ticker = benchmark_ticker\n\n    def get_benchmark(self):  # \u6539\u70ba\u5be6\u4f8b\u65b9\u6cd5(\u79fb\u9664 @staticmethod)\n        df = pd.read_csv('benchmarks.csv', index_col=0, parse_dates=True)\n        return df[self.benchmark_ticker]\n\n# \u4f7f\u7528\nreport = sim(position, market=DynamicBenchmarkMarket('BTC'))\n</code></pre>"}, {"location": "details/market_customization/#_14", "title": "\u5be6\u6230\u6848\u4f8b", "text": ""}, {"location": "details/market_customization/#1-etf", "title": "\u6848\u4f8b 1: \u9ec3\u91d1 ETF \u56de\u6e2c", "text": "<pre><code>class GoldMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'gold'\n\n    @staticmethod\n    def get_freq():\n        return '1d'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u5f9e Yahoo Finance \u8f09\u5165\u9ec3\u91d1 ETF (GLD) \u50f9\u683c\n        import yfinance as yf\n        gold = yf.download('GLD', start='2010-01-01')\n        return gold[[trade_at_price.capitalize()]]  # 'Close' -&gt; 'close'\n\n    @staticmethod\n    def get_benchmark():\n        import yfinance as yf\n        sp500 = yf.download('^GSPC', start='2010-01-01')\n        return sp500['Close'].squeeze()\n\n# \u4f7f\u7528\ngold_close = pd.read_csv('gold_close.csv', index_col=0, parse_dates=True)\nposition = gold_close &gt; gold_close.average(50)\nreport = sim(position, market=GoldMarket(), resample='W')\n</code></pre>"}, {"location": "details/market_customization/#2_1", "title": "\u6848\u4f8b 2: \u53f0\u80a1 + \u7f8e\u80a1\u6df7\u5408\u56de\u6e2c", "text": "<pre><code>class GlobalMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'global'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u53f0\u80a1\n        tw_close = data.get('price:\u6536\u76e4\u50f9')[['2330', '2317']]\n\n        # \u7f8e\u80a1\n        us_close = data.get('etl:us_adj_close')[['AAPL', 'TSLA']]\n\n        # \u5408\u4f75(\u5916\u9023\u63a5,\u81ea\u52d5\u5c0d\u9f4a\u65e5\u671f)\n        combined = pd.concat([tw_close, us_close], axis=1)\n\n        return combined\n\n    @staticmethod\n    def get_benchmark():\n        # \u4f7f\u7528 MSCI \u4e16\u754c\u6307\u6578\u6216 60/40 \u53f0\u7f8e\u80a1\u7d44\u5408\n        tw_benchmark = data.get('benchmark_return:\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578').squeeze()\n        us_benchmark = data.get('world_index:adj_close')['^GSPC']\n\n        combined = pd.concat([tw_benchmark * 0.6, us_benchmark * 0.4], axis=1).sum(axis=1)\n        return combined\n\n# \u4f7f\u7528\nposition = ...  # \u5305\u542b\u53f0\u80a1 + \u7f8e\u80a1\u7684\u6301\u5009\nreport = sim(position, market=GlobalMarket())\n</code></pre>"}, {"location": "details/market_customization/#3-4-k", "title": "\u6848\u4f8b 3: \u52a0\u5bc6\u8ca8\u5e63 4 \u5c0f\u6642 K \u7dda\u56de\u6e2c", "text": "<pre><code>class Crypto4HMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'crypto_4h'\n\n    @staticmethod\n    def get_freq():\n        return '4h'  # 4 \u5c0f\u6642\u983b\u7387\n\n    def get_price(self, trade_at_price='close', adj=True):\n        # \u5f9e Binance API \u8f09\u5165 4 \u5c0f\u6642 K \u7dda\n        df = pd.read_csv('binance_4h_close.csv', index_col=0, parse_dates=True)\n        return df\n\n# \u4f7f\u7528\nclose = pd.read_csv('binance_4h_close.csv', index_col=0, parse_dates=True)\nposition = close &gt; close.rolling(50).mean()\n\n# \u6ce8\u610f: resample \u53c3\u6578\u8981\u5c0d\u61c9\u983b\u7387\nreport = sim(position, market=Crypto4HMarket(), resample='1d')  # \u6bcf\u65e5\u8abf\u6574\n</code></pre>"}, {"location": "details/market_customization/#_15", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>finlab.market API Reference</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>TWMarket \u539f\u59cb\u78bc</li> <li>USMarket \u539f\u59cb\u78bc</li> </ul>"}, {"location": "details/market_customization/#_16", "title": "\u5e38\u898b\u932f\u8aa4\u8207\u89e3\u6c7a\u65b9\u6cd5", "text": ""}, {"location": "details/market_customization/#1_1", "title": "\u932f\u8aa4 1\uff1a\u6a94\u6848\u8b80\u53d6\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u57f7\u884c\u81ea\u8a02\u5e02\u5834\u6642\u62cb\u51fa <code>FileNotFoundError</code></p> <pre><code>class CryptoMarket(Market):\n    def get_price(self, trade_at_price='close', adj=True):\n        df = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\n        return df\n\nmarket = CryptoMarket()\nclose = market.get_price('close')\n# FileNotFoundError: [Errno 2] No such file or directory: 'crypto_close.csv'\n</code></pre> <p>\u539f\u56e0\uff1a - CSV \u6a94\u6848\u4e0d\u5b58\u5728\u6216\u8def\u5f91\u932f\u8aa4 - \u4f7f\u7528\u76f8\u5c0d\u8def\u5f91\u4f46\u5de5\u4f5c\u76ee\u9304\u4e0d\u6b63\u78ba - \u6a94\u540d\u62fc\u5beb\u932f\u8aa4\u6216\u5927\u5c0f\u5beb\u4e0d\u7b26</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab.market import Market\nimport pandas as pd\nimport os\n\nclass CryptoMarket(Market):\n\n    def __init__(self, data_dir='./data'):\n        \"\"\"\n        Args:\n            data_dir: \u8cc7\u6599\u76ee\u9304\u8def\u5f91\uff08\u9810\u8a2d\u70ba ./data\uff09\n        \"\"\"\n        self.data_dir = data_dir\n\n    @staticmethod\n    def get_name():\n        return 'crypto'\n\n    @staticmethod\n    def get_freq():\n        return '1d'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        \"\"\"\u53d6\u5f97\u50f9\u683c\u8cc7\u6599\uff08\u542b\u932f\u8aa4\u8655\u7406\uff09\"\"\"\n\n        # \u69cb\u5efa\u5b8c\u6574\u8def\u5f91\n        file_path = os.path.join(self.data_dir, f'crypto_{trade_at_price}.csv')\n\n        # \u6aa2\u67e5\u6a94\u6848\u662f\u5426\u5b58\u5728\n        if not os.path.exists(file_path):\n            raise FileNotFoundError(\n                f\"\u274c \u627e\u4e0d\u5230\u8cc7\u6599\u6a94\u6848\uff1a{file_path}\\n\"\n                f\"   \u8acb\u78ba\u8a8d\uff1a\\n\"\n                f\"   1. \u6a94\u6848\u662f\u5426\u5b58\u5728\u65bc {self.data_dir} \u76ee\u9304\\n\"\n                f\"   2. \u6a94\u6848\u540d\u7a31\u662f\u5426\u6b63\u78ba\uff08crypto_{trade_at_price}.csv\uff09\\n\"\n                f\"   3. \u5de5\u4f5c\u76ee\u9304\u662f\u5426\u6b63\u78ba\uff08\u7576\u524d\uff1a{os.getcwd()}\uff09\\n\"\n                f\"   \u63d0\u793a\uff1a\u53ef\u81f3 https://example.com/data \u4e0b\u8f09\u7bc4\u4f8b\u8cc7\u6599\"\n            )\n\n        # \u5617\u8a66\u8b80\u53d6\u6a94\u6848\n        try:\n            df = pd.read_csv(file_path, index_col=0, parse_dates=True)\n\n        except PermissionError:\n            raise PermissionError(\n                f\"\u274c \u7121\u6b0a\u9650\u8b80\u53d6\u6a94\u6848\uff1a{file_path}\\n\"\n                f\"   \u8acb\u6aa2\u67e5\u6a94\u6848\u6b0a\u9650\u8a2d\u5b9a\"\n            )\n\n        except pd.errors.EmptyDataError:\n            raise ValueError(\n                f\"\u274c \u8cc7\u6599\u6a94\u6848\u70ba\u7a7a\uff1a{file_path}\\n\"\n                f\"   \u8acb\u78ba\u8a8d\u6a94\u6848\u5167\u5bb9\u662f\u5426\u6b63\u78ba\"\n            )\n\n        except Exception as e:\n            raise RuntimeError(\n                f\"\u274c \u8b80\u53d6\u6a94\u6848\u5931\u6557\uff1a{file_path}\\n\"\n                f\"   \u932f\u8aa4\u8a0a\u606f\uff1a{e}\"\n            )\n\n        # \u6aa2\u67e5\u8cc7\u6599\u5b8c\u6574\u6027\uff08\u5f8c\u7e8c\u6b65\u9a5f\uff0c\u898b\u932f\u8aa4 2\uff09\n        df = self._validate_dataframe(df, file_path)\n\n        return df\n\n    def _validate_dataframe(self, df, file_path):\n        \"\"\"\u9a57\u8b49 DataFrame \u683c\u5f0f\"\"\"\n\n        # \u6aa2\u67e5\u662f\u5426\u70ba\u7a7a\n        if df.empty:\n            raise ValueError(\n                f\"\u274c \u8cc7\u6599\u70ba\u7a7a\uff1a{file_path}\\n\"\n                f\"   \u8acb\u78ba\u8a8d\u6a94\u6848\u5167\u5bb9\u662f\u5426\u6b63\u78ba\"\n            )\n\n        # \u6aa2\u67e5 index \u662f\u5426\u70ba DatetimeIndex\n        if not isinstance(df.index, pd.DatetimeIndex):\n            raise TypeError(\n                f\"\u274c Index \u5fc5\u9808\u70ba DatetimeIndex\uff08\u65e5\u671f\u683c\u5f0f\uff09\\n\"\n                f\"   \u7576\u524d Index \u985e\u578b\uff1a{type(df.index)}\\n\"\n                f\"   \u8acb\u78ba\u8a8d CSV \u7b2c\u4e00\u6b04\u70ba\u65e5\u671f\u683c\u5f0f\uff08\u5982 2020-01-01\uff09\\n\"\n                f\"   \u4e26\u4f7f\u7528 parse_dates=True \u53c3\u6578\"\n            )\n\n        # \u6aa2\u67e5\u662f\u5426\u6709\u6578\u503c\u8cc7\u6599\n        if df.shape[1] == 0:\n            raise ValueError(\n                f\"\u274c \u7121\u4efb\u4f55\u80a1\u7968\u6b04\u4f4d\uff1a{file_path}\\n\"\n                f\"   \u8acb\u78ba\u8a8d CSV \u683c\u5f0f\u6b63\u78ba\uff08\u7b2c\u4e00\u6b04\u70ba\u65e5\u671f\uff0c\u5176\u4ed6\u6b04\u70ba\u80a1\u7968\u4ee3\u865f\uff09\"\n            )\n\n        print(f\"\u2705 \u8cc7\u6599\u8f09\u5165\u6210\u529f\uff1a{file_path}\")\n        print(f\"   \u8cc7\u6599\u7bc4\u570d\uff1a{df.index[0]} ~ {df.index[-1]}\")\n        print(f\"   \u80a1\u7968\u6578\u91cf\uff1a{df.shape[1]} \u6a94\")\n        print(f\"   \u4ea4\u6613\u65e5\u6578\uff1a{df.shape[0]} \u65e5\")\n\n        return df\n\n    @staticmethod\n    def get_benchmark():\n        \"\"\"\u5c0d\u7167\u6307\u6578\uff08\u542b\u932f\u8aa4\u8655\u7406\uff09\"\"\"\n        try:\n            df = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\n            if 'BTC' not in df.columns:\n                print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u627e\u4e0d\u5230 BTC \u6b04\u4f4d\uff0c\u7121\u6cd5\u8a2d\u5b9a\u5c0d\u7167\u6307\u6578\")\n                return pd.Series([])  # \u56de\u50b3\u7a7a Series\n            return df['BTC']\n        except Exception as e:\n            print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u7121\u6cd5\u8f09\u5165\u5c0d\u7167\u6307\u6578\uff1a{e}\")\n            return pd.Series([])  # \u56de\u50b3\u7a7a Series\uff0c\u4e0d\u5f71\u97ff\u4e3b\u8981\u529f\u80fd\n\n\n# \u4f7f\u7528\u7bc4\u4f8b\uff1a\u6307\u5b9a\u8cc7\u6599\u76ee\u9304\ntry:\n    market = CryptoMarket(data_dir='/path/to/crypto/data')\n    close = market.get_price('close')\n    print(\"\u2705 \u5e02\u5834\u7269\u4ef6\u5efa\u7acb\u6210\u529f\")\n\nexcept FileNotFoundError as e:\n    print(f\"\\n{e}\")\n    print(\"\\n\u8acb\u4e0b\u8f09\u7bc4\u4f8b\u8cc7\u6599\u6216\u4fee\u6b63\u6a94\u6848\u8def\u5f91\")\n\nexcept Exception as e:\n    print(f\"\\n\u274c \u5efa\u7acb\u5e02\u5834\u7269\u4ef6\u5931\u6557\uff1a{e}\")\n</code></pre>"}, {"location": "details/market_customization/#2_2", "title": "\u932f\u8aa4 2\uff1a\u8cc7\u6599\u683c\u5f0f\u932f\u8aa4", "text": "<p>\u73fe\u8c61\uff1aDataFrame \u683c\u5f0f\u4e0d\u7b26\u5408\u9810\u671f\uff0c\u5c0e\u81f4\u56de\u6e2c\u5931\u6557</p> <pre><code>close = market.get_price('close')\nreport = sim(position, market=market)\n# TypeError: Index must be DatetimeIndex\n# \u6216\n# KeyError: 'BTC'\n</code></pre> <p>\u5e38\u898b\u683c\u5f0f\u554f\u984c\uff1a</p> <ol> <li>Index \u4e0d\u662f DatetimeIndex</li> <li>\u7f3a\u5c11\u5fc5\u8981\u6b04\u4f4d</li> <li>\u8cc7\u6599\u578b\u614b\u932f\u8aa4\uff08\u5b57\u4e32\u800c\u975e\u6578\u503c\uff09</li> <li>\u5305\u542b\u904e\u591a\u7f3a\u5931\u503c</li> </ol> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a\u5728 <code>get_price()</code> \u4e2d\u5f37\u5316\u9a57\u8b49</p> <pre><code>class RobustMarket(Market):\n\n    def get_price(self, trade_at_price='close', adj=True):\n        \"\"\"\u53d6\u5f97\u50f9\u683c\u8cc7\u6599\uff08\u5b8c\u6574\u9a57\u8b49\uff09\"\"\"\n\n        df = pd.read_csv(f'data_{trade_at_price}.csv', index_col=0)\n\n        # \u9a57\u8b49 1\uff1a\u8f49\u63db index \u70ba DatetimeIndex\n        if not isinstance(df.index, pd.DatetimeIndex):\n            try:\n                df.index = pd.to_datetime(df.index)\n                print(\"\u2705 Index \u5df2\u8f49\u63db\u70ba DatetimeIndex\")\n            except Exception as e:\n                raise TypeError(\n                    f\"\u274c \u7121\u6cd5\u5c07 Index \u8f49\u63db\u70ba DatetimeIndex\\n\"\n                    f\"   Index \u7bc4\u4f8b\uff1a{df.index[:3].tolist()}\\n\"\n                    f\"   \u932f\u8aa4\u8a0a\u606f\uff1a{e}\\n\"\n                    f\"   \u8acb\u78ba\u8a8d\u7b2c\u4e00\u6b04\u683c\u5f0f\u70ba\u65e5\u671f\uff08\u5982 2020-01-01 \u6216 2020/01/01\uff09\"\n                )\n\n        # \u9a57\u8b49 2\uff1a\u6aa2\u67e5\u8cc7\u6599\u578b\u614b\n        non_numeric_cols = df.select_dtypes(exclude=['number']).columns.tolist()\n        if non_numeric_cols:\n            print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u4ee5\u4e0b\u6b04\u4f4d\u975e\u6578\u503c\u578b\u614b\uff0c\u5c07\u5617\u8a66\u8f49\u63db\uff1a{non_numeric_cols}\")\n            for col in non_numeric_cols:\n                try:\n                    df[col] = pd.to_numeric(df[col], errors='coerce')\n                except Exception as e:\n                    raise TypeError(\n                        f\"\u274c \u7121\u6cd5\u5c07\u6b04\u4f4d {col} \u8f49\u63db\u70ba\u6578\u503c\\n\"\n                        f\"   \u8acb\u78ba\u8a8d\u6b04\u4f4d\u5167\u5bb9\u70ba\u6578\u5b57\"\n                    )\n\n        # \u9a57\u8b49 3\uff1a\u6aa2\u67e5\u7f3a\u5931\u503c\u6bd4\u4f8b\n        missing_ratio = df.isna().sum() / len(df)\n        high_missing_cols = missing_ratio[missing_ratio &gt; 0.3].index.tolist()\n\n        if high_missing_cols:\n            print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u4ee5\u4e0b\u6b04\u4f4d\u7f3a\u5931\u503c &gt; 30%\uff1a\")\n            for col in high_missing_cols:\n                print(f\"     {col}: {missing_ratio[col]:.1%} \u7f3a\u5931\")\n            print(\"   \u5efa\u8b70\uff1a\")\n            print(\"   1. \u79fb\u9664\u9019\u4e9b\u6b04\u4f4d\uff08df.drop(columns=high_missing_cols)\uff09\")\n            print(\"   2. \u4f7f\u7528 forward fill \u586b\u5145\uff08df.ffill()\uff09\")\n\n            # \u81ea\u52d5\u8655\u7406\uff1a\u4f7f\u7528 forward fill\n            df = df.ffill()\n            print(\"   \u5df2\u81ea\u52d5\u4f7f\u7528 forward fill \u586b\u5145\u7f3a\u5931\u503c\")\n\n        # \u9a57\u8b49 4\uff1a\u6aa2\u67e5\u8cc7\u6599\u7bc4\u570d\n        if len(df) &lt; 100:\n            print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u8cc7\u6599\u7b46\u6578\u904e\u5c11\uff08{len(df)} \u7b46\uff09\")\n            print(\"   \u5efa\u8b70\u81f3\u5c11 252 \u500b\u4ea4\u6613\u65e5\uff08\u7d04 1 \u5e74\uff09\u4ee5\u4e0a\u7684\u8cc7\u6599\")\n\n        if df.shape[1] &lt; 2:\n            print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u80a1\u7968\u6578\u91cf\u904e\u5c11\uff08{df.shape[1]} \u6a94\uff09\")\n            print(\"   \u5efa\u8b70\u81f3\u5c11 10 \u6a94\u4ee5\u4e0a\u7684\u80a1\u7968\u4ee5\u5206\u6563\u98a8\u96aa\")\n\n        # \u9a57\u8b49 5\uff1a\u6392\u5e8f index\n        if not df.index.is_monotonic_increasing:\n            print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u65e5\u671f\u672a\u6392\u5e8f\uff0c\u5df2\u81ea\u52d5\u6392\u5e8f\")\n            df = df.sort_index()\n\n        # \u9a57\u8b49 6\uff1a\u79fb\u9664\u91cd\u8907\u65e5\u671f\n        if df.index.duplicated().any():\n            dup_dates = df.index[df.index.duplicated()].tolist()\n            print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u767c\u73fe\u91cd\u8907\u65e5\u671f\uff1a{dup_dates[:5]}...\")\n            df = df[~df.index.duplicated(keep='last')]\n            print(\"   \u5df2\u4fdd\u7559\u6700\u5f8c\u4e00\u7b46\u8a18\u9304\")\n\n        print(f\"\\n\u2705 \u8cc7\u6599\u9a57\u8b49\u5b8c\u6210\")\n        print(f\"   \u8cc7\u6599\u7bc4\u570d\uff1a{df.index[0].date()} ~ {df.index[-1].date()}\")\n        print(f\"   \u4ea4\u6613\u65e5\u6578\uff1a{len(df)} \u65e5\")\n        print(f\"   \u80a1\u7968\u6578\u91cf\uff1a{df.shape[1]} \u6a94\")\n        print(f\"   \u7f3a\u5931\u503c\uff1a{df.isna().sum().sum()} \u500b\uff08{df.isna().sum().sum() / df.size:.2%}\uff09\")\n\n        return df\n\n\n# \u4f7f\u7528\u7bc4\u4f8b\ntry:\n    market = RobustMarket()\n    close = market.get_price('close')\n\n    # \u57f7\u884c\u56de\u6e2c\n    position = close &gt; close.rolling(20).mean()\n    report = sim(position, market=market, resample='M')\n    print(\"\\n\u2705 \u56de\u6e2c\u6210\u529f\")\n\nexcept (TypeError, ValueError) as e:\n    print(f\"\\n{e}\")\n    print(\"\\n\u8acb\u4fee\u6b63\u8cc7\u6599\u683c\u5f0f\u5f8c\u91cd\u8a66\")\n</code></pre>"}, {"location": "details/market_customization/#3api", "title": "\u932f\u8aa4 3\uff1aAPI \u8acb\u6c42\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u4f7f\u7528 API \u8f09\u5165\u8cc7\u6599\u6642\u62cb\u51fa\u7db2\u8def\u932f\u8aa4</p> <pre><code>class APIMarket(Market):\n    def get_price(self, trade_at_price='close', adj=True):\n        response = requests.get(f'https://api.example.com/{trade_at_price}')\n        return pd.DataFrame(response.json())\n\nmarket = APIMarket()\nclose = market.get_price('close')\n# requests.exceptions.ConnectionError: Failed to establish a new connection\n</code></pre> <p>\u539f\u56e0\uff1a - \u7db2\u8def\u9023\u7dda\u554f\u984c - API \u91d1\u9470\u7121\u6548\u6216\u904e\u671f - API \u8acb\u6c42\u6b21\u6578\u8d85\u904e\u9650\u5236 - API \u56de\u50b3\u683c\u5f0f\u932f\u8aa4</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a\u5be6\u65bd\u91cd\u8a66\u6a5f\u5236\u8207\u932f\u8aa4\u8655\u7406</p> <pre><code>import requests\nimport time\nfrom requests.adapters import HTTPAdapter\nfrom requests.packages.urllib3.util.retry import Retry\n\nclass APIMarket(Market):\n\n    def __init__(self, api_url, api_key=None, max_retries=3):\n        \"\"\"\n        Args:\n            api_url: API \u57fa\u790e\u7db2\u5740\n            api_key: API \u91d1\u9470\uff08\u9078\u586b\uff09\n            max_retries: \u6700\u5927\u91cd\u8a66\u6b21\u6578\n        \"\"\"\n        self.api_url = api_url\n        self.api_key = api_key\n        self.max_retries = max_retries\n\n        # \u5efa\u7acb\u5e36\u91cd\u8a66\u6a5f\u5236\u7684 Session\n        self.session = self._create_session()\n\n    def _create_session(self):\n        \"\"\"\u5efa\u7acb\u5e36\u91cd\u8a66\u6a5f\u5236\u7684 requests Session\"\"\"\n        session = requests.Session()\n\n        # \u8a2d\u5b9a\u91cd\u8a66\u7b56\u7565\n        retry_strategy = Retry(\n            total=self.max_retries,\n            backoff_factor=1,  # \u6307\u6578\u9000\u907f\uff1a1s, 2s, 4s\n            status_forcelist=[429, 500, 502, 503, 504],  # \u91cd\u8a66\u7684 HTTP \u72c0\u614b\u78bc\n            allowed_methods=[\"HEAD\", \"GET\", \"OPTIONS\"]\n        )\n\n        adapter = HTTPAdapter(max_retries=retry_strategy)\n        session.mount(\"http://\", adapter)\n        session.mount(\"https://\", adapter)\n\n        return session\n\n    @staticmethod\n    def get_name():\n        return 'api_market'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        \"\"\"\u5f9e API \u53d6\u5f97\u50f9\u683c\u8cc7\u6599\uff08\u542b\u932f\u8aa4\u8655\u7406\uff09\"\"\"\n\n        url = f'{self.api_url}/prices/{trade_at_price}'\n\n        # \u8a2d\u5b9a\u8acb\u6c42\u6a19\u982d\n        headers = {}\n        if self.api_key:\n            headers['Authorization'] = f'Bearer {self.api_key}'\n\n        print(f\"\u6b63\u5728\u5f9e API \u4e0b\u8f09\u8cc7\u6599\uff1a{url}\")\n\n        try:\n            # \u767c\u9001\u8acb\u6c42\uff08\u5e36\u8d85\u6642\u8a2d\u5b9a\uff09\n            response = self.session.get(\n                url,\n                headers=headers,\n                timeout=30  # 30 \u79d2\u8d85\u6642\n            )\n\n            # \u6aa2\u67e5 HTTP \u72c0\u614b\u78bc\n            if response.status_code == 401:\n                raise PermissionError(\n                    f\"\u274c API \u8a8d\u8b49\u5931\u6557\uff08HTTP 401\uff09\\n\"\n                    f\"   \u8acb\u6aa2\u67e5 API \u91d1\u9470\u662f\u5426\u6b63\u78ba\u6216\u5df2\u904e\u671f\\n\"\n                    f\"   \u81f3 API \u670d\u52d9\u5546\u7db2\u7ad9\u91cd\u65b0\u53d6\u5f97\u91d1\u9470\"\n                )\n\n            elif response.status_code == 429:\n                raise RuntimeError(\n                    f\"\u274c API \u8acb\u6c42\u6b21\u6578\u8d85\u904e\u9650\u5236\uff08HTTP 429\uff09\\n\"\n                    f\"   \u8acb\u7a0d\u5f8c\u518d\u8a66\u6216\u5347\u7d1a API \u65b9\u6848\"\n                )\n\n            elif response.status_code &gt;= 500:\n                raise RuntimeError(\n                    f\"\u274c API \u4f3a\u670d\u5668\u932f\u8aa4\uff08HTTP {response.status_code}\uff09\\n\"\n                    f\"   \u4f3a\u670d\u5668\u66ab\u6642\u7121\u6cd5\u56de\u61c9\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\"\n                )\n\n            response.raise_for_status()  # \u62cb\u51fa\u5176\u4ed6 HTTP \u932f\u8aa4\n\n            # \u89e3\u6790 JSON\n            data = response.json()\n\n        except requests.exceptions.Timeout:\n            raise TimeoutError(\n                f\"\u274c API \u8acb\u6c42\u8d85\u6642\uff08&gt; 30 \u79d2\uff09\\n\"\n                f\"   \u7db2\u8def\u9023\u7dda\u904e\u6162\u6216 API \u4f3a\u670d\u5668\u8ca0\u8f09\u904e\u9ad8\\n\"\n                f\"   \u5efa\u8b70\uff1a\\n\"\n                f\"   1. \u6aa2\u67e5\u7db2\u8def\u9023\u7dda\\n\"\n                f\"   2. \u7e2e\u77ed\u8cc7\u6599\u7bc4\u570d\\n\"\n                f\"   3. \u7a0d\u5f8c\u518d\u8a66\"\n            )\n\n        except requests.exceptions.ConnectionError:\n            raise ConnectionError(\n                f\"\u274c \u7db2\u8def\u9023\u7dda\u5931\u6557\\n\"\n                f\"   \u7121\u6cd5\u9023\u7dda\u81f3 {self.api_url}\\n\"\n                f\"   \u8acb\u6aa2\u67e5\uff1a\\n\"\n                f\"   1. \u7db2\u8def\u9023\u7dda\u662f\u5426\u6b63\u5e38\\n\"\n                f\"   2. API \u7db2\u5740\u662f\u5426\u6b63\u78ba\\n\"\n                f\"   3. \u9632\u706b\u7246\u662f\u5426\u963b\u64cb\u9023\u7dda\"\n            )\n\n        except requests.exceptions.JSONDecodeError:\n            raise ValueError(\n                f\"\u274c API \u56de\u50b3\u683c\u5f0f\u932f\u8aa4\\n\"\n                f\"   \u9810\u671f JSON \u683c\u5f0f\uff0c\u4f46\u6536\u5230\uff1a{response.text[:200]}...\\n\"\n                f\"   \u8acb\u806f\u7e6b API \u670d\u52d9\u5546\u78ba\u8a8d\u6587\u4ef6\"\n            )\n\n        except Exception as e:\n            raise RuntimeError(\n                f\"\u274c API \u8acb\u6c42\u5931\u6557\uff1a{e}\\n\"\n                f\"   \u8acb\u67e5\u770b\u8a73\u7d30\u932f\u8aa4\u8a0a\u606f\"\n            )\n\n        # \u8f49\u63db\u70ba DataFrame\n        try:\n            df = pd.DataFrame(data)\n\n            # \u8655\u7406\u5e38\u898b\u683c\u5f0f\n            if 'date' in df.columns:\n                df['date'] = pd.to_datetime(df['date'])\n                df = df.set_index('date')\n            elif 'timestamp' in df.columns:\n                df['timestamp'] = pd.to_datetime(df['timestamp'], unit='s')\n                df = df.set_index('timestamp')\n\n            print(f\"\u2705 API \u8cc7\u6599\u4e0b\u8f09\u6210\u529f\")\n            print(f\"   \u8cc7\u6599\u7bc4\u570d\uff1a{df.index[0]} ~ {df.index[-1]}\")\n            print(f\"   \u80a1\u7968\u6578\u91cf\uff1a{df.shape[1]} \u6a94\")\n\n            return df\n\n        except Exception as e:\n            raise ValueError(\n                f\"\u274c \u8cc7\u6599\u8f49\u63db\u5931\u6557\uff1a{e}\\n\"\n                f\"   API \u56de\u50b3\u683c\u5f0f\uff1a{data}\\n\"\n                f\"   \u8acb\u78ba\u8a8d API \u6587\u4ef6\u4e2d\u7684\u8cc7\u6599\u683c\u5f0f\"\n            )\n\n\n# \u4f7f\u7528\u7bc4\u4f8b\nimport os\n\ntry:\n    # \u5f9e\u74b0\u5883\u8b8a\u6578\u8b80\u53d6 API \u91d1\u9470\uff08\u63a8\u85a6\u65b9\u5f0f\uff09\n    api_key = os.environ.get('CRYPTO_API_KEY')\n    if not api_key:\n        print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u672a\u8a2d\u5b9a CRYPTO_API_KEY \u74b0\u5883\u8b8a\u6578\")\n        print(\"   export CRYPTO_API_KEY='your_api_key'\")\n\n    market = APIMarket(\n        api_url='https://api.example.com',\n        api_key=api_key,\n        max_retries=3\n    )\n\n    close = market.get_price('close')\n    print(\"\u2705 \u5e02\u5834\u8cc7\u6599\u53d6\u5f97\u6210\u529f\")\n\nexcept (ConnectionError, TimeoutError, PermissionError) as e:\n    print(f\"\\n{e}\")\n    print(\"\\n\u8acb\u4fee\u6b63\u554f\u984c\u5f8c\u91cd\u8a66\")\n\nexcept Exception as e:\n    print(f\"\\n\u274c \u672a\u9810\u671f\u7684\u932f\u8aa4\uff1a{e}\")\n</code></pre>"}, {"location": "details/market_customization/#4", "title": "\u932f\u8aa4 4\uff1a\u56de\u6e2c\u57f7\u884c\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u5e02\u5834\u7269\u4ef6\u5efa\u7acb\u6210\u529f\uff0c\u4f46\u56de\u6e2c\u6642\u62cb\u51fa\u932f\u8aa4</p> <pre><code>market = CryptoMarket()\nposition = close &gt; close.average(20)\nreport = sim(position, market=market, resample='M')\n# ValueError: Position index does not match price index\n</code></pre> <p>\u539f\u56e0\uff1a - <code>position</code> \u8207 <code>market.get_price()</code> \u7684\u65e5\u671f\u7bc4\u570d\u4e0d\u4e00\u81f4 - <code>position</code> \u8207\u50f9\u683c\u8cc7\u6599\u7684\u80a1\u7968\u4ee3\u865f\u4e0d\u4e00\u81f4 - \u5e02\u5834\u7269\u4ef6\u7684\u65b9\u6cd5\u672a\u6b63\u78ba\u5be6\u4f5c</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a\u5728\u57f7\u884c\u56de\u6e2c\u524d\u9a57\u8b49\u76f8\u5bb9\u6027</p> <pre><code>def validate_before_backtest(position, market):\n    \"\"\"\u56de\u6e2c\u524d\u9a57\u8b49 position \u8207 market \u76f8\u5bb9\u6027\"\"\"\n\n    print(\"=== \u56de\u6e2c\u524d\u9a57\u8b49 ===\\n\")\n\n    # 1. \u53d6\u5f97\u5e02\u5834\u50f9\u683c\n    try:\n        close = market.get_price('close')\n    except Exception as e:\n        raise RuntimeError(f\"\u274c \u7121\u6cd5\u53d6\u5f97\u5e02\u5834\u50f9\u683c\uff1a{e}\")\n\n    # 2. \u6aa2\u67e5\u65e5\u671f\u7bc4\u570d\n    position_dates = position.index\n    price_dates = close.index\n\n    print(f\"Position \u65e5\u671f\u7bc4\u570d\uff1a{position_dates[0]} ~ {position_dates[-1]}\")\n    print(f\"Price \u65e5\u671f\u7bc4\u570d\uff1a{price_dates[0]} ~ {price_dates[-1]}\")\n\n    # \u8a08\u7b97\u4ea4\u96c6\n    common_dates = position_dates.intersection(price_dates)\n    if len(common_dates) == 0:\n        raise ValueError(\n            f\"\u274c Position \u8207 Price \u65e5\u671f\u7bc4\u570d\u7121\u4ea4\u96c6\\n\"\n            f\"   \u8acb\u78ba\u8a8d\u8cc7\u6599\u4f86\u6e90\u4e00\u81f4\"\n        )\n\n    if len(common_dates) &lt; len(position_dates) * 0.8:\n        print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u50c5 {len(common_dates) / len(position_dates):.1%} \u7684\u65e5\u671f\u6709\u5c0d\u61c9\u50f9\u683c\")\n        print(\"   \u90e8\u5206\u4ea4\u6613\u65e5\u53ef\u80fd\u88ab\u5ffd\u7565\")\n\n    # 3. \u6aa2\u67e5\u80a1\u7968\u4ee3\u865f\n    position_stocks = position.columns.tolist()\n    price_stocks = close.columns.tolist()\n\n    print(f\"\\nPosition \u80a1\u7968\u6578\u91cf\uff1a{len(position_stocks)}\")\n    print(f\"Price \u80a1\u7968\u6578\u91cf\uff1a{len(price_stocks)}\")\n\n    # \u8a08\u7b97\u4ea4\u96c6\n    common_stocks = set(position_stocks).intersection(set(price_stocks))\n    if len(common_stocks) == 0:\n        raise ValueError(\n            f\"\u274c Position \u8207 Price \u80a1\u7968\u4ee3\u865f\u7121\u4ea4\u96c6\\n\"\n            f\"   Position \u7bc4\u4f8b\uff1a{position_stocks[:5]}\\n\"\n            f\"   Price \u7bc4\u4f8b\uff1a{price_stocks[:5]}\\n\"\n            f\"   \u8acb\u78ba\u8a8d\u80a1\u7968\u4ee3\u865f\u683c\u5f0f\u4e00\u81f4\"\n        )\n\n    missing_stocks = set(position_stocks) - set(price_stocks)\n    if missing_stocks:\n        print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a{len(missing_stocks)} \u6a94\u80a1\u7968\u5728 Price \u4e2d\u4e0d\u5b58\u5728\uff1a\")\n        print(f\"   {list(missing_stocks)[:10]}...\")\n        print(\"   \u9019\u4e9b\u80a1\u7968\u5c07\u88ab\u5ffd\u7565\")\n\n    # 4. \u6aa2\u67e5\u5e02\u5834\u7269\u4ef6\u65b9\u6cd5\n    required_methods = ['get_name', 'get_freq', 'get_price']\n    for method in required_methods:\n        if not hasattr(market, method):\n            raise AttributeError(\n                f\"\u274c Market \u7269\u4ef6\u7f3a\u5c11\u5fc5\u8981\u65b9\u6cd5\uff1a{method}\\n\"\n                f\"   \u8acb\u78ba\u8a8d\u5df2\u6b63\u78ba\u7e7c\u627f Market \u985e\u5225\u4e26\u5be6\u4f5c\u6240\u6709\u65b9\u6cd5\"\n            )\n\n    print(f\"\\n\u2705 \u9a57\u8b49\u901a\u904e\uff0c\u5171 {len(common_stocks)} \u6a94\u80a1\u7968\u3001{len(common_dates)} \u500b\u4ea4\u6613\u65e5\")\n    print(\"=\" * 50)\n\n\n# \u4f7f\u7528\u7bc4\u4f8b\ntry:\n    market = CryptoMarket()\n    close = market.get_price('close')\n    position = close &gt; close.rolling(20).mean()\n\n    # \u57f7\u884c\u9a57\u8b49\n    validate_before_backtest(position, market)\n\n    # \u57f7\u884c\u56de\u6e2c\n    report = sim(position, market=market, resample='M', upload=False)\n    print(\"\\n\u2705 \u56de\u6e2c\u6210\u529f\")\n    report.display()\n\nexcept Exception as e:\n    print(f\"\\n\u274c \u56de\u6e2c\u5931\u6557\uff1a{e}\")\n    print(\"\u8acb\u4fee\u6b63\u554f\u984c\u5f8c\u91cd\u8a66\")\n</code></pre>"}, {"location": "details/market_customization/#_17", "title": "\u9664\u932f\u6280\u5de7", "text": ""}, {"location": "details/market_customization/#1_2", "title": "1. \u9010\u6b65\u6e2c\u8a66\u5e02\u5834\u7269\u4ef6", "text": "<pre><code># Step 1: \u6e2c\u8a66\u57fa\u672c\u65b9\u6cd5\nmarket = CryptoMarket()\nprint(f\"\u5e02\u5834\u540d\u7a31\uff1a{market.get_name()}\")\nprint(f\"\u8cc7\u6599\u983b\u7387\uff1a{market.get_freq()}\")\n\n# Step 2: \u6e2c\u8a66\u50f9\u683c\u8f09\u5165\nclose = market.get_price('close')\nprint(f\"\\n\u6536\u76e4\u50f9\u8cc7\u6599\uff1a\\n{close.head()}\")\n\n# Step 3: \u6e2c\u8a66\u5c0d\u7167\u6307\u6578\nbenchmark = market.get_benchmark()\nprint(f\"\\n\u5c0d\u7167\u6307\u6578\uff1a\\n{benchmark.head()}\")\n\n# Step 4: \u57f7\u884c\u7c21\u55ae\u7b56\u7565\nposition = close &gt; close.rolling(20).mean()\nprint(f\"\\n\u6301\u5009\u8a0a\u865f\uff1a\\n{position.tail()}\")\n\n# Step 5: \u5c0f\u7bc4\u570d\u56de\u6e2c\nposition_small = position.iloc[-100:]  # \u50c5\u6700\u8fd1 100 \u5929\nreport = sim(position_small, market=market, resample='M', upload=False)\nreport.display()\n</code></pre>"}, {"location": "details/market_customization/#2-try-except", "title": "2. \u4f7f\u7528 try-except \u5305\u88dd\u95dc\u9375\u6b65\u9a5f", "text": "<pre><code>class SafeMarket(Market):\n\n    def get_price(self, trade_at_price='close', adj=True):\n        try:\n            # \u4e3b\u8981\u908f\u8f2f\n            df = pd.read_csv(f'data_{trade_at_price}.csv', index_col=0, parse_dates=True)\n            return df\n\n        except FileNotFoundError as e:\n            print(f\"\u274c \u6a94\u6848\u4e0d\u5b58\u5728\uff1a{e}\")\n            raise\n\n        except Exception as e:\n            print(f\"\u274c \u672a\u9810\u671f\u7684\u932f\u8aa4\uff1a{e}\")\n            print(f\"   \u932f\u8aa4\u985e\u578b\uff1a{type(e).__name__}\")\n            print(f\"   \u932f\u8aa4\u4f4d\u7f6e\uff1a{e.__traceback__.tb_lineno}\")\n            raise\n</code></pre>"}, {"location": "details/market_customization/#3_1", "title": "3. \u8a18\u9304\u8a73\u7d30\u65e5\u8a8c", "text": "<pre><code>import logging\n\nlogging.basicConfig(level=logging.INFO)\nlogger = logging.getLogger(__name__)\n\nclass LoggedMarket(Market):\n\n    def get_price(self, trade_at_price='close', adj=True):\n        logger.info(f\"\u958b\u59cb\u8f09\u5165\u50f9\u683c\u8cc7\u6599\uff1a{trade_at_price}\")\n\n        try:\n            df = pd.read_csv(f'data_{trade_at_price}.csv', index_col=0, parse_dates=True)\n            logger.info(f\"\u8cc7\u6599\u8f09\u5165\u6210\u529f\uff1a{df.shape}\")\n            return df\n\n        except Exception as e:\n            logger.error(f\"\u8cc7\u6599\u8f09\u5165\u5931\u6557\uff1a{e}\", exc_info=True)\n            raise\n</code></pre>"}, {"location": "details/market_customization/#_18", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>finlab.market API Reference</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>\u5e38\u898b\u554f\u984c FAQ</li> <li>TWMarket \u539f\u59cb\u78bc</li> <li>USMarket \u539f\u59cb\u78bc</li> </ul>"}, {"location": "details/optimize_strategy/", "title": "\u7b56\u7565\u53c3\u6578\u512a\u5316", "text": "<p>\u7576\u4f60\u958b\u767c\u4e86\u4e00\u500b\u4ea4\u6613\u7b56\u7565\u5f8c,\u5982\u4f55\u627e\u51fa\u6700\u4f73\u7684\u689d\u4ef6\u7d44\u5408? <code>finlab.optimize</code> \u6a21\u7d44\u63d0\u4f9b\u4e86 <code>sim_conditions()</code> \u51fd\u6578,\u53ef\u4ee5\u81ea\u52d5\u6e2c\u8a66\u6240\u6709\u689d\u4ef6\u7d44\u5408,\u4e26\u900f\u904e\u8996\u89ba\u5316\u5de5\u5177\u5feb\u901f\u6bd4\u8f03\u7e3e\u6548,\u5e6b\u52a9\u4f60\u627e\u51fa\u6700\u5f37\u7684\u7b56\u7565\u3002</p>"}, {"location": "details/optimize_strategy/#_2", "title": "\u70ba\u4ec0\u9ebc\u9700\u8981\u7b56\u7565\u512a\u5316?", "text": "<p>\u5728\u958b\u767c\u4ea4\u6613\u7b56\u7565\u6642,\u6211\u5011\u5e38\u5e38\u6703\u6709\u591a\u500b\u9078\u80a1\u689d\u4ef6:</p> <ul> <li>\u6280\u8853\u9762:\u5747\u7dda\u4ea4\u53c9\u3001\u5275\u65b0\u9ad8\u3001RSI \u6307\u6a19</li> <li>\u57fa\u672c\u9762:\u672c\u76ca\u6bd4\u3001\u71df\u6536\u6210\u9577\u3001\u7372\u5229\u80fd\u529b</li> <li>\u7c4c\u78bc\u9762:\u6295\u4fe1\u8cb7\u8d85\u3001\u878d\u8cc7\u8b8a\u5316</li> </ul> <p>\u6bcf\u500b\u689d\u4ef6\u55ae\u7368\u4f7f\u7528\u53ef\u80fd\u7e3e\u6548\u666e\u901a,\u4f46\u591a\u500b\u689d\u4ef6\u7d44\u5408\u5f8c\u53ef\u80fd\u7522\u751f\u610f\u60f3\u4e0d\u5230\u7684\u6548\u679c\u3002\u624b\u52d5\u6e2c\u8a66\u6240\u6709\u7d44\u5408\u975e\u5e38\u8017\u6642,<code>sim_conditions()</code> \u53ef\u4ee5\u81ea\u52d5\u5316\u9019\u500b\u904e\u7a0b\u3002</p>"}, {"location": "details/optimize_strategy/#_3", "title": "\u5feb\u901f\u4e0a\u624b", "text": ""}, {"location": "details/optimize_strategy/#3", "title": "\u57fa\u790e\u7bc4\u4f8b:3 \u500b\u689d\u4ef6\u7684\u6240\u6709\u7d44\u5408", "text": "<p>\u5047\u8a2d\u6211\u5011\u6709 3 \u500b\u9078\u80a1\u689d\u4ef6:</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\nfrom finlab.optimize.combinations import sim_conditions\n\nclose = data.get(\"price:\u6536\u76e4\u50f9\")\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\u71df\u696d\u5229\u76ca\u6210\u9577\u7387 = data.get('fundamental_features:\u71df\u696d\u5229\u76ca\u6210\u9577\u7387')\n\n# \u5b9a\u7fa9 3 \u500b\u689d\u4ef6\nc1 = (close &gt; close.average(20)) &amp; (close &gt; close.average(60))  # \u6280\u8853\u9762:\u7a81\u7834\u5747\u7dda\nc2 = \u71df\u696d\u5229\u76ca\u6210\u9577\u7387 &gt; 0                                          # \u57fa\u672c\u9762:\u7372\u5229\u6210\u9577\nc3 = rev.average(3) / rev.average(12) &gt; 1.1                     # \u57fa\u672c\u9762:\u71df\u6536\u52a0\u901f\n\n# \u8a2d\u5b9a\u51fa\u5834\u689d\u4ef6\nexits = close &lt; close.average(20)\n\n# \u7d44\u5408\u5b57\u5178,key \u70ba\u689d\u4ef6\u540d\u7a31\nconditions = {'c1': c1, 'c2': c2, 'c3': c3}\n\n# \u6e2c\u8a66\u6240\u6709\u7d44\u5408\nreport_collection = sim_conditions(\n    conditions=conditions,\n    hold_until={'exit': exits, 'stop_loss': 0.1},  # \u8dcc\u7834\u5747\u7dda\u51fa\u5834,\u505c\u640d 10%\n    resample='M',           # \u6bcf\u6708\u8abf\u6574\n    position_limit=0.1,     # \u55ae\u4e00\u6301\u80a1\u4e0a\u9650 10%\n    upload=False            # \u4e0d\u4e0a\u50b3\u81f3\u96f2\u7aef\n)\n</code></pre> <p>\u9019\u6bb5\u7a0b\u5f0f\u78bc\u6703\u81ea\u52d5\u6e2c\u8a66\u4ee5\u4e0b 7 \u7a2e\u7d44\u5408:</p> <ol> <li><code>c1</code> (\u50c5\u6280\u8853\u9762)</li> <li><code>c2</code> (\u50c5\u7372\u5229\u6210\u9577)</li> <li><code>c3</code> (\u50c5\u71df\u6536\u52a0\u901f)</li> <li><code>c1 &amp; c2</code> (\u6280\u8853\u9762 + \u7372\u5229\u6210\u9577)</li> <li><code>c1 &amp; c3</code> (\u6280\u8853\u9762 + \u71df\u6536\u52a0\u901f)</li> <li><code>c2 &amp; c3</code> (\u7372\u5229\u6210\u9577 + \u71df\u6536\u52a0\u901f)</li> <li><code>c1 &amp; c2 &amp; c3</code> (\u4e09\u500b\u689d\u4ef6\u5168\u90e8)</li> </ol>"}, {"location": "details/optimize_strategy/#_4", "title": "\u8996\u89ba\u5316\u6bd4\u8f03\u7b56\u7565\u7e3e\u6548", "text": ""}, {"location": "details/optimize_strategy/#1", "title": "1. \u7d2f\u7a4d\u5831\u916c\u7387\u6298\u7dda\u5716", "text": "<p>\u6bd4\u8f03\u5404\u7d44\u5408\u7684\u6de8\u503c\u66f2\u7dda:</p> <pre><code>report_collection.plot_creturns().show()\n</code></pre> <p></p> <p>\u5f9e\u5716\u4e2d\u53ef\u4ee5\u770b\u51fa\u54ea\u500b\u7d44\u5408\u7684\u9577\u671f\u7e3e\u6548\u6700\u597d,\u4ee5\u53ca\u5404\u7d44\u5408\u7684\u7a69\u5b9a\u6027\u3002</p>"}, {"location": "details/optimize_strategy/#2", "title": "2. \u6307\u6a19\u5206\u7fa4\u68d2\u72c0\u5716", "text": "<pre><code>report_collection.plot_stats('bar').show()\n</code></pre> <p>\u4e26\u6392\u986f\u793a\u6240\u6709\u7d44\u5408\u7684 12 \u7a2e\u95dc\u9375\u6307\u6a19,\u65b9\u4fbf\u5feb\u901f\u6bd4\u8f03\u3002</p>"}, {"location": "details/optimize_strategy/#3_1", "title": "3. \u6307\u6a19\u5206\u7d1a\u71b1\u529b\u5716", "text": "<pre><code>report_collection.plot_stats('heatmap')\n</code></pre> <p>\u71b1\u529b\u5716\u4f7f\u7528\u984f\u8272\u6df1\u6dfa\u8868\u793a\u5404\u6307\u6a19\u7684\u6392\u540d\u767e\u5206\u4f4d(0-100%),\u6578\u503c\u8d8a\u5927\u4ee3\u8868\u6392\u540d\u8d8a\u524d:</p> <ul> <li>avg_score: \u5404\u6307\u6a19\u5e73\u5747\u5206\u6578,\u5206\u6578\u8d8a\u9ad8\u4ee3\u8868\u6574\u9ad4\u8a55\u50f9\u8d8a\u597d</li> <li>\u9810\u8a2d\u4ee5 <code>avg_score</code> \u964d\u51aa\u6392\u5e8f,\u6700\u597d\u7684\u7d44\u5408\u5728\u6700\u4e0a\u65b9</li> <li>\u984f\u8272\u8d8a\u4eae(\u9ec3\u8272)\u4ee3\u8868\u8a72\u6307\u6a19\u5728\u6240\u6709\u7d44\u5408\u4e2d\u6392\u540d\u8d8a\u524d</li> </ul> <p>\u5982\u4f55\u89e3\u8b80\u71b1\u529b\u5716</p> <ul> <li>\u5c0b\u627e avg_score \u6700\u9ad8\u7684\u7d44\u5408(\u901a\u5e38\u5728\u6700\u4e0a\u65b9)</li> <li>\u6aa2\u67e5\u8a72\u7d44\u5408\u662f\u5426\u5728\u95dc\u9375\u6307\u6a19(\u590f\u666e\u7387\u3001\u52dd\u7387\u3001\u6700\u5927\u56de\u64a4)\u90fd\u6709\u4e0d\u932f\u7684\u8868\u73fe</li> <li>\u907f\u514d\u9078\u64c7\u67d0\u4e9b\u6307\u6a19\u7279\u5225\u5dee(\u6df1\u7d2b\u8272)\u7684\u7d44\u5408</li> </ul>"}, {"location": "details/optimize_strategy/#_5", "title": "\u53d6\u5f97\u8a73\u7d30\u7e3e\u6548\u6307\u6a19", "text": "<pre><code>stats = report_collection.get_stats()\nprint(stats)\n</code></pre> <p>\u6703\u56de\u50b3\u4e00\u500b DataFrame,\u5305\u542b 12 \u7a2e\u6307\u6a19:</p>"}, {"location": "details/optimize_strategy/#_6", "title": "\u7b56\u7565\u5c64\u7d1a\u6307\u6a19", "text": "\u6307\u6a19 \u8aaa\u660e \u8a55\u4f30\u65b9\u5411 <code>daily_mean</code> \u5e74\u5316\u5831\u916c\u7387 \u8d8a\u9ad8\u8d8a\u597d <code>daily_sharpe</code> \u5e74\u5316\u590f\u666e\u7387(\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c) \u8d8a\u9ad8\u8d8a\u597d <code>daily_sortino</code> \u5e74\u5316\u7d22\u63d0\u8afe\u6bd4\u7387(\u4e0b\u6a94\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c) \u8d8a\u9ad8\u8d8a\u597d <code>max_drawdown</code> \u6700\u5927\u56de\u64a4\u7387(\u8ca0\u503c) \u7d55\u5c0d\u503c\u8d8a\u5c0f\u8d8a\u597d <code>avg_drawdown</code> \u5e73\u5747\u56de\u64a4\u7387(\u8ca0\u503c) \u7d55\u5c0d\u503c\u8d8a\u5c0f\u8d8a\u597d"}, {"location": "details/optimize_strategy/#_7", "title": "\u4ea4\u6613\u5c64\u7d1a\u6307\u6a19", "text": "\u6307\u6a19 \u8aaa\u660e \u8a55\u4f30\u65b9\u5411 <code>win_ratio</code> \u6bcf\u7b46\u4ea4\u6613\u52dd\u7387 \u8d8a\u9ad8\u8d8a\u597d <code>avg_return</code> \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u7372\u5229\u7387 \u8d8a\u9ad8\u8d8a\u597d <code>avg_mae</code> \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u6700\u5927\u4e0d\u5229\u65b9\u5411\u5e45\u5ea6(\u8ca0\u503c) \u7d55\u5c0d\u503c\u8d8a\u5c0f\u8d8a\u597d <code>avg_bmfe</code> MAE \u767c\u751f\u524d\u7684\u5e73\u5747\u6700\u5927\u6709\u5229\u65b9\u5411\u5e45\u5ea6 \u8d8a\u9ad8\u8d8a\u597d <code>avg_gmfe</code> \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u6700\u5927\u6709\u5229\u65b9\u5411\u5e45\u5ea6 \u8d8a\u9ad8\u8d8a\u597d <code>avg_mdd</code> \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u6700\u5927\u56de\u64a4\u7387(\u8ca0\u503c) \u7d55\u5c0d\u503c\u8d8a\u5c0f\u8d8a\u597d <p>avg_bmfe \u7684\u610f\u7fa9</p> <p><code>avg_bmfe</code> \u4ee3\u8868\u5728\u505c\u640d\u89f8\u767c\u524d,\u80a1\u50f9\u66fe\u7d93\u6f32\u5230\u591a\u9ad8\u3002\u82e5\u6b64\u6578\u503c\u8d8a\u9ad8,\u4ee3\u8868\u8d8a\u6709\u6a5f\u6703\u5728\u505c\u640d\u524d\u5148\u57f7\u884c\u505c\u5229,\u662f\u512a\u5316\u505c\u5229\u9ede\u7684\u91cd\u8981\u53c3\u8003\u3002</p>"}, {"location": "details/optimize_strategy/#5", "title": "\u9032\u968e\u7bc4\u4f8b:5 \u500b\u689d\u4ef6\u7684\u512a\u5316", "text": "<p>\u7576\u689d\u4ef6\u589e\u52a0\u5230 5 \u500b\u6642,\u7d44\u5408\u6578\u6703\u9054\u5230 31 \u7a2e (2^5 - 1)\u3002\u624b\u52d5\u6e2c\u8a66\u975e\u5e38\u56f0\u96e3,\u4f46 <code>sim_conditions()</code> \u53ef\u4ee5\u8f15\u9b06\u8655\u7406:</p> <pre><code>from finlab import data\nfrom finlab.optimize.combinations import sim_conditions\n\nclose = data.get(\"price:\u6536\u76e4\u50f9\")\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536').index_str_to_date()\nrev_ma3 = rev.average(3)\nrev_ma12 = rev.average(12)\n\n# 5 \u500b\u689d\u4ef6\nc1 = (close &gt; close.average(20)) &amp; (close &gt; close.average(60))  # \u5747\u7dda\u591a\u982d\u6392\u5217\nc2 = (close == close.rolling(20).max())                         # \u5275 20 \u65e5\u65b0\u9ad8\nc3 = pe &lt; 15                                                    # \u4f4e\u672c\u76ca\u6bd4\nc4 = rev_ma3 / rev_ma12 &gt; 1.1                                   # \u71df\u6536\u52a0\u901f\u6210\u9577\nc5 = rev / rev.shift(1) &gt; 0.9                                   # \u71df\u6536\u6708\u589e\u7387 &gt; -10%\n\nexits = close &lt; close.average(20)\n\nconditions = {'c1': c1, 'c2': c2, 'c3': c3, 'c4': c4, 'c5': c5}\n\nreport_collection = sim_conditions(\n    conditions=conditions,\n    hold_until={'exit': exits, 'stop_loss': 0.1},\n    resample='M',\n    position_limit=0.1,\n    upload=False\n)\n\n# \u67e5\u770b\u71b1\u529b\u5716,\u5feb\u901f\u627e\u51fa\u6700\u4f73\u7d44\u5408\nreport_collection.plot_stats('heatmap')\n</code></pre>"}, {"location": "details/optimize_strategy/#_8", "title": "\u7d50\u679c\u89e3\u8b80\u7bc4\u4f8b", "text": "<p>\u5047\u8a2d\u71b1\u529b\u5716\u986f\u793a <code>c1 &amp; c3 &amp; c4</code> \u7d44\u5408\u7684 avg_score \u6700\u9ad8:</p> <ol> <li>\u6aa2\u8996\u7d2f\u7a4d\u5831\u916c\u66f2\u7dda: \u78ba\u8a8d\u6de8\u503c\u6210\u9577\u662f\u5426\u7a69\u5b9a</li> <li>\u6aa2\u67e5\u95dc\u9375\u6307\u6a19:</li> <li>\u590f\u666e\u7387 &gt; 1.5? (\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c\u662f\u5426\u8db3\u5920)</li> <li>\u6700\u5927\u56de\u64a4 &lt; -30%? (\u6700\u5dee\u60c5\u6cc1\u80fd\u5426\u627f\u53d7)</li> <li>\u52dd\u7387 &gt; 50%? (\u4ea4\u6613\u52dd\u7387\u662f\u5426\u5408\u7406)</li> <li>\u5206\u6790\u7d44\u5408\u610f\u7fa9: <code>c1 &amp; c3 &amp; c4</code> \u4ee3\u8868\u300c\u6280\u8853\u9762\u7a81\u7834 + \u4f30\u503c\u4fbf\u5b9c + \u71df\u6536\u6210\u9577\u300d,\u9019\u500b\u7d44\u5408\u6709\u5176\u5546\u696d\u908f\u8f2f</li> </ol>"}, {"location": "details/optimize_strategy/#_9", "title": "\u81ea\u8a02\u8981\u986f\u793a\u7684\u6307\u6a19", "text": "<p>\u5982\u679c\u53ea\u95dc\u5fc3\u7279\u5b9a\u6307\u6a19,\u53ef\u4ee5\u4f7f\u7528 <code>indicators</code> \u53c3\u6578:</p> <pre><code># \u53ea\u986f\u793a\u5831\u916c\u7387\u3001\u590f\u666e\u7387\u3001\u6700\u5927\u56de\u64a4\nreport_collection.plot_stats('bar', indicators=['daily_mean', 'daily_sharpe', 'max_drawdown']).show()\n\n# \u71b1\u529b\u5716\u4ee5\u590f\u666e\u7387\u6392\u5e8f\nreport_collection.plot_stats('heatmap', heatmap_sort_by='daily_sharpe')\n\n# \u71b1\u529b\u5716\u4ee5\u591a\u500b\u6307\u6a19\u6392\u5e8f\nreport_collection.plot_stats('heatmap', heatmap_sort_by=['daily_sharpe', 'win_ratio'])\n</code></pre>"}, {"location": "details/optimize_strategy/#_10", "title": "\u7d50\u5408\u505c\u640d\u505c\u5229\u512a\u5316", "text": "<p><code>sim_conditions()</code> \u7684 <code>hold_until</code> \u53c3\u6578\u652f\u63f4\u591a\u7a2e\u51fa\u5834\u908f\u8f2f:</p> <pre><code># 1. \u50c5\u8a2d\u5b9a\u51fa\u5834\u8a0a\u865f\nhold_until = {'exit': exits}\n\n# 2. \u51fa\u5834\u8a0a\u865f + \u505c\u640d\nhold_until = {'exit': exits, 'stop_loss': 0.1}\n\n# 3. \u51fa\u5834\u8a0a\u865f + \u505c\u5229\nhold_until = {'exit': exits, 'take_profit': 0.2}\n\n# 4. \u51fa\u5834\u8a0a\u865f + \u505c\u640d + \u505c\u5229\nhold_until = {'exit': exits, 'stop_loss': 0.1, 'take_profit': 0.2}\n\n# 5. \u51fa\u5834\u8a0a\u865f + \u505c\u640d\uff08\u79fb\u52d5\u505c\u5229\u9700\u5728 sim() \u4e2d\u8a2d\u5b9a trail_stop\uff09\nhold_until = {'exit': exits, 'stop_loss': 0.1}\n# \u642d\u914d: sim_conditions(..., trail_stop=0.15)\n</code></pre> <p>\u505c\u640d\u505c\u5229\u8a2d\u5b9a\u5efa\u8b70</p> <ol> <li>\u5148\u57f7\u884c <code>report.display_mae_mfe_analysis()</code> \u5206\u6790\u6ce2\u52d5\u7279\u6027</li> <li>\u6839\u64da MAE \u5206\u5e03\u8a2d\u5b9a\u505c\u640d\u9ede(\u907f\u514d\u904e\u5ea6\u505c\u640d)</li> <li>\u6839\u64da MFE \u5206\u5e03\u8a2d\u5b9a\u505c\u5229\u9ede(\u78ba\u4fdd\u7372\u5229\u80fd\u5be6\u73fe)</li> <li>\u4f7f\u7528 <code>sim_conditions()</code> \u6e2c\u8a66\u4e0d\u540c\u505c\u640d\u505c\u5229\u7d44\u5408\u7684\u6548\u679c</li> </ol>"}, {"location": "details/optimize_strategy/#_11", "title": "\u5e38\u898b\u554f\u984c\u8207\u6700\u4f73\u5be6\u8e10", "text": ""}, {"location": "details/optimize_strategy/#q1", "title": "Q1: \u7d44\u5408\u592a\u591a\u5c0e\u81f4\u904b\u7b97\u6642\u9593\u904e\u9577?", "text": "<p>\u7576\u689d\u4ef6\u6578\u91cf &gt; 6 \u6642,\u7d44\u5408\u6578\u6703\u8d85\u904e 63 \u7a2e\u3002\u5efa\u8b70:</p> <ol> <li>\u5148\u7be9\u9078\u91cd\u8981\u689d\u4ef6: \u4f7f\u7528\u55ae\u4e00\u689d\u4ef6\u56de\u6e2c,\u79fb\u9664\u7e3e\u6548\u904e\u5dee\u7684\u689d\u4ef6</li> <li>\u5206\u6279\u6e2c\u8a66: \u5c07\u689d\u4ef6\u5206\u6210\u6280\u8853\u9762\u3001\u57fa\u672c\u9762\u3001\u7c4c\u78bc\u9762\u5206\u5225\u512a\u5316</li> <li>\u4f7f\u7528\u66f4\u9577\u7684 resample: \u6539\u7528 <code>resample='Q'</code>(\u5b63\u5ea6)\u6e1b\u5c11\u8a08\u7b97\u91cf</li> </ol>"}, {"location": "details/optimize_strategy/#q2-overfitting", "title": "Q2: \u5982\u4f55\u907f\u514d\u904e\u5ea6\u914d\u9069(overfitting)?", "text": "<ol> <li>\u6a23\u672c\u5916\u6e2c\u8a66: \u4f7f\u7528\u6b77\u53f2\u8cc7\u6599\u512a\u5316,\u7528\u6700\u8fd1\u8cc7\u6599\u9a57\u8b49</li> <li>\u907f\u514d\u689d\u4ef6\u904e\u591a: \u689d\u4ef6\u6578 &gt; 5 \u6642\u8981\u7279\u5225\u5c0f\u5fc3</li> <li>\u6aa2\u67e5\u7d44\u5408\u908f\u8f2f: \u6700\u4f73\u7d44\u5408\u662f\u5426\u6709\u5546\u696d\u908f\u8f2f\u652f\u6490?</li> <li>\u591a\u500b\u6307\u6a19\u7d9c\u5408\u8a55\u4f30: \u4e0d\u8981\u53ea\u770b\u5831\u916c\u7387,\u4e5f\u8981\u770b\u590f\u666e\u7387\u3001\u56de\u64a4\u3001\u52dd\u7387</li> </ol>"}, {"location": "details/optimize_strategy/#q3", "title": "Q3: \u689d\u4ef6\u7684\u8cc7\u6599\u983b\u7387\u4e0d\u4e00\u81f4\u600e\u9ebc\u8fa6?", "text": "<p>FinLab \u6703\u81ea\u52d5\u5c0d\u9f4a\u8cc7\u6599\u983b\u7387:</p> <pre><code># \u65e5\u8cc7\u6599\nclose = data.get(\"price:\u6536\u76e4\u50f9\")  # \u6bcf\u65e5\u66f4\u65b0\n\n# \u6708\u8cc7\u6599\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')  # \u6bcf\u6708\u66f4\u65b0\n\n# \u5b63\u8cc7\u6599\neps = data.get('financial_statement:\u6bcf\u80a1\u76c8\u9918')  # \u6bcf\u5b63\u66f4\u65b0\n\n# \u6df7\u5408\u4f7f\u7528\u6c92\u554f\u984c,FinLab \u6703\u81ea\u52d5 forward fill\nconditions = {\n    'c1': close &gt; close.average(20),\n    'c2': rev.average(3) &gt; rev.average(12),\n    'c3': eps &gt; 0\n}\n</code></pre>"}, {"location": "details/optimize_strategy/#q4", "title": "Q4: \u70ba\u4ec0\u9ebc\u67d0\u4e9b\u7d44\u5408\u56de\u6e2c\u5931\u6557?", "text": "<p>\u53ef\u80fd\u539f\u56e0:</p> <ol> <li>\u689d\u4ef6\u904e\u56b4\u683c: \u4ea4\u96c6\u5f8c\u6c92\u6709\u4efb\u4f55\u80a1\u7968\u7b26\u5408</li> <li>\u8cc7\u6599\u7f3a\u5931: \u67d0\u4e9b\u689d\u4ef6\u7684\u8cc7\u6599\u7bc4\u570d\u4e0d\u8db3</li> <li>\u8a18\u61b6\u9ad4\u4e0d\u8db3: \u689d\u4ef6\u7d44\u5408\u904e\u591a\u5c0e\u81f4 OOM</li> </ol> <p>\u53ef\u5f9e log \u4e2d\u67e5\u770b\u5177\u9ad4\u932f\u8aa4\u8a0a\u606f\u3002</p>"}, {"location": "details/optimize_strategy/#q5", "title": "Q5: \u5982\u4f55\u5b58\u53d6\u7279\u5b9a\u7d44\u5408\u7684\u56de\u6e2c\u5831\u544a?", "text": "<pre><code># report_collection.reports \u662f\u4e00\u500b dict\nprint(report_collection.reports.keys())\n# \u8f38\u51fa: dict_keys(['c1', 'c2', 'c3', 'c1 &amp; c2', 'c1 &amp; c3', ...])\n\n# \u53d6\u5f97\u7279\u5b9a\u7d44\u5408\u7684\u5831\u544a\nreport = report_collection.reports['c1 &amp; c3']\nreport.display()\n</code></pre>"}, {"location": "details/optimize_strategy/#_12", "title": "\u5be6\u6230\u5de5\u4f5c\u6d41\u7a0b\u5efa\u8b70", "text": "<ol> <li>\u5b9a\u7fa9\u5019\u9078\u689d\u4ef6 (5-8 \u500b)</li> <li>\u55ae\u4e00\u689d\u4ef6\u56de\u6e2c: \u78ba\u8a8d\u6bcf\u500b\u689d\u4ef6\u90fd\u6709\u57fa\u672c\u7e3e\u6548</li> <li>\u4f7f\u7528 <code>sim_conditions()</code>: \u6e2c\u8a66\u6240\u6709\u7d44\u5408</li> <li>\u8996\u89ba\u5316\u5206\u6790:</li> <li>\u7528\u71b1\u529b\u5716\u627e\u51fa top 3 \u7d44\u5408</li> <li>\u7528\u6298\u7dda\u5716\u78ba\u8a8d\u6de8\u503c\u7a69\u5b9a\u6027</li> <li>\u7528\u68d2\u72c0\u5716\u6bd4\u8f03\u95dc\u9375\u6307\u6a19</li> <li>\u6df1\u5165\u5206\u6790 top 3:</li> <li>\u57f7\u884c MAE/MFE \u5206\u6790</li> <li>\u6aa2\u67e5\u6d41\u52d5\u6027\u98a8\u96aa</li> <li>\u57f7\u884c\u6a23\u672c\u5916\u6e2c\u8a66</li> <li>\u9078\u64c7\u6700\u7d42\u7b56\u7565: \u7d9c\u5408\u8003\u91cf\u7e3e\u6548\u3001\u98a8\u96aa\u3001\u908f\u8f2f\u6027</li> </ol>"}, {"location": "details/optimize_strategy/#_13", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>finlab.optimize API Reference</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u8a0a\u865f\u9032\u51fa\u5834\u8a9e\u6cd5\u7cd6</li> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> </ul>"}, {"location": "details/order_api/", "title": "\u4e0b\u55ae(\u55ae\u7b56\u7565)", "text": ""}, {"location": "details/order_api/#_1", "title": "\u57f7\u884c\u4ea4\u6613\u7b56\u7565", "text": "<p>\u76ee\u524d\u4ea4\u6613\u7cfb\u7d71\u50c5\u652f\u63f4 <code>finlab&gt;=0.3.0.dev1</code> \u7248\u672c\u3002\u5728\u4e0b\u55ae\u524d\uff0c\u8acb\u5148\u78ba\u8a8d\u5b89\u88dd\u4e86\u65b0\u7248\u7684 Package \u5594\uff01 \u9996\u5148\uff0c\u5728\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5\u958b\u76e4\u524d\uff0c\u57f7\u884c\u7b56\u7565\uff1a <pre><code>from finlab import backtest\n\n# write your own strategy\n\nreport = backtest.sim(...)\n</code></pre></p>"}, {"location": "details/order_api/#_2", "title": "\u8a08\u7b97\u80a1\u7968\u5f35\u6578", "text": "<p>\u63a5\u4e0b\u4f86\uff0c\u986f\u793a\u6700\u8fd1\u7684\u90e8\u4f4d</p> <pre><code>print(report.current_trades)\n</code></pre> stock_id entry_date exit_date entry_sig_date exit_sig_date position period entry_index exit_index return entry_price exit_price mae gmfe bmfe mdd pdays next_weights 1416 \u5ee3\u8c50 2021-10-01 NaT 2021-09-30 2022-06-30 0.510197 159.0 3566.0 -1.0 -3.539823e-02 10.60 NaN -0.053097 0.070796 0.070796 -0.115702 37.0 0.060665 1453 \u5927\u5c07 2021-10-01 NaT 2021-09-30 2022-06-30 0.510197 159.0 3566.0 -1.0 2.348165e+00 8.43 NaN -0.086763 2.403782 0.245829 -0.624585 60.0 0.171264 1524 \u803f\u9f0e 2022-04-01 NaT 2022-03-31 2022-06-30 0.611632 39.0 3686.0 -1.0 -3.330669e-16 10.60 NaN -0.476658 0.015152 0.000000 -0.476658 2.0 0.122168 2543 \u7687\u660c 2021-10-01 NaT 2021-09-30 NaT 0.510197 159.0 3566.0 -1.0 1.073232e-01 7.46 NaN -0.063131 0.363636 0.008838 -0.268519 44.0 0.070298 2701 \u842c\u4f01 2022-04-01 NaT 2022-03-31 2022-06-30 0.611632 39.0 3686.0 -1.0 -3.330669e-16 12.05 NaN -0.025105 0.029289 0.029289 -0.052846 18.0 0.063107 <p>\u5047\u5982\u78ba\u8a8d\u6c92\u554f\u984c\uff0c\u53ef\u4ee5\u8a08\u7b97\u6bcf\u6a94\u80a1\u7968\u6295\u8cc7\u7684\u5f35\u6578\uff1a</p> <p><pre><code>from finlab.online.order_executor import Position\n\n# total fund\nfund = 1000000\nposition = Position.from_report(report, fund)\nprint(position)\n</code></pre> \u53ef\u4ee5\u7522\u751f\u51fa\u4ee5\u4e0b\u7d50\u679c <pre><code>[{'stock_id': '2330', 'quantity': 1, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}]\n</code></pre></p> <p>\u4e0a\u8ff0 <code>Position</code> \u4ee3\u8868\u60a8\u7684\u5e33\u6236\u4e2d\uff0c\u53ea\u5e0c\u671b\u6709\u4e00\u5f35 <code>2330</code> \u53f0\u7a4d\u96fb\u80a1\u7968\uff0c\u4e26\u4e14\u662f\u73fe\u8ca8\u3002</p>"}, {"location": "details/order_api/#_3", "title": "\u9032\u968e\u90e8\u4f4d\u8abf\u6574", "text": ""}, {"location": "details/order_api/#_4", "title": "\u96f6\u80a1\u4ea4\u6613", "text": "<p>\u6b32\u4f7f\u7528\u96f6\u80a1\u90e8\u4f4d\uff0c\u53ea\u8981\u5c07\u4e0a\u8ff0\u7a0b\u5f0f\u78bc\u505a\u4ee5\u4e0b\u4fee\u6539\u5373\u53ef\uff1a</p> <pre><code># \u6574\u80a1\nposition = Position.from_report(report, fund)\n\n# \u96f6\u80a1\nposition = Position.from_report(report, fund, odd_lot=True)\n</code></pre>"}, {"location": "details/order_api/#_5", "title": "\u5ba2\u88fd\u5316\u90e8\u4f4d\u5f35\u6578", "text": "<p>\u4e0a\u8ff0\u65b9\u6cd5\u4f7f\u7528 <code>Position.from_report</code> \u4f86\u5efa\u69cb\u90e8\u4f4d\uff0c\u5176\u5be6\u6211\u5011\u4e5f\u53ef\u4ee5\u55ae\u7d14\u7528\u5f88\u76f4\u89ba\u7684\u65b9\u5f0f\u5efa\u69cb\u60f3\u8981\u518d\u5e73\u8861\u7684\u90e8\u4f4d\uff1a</p> <p><pre><code>position = Position({'2330': 1, '1101': 1.001})\n</code></pre> \u53ef\u4ee5\u7522\u751f\u51fa\u4ee5\u4e0b\u7d50\u679c <pre><code>[{'stock_id': '2330', 'quantity': 1, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}\n {'stock_id': '1101', 'quantity': 1.001, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}]\n</code></pre></p>"}, {"location": "details/order_api/#_6", "title": "\u90e8\u4f4d\u589e\u6e1b\u8abf\u6574", "text": "<p><code>Position</code> \u662f\u53ef\u4ee5\u76f8\u52a0\u6e1b\u7684\uff0c\u6211\u5011\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u6cd5\u8abf\u6574\u90e8\u4f4d\u5927\u5c0f</p> <pre><code># \u6e1b\u4e00\u5f35 2330 \u80a1\u7968\nnew_position = position - Position({'2330': 1})\n# \u589e\u52a0\u4e00\u5f35 1101 \u80a1\u7968\nnew_position = position + Position({'1101': 1})\n</code></pre>"}, {"location": "details/order_api/#_7", "title": "\u591a\u7b56\u7565\u6b0a\u91cd\u52a0\u7e3d", "text": "<p>\u5047\u5982\u6211\u5011\u6709\u591a\u500b position\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u5f0f\u52a0\u7e3d\uff1a <pre><code>from finlab import backtest\nfrom finlab.online.order_executor import Position\n\nreport1 = backtest.sim(...)\nreport2 = backtest.sim(...)\n\nposition1 = Position.from_report(report1, 1000000) # \u7b56\u7565\u64cd\u4f5c\u91d1\u984d\u4e00\u767e\u842c\nposition2 = Position.from_report(report2, 1000000) # \u7b56\u7565\u64cd\u4f5c\u91d1\u984d\u4e00\u767e\u842c\n\ntotal_position = position1 + position2\n</code></pre></p>"}, {"location": "details/order_api/#_8", "title": "\u5be6\u969b\u4e0b\u55ae", "text": ""}, {"location": "details/order_api/#1-api", "title": "1. \u5b89\u88dd\u5238\u5546 API", "text": "<p>\u76ee\u524d\u652f\u63f4 <code>\u7389\u5c71\u8b49\u5238</code>\u3001<code>\u6c38\u8c50\u8b49\u5238</code>\u3001<code>\u5143\u5bcc\u8b49\u5238</code> \u53ca <code>\u5bcc\u90a6\u8b49\u5238</code> \u7684\u4e0b\u55ae\u7cfb\u7d71\uff0c\u64c7\u4e00\u4f7f\u7528\u5373\u53ef\u3002 <pre><code># \u7389\u5c71\u8b49\u5238\npip install esun-trade\n\n# \u6c38\u8c50\npip install shioaji\n</code></pre></p>"}, {"location": "details/order_api/#2", "title": "2. \u9023\u63a5\u8b49\u5238\u5e33\u6236", "text": "<p>\u76ee\u524d\u652f\u63f4 <code>\u7389\u5c71\u8b49\u5238</code>\u3001<code>\u6c38\u8c50\u8b49\u5238</code>\u3001<code>\u5143\u5bcc\u8b49\u5238</code> \u4ee5\u53ca <code>\u5bcc\u90a6\u8b49\u5238</code> \u7684\u4e0b\u55ae\u7cfb\u7d71\u3002\u53ef\u4ee5\u5148\u5c07\u5e33\u865f\u5bc6\u78bc\u8a2d\u5b9a\u6210\u74b0\u5883\u8b8a\u6578\uff0c\u53ea\u8981\u91dd\u5c0d\u60a8\u9700\u8981\u7684\u5238\u5546\u4f86\u8a2d\u5b9a\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u591a\u500b\u5238\u5546\u540c\u6642\u4e32\u63a5\u3002</p> <p>\u9078\u64c7\u60a8\u7684\u5238\u5546</p> \u7389\u5c71\u8b49\u5238\u6c38\u8c50\u8b49\u5238\u5143\u5bcc\u8b49\u5238\u5bcc\u90a6\u8b49\u5238 <p></p> <ul> <li>\u8acb\u5148\u6309\u7167config \u6559\u5b78\u7372\u53d6 config \u8a2d\u5b9a\u6a94\u3002</li> <li>\u4e26\u5230\u767b\u5165\u7389\u5c71\u8b49\u5238API\uff0c\u7372\u5f97\u5e02\u5834\u884c\u60c5 Token\u3002</li> </ul> <pre><code>from finlab.online.esun_account import EsunAccount\nimport os\nos.environ['ESUN_CONFIG_PATH'] = '\u7389\u5c71\u8b49\u5238\u4ea4\u6613\u8a2d\u5b9a\u6a94(config.ini.example)\u8def\u5f91'\nos.environ['ESUN_MARKET_API_KEY'] = '\u7389\u5c71\u8b49\u5238\u7684\u884c\u60c5API Token'\nos.environ['ESUN_ACCOUNT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u5e33\u865f\u5bc6\u78bc'\nos.environ['ESUN_CERT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u6191\u8b49\u5bc6\u78bc'\n\nacc = EsunAccount()\n</code></pre> \u820a\u7248 Fugle \u74b0\u5883\u8b8a\u6578\uff08\u4ecd\u53ef\u4f7f\u7528\uff09 <pre><code>from finlab.online.fugle_account import FugleAccount\nimport os\nos.environ['FUGLE_CONFIG_PATH'] = '\u7389\u5c71\u8b49\u5238\u4ea4\u6613\u8a2d\u5b9a\u6a94(config.ini.example)\u8def\u5f91'\nos.environ['FUGLE_MARKET_API_KEY'] = '\u7389\u5c71\u8b49\u5238\u7684\u884c\u60c5API Token'\nos.environ['FUGLE_ACCOUNT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u5e33\u865f\u5bc6\u78bc'\nos.environ['FUGLE_CERT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u6191\u8b49\u5bc6\u78bc'\n\nacc = FugleAccount()\n</code></pre> <p>\u5047\u5982\u4f7f\u7528\u4e2d\u4e0b\u55ae\u51fa\u73fe\u932f\u8aa4\u4ee3\u78bc\uff0c\u53ef\u4ee5\u5230\u7389\u5c71\u8b49\u5238\u6587\u4ef6 \u4f86\u67e5\u627e\u539f\u56e0\u3002\u5047\u5982\u5c0d\u65bc Finlab Package \u4e0b\u55ae\u4e0d\u719f\u7fd2\uff0c\u5efa\u8b70\u4e5f\u53ef\u4ee5\u5148\u6309\u7167\u5238\u5546\u7684\u6559\u5b78\u4f86\u7df4\u7fd2\uff0c\u5047\u5982\u4e32\u63a5\u6210\u529f\uff0c\u5247 FinLab Package \u7684\u4e32\u63a5\u4e5f\u5c31\u662f\u5982\u6cd5\u70ae\u88fd\u7684\u8a2d\u5b9a\u56c9\uff01</p> <p></p> <ul> <li> <p>\u8acb\u5148\u7372\u53d6\u6191\u8b49</p> <ul> <li>Windows \u6191\u8b49\u4e0b\u8f09\u65b9\u5f0f</li> <li>MacOS \u6191\u8b49\u4e0b\u8f09\uff1a\u76ee\u524d\u6c38\u8c50\u96d6\u652f\u63f4 MacOS \u4e0b\u55ae\uff0c\u4f46\u4e26\u4e0d\u652f\u63f4\u7528 MacOS \u7372\u53d6\u6191\u8b49\uff0c\u53ef\u4ee5\u5148\u627e\u4e00\u53f0 Windows \u4f5c\u696d\u7cfb\u7d71\uff0c\u4e26\u4e14\u4f7f\u7528\u4e0a\u8ff0\u65b9\u6cd5\u7372\u53d6\u6191\u8b49\u5f8c\uff0c\u518d\u5c07\u6191\u8b49\u65bc MacOS \u4f86\u4f7f\u7528\u3002</li> </ul> </li> </ul> <p><pre><code>import os\nfrom finlab.online.sinopac_account import SinopacAccount\n\nos.environ['SHIOAJI_API_KEY'] = '\u6c38\u8c50\u8b49\u5238API_KEY'\nos.environ['SHIOAJI_SECRET_KEY'] = '\u6c38\u8c50\u8b49\u5238SECRET_KEY'\nos.environ['SHIOAJI_CERT_PERSON_ID']= '\u8eab\u4efd\u8b49\u5b57\u865f'\nos.environ['SHIOAJI_CERT_PATH']= '\u6c38\u8c50\u8b49\u5238\u6191\u8b49\u8def\u5f91'\nos.environ['SHIOAJI_CERT_PASSWORD'] = '\u6c38\u8c50\u8b49\u5238\u6191\u8b49\u5bc6\u78bc' # \u9810\u8a2d\u8207\u8eab\u4efd\u8b49\u5b57\u865f\n\nacc = SinopacAccount()\n</code></pre> \u5047\u5982\u5c0d\u65bc Finlab Package \u4e0b\u55ae\u4e0d\u719f\u7fd2\uff0c\u5efa\u8b70\u4e5f\u53ef\u4ee5\u5148\u6309\u7167 \u5238\u5546\u7684\u6559\u5b78 \u4f86\u7df4\u7fd2\uff0c\u5047\u5982\u4e32\u63a5\u6210\u529f\uff0c\u5247 FinLab Package \u7684\u4e32\u63a5\u5c31\u6703\u975e\u5e38\u7c21\u55ae\u56c9\uff01</p> <p>\u8acb\u53c3\u8003\u5143\u5bcc\u8b49\u5238\u7684\u6559\u5b78 \u4f86\u7372\u53d6\u6191\u8b49\uff0c\u4e26\u4e14\u5c07\u6191\u8b49\u653e\u5728\u76f8\u5c0d\u61c9\u7684\u8def\u5f91\u4e4b\u4e2d\uff0c\u4e26\u4e14\u5b89\u88dd\u76f8\u5c0d\u61c9\u7684\u5957\u4ef6\u5f8c\uff0c\u5373\u53ef\u57f7\u884c\uff1a</p> <pre><code>import os\nfrom finlab.online.masterlink_account import MasterlinkAccount\n\nos.environ['MASTERLINK_NATIONAL_ID'] = '\u8eab\u5206\u8b49\u5b57\u865f'\nos.environ['MASTERLINK_ACCOUNT'] = '\u4ea4\u6613\u5e33\u865f'\nos.environ['MASTERLINK_ACCOUNT_PASS'] = '\u5bc6\u78bc'\nos.environ['MASTERLINK_CERT_PATH'] = '\u5143\u5bcc\u8b49\u5238\u6191\u8b49\u8def\u5f91'\nos.environ['MASTERLINK_CERT_PASS'] = '\u5143\u5bcc\u8b49\u5238\u6191\u8b49\u5bc6\u78bc' # \u9810\u8a2d\u8207\u8eab\u5206\u8b49\u5b57\u865f\n\nacc = MasterlinkAccount()\n</code></pre> <p>\u5373\u53ef\u5b8c\u6210\u8a2d\u5b9a\uff01</p> <p>\u8acb\u53c3\u8003\u5bcc\u90a6\u8b49\u5238\u7684\u6559\u5b78 \u4f86\u7372\u53d6\u6191\u8b49\uff0c\u4e26\u4e14\u5c07\u6191\u8b49\u653e\u5728\u76f8\u5c0d\u61c9\u7684\u8def\u5f91\u4e4b\u4e2d\uff0c\u4e26\u4e14\u5b89\u88dd\u76f8\u5c0d\u61c9\u7684\u5957\u4ef6\u5f8c\uff0c\u5373\u53ef\u57f7\u884c\uff1a</p> <pre><code>import os\nfrom fubon_account import FubonAccount\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\nimport os\n\nos.environ['FUBON_NATIONAL_ID'] = \"A123456789\"\nos.environ['FUBON_ACCOUNT_PASS'] = \"your_password\"\nos.environ['FUBON_CERT_PATH'] = \"/path/to/cert.pfx\"\n\n\naccount = FubonAccount()\n</code></pre> <p>\u5373\u53ef\u5b8c\u6210\u8a2d\u5b9a\uff01</p>"}, {"location": "details/order_api/#3", "title": "3. \u6279\u6b21\u4e0b\u55ae", "text": "<p>\u6700\u5f8c\u5229\u7528 <code>OrderExecuter</code> \u5c07\u7576\u8b49\u5238\u5e33\u6236\u7684\u90e8\u4f4d\uff0c\u6309\u7167 <code>position</code> \u7684\u90e8\u4f4d\u9032\u884c\u8abf\u6574\u3002</p> <pre><code>from finlab.online.order_executor import OrderExecutor\n\n# Order Executer\norder_executer = OrderExecutor(position , account=acc)\n</code></pre> <p>\u82e5\u4e0b\u55ae\u90e8\u4f4d\u542b\u6709\u300c \u5168\u984d\u4ea4\u5272\u80a1\u300d\u3001\u300c\u8655\u7f6e\u80a1\u300d\u3001\u300c\u8b66\u793a\u80a1\u300d\uff0c\u9700\u5148\u65bc\u8b49\u5238\u5e33\u6236\u5708\u5b58\u3002\u53c3\u8003\u5bcc\u679c\u5708\u5b58\u3001\u6c38\u8c50\u5708\u5b58\u65b9\u5f0f\u3002</p> <pre><code># \u986f\u793a\u4e0b\u55ae\u90e8\u4f4d\u662f\u5426\u6709\u8b66\u793a\u80a1\u53ca\u76f8\u95dc\u8cc7\u8a0a\norder_executer.show_alerting_stocks()\n</code></pre> <p><pre><code>\u8cb7\u5165 8101 0.429 \u5f35 - \u7e3d\u50f9\u7d04         2672.67\n</code></pre> \u6839\u64da<code>show_alerting_stocks</code>\u986f\u793a\u7d50\u679c\u9032\u884c\u5708\u5b58\u5f8c\uff0c\u5373\u53ef\u7e7c\u7e8c\u57f7\u884c\u4e0b\u55ae\u3002</p> <pre><code># \u4e0b\u55ae\u6aa2\u67e5\uff08\u700f\u89bd\u6a21\u5f0f\uff0c\u4e0d\u6703\u771f\u7684\u4e0b\u55ae\uff09\norder_executer.create_orders(view_only=True)\n\n# \u57f7\u884c\u4e0b\u55ae\uff08\u6703\u771f\u7684\u4e0b\u55ae\uff0c\u521d\u6b21\u4f7f\u7528\u5efa\u8b70\u6536\u5e02\u6642\u6e2c\u8a66\uff09\n# \u9810\u8a2d\u4f7f\u7528\u6700\u8fd1\u4e00\u7b46\u6210\u4ea4\u50f9\u7576\u6210\u9650\u50f9\norder_executer.create_orders()\n\n# \u66f4\u65b0\u9650\u50f9\uff08\u5c07\u6700\u5f8c\u4e00\u7b46\u6210\u4ea4\u50f9\u7576\u6210\u65b0\u7684\u9650\u50f9\uff09\norder_executer.update_order_price()\n\n# \u522a\u9664\u6240\u6709\u59d4\u8a17\u55ae\norder_executer.cancel_orders()\n</code></pre>"}, {"location": "details/order_api/#_9", "title": "\u67e5\u770b\u5e33\u6236\u90e8\u4f4d", "text": "<p>\u4e0d\u8ad6\u662f\u6c38\u8c50\u9084\u662f\u7389\u5c71\u8b49\u5238\u5e33\u6236\uff0c\u90fd\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u5f0f\u67e5\u627e\u5e33\u6236\u7684\u90e8\u4f4d</p> <p><pre><code># \u9078\u64c7\u6b32\u4f7f\u7528\u7684\u5238\u5546(\u64c7\u4e00\u5373\u53ef)\n\n# \u6c38\u8c50\nfrom finlab.online.sinopac_account import SinopacAccount\nacc = SinopacAccount()\n\n# \u7389\u5c71\u8b49\u5238\nfrom finlab.online.esun_account import EsunAccount\nacc = EsunAccount()\n\n# \u6216\u4f7f\u7528\u820a\u7248\u540d\u7a31\uff08\u4ecd\u53ef\u4f7f\u7528\uff09\n# from finlab.online.fugle_account import FugleAccount\n# acc = FugleAccount()\n\nprint(acc.get_position())\n</code></pre> \u53ef\u4ee5\u5370\u51fa\u4ee5\u4e0b\u7d50\u679c <pre><code>[{'stock_id': '2330', 'quantity': 1, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}\n {'stock_id': '1101', 'quantity': 1.001, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}]\n</code></pre></p>"}, {"location": "details/order_api/#_10", "title": "\u5e38\u898b\u932f\u8aa4\u8207\u89e3\u6c7a\u65b9\u6cd5", "text": "<p>\u26a0\ufe0f \u91cd\u8981\u98a8\u96aa\u8b66\u544a</p> <p>\u5be6\u76e4\u4ea4\u6613\u6d89\u53ca\u771f\u5be6\u91d1\u9322\uff0c\u932f\u8aa4\u53ef\u80fd\u5c0e\u81f4\u8ca1\u52d9\u640d\u5931\uff01</p> <p>\u4e0b\u55ae\u524d\u52d9\u5fc5\u6aa2\u67e5\uff1a 1. \u2705 \u5148\u5728\u6a21\u64ec\u5e33\u6236\u6e2c\u8a66\u81f3\u5c11 1 \u9031 2. \u2705 \u521d\u671f\u8cc7\u91d1\u4e0d\u8d85\u904e\u7e3d\u8cc7\u91d1\u7684 10-20% 3. \u2705 \u4f7f\u7528 <code>view_only=True</code> \u9810\u89bd\u8a02\u55ae 4. \u2705 \u6bcf\u65e5\u76e3\u63a7\u6301\u5009\u8207\u8a02\u55ae\u72c0\u614b 5. \u2705 \u8a2d\u5b9a\u505c\u640d\u6a5f\u5236\uff0c\u907f\u514d\u55ae\u6b21\u5de8\u5927\u8667\u640d</p>"}, {"location": "details/order_api/#1", "title": "\u932f\u8aa4 1\uff1a\u5e33\u6236\u9023\u7dda\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u57f7\u884c <code>acc = SinopacAccount()</code> \u6216 <code>acc = EsunAccount()</code> \u6642\u62cb\u51fa\u9023\u7dda\u932f\u8aa4</p> <pre><code>from finlab.online.sinopac_account import SinopacAccount\nacc = SinopacAccount()\n# ConnectionError: \u7121\u6cd5\u9023\u7dda\u81f3\u5238\u5546 API\n</code></pre> <p>\u539f\u56e0\uff1a - \u74b0\u5883\u8b8a\u6578\u672a\u6b63\u78ba\u8a2d\u5b9a\uff08API KEY\u3001\u6191\u8b49\u8def\u5f91\u7b49\uff09 - \u6191\u8b49\u6a94\u6848\u4e0d\u5b58\u5728\u6216\u8def\u5f91\u932f\u8aa4 - \u6191\u8b49\u5bc6\u78bc\u932f\u8aa4 - \u7db2\u8def\u9023\u7dda\u554f\u984c\u6216\u5238\u5546 API \u670d\u52d9\u66ab\u505c</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>import os\nfrom finlab.online.sinopac_account import SinopacAccount\n\n# \u6b65\u9a5f 1\uff1a\u6aa2\u67e5\u74b0\u5883\u8b8a\u6578\u662f\u5426\u8a2d\u5b9a\nrequired_env_vars = [\n    'SHIOAJI_API_KEY',\n    'SHIOAJI_SECRET_KEY',\n    'SHIOAJI_CERT_PERSON_ID',\n    'SHIOAJI_CERT_PATH',\n    'SHIOAJI_CERT_PASSWORD'\n]\n\nprint(\"=== \u74b0\u5883\u8b8a\u6578\u6aa2\u67e5 ===\")\nfor var in required_env_vars:\n    value = os.environ.get(var)\n    if value:\n        # \u96b1\u85cf\u654f\u611f\u8cc7\u8a0a\n        if 'KEY' in var or 'PASSWORD' in var:\n            print(f\"\u2705 {var}: {'*' * 8} (\u5df2\u8a2d\u5b9a)\")\n        else:\n            print(f\"\u2705 {var}: {value}\")\n    else:\n        print(f\"\u274c {var}: \u672a\u8a2d\u5b9a\")\n\n# \u6b65\u9a5f 2\uff1a\u6aa2\u67e5\u6191\u8b49\u6a94\u6848\u662f\u5426\u5b58\u5728\ncert_path = os.environ.get('SHIOAJI_CERT_PATH')\nif cert_path and os.path.exists(cert_path):\n    print(f\"\\n\u2705 \u6191\u8b49\u6a94\u6848\u5b58\u5728\uff1a{cert_path}\")\nelse:\n    print(f\"\\n\u274c \u6191\u8b49\u6a94\u6848\u4e0d\u5b58\u5728\uff1a{cert_path}\")\n    print(\"\u8acb\u78ba\u8a8d\u6191\u8b49\u8def\u5f91\u662f\u5426\u6b63\u78ba\")\n    exit(1)\n\n# \u6b65\u9a5f 3\uff1a\u5617\u8a66\u9023\u7dda\u4e26\u6355\u6349\u932f\u8aa4\ntry:\n    acc = SinopacAccount()\n    print(\"\\n\u2705 \u5e33\u6236\u9023\u7dda\u6210\u529f\")\n\n    # \u9a57\u8b49\u5e33\u6236\u72c0\u614b\n    balance = acc.get_balance()\n    print(f\"\u2705 \u53ef\u7528\u9918\u984d\uff1aNT$ {balance:,.0f}\")\n\nexcept FileNotFoundError as e:\n    print(f\"\\n\u274c \u6191\u8b49\u6a94\u6848\u932f\u8aa4\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5 SHIOAJI_CERT_PATH \u662f\u5426\u6b63\u78ba\")\n\nexcept PermissionError as e:\n    print(f\"\\n\u274c \u6191\u8b49\u6b0a\u9650\u932f\u8aa4\uff1a{e}\")\n    print(\"\u8acb\u78ba\u8a8d\u6191\u8b49\u5bc6\u78bc\u662f\u5426\u6b63\u78ba\uff08SHIOAJI_CERT_PASSWORD\uff09\")\n\nexcept ConnectionError as e:\n    print(f\"\\n\u274c \u7db2\u8def\u9023\u7dda\u932f\u8aa4\uff1a{e}\")\n    print(\"\u53ef\u80fd\u539f\u56e0\uff1a\")\n    print(\"1. \u7db2\u8def\u9023\u7dda\u4e0d\u7a69\u5b9a\")\n    print(\"2. \u5238\u5546 API \u670d\u52d9\u66ab\u6642\u7121\u6cd5\u4f7f\u7528\")\n    print(\"3. API KEY \u6216 SECRET KEY \u932f\u8aa4\")\n    print(\"\u8acb\u7a0d\u5f8c\u518d\u8a66\u6216\u806f\u7e6b\u5238\u5546\u5ba2\u670d\")\n\nexcept Exception as e:\n    print(f\"\\n\u274c \u672a\u77e5\u932f\u8aa4\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5\u6240\u6709\u74b0\u5883\u8b8a\u6578\u662f\u5426\u6b63\u78ba\u8a2d\u5b9a\")\n    print(\"\u53c3\u8003\u6559\u5b78\uff1ahttps://doc.finlab.tw/details/order_api/\")\n</code></pre> <p>\u7389\u5c71\u8b49\u5238\u5c08\u7528\u6aa2\u67e5\uff1a</p> <pre><code>import os\nfrom finlab.online.esun_account import EsunAccount\n\n# \u6aa2\u67e5\u7389\u5c71\u8b49\u5238\u74b0\u5883\u8b8a\u6578\nrequired_vars = [\n    'ESUN_CONFIG_PATH',\n    'ESUN_MARKET_API_KEY',\n    'ESUN_ACCOUNT_PASSWORD',\n    'ESUN_CERT_PASSWORD'\n]\n\nfor var in required_vars:\n    if not os.environ.get(var):\n        print(f\"\u274c {var} \u672a\u8a2d\u5b9a\")\n        print(f\"   \u8acb\u53c3\u8003\uff1ahttps://www.esunsec.com.tw/trading-platforms/api-trading/docs/trading/quick-start/\")\n        exit(1)\n\n# \u6aa2\u67e5 config.ini \u662f\u5426\u5b58\u5728\nconfig_path = os.environ.get('ESUN_CONFIG_PATH')\nif not os.path.exists(config_path):\n    print(f\"\u274c Config \u6a94\u6848\u4e0d\u5b58\u5728\uff1a{config_path}\")\n    exit(1)\n\ntry:\n    acc = EsunAccount()\n    print(\"\u2705 \u7389\u5c71\u8b49\u5238\u5e33\u6236\u9023\u7dda\u6210\u529f\")\nexcept Exception as e:\n    print(f\"\u274c \u9023\u7dda\u5931\u6557\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5 config.ini \u5167\u5bb9\u662f\u5426\u6b63\u78ba\")\n</code></pre>"}, {"location": "details/order_api/#2_1", "title": "\u932f\u8aa4 2\uff1a\u4e0b\u55ae\u524d\u5b89\u5168\u6aa2\u67e5\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u8cc7\u91d1\u4e0d\u8db3\u3001\u6301\u5009\u904e\u591a\u6216\u55ae\u80a1\u6b0a\u91cd\u904e\u9ad8</p> <p>\u539f\u56e0\uff1a - \u53ef\u7528\u8cc7\u91d1\u4e0d\u8db3\u4ee5\u8cb7\u5165 <code>position</code> \u6307\u5b9a\u7684\u80a1\u7968 - \u7b56\u7565\u7522\u751f\u7684\u6301\u80a1\u6578\u91cf\u8d85\u904e\u98a8\u96aa\u9650\u5236 - \u55ae\u4e00\u80a1\u7968\u6b0a\u91cd\u904e\u9ad8\uff08\u672a\u5206\u6563\u98a8\u96aa\uff09</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a\u5be6\u65bd\u591a\u5c64\u5b89\u5168\u6aa2\u67e5</p> <pre><code>from finlab.online.order_executor import OrderExecutor, Position\nfrom finlab.online.sinopac_account import SinopacAccount\n\ndef safe_order_check(position, account, max_stocks=50, max_weight=0.15, min_cash_buffer=0.1):\n    \"\"\"\n    \u4e0b\u55ae\u524d\u5b89\u5168\u6aa2\u67e5\u51fd\u6578\n\n    Args:\n        position: Position \u7269\u4ef6\n        account: \u5238\u5546\u5e33\u6236\u7269\u4ef6\n        max_stocks: \u6700\u5927\u6301\u80a1\u6578\u91cf\uff08\u9810\u8a2d 50 \u6a94\uff09\n        max_weight: \u55ae\u80a1\u6700\u5927\u6b0a\u91cd\uff08\u9810\u8a2d 15%\uff09\n        min_cash_buffer: \u6700\u5c0f\u73fe\u91d1\u7de9\u885d\u6bd4\u4f8b\uff08\u9810\u8a2d 10%\uff09\n\n    Raises:\n        ValueError: \u6aa2\u67e5\u4e0d\u901a\u904e\u6642\u62cb\u51fa\u932f\u8aa4\n    \"\"\"\n    print(\"=== \u4e0b\u55ae\u5b89\u5168\u6aa2\u67e5 ===\\n\")\n\n    # \u6aa2\u67e5 1\uff1a\u6301\u5009\u6578\u91cf\n    num_stocks = len(position)\n    print(f\"\u6301\u5009\u6578\u91cf\uff1a{num_stocks} \u6a94\")\n    if num_stocks &gt; max_stocks:\n        raise ValueError(\n            f\"\u274c \u6301\u5009\u904e\u591a\uff08{num_stocks} \u6a94\uff09\uff0c\u8d85\u904e\u9650\u5236 {max_stocks} \u6a94\\n\"\n            f\"   \u5efa\u8b70\uff1a\u4f7f\u7528 .is_largest(N) \u9650\u5236\u9078\u80a1\u6578\u91cf\"\n        )\n    print(f\"\u2705 \u6301\u5009\u6578\u91cf\u6aa2\u67e5\u901a\u904e\uff08&lt; {max_stocks} \u6a94\uff09\\n\")\n\n    # \u6aa2\u67e5 2\uff1a\u55ae\u4e00\u6301\u80a1\u6b0a\u91cd\n    # \u5047\u8a2d position \u662f dict \u683c\u5f0f {'stock_id': quantity}\n    total_value = sum(position.values())  # \u7e3d\u50f9\u503c\uff08\u5f35\u6578\u7e3d\u548c\uff09\n\n    for stock_id, quantity in position.items():\n        weight = quantity / total_value if total_value &gt; 0 else 0\n        print(f\"  {stock_id}: {quantity:.2f} \u5f35 ({weight:.1%})\")\n\n        if weight &gt; max_weight:\n            raise ValueError(\n                f\"\u274c \u55ae\u80a1\u6b0a\u91cd\u904e\u9ad8\uff1a{stock_id} \u4f54 {weight:.1%}\uff0c\u8d85\u904e\u9650\u5236 {max_weight:.0%}\\n\"\n                f\"   \u5efa\u8b70\uff1a\u4f7f\u7528 position_limit \u53c3\u6578\u9650\u5236\u55ae\u80a1\u6b0a\u91cd\"\n            )\n\n    print(f\"\\n\u2705 \u55ae\u80a1\u6b0a\u91cd\u6aa2\u67e5\u901a\u904e\uff08&lt; {max_weight:.0%}\uff09\\n\")\n\n    # \u6aa2\u67e5 3\uff1a\u53ef\u7528\u8cc7\u91d1\n    available_cash = account.get_balance()\n    print(f\"\u53ef\u7528\u8cc7\u91d1\uff1aNT$ {available_cash:,.0f}\")\n\n    # \u4f30\u7b97\u6240\u9700\u8cc7\u91d1\uff08\u7c21\u5316\u8a08\u7b97\uff0c\u5be6\u969b\u9700\u8981\u8003\u616e\u80a1\u50f9\uff09\n    # \u9019\u88e1\u5047\u8a2d position.get_required_cash() \u65b9\u6cd5\u5b58\u5728\n    # required_cash = position.get_required_cash()\n\n    # \u7c21\u5316\u7248\uff1a\u5047\u8a2d\u5e73\u5747\u6bcf\u5f35 50,000 \u5143\n    estimated_cost = total_value * 50000\n    print(f\"\u9810\u4f30\u6210\u672c\uff1aNT$ {estimated_cost:,.0f}\")\n\n    cash_buffer = available_cash * min_cash_buffer\n    if estimated_cost &gt; (available_cash - cash_buffer):\n        raise ValueError(\n            f\"\u274c \u8cc7\u91d1\u4e0d\u8db3\uff01\\n\"\n            f\"   \u53ef\u7528\u8cc7\u91d1\uff1aNT$ {available_cash:,.0f}\\n\"\n            f\"   \u9810\u4f30\u6210\u672c\uff1aNT$ {estimated_cost:,.0f}\\n\"\n            f\"   \u73fe\u91d1\u7de9\u885d\uff1aNT$ {cash_buffer:,.0f}\uff08\u4fdd\u7559 {min_cash_buffer:.0%}\uff09\\n\"\n            f\"   \u5efa\u8b70\uff1a\u964d\u4f4e\u7e3d\u8cc7\u91d1\u6bd4\u4f8b\u6216\u8ffd\u52a0\u8cc7\u91d1\"\n        )\n\n    print(f\"\u2705 \u8cc7\u91d1\u6aa2\u67e5\u901a\u904e\uff08\u5269\u9918 {min_cash_buffer:.0%} \u7de9\u885d\uff09\\n\")\n\n    # \u6aa2\u67e5 4\uff1a\u8655\u7f6e\u80a1/\u8b66\u793a\u80a1\u6aa2\u67e5\uff08\u9700\u8981\u984d\u5916\u8cc7\u6599\uff09\n    # \u9019\u90e8\u5206\u5728\u5be6\u969b\u4f7f\u7528\u6642\u9700\u8981\u8abf\u7528 show_alerting_stocks()\n    print(\"\u26a0\ufe0f  \u63d0\u9192\uff1a\u4e0b\u55ae\u524d\u8acb\u57f7\u884c order_executer.show_alerting_stocks() \u6aa2\u67e5\u8655\u7f6e\u80a1\\n\")\n\n    print(\"=\" * 50)\n    print(\"\u2705 \u6240\u6709\u5b89\u5168\u6aa2\u67e5\u901a\u904e\uff0c\u53ef\u4ee5\u57f7\u884c\u4e0b\u55ae\")\n    print(\"=\" * 50)\n\n\n# \u4f7f\u7528\u7bc4\u4f8b\ntry:\n    acc = SinopacAccount()\n    position = Position.from_report(report, fund=1000000)\n\n    # \u57f7\u884c\u5b89\u5168\u6aa2\u67e5\n    safe_order_check(position, acc, max_stocks=30, max_weight=0.10)\n\n    # \u901a\u904e\u6aa2\u67e5\u5f8c\uff0c\u57f7\u884c\u4e0b\u55ae\n    order_executor = OrderExecutor(position, account=acc)\n\n    # \u5148\u9810\u89bd\uff08\u4e0d\u6703\u771f\u7684\u4e0b\u55ae\uff09\n    print(\"\\n=== \u9810\u89bd\u8a02\u55ae ===\")\n    order_executor.create_orders(view_only=True)\n\n    # \u78ba\u8a8d\u7121\u8aa4\u5f8c\uff0c\u57f7\u884c\u4e0b\u55ae\n    # order_executor.create_orders()  # \u53d6\u6d88\u8a3b\u89e3\u4ee5\u5be6\u969b\u4e0b\u55ae\n\nexcept ValueError as e:\n    print(f\"\\n{e}\")\n    print(\"\\n\u8acb\u4fee\u6b63\u554f\u984c\u5f8c\u518d\u57f7\u884c\u4e0b\u55ae\")\n\nexcept Exception as e:\n    print(f\"\\n\u274c \u672a\u9810\u671f\u7684\u932f\u8aa4\uff1a{e}\")\n    print(\"\u8acb\u806f\u7e6b\u6280\u8853\u652f\u63f4\u6216\u67e5\u770b\u8a73\u7d30\u932f\u8aa4\u8a0a\u606f\")\n</code></pre>"}, {"location": "details/order_api/#3_1", "title": "\u932f\u8aa4 3\uff1a\u8a02\u55ae\u88ab\u62d2\u7d55", "text": "<p>\u73fe\u8c61\uff1a\u57f7\u884c <code>create_orders()</code> \u5f8c\uff0c\u90e8\u5206\u6216\u5168\u90e8\u8a02\u55ae\u88ab\u5238\u5546\u62d2\u7d55</p> <pre><code>order_executor.create_orders()\n# \u8a02\u55ae\u72c0\u614b\uff1a\u90e8\u5206\u6210\u529f\u3001\u90e8\u5206\u5931\u6557\n</code></pre> <p>\u5e38\u898b\u62d2\u55ae\u539f\u56e0\uff1a</p> <ol> <li>\u8655\u7f6e\u80a1\u672a\u5708\u5b58</li> <li>\u80a1\u7968\u66ab\u505c\u4ea4\u6613</li> <li>\u6f32\u8dcc\u505c\u9396\u6b7b</li> <li>\u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\u932f\u8aa4</li> <li>\u5e33\u6236\u6b0a\u9650\u4e0d\u8db3</li> </ol> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from finlab.online.order_executor import OrderExecutor\n\n# \u5efa\u7acb OrderExecutor\norder_executor = OrderExecutor(position, account=acc)\n\n# \u6b65\u9a5f 1\uff1a\u6aa2\u67e5\u8655\u7f6e\u80a1/\u8b66\u793a\u80a1\nprint(\"=== \u6aa2\u67e5\u8655\u7f6e\u80a1 ===\")\nalerting_stocks = order_executor.show_alerting_stocks()\n\nif alerting_stocks:\n    print(\"\u26a0\ufe0f  \u767c\u73fe\u8655\u7f6e\u80a1/\u8b66\u793a\u80a1\uff0c\u8acb\u81f3\u5238\u5546\u5e73\u53f0\u5708\u5b58\u5f8c\u518d\u4e0b\u55ae\")\n    print(\"\u53c3\u8003\u5708\u5b58\u6559\u5b78\uff1a\")\n    print(\"  - \u5bcc\u679c\uff1ahttps://support.fugle.tw/trading/trading-troubleshoot/5231/\")\n    print(\"  - \u6c38\u8c50\uff1ahttps://www.sinotrade.com.tw/richclub/freshman/...\")\n    # \u7b49\u5f85\u7528\u6236\u624b\u52d5\u5708\u5b58\u5f8c\u518d\u7e7c\u7e8c\n    input(\"\u5708\u5b58\u5b8c\u6210\u5f8c\uff0c\u6309 Enter \u7e7c\u7e8c...\")\n\n# \u6b65\u9a5f 2\uff1a\u6aa2\u67e5\u4ea4\u6613\u6642\u6bb5\nfrom datetime import datetime\nnow = datetime.now()\nhour = now.hour\nminute = now.minute\n\nif 9 &lt;= hour &lt; 13 or (hour == 13 and minute &lt;= 30):\n    print(\"\u2705 \u7576\u524d\u70ba\u4ea4\u6613\u6642\u6bb5\uff0809:00-13:30\uff09\")\nelse:\n    print(\"\u26a0\ufe0f  \u7576\u524d\u70ba\u975e\u4ea4\u6613\u6642\u6bb5\")\n    print(\"   \u6574\u80a1\u4ea4\u6613\u6642\u6bb5\uff1a09:00-13:30\")\n    print(\"   \u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\uff1a09:00-13:40\uff08\u76e4\u4e2d\uff09\u300114:00-14:30\uff08\u76e4\u5f8c\uff09\")\n\n# \u6b65\u9a5f 3\uff1a\u5148\u9810\u89bd\uff0c\u518d\u4e0b\u55ae\nprint(\"\\n=== \u9810\u89bd\u8a02\u55ae ===\")\norder_executor.create_orders(view_only=True)\n\nconfirmation = input(\"\\n\u78ba\u8a8d\u7121\u8aa4\u5f8c\u8f38\u5165 'YES' \u57f7\u884c\u4e0b\u55ae\uff1a\")\nif confirmation == 'YES':\n    try:\n        # \u57f7\u884c\u4e0b\u55ae\n        orders = order_executor.create_orders()\n\n        # \u6aa2\u67e5\u8a02\u55ae\u72c0\u614b\n        print(\"\\n=== \u8a02\u55ae\u72c0\u614b ===\")\n        for order in orders:\n            print(f\"{order['stock_id']}: {order['status']}\")\n\n        # \u7d71\u8a08\u6210\u529f/\u5931\u6557\n        success_count = sum(1 for o in orders if o['status'] == 'success')\n        fail_count = len(orders) - success_count\n\n        if fail_count &gt; 0:\n            print(f\"\\n\u26a0\ufe0f  {fail_count} \u7b46\u8a02\u55ae\u5931\u6557\uff0c\u8acb\u6aa2\u67e5\u62d2\u55ae\u539f\u56e0\uff1a\")\n            for order in orders:\n                if order['status'] != 'success':\n                    print(f\"  {order['stock_id']}: {order['error_message']}\")\n\n            print(\"\\n\u5e38\u898b\u62d2\u55ae\u539f\u56e0\uff1a\")\n            print(\"1. \u8655\u7f6e\u80a1\u672a\u5708\u5b58\")\n            print(\"2. \u80a1\u7968\u66ab\u505c\u4ea4\u6613\uff08\u505c\u724c\u3001\u5168\u984d\u4ea4\u5272\uff09\")\n            print(\"3. \u6f32\u8dcc\u505c\u9396\u6b7b\u7121\u6cd5\u6210\u4ea4\")\n            print(\"4. \u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\u932f\u8aa4\")\n            print(\"5. \u8cc7\u91d1\u4e0d\u8db3\")\n        else:\n            print(f\"\\n\u2705 \u6240\u6709\u8a02\u55ae\u6210\u529f\u9001\u51fa\uff08{success_count} \u7b46\uff09\")\n\n    except Exception as e:\n        print(f\"\\n\u274c \u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n        print(\"\u8acb\u6aa2\u67e5\u7db2\u8def\u9023\u7dda\u6216\u806f\u7e6b\u5238\u5546\u5ba2\u670d\")\nelse:\n    print(\"\u5df2\u53d6\u6d88\u4e0b\u55ae\")\n</code></pre>"}, {"location": "details/order_api/#4", "title": "\u932f\u8aa4 4\uff1a\u96f6\u80a1\u4e0b\u55ae\u5931\u6557", "text": "<p>\u73fe\u8c61\uff1a\u4f7f\u7528 <code>odd_lot=True</code> \u4f46\u8a02\u55ae\u5931\u6557</p> <pre><code>position = Position.from_report(report, fund, odd_lot=True)\norder_executor = OrderExecutor(position, account=acc)\norder_executor.create_orders()\n# \u932f\u8aa4\uff1a\u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\u4e0d\u7b26\n</code></pre> <p>\u539f\u56e0\uff1a - \u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\u9650\u5236\uff08\u76e4\u4e2d 09:00-13:40\u3001\u76e4\u5f8c 14:00-14:30\uff09 - \u90e8\u5206\u5238\u5546\u4e0d\u652f\u63f4\u96f6\u80a1 API \u4ea4\u6613 - \u96f6\u80a1\u6210\u4ea4\u91cf\u4e0d\u8db3</p> <p>\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <pre><code>from datetime import datetime\nfrom finlab.online.order_executor import Position, OrderExecutor\n\n# \u6aa2\u67e5\u662f\u5426\u5728\u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\nnow = datetime.now()\nhour, minute = now.hour, now.minute\n\n# \u76e4\u4e2d\u96f6\u80a1\uff1a09:00-13:40\nis_intraday_odd_lot = (9 &lt;= hour &lt; 13) or (hour == 13 and minute &lt;= 40)\n\n# \u76e4\u5f8c\u96f6\u80a1\uff1a14:00-14:30\nis_afterhours_odd_lot = (hour == 14 and 0 &lt;= minute &lt;= 30)\n\nif not (is_intraday_odd_lot or is_afterhours_odd_lot):\n    print(\"\u26a0\ufe0f  \u7576\u524d\u4e0d\u5728\u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\")\n    print(\"   \u76e4\u4e2d\u96f6\u80a1\uff1a09:00-13:40\")\n    print(\"   \u76e4\u5f8c\u96f6\u80a1\uff1a14:00-14:30\")\n    print(\"\\n\u5efa\u8b70\uff1a\")\n    print(\"1. \u7b49\u5f85\u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\u518d\u4e0b\u55ae\")\n    print(\"2. \u6539\u7528\u6574\u80a1\u4ea4\u6613\uff08\u79fb\u9664 odd_lot=True\uff09\")\n    exit(0)\n\n# \u5efa\u7acb\u96f6\u80a1\u90e8\u4f4d\nposition = Position.from_report(report, fund=500000, odd_lot=True)\nprint(f\"\u2705 \u7576\u524d\u5728\u96f6\u80a1\u4ea4\u6613\u6642\u6bb5\uff0c\u53ef\u57f7\u884c\u4e0b\u55ae\")\n\n# \u57f7\u884c\u4e0b\u55ae\ntry:\n    order_executor = OrderExecutor(position, account=acc)\n    order_executor.create_orders(view_only=True)  # \u5148\u9810\u89bd\n    # order_executor.create_orders()  # \u78ba\u8a8d\u5f8c\u53d6\u6d88\u8a3b\u89e3\n\nexcept Exception as e:\n    print(f\"\u274c \u96f6\u80a1\u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n    print(\"\\n\u53ef\u80fd\u539f\u56e0\uff1a\")\n    print(\"1. \u5238\u5546\u4e0d\u652f\u63f4\u96f6\u80a1 API \u4ea4\u6613\uff08\u8acb\u806f\u7e6b\u5238\u5546\u78ba\u8a8d\uff09\")\n    print(\"2. \u96f6\u80a1\u6210\u4ea4\u91cf\u4e0d\u8db3\uff08\u5efa\u8b70\u6539\u7528\u6574\u80a1\uff09\")\n    print(\"3. \u7db2\u8def\u9023\u7dda\u554f\u984c\")\n</code></pre>"}, {"location": "details/order_api/#_11", "title": "\u5be6\u76e4\u4ea4\u6613\u6700\u4f73\u5be6\u8e10", "text": ""}, {"location": "details/order_api/#1_1", "title": "1. \u4f7f\u7528\u6a21\u64ec\u5e33\u6236\u6e2c\u8a66", "text": "<pre><code># \u5927\u591a\u6578\u5238\u5546\u63d0\u4f9b\u6a21\u64ec\u5e33\u6236\uff0c\u5efa\u8b70\u5148\u6e2c\u8a66 1-2 \u9031\n# \u78ba\u8a8d\u6240\u6709\u6d41\u7a0b\u6b63\u5e38\u5f8c\u518d\u4f7f\u7528\u771f\u5be6\u5e33\u6236\n</code></pre>"}, {"location": "details/order_api/#2_2", "title": "2. \u8a2d\u5b9a\u6bcf\u65e5\u4e0b\u55ae\u6392\u7a0b", "text": "<pre><code>import schedule\nimport time\n\ndef daily_rebalance():\n    \"\"\"\u6bcf\u65e5\u6536\u76e4\u5f8c\u81ea\u52d5\u8abf\u5009\"\"\"\n    try:\n        # 1. \u57f7\u884c\u7b56\u7565\n        report = backtest.sim(position, resample='M')\n\n        # 2. \u8a08\u7b97\u90e8\u4f4d\n        position = Position.from_report(report, fund=1000000)\n\n        # 3. \u5b89\u5168\u6aa2\u67e5\n        safe_order_check(position, acc)\n\n        # 4. \u57f7\u884c\u4e0b\u55ae\n        order_executor = OrderExecutor(position, account=acc)\n        order_executor.create_orders()\n\n        print(f\"\u2705 {datetime.now()} - \u4e0b\u55ae\u5b8c\u6210\")\n\n    except Exception as e:\n        print(f\"\u274c {datetime.now()} - \u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n        # \u767c\u9001\u901a\u77e5\uff08LINE/Email\uff09\n\n# \u6bcf\u65e5 14:00 \u57f7\u884c\uff08\u6536\u76e4\u5f8c\uff09\nschedule.every().day.at(\"14:00\").do(daily_rebalance)\n\nwhile True:\n    schedule.run_pending()\n    time.sleep(60)\n</code></pre>"}, {"location": "details/order_api/#3_2", "title": "3. \u8a18\u9304\u6240\u6709\u4ea4\u6613", "text": "<pre><code>import json\nfrom datetime import datetime\n\ndef log_trade(position, orders, status):\n    \"\"\"\u8a18\u9304\u4ea4\u6613\u65e5\u8a8c\"\"\"\n    log_entry = {\n        'timestamp': datetime.now().isoformat(),\n        'position': position,\n        'orders': orders,\n        'status': status\n    }\n\n    with open('trade_log.json', 'a') as f:\n        f.write(json.dumps(log_entry, ensure_ascii=False) + '\\n')\n</code></pre>"}, {"location": "details/order_api/#_12", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>API Reference - online - OrderExecutor \u5b8c\u6574\u53c3\u6578\u8aaa\u660e</li> <li>\u5be6\u76e4\u4e0b\u55ae\u6559\u5b78\uff08\u591a\u7b56\u7565\uff09 - \u591a\u7b56\u7565\u7d44\u5408\u4e0b\u55ae</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357 - \u5be6\u76e4\u98a8\u96aa\u63a7\u5236</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5f9e\u56de\u6e2c\u5230\u5be6\u76e4</li> <li>\u5e38\u898b\u554f\u984c FAQ - \u66f4\u591a\u7591\u96e3\u6392\u89e3</li> </ul> <p>\u6700\u5f8c\u63d0\u9192</p> <p>\u8acb\u52d9\u5fc5\u5728\u6a21\u64ec\u5e33\u6236\u5145\u5206\u6e2c\u8a66\u5f8c\uff0c\u624d\u4f7f\u7528\u771f\u5be6\u8cc7\u91d1\uff01</p> <p>\u5efa\u8b70\u6e2c\u8a66\u6e05\u55ae\uff1a - \u2705 \u5e33\u6236\u9023\u7dda\u7a69\u5b9a\u7121\u932f\u8aa4 - \u2705 \u4e0b\u55ae\u6d41\u7a0b\u5b8c\u6574\u57f7\u884c - \u2705 \u6301\u5009\u8a08\u7b97\u6b63\u78ba\uff08\u8207\u9810\u671f\u4e00\u81f4\uff09 - \u2705 \u8cc7\u91d1\u63a7\u5236\u6b63\u5e38\uff08\u4e0d\u8d85\u652f\uff09 - \u2705 \u7570\u5e38\u8655\u7406\u6a5f\u5236\u6709\u6548 - \u2705 \u9023\u7e8c\u904b\u884c 1-2 \u9031\u7121\u554f\u984c</p> <p>\u53ea\u6709\u5728\u4ee5\u4e0a\u9805\u76ee\u5168\u90e8\u78ba\u8a8d\u5f8c\uff0c\u624d\u8003\u616e\u4f7f\u7528\u771f\u5be6\u8cc7\u91d1\uff01</p>"}, {"location": "details/order_api2/", "title": "\u4e0b\u55ae(\u591a\u7b56\u7565)", "text": "<p>\u672c\u6307\u5357\u9069\u7528\u65bc\u6709\u660e\u78ba\u4ea4\u6613\u7b56\u7565\u7684\u7528\u6236\uff0c\u5305\u62ec\u4ee5\u4e0b\u6b65\u9a5f\uff1a</p> <ol> <li>\u57f7\u884c\u4ea4\u6613\u7b56\u7565</li> <li>\u7d44\u5408\u4ea4\u6613\u90e8\u4f4d</li> <li>\u8a08\u7b97\u80a1\u7968\u5f35\u6578</li> <li>\u5be6\u969b\u4e0b\u55ae</li> </ol> <p>\u4e0b\u9762\u5c07\u6703\u4e00\u4e00\u4ecb\u7d39\u5982\u4f55\u9032\u884c\u4e0b\u55ae\u3002</p> <p>\u6b64\u529f\u80fd\u70baBETA\u7248</p> <p>\u672c\u529f\u80fd\u76ee\u524d\u5df2\u6709\u4e0a\u5343\u842c\u7684\u8cc7\u91d1\u6b63\u5728\u4f7f\u7528\uff0c\u4f46\u7b2c\u4e00\u6b21\u4f7f\u7528\u6642\uff0c\u8acb\u65bc\u76e4\u5f8c\u6216\u76e4\u524d\u9032\u884c\uff0c\u907f\u514d\u5728\u4ea4\u6613\u6642\u6bb5\u64cd\u4f5c\uff0c\u4ee5\u514d\u767c\u751f\u975e\u9810\u671f\u7684\u932f\u8aa4\u3002</p>"}, {"location": "details/order_api2/#1", "title": "1. \u57f7\u884c\u4ea4\u6613\u7b56\u7565", "text": "<p>\u5728\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5\u958b\u76e4\u524d\uff0c\u9996\u5148\u9700\u8981\u57f7\u884c\u7b56\u7565\u4e26\u53d6\u5f97\u4ea4\u6613\u5831\u544a\u3002\u4ee5\u4e0b\u4ecb\u7d39\u4e09\u7a2e\u65b9\u5f0f\uff1a</p>"}, {"location": "details/order_api2/#a-backtestsim", "title": "A. \u4f7f\u7528 <code>backtest.sim</code> \u9032\u884c\u56de\u6e2c\uff0c", "text": "<p>\u7528\u6236\u53ef\u4ee5\u6839\u64da \u56de\u6e2c\u6559\u5b78 \u64b0\u5beb\u81ea\u5df1\u7684\u7b56\u7565\uff0c\u4e26\u901a\u904e\u56de\u6e2c\u7372\u53d6\u5831\u544a\uff1a</p> <p><pre><code>from finlab import backtest\n\n# \u64b0\u5beb\u60a8\u7684\u7b56\u7565\n\nreport1 = backtest.sim(...)\nreport2 = backtest.sim(...)\n</code></pre> \u8aaa\u660e\uff1a\u9019\u7a2e\u65b9\u5f0f\u9700\u8981\u5b8c\u6574\u57f7\u884c\u7a0b\u5f0f\u78bc\uff0c\u53ef\u80fd\u6703\u82b1\u8cbb\u4e00\u4e9b\u6642\u9593\u3002</p>"}, {"location": "details/order_api2/#b", "title": "B. \u4e0b\u8f09\u5e73\u53f0\u4e0a\u4f7f\u7528\u8005\u7684\u7b56\u7565\u4f86\u7372\u5f97\u56de\u6e2c\u5831\u544a", "text": "<p>\u7528\u6236\u53ef\u4ee5\u5728\u5e73\u53f0\u4e0a\u7684 \u6211\u7684\u7b56\u7565 \u4e2d\u9078\u64c7\u60f3\u8981\u4e0b\u55ae\u7684\u7b56\u7565\uff0c\u8a18\u9304\u540d\u7a31\u5f8c\u4e0b\u8f09\u5831\u544a\u4e26\u4e0b\u55ae\uff1a</p> <pre><code>from finlab.portfolio import create_report_from_cloud\n\nreport1 = create_report_from_cloud('NAME_OF_STRATEGY1')\nreport2 = create_report_from_cloud('NAME_OF_STRATEGY2')\n</code></pre>"}, {"location": "details/order_api2/#c", "title": "C. \u76f4\u63a5\u8a2d\u5b9a\u90e8\u4f4d", "text": "<p>\u9069\u5408\u5df2\u6709\u6301\u80a1\u4e26\u5e0c\u671b\u5b9a\u671f\u9032\u884c\u91cd\u65b0\u5e73\u8861\u7684\u7528\u6236\uff1a</p> <p><pre><code>from finlab.portfolio import create_multi_asset_report\n\nreport1 = create_multi_asset_report({'2330': 0.5, '1101': 0.5}, resample='Q')\nreport2 = create_multi_asset_report({'2330': 0.7, '1101': 0.3}, resample='M')\n</code></pre> \u8aaa\u660e\uff1a<code>resample</code> \u53c3\u6578\u8868\u793a\u91cd\u65b0\u5e73\u8861\u7684\u983b\u7387\uff0c\u4f8b\u5982 <code>Q</code> \u8868\u793a\u6309\u5b63\u5ea6\u91cd\u65b0\u5e73\u8861\u3002</p>"}, {"location": "details/order_api2/#2", "title": "2. \u7d44\u5408\u4ea4\u6613\u90e8\u4f4d", "text": "<p>\u53d6\u5f97\u591a\u500b\u7b56\u7565\u5831\u544a\u5f8c\uff0c\u53ef\u4ee5\u7d44\u5408\u9019\u4e9b\u90e8\u4f4d\u4e26\u8a55\u4f30\u7e3e\u6548\uff1a</p> <pre><code>from finlab.portfolio import Portfolio\nport = Portfolio({\n    'strategy1': (report1, 0.5),\n    'strategy2': (report2, 0.5)\n})\nport.display()\n</code></pre> <p>\u6b64\u6642\u7a0b\u5f0f\u6703\u6a21\u64ec\u9019\u5169\u500b\u90e8\u4f4d\u7684\u7d44\u5408\u4e26\u8a08\u7b97\u51fa\u7e3e\u6548\u3002\u5982\u4e0b\u5716\u6240\u793a\uff1a </p>"}, {"location": "details/order_api2/#3", "title": "3. \u8a08\u7b97\u80a1\u7968\u5f35\u6578", "text": "<p>\u63a5\u4e0b\u4f86\uff0c\u6211\u5011\u9700\u8981\u8a08\u7b97\u6bcf\u6a94\u80a1\u7968\u6295\u8cc7\u7684\u5f35\u6578\u3002\u4f7f\u7528 <code>PortfolioSyncManager</code> \u53ef\u4ee5\u9054\u6210\u4ee5\u4e0b\u76ee\u6a19\uff1a</p> <ul> <li>\u5224\u65b7\u662f\u5426\u9700\u8981\u66f4\u65b0\u90e8\u4f4d</li> <li>\u5728\u7b56\u7565\u63db\u80a1\u65e5\uff0c\u91cd\u65b0\u8a08\u7b97\u6bcf\u6a94\u80a1\u7968\u7684\u5f35\u6578</li> <li>\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u5f8c\uff0c\u6aa2\u67e5\u662f\u5426\u9700\u8981\u505c\u640d\u6216\u505c\u5229</li> <li>\u5728\u63db\u80a1\u6642\uff0c\u78ba\u4fdd\u5728\u6307\u5b9a\u7684\u91d1\u984d (<code>total_balance</code>) \u5167\u9032\u884c\u63db\u80a1</li> </ul>"}, {"location": "details/order_api2/#portfoliosyncmanager", "title": "\u5275\u5efa <code>PortfolioSyncManager</code>", "text": "<p>\u7528\u6236\u53ef\u4ee5\u9078\u64c7\u4ee5\u4e0b\u65b9\u5f0f\u4e4b\u4e00\u4f86\u5275\u5efa PortfolioSyncManager\uff1a</p> \u7b2c\u4e00\u6b21\u5275\u7acb\u90e8\u4f4d\u5f9e\u96f2\u7aef\u53d6\u5f97\u539f\u672c\u7684\u90e8\u4f4d\u5f9e\u672c\u5730\u7aef\u53d6\u5f97\u539f\u672c\u7684\u90e8\u4f4d <pre><code>from finlab.portfolio import PortfolioSyncManager\n\n# \u5efa\u7acb\u4e00\u500b\u65b0\u7684\u8cc7\u6599\u5eab\npm = PortfolioSyncManager()\n</code></pre> <pre><code>from finlab.portfolio import PortfolioSyncManager\n\n# \u5f9e\u96f2\u7aef\u53d6\u5f97\u539f\u672c\u7684\u90e8\u4f4d\npm = PortfolioSyncManager.from_cloud()\n</code></pre> <pre><code>from finlab.portfolio import PortfolioSyncManager\n\n# \u5f9e\u672c\u5730\u7aef\u53d6\u5f97\u539f\u672c\u7684\u90e8\u4f4d\npm = PortfolioSyncManager.from_local()\n</code></pre>"}, {"location": "details/order_api2/#_1", "title": "\u66f4\u65b0\u6301\u80a1\uff1a", "text": "<p>\u53ef\u4ee5\u6839\u64da\u9700\u6c42\u9078\u64c7\u4e0d\u540c\u7684\u66f4\u65b0\u65b9\u5f0f\uff1a</p> \u63db\u80a1\u65e5\u624d\u63db\u80a1\u96f6\u80a1\u878d\u8cc7\u4ea4\u6613 <pre><code># \u7a0b\u5f0f\u6703\u5728\u63db\u80a1\u65e5\u7576\u5929\uff0c\u624d\u6703\u9032\u884c\u63db\u80a1\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21\u5275\u5efa\u6642\uff0c\u6703\u662f\u7a7a\u7684\u3002\npm.update(port, total_balance=1000000)\n</code></pre> <pre><code># \u96f6\u80a1\u4ea4\u6613\npm.update(port, total_balance=1000000, odd_lot=True)\n</code></pre> <pre><code># \u878d\u8cc7\u3001\u878d\u5238\u4ea4\u6613\npm.update(port, total_balance=1000000, margin_trading=True)\n</code></pre> <p><pre><code>print(pm)\n</code></pre> <pre><code>Estimate value 9633950\n\n          quantity  price    weight  close_price    volume                    strategy            type\nstock_id                                                                                              \n1213          19.0  10.15  0.019055        10.15    69.948                       r2,r3  MARGIN_TRADING\n1336           8.0  22.05  0.017430        22.05   270.865                    r5,r6,r7  MARGIN_TRADING\n1441          12.0  14.70  0.017430        14.70    76.901                       r0,r8  MARGIN_TRADING\n1468           8.0  14.60  0.011541        14.60    33.000                          r9  MARGIN_TRADING\n1474           8.0  13.90  0.010987        13.90   113.962                          r1  MARGIN_TRADING\n2496          15.0  73.50  0.108936        73.50    11.613     r0,r1,r2,r3,r4,r5,r8,r9  MARGIN_TRADING\n3019           3.0  85.90  0.025463        85.90  5376.965                    r3,r4,r5  MARGIN_TRADING\n3430           6.0  60.30  0.035749        60.30   300.173                 r4,r5,r6,r7  MARGIN_TRADING\n3632          42.0  15.30  0.063494        15.30    15.637        r0,r1,r3,r4,r5,r6,r7  MARGIN_TRADING\n4154          20.0  15.75  0.031125        15.75    57.116                 r4,r5,r6,r7  MARGIN_TRADING\n4554           3.0  29.50  0.008745        29.50    43.018                          r8  MARGIN_TRADING\n</code></pre> \u8acb\u6bcf\u65e5\u57f7\u884c <code>PortfolioSyncManager.update</code>\uff0c\u4ee5\u78ba\u4fdd\u90e8\u4f4d\u7684\u6b63\u78ba\u6027\u3002</p> PortfolioSyncManager.update \u63a7\u5236\u53c3\u6578 <p><code>PortfolioSyncManager.update</code> \u6709\u4ee5\u4e0b\u53c3\u6578\uff0c\u8acb\u8a73\u7d30\u95b1\u8b80\u78ba\u4fdd\u60a8\u7684\u90e8\u4f4d\u66f4\u65b0\u6b63\u78ba\uff1a</p> <p>portfolio (Portfolio or Report)</p> <p>\u9019\u662f\u4e00\u500b\u5305\u542b\u6295\u8cc7\u7d44\u5408\uff0c\u9019\u500b\u8a08\u7b97\u80a1\u7968\u540c\u6b65\u5e33\u6236\u7684\u6838\u5fc3\u6578\u64da\u7d50\u69cb\uff0c\u6240\u6709\u80a1\u7968\u5f35\u6578\u904b\u7b97\u90fd\u6703\u53c3\u8003 portfolio \u9032\u884c\u3002</p> <p>total_balance (float)</p> <p>\u7e3d\u8cc7\u7522\u7684\u6d6e\u9ede\u6578\u503c\uff0c\u8868\u793a\u6295\u8cc7\u8005\u7684\u6574\u9ad4\u8cc7\u91d1\u72c0\u6cc1\u3002\u9019\u500b\u6578\u503c\u5305\u62ec\u6240\u6709\u73fe\u91d1\u548c\u8cc7\u7522\u8207\u80a1\u7968\u7684\u7e3d\u548c\u3002</p> <p>rebalance_safety_weight (float)</p> <p>\u73fe\u91d1\u7684\u6b0a\u91cd\uff0c\u78ba\u4fdd\u5728\u4ee5\u5e02\u50f9\u8cb7\u8ce3\u8cc7\u7522\u6642\uff0c\u65b0\u7684\u7b56\u7565\u7d44\u5408\u7684\u7e3d\u50f9\u503c\u4e0d\u6703\u8d85\u904e\u539f\u6709\u7684\u7d44\u5408\u50f9\u503c\u3002\u9019\u500b\u53c3\u6578\u662f\u518d\u5e73\u8861\u7b56\u7565\u7684\u4e00\u90e8\u5206\uff0c\u7528\u65bc\u8a08\u7b97\u8ce3\u51fa\u80a1\u7968\u5f8c\uff0c\u6709\u591a\u5c11\u6bd4\u4f8b\u9700\u8981\u8f49\u63db\u6210\u73fe\u91d1\u3002\u8209\u4f8b\u4f86\u8aaa\uff0c\u5982\u679c\u8a2d\u5b9a\u70ba20\uff05\uff0c\u5247\u8ce3\u51fa\u8cc7\u7522\u5f8c\uff0c20\uff05\u7684\u8cc7\u91d1\u5c07\u4fdd\u7559\u70ba\u73fe\u91d1\uff0c\u5176\u9918\u90e8\u5206\u5c07\u7528\u65bc\u8cfc\u8cb7\u65b0\u7684\u8cc7\u7522\u3002\u9019\u6709\u52a9\u65bc\u7ba1\u7406\u6295\u8cc7\u98a8\u96aa\u548c\u78ba\u4fdd\u6d41\u52d5\u6027\u3002\u5047\u5982\u4f7f\u7528\u8005\u4f7f\u7528\u9650\u50f9\u4ea4\u6613\uff0c\u53ef\u4ee5\u5c07\u6b64\u53c3\u6578\u8a2d\u5b9a\u70ba 5\uff05\u3002</p> <p>smooth_transition (bool)</p> <p>\u6b64\u53c3\u6578\u6c7a\u5b9a\u662f\u5426\u63a1\u7528\u5e73\u6ed1\u904e\u6e21\u7684\u65b9\u5f0f\u9032\u884c\u6295\u8cc7\u7d44\u5408\u66f4\u65b0\u3002\u7576\u65b0\u589e\u6216\u6e1b\u5c11\u7b56\u7565\u3001\u4ee5\u53ca\u66f4\u65b0\u6b0a\u91cd\u6642\uff0c\u5982\u679c\u8a2d\u5b9a\u70ba True\uff0c\u6295\u8cc7\u7d44\u5408\u4e0d\u6703\u7acb\u5373\u8b8a\u66f4\uff0c\u800c\u662f\u5728\u6bcf\u500b\u7b56\u7565\u7684\u5230\u671f\u65e5\u9032\u884c\u66f4\u65b0\u3002\u9019\u6a23\u53ef\u4ee5\u907f\u514d\u983b\u7e41\u7684\u4ea4\u6613\uff0c\u6e1b\u5c11\u4ea4\u6613\u6210\u672c\uff0c\u4e26\u6709\u52a9\u65bc\u6295\u8cc7\u7d44\u5408\u7684\u7a69\u5b9a\u6027\u3002\u9810\u8a2d\u503c\u70ba True\u3002</p> <p>force_override_difference (bool)</p> <p>\u6b64\u53c3\u6578\u6c7a\u5b9a\u662f\u5426\u5f37\u5236\u8986\u84cb\u73fe\u6709\u7684\u4e0d\u540c\u90e8\u4f4d\uff0c\u5047\u5982\u7576\u5929\u4e0d\u662f\u63db\u80a1\u65e5\uff0c\u800c\u4e14\u6c92\u6709\u505c\u640d\u505c\u5229\uff0c\u7a0b\u5f0f\u9084\u662f\u6703\u9a57\u8b49\u7576\u524d\u90e8\u4f4d\uff0c\u4ee5\u53ca\u8ddf\u6a21\u64ec\u90e8\u4f4d\u662f\u5426\u4e00\u81f4\uff08\u7406\u8ad6\u4e0a\u61c9\u8a72\u4e00\u81f4\uff0c\u4f46\u73fe\u5be6\u4e0a\u6709\u53ef\u80fd\u56e0\u70ba\u8cc7\u6599\u5ef6\u9072\u767b\u8f09\u3001\u4f7f\u7528\u8005\u5fd8\u8a18\u57f7\u884c\u7b56\u7565\u3001\u4f7f\u7528\u8005\u5728\u8cc7\u6599\u767b\u8f09\u524d\u57f7\u884c\u7b56\u7565\uff0c\u800c\u5c0e\u81f4\u7a0d\u6709\u4e0d\u540c\uff09\u3002\u82e5\u6b64\u53c3\u6578\u8a2d\u5b9a\u70ba True\uff0c\u767c\u73fe\u6709\u5dee\u7570\u6642\uff0c\u5247\u6703\u5f37\u5236\u6309\u7167\u65b0\u7684\u7b56\u7565\u9032\u884c\u8abf\u6574\uff0c\u9810\u8a2d\u503c\u70ba False\uff0c\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u4ea4\u6613\u548c\u6f5b\u5728\u98a8\u96aa\u3002</p> <p>\u9019\u4e9b\u53c3\u6578\u5728\u9032\u884c\u6295\u8cc7\u7d44\u5408\u540c\u6b65\u548c\u518d\u5e73\u8861\u6642\u975e\u5e38\u91cd\u8981\uff0c\u6b63\u78ba\u8a2d\u5b9a\u548c\u7406\u89e3\u9019\u4e9b\u53c3\u6578\u53ef\u4ee5\u5e6b\u52a9\u6295\u8cc7\u8005\u5be6\u73fe\u66f4\u6709\u6548\u7684\u8cc7\u7522\u7ba1\u7406\u548c\u98a8\u96aa\u63a7\u5236\u3002</p> PortfolioSyncManager.update \u5be6\u969b\u6848\u4f8b\u5206\u6790 <p><code>update</code> \u51fd\u6578\u4ecb\u7d39<code>update</code> \u51fd\u6578\u662f\u7ba1\u7406\u6295\u8cc7\u7d44\u5408\u7684\u91cd\u8981\u5de5\u5177\u3002\u5b83\u78ba\u4fdd\u6295\u8cc7\u7d44\u5408\u4fdd\u6301\u5e73\u8861\uff0c\u4e26\u5728\u5fc5\u8981\u6642\u91cd\u65b0\u8abf\u6574\u6295\u8cc7\uff0c\u4ee5\u9075\u5faa\u7b56\u7565\u5206\u914d\u3002\u4ee5\u4e0b\u662f\u8a72\u51fd\u6578\u7684\u8a73\u7d30\u5de5\u4f5c\u539f\u7406\u3002</p> <p>\u65b0\u589e\u79fb\u9664\u7b56\u7565</p> <p>\u7576\u60a8\u6bcf\u5929\u4f7f\u7528 <code>pm.update</code> \u6642\uff0c\u53ef\u4ee5\u4e1f\u5165\u4e0d\u540c\u7684\u7b56\u7565\uff0c\u4e0d\u540c\u7684\u53c3\u6578\uff0c\u4f86\u9032\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u4e0d\u8ad6\u5982\u4f55\uff0c\u5b83\u5c31\u662f\u6703\u7528\u6700\u5408\u7406\u7684\u65b9\u5f0f\uff0c\u5b8c\u6210\u60a8\u7684\u90e8\u4f4d\u66f4\u65b0\u3002 \u7576\u4f60\u60f3\u8981\u99ac\u4e0a\u5207\u63db\u7b56\u7565\uff0c\u4e0d\u60f3\u8981\u7b49\u5f85\u63db\u80a1\u65e5\u624d\u5207\u63db\uff0c\u53ef\u4ee5\u8a2d\u5b9a <code>pm.update(..., smooth_transition=False)</code></p>"}, {"location": "details/order_api2/#_2", "title": "\u6b65\u9a5f\u8aaa\u660e", "text": "<ol> <li> <p>\u8b58\u5225\u9700\u8981\u66f4\u65b0\u7684\u7b56\u7565</p> <ul> <li> <p>\u51fd\u6578\u9996\u5148\u6aa2\u67e5\u54ea\u4e9b\u7b56\u7565\u9700\u8981\u66f4\u65b0\u3002\u9019\u57fa\u65bc\u7b56\u7565\u4e2d\u8a2d\u5b9a\u7684\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5\u671f\u3002\u5982\u679c\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5\u671f\u5df2\u5230\u6216\u5df2\u904e\uff0c\u6216\u7b56\u7565\u6b0a\u91cd\u767c\u751f\u8b8a\u5316\uff0c\u5c31\u9700\u8981\u66f4\u65b0\u3002</p> </li> <li> <p>\u5b83\u9084\u6703\u8003\u616e\u662f\u5426\u555f\u7528\u5e73\u6ed1\u904e\u6e21\uff0c\u9019\u610f\u5473\u8457\u66f4\u65b0\u5c07\u50c5\u5728\u4e0b\u4e00\u500b\u9810\u5b9a\u4ea4\u6613\u65e5\u671f\u9032\u884c\uff0c\u4ee5\u907f\u514d\u7acb\u5373\u8b8a\u66f4\u3002</p> </li> </ul> </li> <li> <p>\u6aa2\u67e5\u7576\u524d\u6301\u5009 </p> <ul> <li>\u51fd\u6578\u6703\u6aa2\u67e5\u6295\u8cc7\u7d44\u5408\u4e2d\u7576\u524d\u6301\u6709\u7684\u80a1\u7968\u5217\u8868\uff0c\u78ba\u8a8d\u5b83\u5011\u662f\u5426\u8207\u7b56\u7565\u5831\u544a\u4e2d\u7684\u80a1\u7968\u5339\u914d\u3002\u5982\u679c\u6709\u5dee\u7570\uff0c\u51fd\u6578\u6703\u8a18\u9304\u8b66\u544a\uff0c\u4e26\u5728\u5fc5\u8981\u6642\u5f37\u5236\u66f4\u65b0\u3002</li> </ul> </li> <li> <p>\u8a08\u7b97\u8cc7\u7522\u50f9\u503c\u548c\u6d41\u52d5\u8cc7\u91d1 </p> <ul> <li> <p>\u7e3d\u8cc7\u7522\u50f9\u503c \uff1a\u51fd\u6578\u6703\u5c07\u6295\u8cc7\u7d44\u5408\u4e2d\u6240\u6709\u7576\u524d\u6301\u5009\u7684\u50f9\u503c\u76f8\u52a0\uff0c\u9019\u662f\u76ee\u524d\u6301\u6709\u7684\u8cc7\u7522\u7e3d\u50f9\u503c\u3002</p> </li> <li> <p>\u6d41\u52d5\u8cc7\u91d1 \uff1a\u9019\u4ee3\u8868\u901a\u904e\u51fa\u552e\u7576\u524d\u6301\u5009\u53ef\u4ee5\u7372\u5f97\u7684\u8cc7\u91d1\u3002\u5c0d\u65bc\u9700\u8981\u91cd\u65b0\u8abf\u6574\u7684\u7b56\u7565\uff08\u90a3\u4e9b\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5\u671f\u5df2\u5230\u7684\u7b56\u7565\uff09\uff0c\u5176\u6301\u5009\u50f9\u503c\u5c07\u8a08\u5165\u6d41\u52d5\u8cc7\u91d1\u4e2d\u3002\u9084\u6703\u8003\u616e\u5269\u9918\u9918\u984d\uff08\u7e3d\u9918\u984d\u6e1b\u53bb\u7576\u524d\u8cc7\u7522\u50f9\u503c\uff09\u3002</p> </li> <li> <p>\u9650\u5236\u6d41\u52d5\u8cc7\u91d1 \uff1a\u6d41\u52d5\u8cc7\u91d1\u6703\u88ab\u9650\u5236\uff0c\u4ee5\u78ba\u4fdd\u4e0d\u8d85\u904e\u6839\u64da\u7b56\u7565\u6b0a\u91cd\u7e3d\u548c\u8a08\u7b97\u51fa\u7684\u7e3d\u9918\u984d\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7e3d\u9918\u984d\u70ba $1,000,000\uff0c\u800c\u5169\u500b\u7b56\u7565\u5404\u81ea\u7684\u6b0a\u91cd\u70ba 50%\uff0c\u5247\u6700\u5927\u6d41\u52d5\u8cc7\u91d1\u70ba $500,000\u3002</p> </li> <li> <p>\u5b89\u5168\u8cc7\u91d1 \uff1a\u6d41\u52d5\u8cc7\u91d1\u7684\u4e00\u90e8\u5206\u5c07\u88ab\u4fdd\u7559\u70ba\u5b89\u5168\u8cc7\u91d1\uff0c\u4ee5\u78ba\u4fdd\u91cd\u65b0\u8abf\u6574\u671f\u9593\u6295\u8cc7\u7d44\u5408\u7684\u7a69\u5b9a\u6027\u3002\u9019\u901a\u5e38\u662f\u6d41\u52d5\u8cc7\u91d1\u7684\u4e00\u500b\u767e\u5206\u6bd4\uff08\u4f8b\u5982 20%\uff09\u3002</p> </li> <li> <p>\u53ef\u6295\u8cc7\u8cc7\u91d1 \uff1a\u4fdd\u7559\u5b89\u5168\u8cc7\u91d1\u5f8c\u7684\u5269\u9918\u6d41\u52d5\u8cc7\u91d1\u5373\u70ba\u53ef\u6295\u8cc7\u8cc7\u91d1\u3002\u9019\u4e9b\u8cc7\u91d1\u53ef\u7528\u65bc\u6839\u64da\u66f4\u65b0\u7684\u7b56\u7565\u5206\u914d\u9032\u884c\u65b0\u6295\u8cc7\u3002</p> </li> </ul> </li> <li> <p>\u66f4\u65b0\u5404\u7b56\u7565\u7684\u6301\u5009 </p> <ul> <li> <p>\u5c0d\u65bc\u6bcf\u500b\u9700\u8981\u66f4\u65b0\u7684\u7b56\u7565\uff0c\u51fd\u6578\u6703\u6839\u64da\u7b56\u7565\u6b0a\u91cd\u548c\u53ef\u6295\u8cc7\u8cc7\u91d1\u8a08\u7b97\u8cc7\u91d1\u5206\u914d\u3002</p> </li> <li> <p>\u5c07\u8a72\u7b56\u7565\u7684\u820a\u6301\u5009\u6e05\u7b97\uff0c\u4e26\u6839\u64da\u66f4\u65b0\u7684\u7b56\u7565\u5206\u914d\u5275\u5efa\u65b0\u6301\u5009\u3002\u5982\u679c\u67d0\u652f\u80a1\u7968\u540c\u6642\u51fa\u73fe\u5728\u820a\u6301\u5009\u548c\u65b0\u6301\u5009\u4e2d\uff0c\u5247\u5728\u91cd\u65b0\u5e73\u8861\u904e\u7a0b\u4e2d\u5c07\u4fdd\u7559\u8a72\u80a1\u7968\u3002</p> </li> <li> <p>\u5982\u679c\u4efb\u4f55\u80a1\u7968\u89f8\u767c\u505c\u640d\u6216\u505c\u5229\u8a02\u55ae\uff0c\u5176\u6301\u5009\u5c07\u88ab\u8a2d\u7f6e\u70ba\u96f6\uff0c\u800c\u4e0d\u6703\u91cd\u65b0\u5e73\u8861\u6574\u500b\u7b56\u7565\u3002</p> </li> </ul> </li> <li> <p>\u4fdd\u5b58\u66f4\u65b0\u5f8c\u7684\u6295\u8cc7\u7d44\u5408 </p> <ul> <li>\u6700\u5f8c\uff0c\u6839\u64da\u521d\u59cb\u8a2d\u7f6e\uff0c\u5c07\u66f4\u65b0\u5f8c\u7684\u6295\u8cc7\u7d44\u5408\u4fe1\u606f\u4fdd\u5b58\u5230\u672c\u5730\u6216\u96f2\u7aef\uff0c\u78ba\u4fdd\u8b8a\u66f4\u662f\u6301\u4e45\u7684\uff0c\u672a\u4f86\u53ef\u4ee5\u8a2a\u554f\u3002</li> </ul> </li> </ol>"}, {"location": "details/order_api2/#_3", "title": "\u793a\u4f8b\u60c5\u5883", "text": "<p>\u70ba\u4e86\u66f4\u5177\u9ad4\uff0c\u6211\u5011\u4f86\u8003\u616e\u4e00\u500b\u4f8b\u5b50\uff1a</p> <ul> <li> <p>\u521d\u59cb\u8a2d\u7f6e \uff1a\u60a8\u7684\u6295\u8cc7\u7d44\u5408\u6709\u5169\u500b\u7b56\u7565\uff0cA \u548c B\uff0c\u5404\u81ea\u7684\u6b0a\u91cd\u70ba 50%\u3002</p> </li> <li> <p>\u7576\u524d\u50f9\u503c \uff1a\u7e3d\u6de8\u503c\u70ba $1,000,000\u3002\u5176\u4e2d\u7b56\u7565 A \u7684\u7576\u524d\u50f9\u503c\u70ba $300,000\uff0c\u7b56\u7565 B \u7684\u50f9\u503c\u4e5f\u662f $600,000\u3002\u4e4b\u6240\u4ee5\u7b56\u7565 A \u7684\u50f9\u503c\u8f03\u4f4e\uff0c\u662f\u56e0\u70ba\u505c\u640d\u8a02\u55ae\u5c0e\u81f4\u90e8\u5206\u80a1\u7968\u6301\u5009\u88ab\u6e05\u7b97\uff1b\u800c\u7b56\u7565 B \u7684\u50f9\u503c\u8f03\u9ad8\uff0c\u662f\u56e0\u70ba\u5176\u80a1\u7968\u8868\u73fe\u826f\u597d\uff0c\u4e0a\u6f32\u4e86\u3002</p> </li> <li> <p>\u91cd\u65b0\u8abf\u6574\u689d\u4ef6 \uff1a\u7b56\u7565 B \u8a08\u5283\u5728\u660e\u5929\u662f\u63db\u80a1\u65e5\uff0c\u4f46 A \u4e26\u4e0d\u662f\u3002</p> </li> </ul> <p>\u66f4\u65b0\u904e\u7a0b \uff1a </p> <ol> <li> <p>\u8b58\u5225\u9700\u8981\u66f4\u65b0\u7684\u7b56\u7565 \uff1a</p> <ul> <li>\u51fd\u6578\u8b58\u5225\u5230\u7b56\u7565 B \u9700\u8981\u66f4\u65b0\u3002</li> </ul> </li> <li> <p>\u8a08\u7b97\u8cc7\u7522\u50f9\u503c\u548c\u6d41\u52d5\u8cc7\u91d1 \uff1a </p> <ul> <li> <p>\u7e3d\u8cc7\u7522\u50f9\u503c \uff1a$1,000,000\u3002</p> </li> <li> <p>\u6d41\u52d5\u8cc7\u91d1\u8a08\u7b97 \uff1a</p> <ul> <li> <p>\u7b56\u7565 B \u7684\u6301\u5009\u6f5b\u5728\u6d41\u52d5\u8cc7\u91d1\uff1a$600,000\u3002</p> </li> <li> <p>\u5269\u9918\u9918\u984d\uff1a$100,000\u3002</p> </li> <li> <p>\u660e\u65e5\u7e3d\u6d41\u52d5\u8cc7\u91d1\u70ba \\(700,000\uff08\\)100,000 + $600,000\uff09\u3002</p> </li> <li> <p>\u63d0\u4f9b\u7d66 B \u7684\u6d41\u52d5\u8cc7\u91d1\u9650\u5236\u70ba $500,000\uff08\u7531\u65bc\u7b56\u7565 B \u7684\u6b0a\u91cd\u70ba 50%\uff09\u3002</p> </li> </ul> </li> <li> <p>\u5b89\u5168\u8cc7\u91d1\u8a08\u7b97 \uff1a</p> <ul> <li>\u5b89\u5168\u8cc7\u91d1\uff1a$500,000 \u7684 20% = $100,000\u3002</li> </ul> </li> <li> <p>\u53ef\u6295\u8cc7\u8cc7\u91d1\u8a08\u7b97 \uff1a</p> <ul> <li>\u53ef\u6295\u8cc7\u8cc7\u91d1\uff1a$500,000\uff08\u6d41\u52d5\u8cc7\u91d1\uff09- $100,000\uff08\u5b89\u5168\u8cc7\u91d1\uff09= $400,000\u3002</li> </ul> </li> <li> <p>\u9592\u7f6e\u8cc7\u91d1\u8a08\u7b97 \uff1a</p> <ul> <li>\u9592\u7f6e\u8cc7\u91d1\uff1a\u7b56\u7565 A (\\(300,000)\u8207\u65b0\u7684\u7b56\u7565 B (\\)500,000) \u7684\u7e3d\u6301\u5009\u50f9\u503c\u70ba $800,000\uff0c\u56e0\u6b64\u5269\u9918\u9918\u984d\u70ba $200,000\u3002</li> </ul> </li> <li> <p>\u4ee5\u9592\u7f6e\u8cc7\u91d1\u53d6\u4ee3\u5b89\u5168\u8cc7\u91d1 \uff1a</p> <ul> <li>\u7531\u65bc\u9592\u7f6e\u8cc7\u91d1\uff08\\(200,000\uff09\u5927\u65bc\u5b89\u5168\u8cc7\u91d1\uff08\\)100,000\uff09\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u5b89\u5168\u8cc7\u91d1\u4f86\u63db\u80a1\uff0c\u800c\u662f\u4f7f\u7528\u9592\u7f6e\u8cc7\u91d1\u5373\u53ef\u3002</li> <li>\u91cd\u65b0\u8a08\u7b97\u53ef\u6295\u8cc7\u8cc7\u91d1\uff1a$500,000\uff08\u539f\u59cb\u53ef\u6295\u8cc7\u8cc7\u91d1\uff09- $0\uff08\u5b89\u5168\u8cc7\u91d1\uff09= $500,000\u3002</li> </ul> </li> </ul> </li> <li> <p>\u66f4\u65b0\u7b56\u7565 B \u7684\u6301\u5009 \uff1a</p> <ul> <li> <p>\u5728\u4ea4\u6613\u65e5\u671f\uff0c\u7b56\u7565 B \u7684\u820a\u6301\u5009 $600,000 \u5c07\u88ab\u6e05\u7b97\u3002</p> </li> <li> <p>\u4e4b\u5f8c\u5c07\u7528 $500,000 \u6839\u64da\u7b56\u7565 B \u8cb7\u9032\u80a1\u7968\u3002</p> </li> <li> <p>\u4efb\u4f55 A \u89f8\u767c\u505c\u640d\u6216\u505c\u5229\u8a02\u55ae\u7684\u80a1\u7968\uff0c\u5176\u6301\u5009\u5c07\u88ab\u8a2d\u7f6e\u70ba\u96f6\uff0c\u800c\u4e0d\u6703\u91cd\u65b0\u5e73\u8861 B \u7b56\u7565\u6301\u80a1\u3002</p> </li> </ul> </li> <li> <p>\u4fdd\u5b58\u66f4\u65b0\u5f8c\u7684\u6295\u8cc7\u7d44\u5408 \uff1a</p> <ul> <li>\u4fdd\u5b58\u66f4\u65b0\u5f8c\u7684\u8cc7\u8a0a\uff0c\u4ee5\u78ba\u4fdd\u672a\u4f86\u53ef\u4ee5\u8a2a\u554f\u3002</li> </ul> </li> </ol>"}, {"location": "details/order_api2/#_4", "title": "\u7e3d\u7d50", "text": "<p><code>update</code> \u51fd\u6578\u78ba\u4fdd\u60a8\u7684\u6295\u8cc7\u7d44\u5408\u4fdd\u6301\u5e73\u8861\u4e26\u9075\u5faa\u7b56\u7565\u5206\u914d\u3002\u5b83\u4ed4\u7d30\u8a08\u7b97\u7576\u524d\u6301\u5009\u7684\u50f9\u503c\uff0c\u78ba\u5b9a\u53ef\u7528\u8cc7\u91d1\uff0c\u4e26\u6839\u64da\u6700\u65b0\u7b56\u7565\u66f4\u65b0\u6295\u8cc7\u7d44\u5408\uff0c\u540c\u6642\u78ba\u4fdd\u904e\u7a0b\u4e2d\u7684\u7a69\u5b9a\u6027\u3002\u89f8\u767c\u505c\u640d\u6216\u505c\u5229\u8a02\u55ae\u7684\u80a1\u7968\u5c07\u88ab\u8a2d\u7f6e\u70ba\u96f6\uff0c\u800c\u4e0d\u6703\u91cd\u65b0\u5e73\u8861\u6574\u500b\u7b56\u7565\u3002\u9019\u6709\u52a9\u65bc\u7ba1\u7406\u98a8\u96aa\u4e26\u96a8\u6642\u9593\u4fdd\u6301\u671f\u671b\u7684\u6295\u8cc7\u7b56\u7565\u3002</p>"}, {"location": "details/order_api2/#_5", "title": "\u5132\u5b58\u90e8\u4f4d\uff1a", "text": "<p>\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4f86\u5132\u5b58\u90e8\u4f4d\uff1a</p> \u5132\u5b58\u5230\u96f2\u7aef\u5132\u5b58\u5230\u672c\u5730 <pre><code>pm.to_cloud()\n</code></pre> <pre><code>pm.to_local()\n</code></pre>"}, {"location": "details/order_api2/#_6", "title": "\u81ea\u52d5\u5316\u8a2d\u8a08\u8173\u672c", "text": "<p>\u7b2c\u4e00\u6b21\u8acb\u5148\u5275\u5efa\u90e8\u4f4d\uff1a</p> <pre><code># \u521d\u59cb\u5316 PortfolioSyncManager\npm = PortfolioSyncManager()\npm.to_local()\n</code></pre> <p>\u4e4b\u5f8c\u53ef\u4ee5\u6bcf\u5929\u81ea\u52d5\u5316\u57f7\u884c\uff1a</p> <pre><code># \u521d\u59cb\u5316 PortfolioSyncManager\npm = PortfolioSyncManager.from_local()\n\n# \u76f8\u95dc\u64cd\u4f5c\n# pm.update(...)\n\n# \u4fdd\u5b58\u6700\u5f8c\u7684\u64cd\u4f5c\u7d50\u679c\npm.to_local()\n</code></pre>"}, {"location": "details/order_api2/#4", "title": "4. \u5be6\u969b\u4e0b\u55ae", "text": "<p>\u76ee\u524d\u652f\u63f4 <code>\u7389\u5c71\u8b49\u5238</code>\u3001<code>\u6c38\u8c50\u8b49\u5238</code>\u3001<code>\u5143\u5bcc\u8b49\u5238</code> \u4ee5\u53ca <code>\u5bcc\u90a6\u8b49\u5238</code> \u7684\u4e0b\u55ae\u7cfb\u7d71\uff0c\u53ef\u4ee5\u5148\u5c07\u5e33\u865f\u5bc6\u78bc\u8a2d\u5b9a\u6210\u74b0\u5883\u8b8a\u6578\uff0c\u53ea\u8981\u91dd\u5c0d\u60a8\u9700\u8981\u7684\u5238\u5546\u4f86\u8a2d\u5b9a\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u591a\u500b\u5238\u5546\u540c\u6642\u4e32\u63a5\u3002</p> <p>\u9078\u64c7\u60a8\u7684\u5238\u5546</p> \u7389\u5c71\u8b49\u5238\u6c38\u8c50\u8b49\u5238\u5143\u5bcc\u8b49\u5238\u5bcc\u90a6\u8b49\u5238 <p></p> <ul> <li>\u8acb\u5148\u6309\u7167config \u6559\u5b78\u7372\u53d6 config \u8a2d\u5b9a\u6a94\u3002</li> <li>\u4e26\u5230\u767b\u5165\u7389\u5c71\u8b49\u5238API\uff0c\u7372\u5f97\u5e02\u5834\u884c\u60c5 Token\u3002</li> </ul> <pre><code>from finlab.online.esun_account import EsunAccount\nimport os\nos.environ['ESUN_CONFIG_PATH'] = '\u7389\u5c71\u8b49\u5238\u4ea4\u6613\u8a2d\u5b9a\u6a94(config.ini.example)\u8def\u5f91'\nos.environ['ESUN_MARKET_API_KEY'] = '\u7389\u5c71\u8b49\u5238\u7684\u884c\u60c5API Token'\nos.environ['ESUN_ACCOUNT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u5e33\u865f\u5bc6\u78bc'\nos.environ['ESUN_CERT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u6191\u8b49\u5bc6\u78bc'\n\naccount = EsunAccount()\n</code></pre> \u820a\u7248 Fugle \u74b0\u5883\u8b8a\u6578\uff08\u4ecd\u53ef\u4f7f\u7528\uff09 <pre><code>from finlab.online.fugle_account import FugleAccount\nimport os\nos.environ['FUGLE_CONFIG_PATH'] = '\u7389\u5c71\u8b49\u5238\u4ea4\u6613\u8a2d\u5b9a\u6a94(config.ini.example)\u8def\u5f91'\nos.environ['FUGLE_MARKET_API_KEY'] = '\u7389\u5c71\u8b49\u5238\u7684\u884c\u60c5API Token'\nos.environ['FUGLE_ACCOUNT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u5e33\u865f\u5bc6\u78bc'\nos.environ['FUGLE_CERT_PASSWORD'] = '\u7389\u5c71\u8b49\u5238\u7684\u6191\u8b49\u5bc6\u78bc'\n\naccount = FugleAccount()\n</code></pre> <p>\u5047\u5982\u4f7f\u7528\u4e2d\u4e0b\u55ae\u51fa\u73fe\u932f\u8aa4\u4ee3\u78bc\uff0c\u53ef\u4ee5\u5230\u7389\u5c71\u8b49\u5238\u6587\u4ef6 \u4f86\u67e5\u627e\u539f\u56e0\u3002\u5047\u5982\u5c0d\u65bc Finlab Package \u4e0b\u55ae\u4e0d\u719f\u7fd2\uff0c\u5efa\u8b70\u4e5f\u53ef\u4ee5\u5148\u6309\u7167\u5238\u5546\u7684\u6559\u5b78\u4f86\u7df4\u7fd2\uff0c\u5047\u5982\u4e32\u63a5\u6210\u529f\uff0c\u5247 FinLab Package \u7684\u4e32\u63a5\u4e5f\u5c31\u662f\u5982\u6cd5\u70ae\u88fd\u7684\u8a2d\u5b9a\u56c9\uff01</p> <p></p> <ul> <li> <p>\u8acb\u5148\u7372\u53d6\u6191\u8b49</p> <ul> <li>Windows \u6191\u8b49\u4e0b\u8f09\u65b9\u5f0f</li> <li>MacOS \u6191\u8b49\u4e0b\u8f09\uff1a\u76ee\u524d\u6c38\u8c50\u96d6\u652f\u63f4 MacOS \u4e0b\u55ae\uff0c\u4f46\u4e26\u4e0d\u652f\u63f4\u7528 MacOS \u7372\u53d6\u6191\u8b49\uff0c\u53ef\u4ee5\u5148\u627e\u4e00\u53f0 Windows \u4f5c\u696d\u7cfb\u7d71\uff0c\u4e26\u4e14\u4f7f\u7528\u4e0a\u8ff0\u65b9\u6cd5\u7372\u53d6\u6191\u8b49\u5f8c\uff0c\u518d\u5c07\u6191\u8b49\u65bc MacOS \u4f86\u4f7f\u7528\u3002</li> </ul> </li> </ul> <p><pre><code>import os\nfrom finlab.online.sinopac_account import SinopacAccount\n\nos.environ['SHIOAJI_API_KEY'] = '\u6c38\u8c50\u8b49\u5238API_KEY'\nos.environ['SHIOAJI_SECRET_KEY'] = '\u6c38\u8c50\u8b49\u5238SECRET_KEY'\nos.environ['SHIOAJI_CERT_PERSON_ID']= '\u8eab\u4efd\u8b49\u5b57\u865f'\nos.environ['SHIOAJI_CERT_PATH']= '\u6c38\u8c50\u8b49\u5238\u6191\u8b49\u8def\u5f91'\nos.environ['SHIOAJI_CERT_PASSWORD'] = '\u6c38\u8c50\u8b49\u5238\u6191\u8b49\u5bc6\u78bc' # \u9810\u8a2d\u8207\u8eab\u4efd\u8b49\u5b57\u865f\n\naccount = SinopacAccount()\n</code></pre> \u5047\u5982\u5c0d\u65bc Finlab Package \u4e0b\u55ae\u4e0d\u719f\u7fd2\uff0c\u5efa\u8b70\u4e5f\u53ef\u4ee5\u5148\u6309\u7167 \u5238\u5546\u7684\u6559\u5b78 \u4f86\u7df4\u7fd2\uff0c\u5047\u5982\u4e32\u63a5\u6210\u529f\uff0c\u5247 FinLab Package \u7684\u4e32\u63a5\u5c31\u6703\u975e\u5e38\u7c21\u55ae\u56c9\uff01</p> <p>\u8acb\u53c3\u8003\u5143\u5bcc\u8b49\u5238\u7684\u6559\u5b78 \u4f86\u7372\u53d6\u6191\u8b49\uff0c\u4e26\u4e14\u5c07\u6191\u8b49\u653e\u5728\u76f8\u5c0d\u61c9\u7684\u8def\u5f91\u4e4b\u4e2d\uff0c\u4e26\u4e14\u5b89\u88dd\u76f8\u5c0d\u61c9\u7684\u5957\u4ef6\u5f8c\uff0c\u5373\u53ef\u57f7\u884c\uff1a</p> <pre><code>import os\nfrom finlab.online.masterlink_account import MasterlinkAccount\n\nos.environ['MASTERLINK_NATIONAL_ID'] = '\u8eab\u5206\u8b49\u5b57\u865f'\nos.environ['MASTERLINK_ACCOUNT'] = '\u4ea4\u6613\u5e33\u865f'\nos.environ['MASTERLINK_ACCOUNT_PASS'] = '\u5bc6\u78bc'\nos.environ['MASTERLINK_CERT_PATH'] = '\u5143\u5bcc\u8b49\u5238\u6191\u8b49\u8def\u5f91'\nos.environ['MASTERLINK_CERT_PASS'] = '\u5143\u5bcc\u8b49\u5238\u6191\u8b49\u5bc6\u78bc' # \u9810\u8a2d\u8207\u8eab\u5206\u8b49\u5b57\u865f\n\naccount = MasterlinkAccount()\n</code></pre> <p>\u5373\u53ef\u5b8c\u6210\u8a2d\u5b9a\uff01</p> <p>\u8acb\u53c3\u8003\u5bcc\u90a6\u8b49\u5238\u7684\u6559\u5b78 \u4f86\u7372\u53d6\u6191\u8b49\uff0c\u4e26\u4e14\u5c07\u6191\u8b49\u653e\u5728\u76f8\u5c0d\u61c9\u7684\u8def\u5f91\u4e4b\u4e2d\uff0c\u4e26\u4e14\u5b89\u88dd\u76f8\u5c0d\u61c9\u7684\u5957\u4ef6\u5f8c\uff0c\u5373\u53ef\u57f7\u884c\uff1a</p> <pre><code>import os\nfrom fubon_account import FubonAccount\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\nimport os\n\nos.environ['FUBON_NATIONAL_ID'] = \"A123456789\"\nos.environ['FUBON_ACCOUNT_PASS'] = \"your_password\"\nos.environ['FUBON_CERT_PATH'] = \"/path/to/cert.pfx\"\n\n\naccount = FubonAccount()\n</code></pre> <p>\u5373\u53ef\u5b8c\u6210\u8a2d\u5b9a\uff01</p>"}, {"location": "details/order_api2/#_7", "title": "\u6279\u6b21\u4e0b\u55ae\uff0c\u8207\u80a1\u7968\u5e33\u6236\u540c\u6b65\uff1a", "text": "\u6a21\u64ec\u4e0b\u55ae\u6700\u65b0\u50f9\u683c\u4e0b\u55ae\u5e02\u50f9\u55ae\u4ee5\u512a\u52e2 1\uff05 \u9650\u50f9\u4e0b\u55ae\u6bd4\u52a3\u52e2 1% \u9650\u50f9\u639b\u55ae <pre><code># \u4e0d\u6703\u771f\u7684\u4e0b\u55ae\uff0c\u6a21\u64ec\u800c\u5df2\npm.sync(account, view_only=True)\n</code></pre> <pre><code># \u9810\u8a2d\u4f7f\u7528\u6700\u8fd1\u4e00\u7b46\u6210\u4ea4\u50f9\u7576\u6210\u9650\u50f9\npm.sync(account)\n</code></pre> <pre><code># \u6f32\u505c\u8cb7\u5165\uff0c\u8dcc\u505c\u8ce3\u51fa\uff0c\u91dd\u5c0d\u6d41\u52d5\u6027\u9ad8\u7684\u500b\u80a1\u8f03\u9069\u5408\npm.sync(account, market_order=True)\n</code></pre> <pre><code># \u4ee5\u512a\u52e2 1\uff05 \u9650\u50f9\u4e0b\u55ae (\u8f03\u5bb9\u6613\u6210\u4ea4)\npm.sync(account, extra_bid_pct=0.01)\n</code></pre> <pre><code># \u6bd4\u52a3\u52e2 1% \u9650\u50f9\u639b\u55ae(\u8f03\u4e0d\u5bb9\u6613\u6210\u4ea4)\npm.sync(account, extra_bid_pct=-0.01)\n</code></pre>"}, {"location": "details/order_api2/#_8", "title": "\u5176\u4ed6\u64cd\u4f5c", "text": ""}, {"location": "details/order_api2/#_9", "title": "\u66f4\u65b0\u9650\u50f9", "text": "<pre><code>order_executor = pm.create_order_executor(account)\norder_executor.update_order_price()\n</code></pre>"}, {"location": "details/order_api2/#_10", "title": "\u522a\u9664\u6240\u6709\u59d4\u8a17\u55ae", "text": "<pre><code>order_executor.cancel_orders()\n</code></pre> <p>\u82e5\u4e0b\u55ae\u90e8\u4f4d\u542b\u6709\u300c \u5168\u984d\u4ea4\u5272\u80a1\u300d\u3001\u300c\u8655\u7f6e\u80a1\u300d\u3001\u300c\u8b66\u793a\u80a1\u300d\uff0c\u9700\u5148\u65bc\u8b49\u5238\u5e33\u6236\u5708\u5b58\u3002\u53c3\u8003\u5bcc\u679c\u5708\u5b58\u3001\u6c38\u8c50\u5708\u5b58\u65b9\u5f0f\u3002</p>"}, {"location": "details/tech_ind/", "title": "\u6307\u6a19", "text": "<p>\u652f\u63f4 TA-Lib \u8207 pandas_ta \u4e0a\u767e\u7a2e\u6280\u8853\u6307\u6a19\uff0c\u4e00\u884c\u5373\u53ef\u8a08\u7b97\u6578\u5343\u6a94\u3001\u9577\u5e74\u671f\u8cc7\u6599\uff0c\u53ef\u7528\u65bc\u500b\u80a1\u5206\u6790\u8207\u6a5f\u5668\u5b78\u7fd2\u3002</p>"}, {"location": "details/tech_ind/#ta-lib", "title": "\u5b89\u88ddta-lib", "text": "<p>\u5728\u8a08\u7b97\u524d\u9700\u5148\u5b89\u88dd TA-Lib\uff1a</p> <ul> <li>\u672c\u5730\u7aef\uff1a\u53ef\u4ee5\u53c3\u8003 \u5b98\u65b9\u5b89\u88dd\u6559\u5b78 \u4f86\u5b89\u88dd\uff0c\u652f\u63f4 Windows\u3001MacOS\u3001Linux\u3002</li> <li>Google Colab\uff1a\u8acb\u904b\u884c\u4ee5\u4e0b\u6307\u4ee4\u5373\u53ef\uff1a <pre><code>!pip install ta-lib\n</code></pre></li> </ul> <p>\u66f4\u591a\u53c3\u6578\u8207\u51fd\u5f0f\u8acb\u53c3\u8003 TA-Lib \u5b98\u65b9\u6587\u4ef6\u3002</p>"}, {"location": "details/tech_ind/#rsi", "title": "\u8a08\u7b97\u6240\u6709\u80a1\u7968\u7684 RSI \u6578\u503c", "text": "<p>\u4f7f\u7528 <code>data.indicator()</code> \u8a08\u7b97 RSI\uff08<code>timeperiod=14</code>\uff09\uff1a</p> <pre><code>from finlab import data\ndata.indicator('RSI', timeperiod=14)\n</code></pre> <p></p> <p>\u524d 14 \u5929\u56e0\u8cc7\u6599\u4e0d\u8db3\u53ef\u80fd\u70ba <code>NaN</code>\u3002</p>"}, {"location": "details/tech_ind/#kd", "title": "\u5169\u500b\u6642\u9593\u5e8f\u5217\u7684\u6280\u8853\u6307\u6a19\uff08KD\u503c\uff09", "text": "<p>\u4f7f\u7528 <code>data.indicator('STOCH')</code> \u8a08\u7b97 KD \u503c\uff0c\u6703\u56de\u50b3\u5169\u500b DataFrame\uff08K\u3001D\uff09\u3002</p> <pre><code>from finlab import data\nk, d = data.indicator('STOCH')\nk\n</code></pre> <p></p>"}, {"location": "details/tech_ind/#kd_1", "title": "\u5229\u7528 KD \u503c\u4f86\u9078\u80a1", "text": "<p>\u5217\u51fa\u6700\u8fd1\u4e00\u65e5 K &gt; D \u7684\u80a1\u7968\uff1a <pre><code>(k &gt; d).iloc[-1]\n</code></pre> <pre><code>0015    False\n0050     True\n0051    False\n0052     True\n0053     True\n        ...  \n9951     True\n9955    False\n9958    False\n9960     True\n9962     True\nName: 2021-07-13 00:00:00, Length: 2269, dtype: bool\n</code></pre> \u4e0a\u8ff0\u8a9e\u6cd5\u4e2d\uff0c(k &gt; d) \u6703\u56de\u50b3\u4e00\u500b DataFrame \u7269\u4ef6\uff0c\u5176\u4e2d\u6bcf\u500b\u5143\u7d20\u90fd\u662f\u4e00\u500b\u5e03\u6797\u503c\uff0c\u4ee3\u8868\u5c0d\u61c9\u7684\u80a1\u7968\u7576\u524d\u7684 K \u503c\u662f\u5426\u5927\u65bc D \u503c\u3002\u800c .iloc[-1] \u5247\u4ee3\u8868\u53d6\u51fa\u6700\u5f8c\u4e00\u5217\uff0c\u4e5f\u5c31\u662f\u6700\u8fd1\u4e00\u5929\u7684\u8cc7\u6599\u3002\u6700\u5f8c\uff0c\u5c07\u6703\u56de\u50b3\u4e00\u500b\u5e03\u6797\u503c\u5e8f\u5217\uff0c\u5176\u4e2d\u503c\u70ba True \u7684\u80a1\u7968\u4ee3\u8868\u7576\u524d K &gt; D\u3002</p>"}, {"location": "details/tech_ind/#pandas_ta", "title": "\u8a08\u7b97 Pandas_ta \u6280\u8853\u6307\u6a19", "text": "<p><code>pandas_ta</code> \u4ea6\u53ef\u8a08\u7b97\u591a\u7a2e\u6280\u8853\u6307\u6a19\uff1b\u5b89\u88dd\u8207\u6307\u6a19\u5217\u8868\u8acb\u898b\u5b98\u65b9\u6587\u4ef6\u3002</p> <p><pre><code>pip install pandas-ta\n</code></pre> \u5728 FinLab \u4e2d\u53ef\u76f4\u63a5\u900f\u904e <code>data.indicator()</code> \u4f7f\u7528\uff0c\u4f8b\u5982\u8a08\u7b97 supertrend\uff1a</p> <p><pre><code>from finlab import data\n\nvalues = data.indicator('supertrend')\n</code></pre> \u82e5 TA-Lib \u7121\u5c0d\u61c9\u51fd\u5f0f\uff0c\u5c07\u6539\u7528 pandas_ta\uff08\u8a08\u7b97\u901f\u5ea6\u53ef\u80fd\u8f03\u6162\uff09\u3002</p>"}, {"location": "reference/analysis/", "title": "finlab.analysis", "text": "<p>\u7b56\u7565\u5206\u6790\u6a21\u7d44\u63d0\u4f9b\u6df1\u5ea6\u5206\u6790\u5de5\u5177,\u5f9e\u6d41\u52d5\u6027\u98a8\u96aa\u3001\u6ce2\u52d5\u7279\u6027\u3001\u6642\u671f\u7a69\u5b9a\u6027\u7b49\u591a\u500b\u89d2\u5ea6\u8a55\u4f30\u7b56\u7565\u54c1\u8cea\u3002</p>"}, {"location": "reference/analysis/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c: \u5927\u8cc7\u91d1\u7b56\u7565\u5fc5\u9808\u6aa2\u67e5\u662f\u5426\u6703\u9047\u5230\u6210\u4ea4\u91cf\u4e0d\u8db3\u3001\u6f32\u8dcc\u505c\u677f\u7b49\u554f\u984c</li> <li>\u512a\u5316\u505c\u640d\u505c\u5229: \u900f\u904e MAE/MFE \u5206\u6790\u627e\u51fa\u6700\u4f73\u7684\u505c\u640d\u505c\u5229\u9ede</li> <li>\u6aa2\u8996\u9577\u671f\u7a69\u5b9a\u6027: \u5206\u6790\u7b56\u7565\u5728\u4e0d\u540c\u5e74\u5ea6\u3001\u6708\u5ea6\u7684\u8868\u73fe\u662f\u5426\u7a69\u5b9a</li> <li>\u8a55\u4f30\u8d85\u984d\u5831\u916c: \u900f\u904e Alpha/Beta \u5206\u6790\u8861\u91cf\u7b56\u7565\u662f\u5426\u6709\u8d85\u8d8a\u5927\u76e4\u7684\u80fd\u529b</li> <li>\u81ea\u8a02\u5206\u6790\u908f\u8f2f: \u7e7c\u627f <code>Analysis</code> \u985e\u5225\u958b\u767c\u5c08\u5c6c\u7684\u5206\u6790\u6a21\u7d44</li> </ul>"}, {"location": "reference/analysis/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u5b8c\u6210\u56de\u6e2c\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\nreport = sim(position, resample='M')\n\n# 1. \u6d41\u52d5\u6027\u6aa2\u6e2c\nreport.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# 2. \u6ce2\u52d5\u5206\u6790(MAE/MFE)\nreport.display_mae_mfe_analysis()\n\n# 3. \u6642\u671f\u7a69\u5b9a\u6027\u5206\u6790\nreport.run_analysis('PeriodStatsAnalysis')\n\n# 4. Alpha/Beta \u5206\u6790\nreport.run_analysis('AlphaBetaAnalysis')\n</code></pre>"}, {"location": "reference/analysis/#_3", "title": "\u5167\u5efa\u5206\u6790\u6a21\u7d44\u5c0d\u6bd4", "text": "\u6a21\u7d44 \u7528\u9014 \u95dc\u9375\u8f38\u51fa <code>LiquidityAnalysis</code> \u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c \u6f32\u8dcc\u505c\u3001\u4f4e\u6210\u4ea4\u91cf\u3001\u8655\u7f6e\u80a1\u6bd4\u4f8b <code>MaeMfeAnalysis</code> \u6ce2\u52d5\u5206\u6790 12 \u500b\u5b50\u5716(MAE/MFE/\u52dd\u7387/Edge Ratio) <code>PeriodStatsAnalysis</code> \u6642\u671f\u7a69\u5b9a\u6027 \u5e74\u5ea6\u3001\u6708\u5ea6\u3001\u8fd1\u671f\u8868\u73fe <code>InequalityAnalysis</code> \u4e0d\u7b49\u5f0f\u56e0\u5b50 \u5831\u916c\u96c6\u4e2d\u5ea6\u3001\u57fa\u5c3c\u4fc2\u6578 <code>AlphaBetaAnalysis</code> Alpha/Beta \u8d85\u984d\u5831\u916c\u3001\u5e02\u5834\u654f\u611f\u5ea6 <code>DrawdownAnalysis</code> \u56de\u64a4\u5206\u6790 \u56de\u64a4\u4e8b\u4ef6\u3001\u6301\u7e8c\u6642\u9593"}, {"location": "reference/analysis/#_4", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u7b56\u7565\u5206\u6790\u6a21\u7d44\u5b8c\u6574\u6307\u5357\uff0c\u4e86\u89e3:</p> <ul> <li>\u6bcf\u500b\u6a21\u7d44\u7684\u8a73\u7d30\u529f\u80fd\u8207\u53c3\u6578\u8aaa\u660e</li> <li>\u5982\u4f55\u89e3\u8b80\u8f38\u51fa\u7d50\u679c\u4e26\u505a\u51fa\u6c7a\u7b56</li> <li>\u5982\u4f55\u7e7c\u627f <code>Analysis</code> \u985e\u5225\u958b\u767c\u81ea\u8a02\u5206\u6790</li> <li>\u91dd\u5c0d\u4e0d\u540c\u7b56\u7565\u985e\u578b\u7684\u5206\u6790\u91cd\u9ede</li> <li>\u5206\u6790\u7d50\u679c\u7684\u6c7a\u7b56\u6a39</li> </ul>"}, {"location": "reference/analysis/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/analysis/#liquidityanalysis-", "title": "LiquidityAnalysis - \u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c", "text": "<p>\u98a8\u96aa\u95be\u503c\u5efa\u8b70</p> <ul> <li><code>buy_high</code> \u6216 <code>sell_low</code> &gt; 10%: \u53ef\u80fd\u7121\u6cd5\u9806\u5229\u6210\u4ea4</li> <li><code>low_volume_stocks</code> &gt; 20%: \u5927\u8cc7\u91d1\u53ef\u80fd\u7121\u6cd5\u5168\u90e8\u57f7\u884c</li> <li><code>\u8655\u7f6e\u80a1</code> &gt; 5%: \u7b56\u7565\u53ef\u80fd\u5c08\u6311\u9ad8\u98a8\u96aa\u6a19\u7684</li> </ul>"}, {"location": "reference/analysis/#finlab.analysis.liquidityAnalysis.LiquidityAnalysis", "title": "finlab.analysis.liquidityAnalysis.LiquidityAnalysis", "text": "<pre><code>LiquidityAnalysis(required_volume=200000, required_turnover=1000000)\n</code></pre> <p>               Bases: <code>Analysis</code></p> <p>\u5206\u6790\u53f0\u80a1\u7b56\u7565\u6d41\u52d5\u6027\u98a8\u96aa\u9805\u76ee\u7684\u6a5f\u7387</p> <p>Note</p> <p>\u53c3\u8003VIP\u9650\u5b9a\u6587\u7ae0\u66f4\u4e86\u89e3\u6d41\u52d5\u6027\u6aa2\u6e2c\u5167\u5bb9\u7d30\u7bc0\u3002</p> <p>Args:     required_volume (int): \u8981\u6c42\u9032\u51fa\u5834\u6642\u7684\u55ae\u65e5\u6210\u4ea4\u80a1\u6578\u81f3\u5c11\u8981\u591a\u5c11\uff1f     required_turnover (int): \u8981\u6c42\u9032\u51fa\u5834\u6642\u7684\u55ae\u65e5\u6210\u4ea4\u91d1\u984d\u81f3\u5c11\u8981\u591a\u5c11\u5143\uff1f\u907f\u514d\u6210\u4ea4\u80a1\u6578\u5920\uff0c\u4f46\u56e0\u4f4e\u50f9\u80a1\u56e0\u7d20\uff0c\u9020\u6210\u80c3\u7d0d\u91cf\u4ecd\u7121\u6cd5\u7b26\u5408\u8cc7\u91d1\u9700\u6c42\u3002</p> <p>Examples:</p> <pre><code># better syntax\nreport.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# original syntax\nfrom finlab.analysis.liquidityAnalysis import LiquidityAnalysis\nreport.run_analysis(LiquidityAnalysis(required_volume=100000))\n</code></pre>"}, {"location": "reference/analysis/#finlab.analysis.liquidityAnalysis.LiquidityAnalysis.is_market_supported", "title": "is_market_supported", "text": "<pre><code>is_market_supported(market)\n</code></pre> <p>Check if the market is supported for liquidity analysis.</p> <p>Currently only Taiwan stock market is supported, as it has unique features like disposal stocks, warning stocks, full delivery stocks, and price limit regulations.</p>"}, {"location": "reference/analysis/#inequalityanalysis-", "title": "InequalityAnalysis - \u4e0d\u7b49\u5f0f\u56e0\u5b50\u5206\u6790", "text": "<p>\u7a69\u5065\u6027\u5224\u65b7</p> <ul> <li>Gini \u4fc2\u6578 &gt; 0.7: \u5831\u916c\u904e\u5ea6\u96c6\u4e2d,\u9700\u5206\u6563\u98a8\u96aa</li> <li>\u524d 5% \u80a1\u7968\u8ca2\u737b &gt; 50% \u5831\u916c: \u7b56\u7565\u7a69\u5065\u6027\u4e0d\u8db3</li> </ul>"}, {"location": "reference/analysis/#finlab.analysis.inequalityAnalysis.InequalityAnalysis", "title": "finlab.analysis.inequalityAnalysis.InequalityAnalysis", "text": "<pre><code>InequalityAnalysis(name, df=None, date_type='entry_sig_date', target='return')\n</code></pre> <p>               Bases: <code>Analysis</code></p> <p>Analyze return of trades with condition inequality</p> PARAMETER DESCRIPTION <code>name</code> <p>name of the condition</p> <p> TYPE: <code>str</code> </p> <code>df</code> <p>value used in condition. If df is None, <code>data.get(name)</code> will be automatically perform to fetch the values.</p> <p> TYPE: <code>DataFrame or None</code> DEFAULT: <code>None</code> </p> <code>date_type</code> <p>can be either <code>entry_date</code>, <code>entry_sig_date</code>, <code>exit_date</code>, <code>exit_sig_date</code>.</p> <p> TYPE: <code>str</code> DEFAULT: <code>'entry_sig_date'</code> </p> <code>target</code> <p>the target to optimize. Any column name in report.get_trades()</p> <p> TYPE: <code>str</code> DEFAULT: <code>'return'</code> </p> <p>Examples:</p> <pre><code>report.run_analysis('InequalityAnalysis', name='price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\n</code></pre>"}, {"location": "reference/analysis/#periodstatsanalysis-", "title": "PeriodStatsAnalysis - \u6642\u671f\u7a69\u5b9a\u6027\u5206\u6790", "text": "<p>\u8a55\u4f30\u6a19\u6e96</p> <ul> <li>\u7b56\u7565 sharpe_ratio &lt; benchmark: \u7b56\u7565\u9700\u6539\u9032</li> <li>\u67d0\u4e9b\u5e74\u5ea6\u8868\u73fe\u7279\u5225\u5dee: \u6aa2\u67e5\u662f\u5426\u9047\u5230\u7279\u5b9a\u5e02\u5834\u74b0\u5883</li> <li>\u8fd1\u671f\u8868\u73fe\u5927\u5e45\u8870\u9000: \u7b56\u7565\u53ef\u80fd\u5931\u6548</li> </ul>"}, {"location": "reference/analysis/#finlab.analysis.periodStatsAnalysis.PeriodStatsAnalysis", "title": "finlab.analysis.periodStatsAnalysis.PeriodStatsAnalysis", "text": "<pre><code>PeriodStatsAnalysis()\n</code></pre> <p>               Bases: <code>Analysis</code></p> <p>\u5206\u6790\u53f0\u80a1\u7b56\u7565\u7684\u4e0d\u540c\u6642\u671f\u8207\u5927\u76e4\u6307\u6a19\u4f5c\u6bd4\u8f03</p> <p>Examples:</p> <p>\u53ef\u4ee5\u57f7\u884c\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u4f86\u7522\u751f\u5206\u6790\u7d50\u679c\uff1a</p> <pre><code>report.run_analysis('PeriodStatsAnalysis')\n</code></pre> <p>\u7522\u751f\u7684\u7d50\u679c\uff1a</p> benchmark strategy ('overall_daily', 'calmar_ratio') 0.149192 0.0655645 ('overall_daily', 'sortino_ratio') 0.677986 0.447837 ('overall_daily', 'sharpe_ratio') 0.532014 0.306351 ('overall_daily', 'profit_factor') 1.20022 1.07741 ('overall_daily', 'tail_ratio') 0.914881 0.987751 ('overall_daily', 'return') 0.0835801 0.0478957 ('overall_daily', 'volatility') 0.182167 0.312543 ('overall_monthly', 'calmar_ratio') 0.155321 0.0731378 ('overall_monthly', 'sortino_ratio') 0.697382 0.439003 ('overall_monthly', 'sharpe_ratio') 0.524943 0.307292 ('overall_monthly', 'profit_factor') 1.75714 1.27059 ('overall_monthly', 'tail_ratio') 1.03322 0.903335 ('overall_monthly', 'return') 0.0836545 0.0479377 ('overall_monthly', 'volatility') 0.186989 0.316178 ('overall_yearly', 'calmar_ratio') 0.436075 0.127784 ('overall_yearly', 'sortino_ratio') 0.738327 0.694786 ('overall_yearly', 'sharpe_ratio') 0.407324 0.350986 ('overall_yearly', 'profit_factor') 2.2 1.66667 ('overall_yearly', 'tail_ratio') 1.71647 1.359 ('overall_yearly', 'return') 0.0814469 0.0663674 ('overall_yearly', 'volatility') 0.284742 0.419087"}, {"location": "reference/analysis/#alphabetaanalysis-alphabeta", "title": "AlphaBetaAnalysis - Alpha/Beta \u5206\u6790", "text": "<p>\u7406\u60f3\u6307\u6a19</p> <ul> <li>Alpha &gt; 0: \u7b56\u7565\u6709\u8d85\u984d\u5831\u916c</li> <li>Beta 0.5-1.5: \u5e02\u5834\u76f8\u95dc\u6027\u9069\u4e2d</li> <li>Beta &lt; 0: \u7b56\u7565\u8207\u5e02\u5834\u8ca0\u76f8\u95dc(\u9069\u5408\u907f\u96aa)</li> </ul>"}, {"location": "reference/analysis/#finlab.analysis.alphaBetaAnalysis.AlphaBetaAnalysis", "title": "finlab.analysis.alphaBetaAnalysis.AlphaBetaAnalysis", "text": "<pre><code>AlphaBetaAnalysis()\n</code></pre> <p>               Bases: <code>Analysis</code></p>"}, {"location": "reference/analysis/#drawdownanalysis-", "title": "DrawdownAnalysis - \u56de\u64a4\u5206\u6790", "text": "<p>\u98a8\u96aa\u63a7\u5236</p> <ul> <li>\u6700\u5927\u56de\u64a4 &gt; -50%: \u98a8\u96aa\u904e\u9ad8</li> <li>\u56de\u64a4\u6301\u7e8c\u6642\u9593 &gt; 1 \u5e74: \u7b56\u7565\u53ef\u80fd\u9577\u671f\u5931\u6548</li> </ul>"}, {"location": "reference/analysis/#finlab.analysis.drawdownAnalysis.DrawdownAnalysis", "title": "finlab.analysis.drawdownAnalysis.DrawdownAnalysis", "text": "<p>               Bases: <code>Analysis</code></p>"}, {"location": "reference/analysis/#maemfeanalysis-", "title": "MaeMfeAnalysis - \u6ce2\u52d5\u5206\u6790", "text": "<p>\u505c\u640d\u505c\u5229\u512a\u5316</p> <ol> <li>\u505c\u640d\u9ede = MAE \u7684 75 \u5206\u4f4d\u6578 \u00d7 1.2</li> <li>\u505c\u5229\u9ede = GMFE \u7684 75 \u5206\u4f4d\u6578 \u00d7 0.8</li> <li>Missed Win-profits PCT &lt; 20%: \u9069\u5408\u4f7f\u7528\u79fb\u52d5\u505c\u5229</li> </ol>"}, {"location": "reference/analysis/#finlab.analysis.maeMfeAnalysis.MaeMfeAnalysis", "title": "finlab.analysis.maeMfeAnalysis.MaeMfeAnalysis", "text": "<pre><code>MaeMfeAnalysis(violinmode='group', mfe_scatter_x='mae', **kwargs)\n</code></pre> <p>               Bases: <code>Analysis</code></p>"}, {"location": "reference/analysis/#_5", "title": "\u81ea\u8a02\u5206\u6790\u6a21\u7d44", "text": "<p>\u5047\u5982\u5e0c\u671b\u958b\u767c\u4ea4\u6613\u5206\u6790\u7cfb\u7d71\uff0c\u53ef\u4ee5\u7e7c\u627f <code>finlab.analysis.Analysis</code> \u4f86\u5be6\u505a\u5206\u6790\u3002</p>"}, {"location": "reference/analysis/#finlab.analysis.Analysis", "title": "finlab.analysis.Analysis", "text": "<p>               Bases: <code>ABC</code></p>"}, {"location": "reference/analysis/#finlab.analysis.Analysis.analyze", "title": "analyze", "text": "<pre><code>analyze(report)\n</code></pre> <p>Analyze trading report.</p> <p>One could assume self.caluclate_trade_info will be executed before self.analyze, so the <code>report.get_trades()</code> will contain the required trade info.</p>"}, {"location": "reference/analysis/#finlab.analysis.Analysis.calculate_trade_info", "title": "calculate_trade_info", "text": "<pre><code>calculate_trade_info(report)\n</code></pre> <p>Additional trade info can be calculated easily.</p> <p>User could override this function if additional trade info is required for later anlaysis.</p> <p>Examples:</p> <pre><code>from finlab.analysis import Analysis\n\nclass SomeAnalysis(Analysis):\n  def calculate_trade_info(self, report):\n    return [\n      ['\u80a1\u50f9\u6de8\u503c\u6bd4', data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'), 'entry_sig_date']\n    ]\n\nreport.run_analysis(SomeAnalysis())\ntrades = report.get_trades()\n\nassert '\u80a1\u50f9\u6de8\u503c\u6bd4@entry_sig_date' in trades.columns\n\nprint(trades)\n</code></pre>"}, {"location": "reference/analysis/#finlab.analysis.Analysis.display", "title": "display", "text": "<pre><code>display()\n</code></pre> <p>Display result</p> <p>When implement this function, returning Plotly figure instance is recommended.</p>"}, {"location": "reference/analysis/#finlab.analysis.Analysis.is_market_supported", "title": "is_market_supported", "text": "<pre><code>is_market_supported(market)\n</code></pre> <p>Check if market info is supported</p> RETURNS DESCRIPTION <code>bool</code> <p>True, support. False not support.</p>"}, {"location": "reference/analysis/#_6", "title": "\u81ea\u8a02\u7bc4\u4f8b", "text": "<pre><code>from finlab import data\nfrom finlab.analysis import Analysis\n\nclass IndustryAnalysis(Analysis):\n    \"\"\"\u7522\u696d\u5206\u6790\"\"\"\n\n    def calculate_trade_info(self, report):\n        industry = data.get('etl:industry')\n        return [['\u7522\u696d', industry, 'entry_sig_date']]\n\n    def analyze(self, report):\n        trades = report.get_trades()\n        industry_stats = trades.groupby('\u7522\u696d@entry_sig_date')['return'].agg(['count', 'mean'])\n        self.result = industry_stats.sort_values('mean', ascending=False)\n        return self.result.to_dict()\n\n    def display(self):\n        return self.result\n\n# \u4f7f\u7528\nreport.run_analysis(IndustryAnalysis())\n</code></pre>"}, {"location": "reference/analysis/#_7", "title": "\u6700\u4f73\u5be6\u8e10", "text": ""}, {"location": "reference/analysis/#_8", "title": "\u6a19\u6e96\u5206\u6790\u6d41\u7a0b", "text": "<pre><code># Step 1: \u57fa\u672c\u7e3e\u6548\u6aa2\u8996\nreport.display()\n\n# Step 2: \u6d41\u52d5\u6027\u98a8\u96aa(\u5927\u8cc7\u91d1\u5fc5\u6aa2)\nif capital &gt; 1000000:\n    report.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# Step 3: \u6ce2\u52d5\u5206\u6790(\u5fc5\u505a)\nreport.display_mae_mfe_analysis()\n\n# Step 4: \u6642\u671f\u7a69\u5b9a\u6027\nreport.run_analysis('PeriodStatsAnalysis')\n\n# Step 5: Alpha/Beta\nreport.run_analysis('AlphaBetaAnalysis')\n</code></pre>"}, {"location": "reference/analysis/#_9", "title": "\u91dd\u5c0d\u4e0d\u540c\u7b56\u7565\u985e\u578b", "text": "\u7b56\u7565\u985e\u578b \u91cd\u9ede\u5206\u6790\u6a21\u7d44 \u77ed\u7dda\u4ea4\u6613(\u65e5\u5167\u3001\u9031\u7dda) MaeMfeAnalysis \u9577\u7dda\u6295\u8cc7(\u6708\u7dda\u3001\u5b63\u7dda) PeriodStatsAnalysis \u5927\u8cc7\u91d1\u7b56\u7565(&gt; 1000 \u842c) LiquidityAnalysis \u5e02\u5834\u4e2d\u6027\u7b56\u7565 AlphaBetaAnalysis \u9ad8\u983b\u4ea4\u6613 DrawdownAnalysis"}, {"location": "reference/analysis/#_10", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44\u5b8c\u6574\u6307\u5357</li> <li>MAE/MFE \u5206\u6790\u6587\u7ae0</li> <li>\u6d41\u52d5\u6027\u6aa2\u6e2c\u6587\u7ae0</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>GitHub \u539f\u59cb\u78bc</li> </ul>"}, {"location": "reference/backtest/", "title": "finlab.backtest", "text": "<p>\u56de\u6e2c\u5f15\u64ce\u6a21\u7d44\uff0c\u7528\u65bc\u8a55\u4f30\u7b56\u7565\u5728\u6b77\u53f2\u8cc7\u6599\u4e0a\u7684\u8868\u73fe\u3002</p>"}, {"location": "reference/backtest/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u9a57\u8b49\u7b56\u7565\u908f\u8f2f: \u78ba\u8a8d\u7b56\u7565\u7684\u9032\u51fa\u5834\u908f\u8f2f\u662f\u5426\u7b26\u5408\u9810\u671f\uff0c\u6aa2\u8996\u5be6\u969b\u4ea4\u6613\u8a18\u9304</li> <li>\u8a55\u4f30\u98a8\u96aa\u5831\u916c: \u8a08\u7b97\u5e74\u5316\u5831\u916c\u3001\u590f\u666e\u7387\u3001\u6700\u5927\u56de\u64a4\u7b49\u95dc\u9375\u7e3e\u6548\u6307\u6a19</li> <li>\u512a\u5316\u7b56\u7565\u53c3\u6578: \u7d50\u5408 <code>finlab.optimize</code> \u6a21\u7d44\u6e2c\u8a66\u4e0d\u540c\u53c3\u6578\u7d44\u5408\uff08\u8abf\u5009\u983b\u7387\u3001\u505c\u640d\u505c\u5229\u7b49\uff09</li> <li>\u5c0d\u6bd4\u591a\u500b\u7b56\u7565: \u6bd4\u8f03\u4e0d\u540c\u7b56\u7565\u7684\u7e3e\u6548\u8868\u73fe\uff0c\u627e\u51fa\u6700\u9069\u5408\u7684\u4ea4\u6613\u65b9\u6cd5</li> </ul>"}, {"location": "reference/backtest/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u8f09\u5165\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u7b56\u7565\u908f\u8f2f\uff1a\u50f9\u683c\u7a81\u7834 20 \u65e5\u5747\u7dda\nma20 = close.average(20)\nposition = close &gt; ma20\n\n# \u56de\u6e2c\uff08\u6bcf\u6708\u8abf\u5009\uff0c\u55ae\u80a1\u4e0a\u9650 10%\uff09\nreport = sim(\n    position,\n    resample='M',           # \u6bcf\u6708\u8abf\u5009\n    position_limit=0.1      # \u55ae\u80a1\u6b0a\u91cd\u4e0a\u9650 10%\n)\n\n# \u986f\u793a\u7e3e\u6548\u5831\u544a\nreport.display()\n</code></pre>"}, {"location": "reference/backtest/#_3", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u6b77\u53f2\u56de\u6e2c\u5b8c\u6574\u6307\u5357\uff0c\u4e86\u89e3\uff1a</p> <ul> <li>\u5b8c\u6574\u56de\u6e2c\u53c3\u6578\u8aaa\u660e\uff08resample, position_limit, stop_loss \u7b49\uff09</li> <li>\u7e3e\u6548\u6307\u6a19\u8a73\u7d30\u89e3\u8b80\uff08\u5e74\u5316\u5831\u916c\u3001\u590f\u666e\u7387\u3001\u52dd\u7387\u7b49\uff09</li> <li>\u9032\u968e\u56de\u6e2c\u6280\u5de7\uff08\u591a\u5e02\u5834\u3001\u81ea\u8a02\u624b\u7e8c\u8cbb\u3001\u6ed1\u50f9\u8a2d\u5b9a\uff09</li> <li>\u56de\u6e2c\u5831\u544a\u7684\u6df1\u5ea6\u5206\u6790\u65b9\u6cd5</li> </ul>"}, {"location": "reference/backtest/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/backtest/#sim", "title": "sim()", "text": "<p>\u5e38\u7528\u53c3\u6578\u7d44\u5408</p> <p>\u6708\u7dda\u7b56\u7565\uff08\u9069\u5408\u4e0a\u73ed\u65cf\uff09: <pre><code>report = sim(\n    position,\n    resample='M',           # \u6bcf\u6708\u8abf\u5009\n    position_limit=0.1,     # \u55ae\u80a1\u4e0a\u9650 10%\n    upload=True             # \u4e0a\u50b3\u81f3\u96f2\u7aef\n)\n</code></pre></p> <p>\u9031\u7dda\u7b56\u7565\uff08\u9069\u5408\u7a4d\u6975\u578b\uff09: <pre><code>report = sim(\n    position,\n    resample='W',           # \u6bcf\u9031\u8abf\u5009\n    position_limit=0.05,    # \u55ae\u80a1\u4e0a\u9650 5%\uff08\u5206\u6563\u98a8\u96aa\uff09\n    trade_at_price='open'   # \u4ee5\u958b\u76e4\u50f9\u4ea4\u6613\uff08\u66f4\u4fdd\u5b88\uff09\n)\n</code></pre></p> <p>\u505c\u640d\u505c\u5229\u7b56\u7565: <pre><code># \u65b9\u6cd5 1: \u5728 sim() \u4e2d\u8a2d\u5b9a\nreport = sim(\n    position.hold_until(stop_loss=0.1, take_profit=0.2),\n    resample='M'\n)\n\n# \u65b9\u6cd5 2: \u4f7f\u7528 hold_until() \u66f4\u9748\u6d3b\nexit_condition = close &lt; ma20  # \u8dcc\u7834\u5747\u7dda\u51fa\u5834\nposition_with_exit = position.hold_until(\n    exit=exit_condition,\n    stop_loss=0.1,      # \u8667\u640d 10% \u505c\u640d\n    take_profit=0.2     # \u7372\u5229 20% \u505c\u5229\n)\nreport = sim(position_with_exit, resample='M')\n</code></pre></p> <p>\u5e38\u898b\u932f\u8aa4\u8207\u89e3\u6c7a\u65b9\u6cd5</p> <p>1. \u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304 <pre><code># \u554f\u984c\uff1a\u9032\u5834\u689d\u4ef6\u904e\u56b4\uff0cposition \u5168\u70ba False\nreport = sim(position, resample='M')\ntrades = report.get_trades()\nif len(trades) == 0:\n    print(\"\u26a0\ufe0f \u8b66\u544a\uff1a\u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304\uff01\")\n    # \u6aa2\u67e5\u9032\u5834\u6b21\u6578\n    print(f\"\u5e73\u5747\u6bcf\u65e5\u9032\u5834\u80a1\u7968\u6578\uff1a{position.sum(axis=1).mean():.1f}\")\n    print(f\"\u6700\u5927\u9032\u5834\u80a1\u7968\u6578\uff1a{position.sum(axis=1).max()}\")\n\n# \u89e3\u6c7a\uff1a\u653e\u5bec\u689d\u4ef6\u6216\u6aa2\u67e5\u8cc7\u6599\u7bc4\u570d\n</code></pre></p> <p>2. KeyError: \u65e5\u671f\u4e0d\u5b58\u5728 <pre><code># \u554f\u984c\uff1a\u8cc7\u6599\u65e5\u671f\u7bc4\u570d\u4e0d\u5339\u914d\n# \u89e3\u6c7a\uff1a\u4f7f\u7528 truncate_start \u5c0d\u9f4a\u8d77\u59cb\u65e5\u671f\nimport finlab\nfinlab.truncate_start = '2020-01-01'  # \u53ea\u56de\u6e2c 2020 \u5e74\u5f8c\u7684\u8cc7\u6599\nreport = sim(position, resample='M')\n</code></pre></p> <p>3. \u5fd8\u8a18\u8a2d\u5b9a resample \u5c0e\u81f4\u6bcf\u65e5\u8abf\u5009 <pre><code># \u932f\u8aa4\uff1a\u4ea4\u6613\u6210\u672c\u904e\u9ad8\nreport = sim(position)  # \u274c \u9810\u8a2d\u6bcf\u65e5\u8abf\u5009\n\n# \u6b63\u78ba\uff1a\u8a2d\u5b9a\u5408\u7406\u7684\u8abf\u5009\u983b\u7387\nreport = sim(position, resample='M')  # \u2705 \u6bcf\u6708\u8abf\u5009\n</code></pre></p>"}, {"location": "reference/backtest/#finlab.backtest.sim", "title": "finlab.backtest.sim", "text": "<pre><code>sim(position, resample=None, resample_offset=None, trade_at_price='close', position_limit=1, fee_ratio=1.425 / 1000, tax_ratio=3 / 1000, name='\u672a\u547d\u540d', stop_loss=None, take_profit=None, trail_stop=None, touched_exit=False, retain_cost_when_rebalance=False, stop_trading_next_period=True, live_performance_start=None, mae_mfe_window=0, mae_mfe_window_step=1, market=None, upload=True, fast_mode=False, notification_enable=False, line_access_token='')\n</code></pre> <p>Simulate the equity given the stock position history. \u56de\u6e2c\u6a21\u64ec\u80a1\u7968\u90e8\u4f4d\u6240\u7522\u751f\u7684\u6de8\u503c\u5831\u916c\u7387\u3002</p> PARAMETER DESCRIPTION <code>position</code> <p>\u8cb7\u8ce3\u8a0a\u865f\u7d00\u9304\u3002True \u70ba\u6301\u6709\uff0c False \u70ba\u7a7a\u624b\u3002 \u82e5\u9078\u64c7\u505a\u7a7aposition\uff0c\u53ea\u8981\u5c07 sim(position) \u6539\u6210\u8ca0\u7684 sim(-position.astype(float))\u5373\u53ef\u505a\u7a7a\u3002</p> <p> TYPE: <code>DataFrame or Series</code> </p> <code>resample</code> <p>\u4ea4\u6613\u9031\u671f\u3002\u5c07 position \u7684\u8a0a\u865f\u4ee5\u9031\u671f\u6027\u7684\u65b9\u5f0f\u8ad6\u52d5\u80a1\u7968\uff0c\u9810\u8a2d\u70ba\u6bcf\u5929\u63db\u80a1\u3002\u5176\u4ed6\u5e38\u7528\u6578\u503c\u70ba W\u3001 M \u3001 Q \uff08\u6bcf\u9031\u3001\u6bcf\u6708\u3001\u6bcf\u5b63\u63db\u80a1\u4e00\u6b21\uff09\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 W-Fri \u5728\u9031\u4e94\u7684\u6642\u5019\u7522\u751f\u65b0\u7684\u80a1\u7968\u6e05\u55ae\uff0c\u4e26\u4e14\u65bc\u4e0b\u9031\u4ea4\u6613\u65e5\u4e0b\u55ae\u3002</p> <ul> <li><code>D</code>: Daily</li> <li><code>W</code>: Weekly</li> <li><code>W-Wed</code>: Every Wednesday</li> <li><code>M</code>: Monthly</li> <li><code>MS</code>: Start of every month</li> <li><code>Q</code>: Quarterly</li> <li><code>QS</code>: Start of every quarter</li> </ul> <p>Note</p> <p>'D'\u8207'None'\u7684\u5dee\u5225\uff1f resample='D' \u7684\u610f\u7fa9\u70ba\u6bcf\u5929\u96a8\u80a1\u50f9\u8b8a\u5316\u505a\u518d\u5e73\u8861\uff0c\u5c31\u7b97\u7576\u5929\u80a1\u7968\u6e05\u55ae\u6c92\u8b8a\uff0c\u4f46\u80a1\u7968\u6f32\u8dcc\u5f8c\uff0c\u90e8\u4f4d\u5927\u5c0f\u6703\u8b8a\u5316\uff0c\u800c resample='D' \u6703\u5f37\u5236\u518d\u5e73\u8861\uff0c\u5e73\u5747\u5206\u6563\u98a8\u96aa\u3002</p> <p>\u4f46\u662f\u7576 resample=None \u7684\u8a71\uff0c\u5047\u5982\u6e05\u55ae\u4e0d\u8b8a\uff0c\u5247\u4e0d\u6703\u5f37\u5236\u518d\u5e73\u8861\uff0c\u53ea\u6709\u6e05\u55ae\u6539\u8b8a\u6642\uff0c\u624d\u505a\u518d\u5e73\u8861\u3002\u9069\u7528\u60c5\u5883\u5728\u8f03\u5e38\u9078\u5230\u5927\u6ce2\u6bb5\u6a19\u7684\u7684\u8da8\u52e2\u7b56\u7565\uff0c\u8f03\u6709\u6a5f\u6703\u5c07\u5f37\u52e2\u80a1\u7559\u4e0b\uff0c\u800c\u4e0d\u6703\u6c70\u5f37\u7559\u5f31\u505a\u518d\u5e73\u8861\u3002</p> <p>\u53e6\u5916 <code>resample</code> \u4e5f\u63a5\u53d7 pd.DataFrame \u4ee5\u53ca pd.Series\uff0c\u4e26\u4e14\u5c07\u5176 index \u7528\u4f86\u7576\u6210\u63db\u80a1\u7684\u6642\u9593\u9ede\uff0c\u4f8b\u5982\u4ee5\u4e0b\u7684\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import backtest, data\n\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nposition = ...\n\n# \u6708\u71df\u6536\u767c\u5e03\u6642\u624d\u63db\u80a1\nbacktest.sim(position, resample=rev)\n</code></pre> <p> TYPE: <code>(str, None, DataFrame, Series, FinlabDataFrame)</code> DEFAULT: <code>None</code> </p> <code>resample_offset</code> <p>\u4ea4\u6613\u9031\u671f\u7684\u6642\u9593\u4f4d\u79fb\uff0c\u4f8b\u5982\u3002</p> <ul> <li>'1D': \u4f4d\u79fb\u4e00\u5929</li> <li>'1H': \u4f4d\u79fb\u4e00\u5c0f\u6642</li> </ul> <p> TYPE: <code>str or None</code> DEFAULT: <code>None</code> </p> <code>trade_at_price</code> <p>\u9078\u64c7\u56de\u6e2c\u4e4b\u9084\u539f\u80a1\u50f9\u4ee5\u6536\u76e4\u50f9\u6216\u958b\u76e4\u50f9\u8a08\u7b97\uff0c\u9810\u8a2d\u70ba'close'\u3002\u53ef\u9078'close'\u3001'open'\u3001'open_close_avg'\u3001'high_low_avg'\u6216 'price_avg'\u3002</p> <p> TYPE: <code>str or DataFrame</code> DEFAULT: <code>'close'</code> </p> <code>position_limit</code> <p>maximum amount of investing a stock. \u55ae\u6a94\u6a19\u7684\u6301\u80a1\u6bd4\u4f8b\u4e0a\u9650\uff0c\u63a7\u5236\u5009\u4f4d\u98a8\u96aa\u3002\u9810\u8a2d\u70baNone\u3002\u7bc4\u4f8b\uff1a0.2\uff0c\u4ee3\u8868\u55ae\u6a94\u6a19\u7684\u6700\u591a\u6301\u6709 20 % \u90e8\u4f4d\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>1</code> </p> <code>fee_ratio</code> <p>fee ratio of buying or selling a stock. \u4ea4\u6613\u624b\u7e8c\u8cbb\u7387\uff0c\u9810\u8a2d\u70ba\u53f0\u7063\u7121\u6253\u6298\u624b\u7e8c\u8cbb 0.001425\u3002\u53ef\u8996\u500b\u4eba\u4f7f\u7528\u7684\u5238\u5546\u512a\u60e0\u8abf\u6574\u8cbb\u7387\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>1.425 / 1000</code> </p> <code>tax_ratio</code> <p>tax ratio of selling a stock. \u4ea4\u6613\u7a05\u7387\uff0c\u9810\u8a2d\u70ba\u53f0\u7063\u666e\u901a\u80a1\u4e00\u822c\u4ea4\u6613\u4ea4\u6613\u7a05\u7387 0.003\u3002\u82e5\u4ea4\u6613\u7b56\u7565\u7684\u6a19\u7684\u7686\u70baETF\uff0c\u8a18\u5f97\u8a2d\u6210 0.001\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>3 / 1000</code> </p> <code>name</code> <p>name of the strategy. \u7b56\u7565\u540d\u7a31\uff0c\u9810\u8a2d\u70ba \u672a\u6307\u540d\u3002\u7b56\u7565\u540d\u7a31\u3002\u76f8\u540c\u540d\u7a31\u4e4b\u7b56\u7565\u4e0a\u50b3\u6703\u8986\u5beb\u3002\u547d\u540d\u898f\u5247:\u5168\u82f1\u6587\u6216\u958b\u982d\u4e2d\u6587\uff0c\u4e0d\u63a5\u53d7\u958b\u982d\u82f1\u6587\u63a5\u4e2d\u6587\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'\u672a\u547d\u540d'</code> </p> <code>stop_loss</code> <p>\u505c\u640d\u57fa\u6e96\uff0c\u9810\u8a2d\u70baNone\uff0c\u4e0d\u57f7\u884c\u505c\u640d\u3002\u7bc4\u4f8b\uff1a0.1\uff0c\u4ee3\u8868\u5f9e\u518d\u5e73\u8861\u958b\u59cb\uff0c\u8667\u640d 10% \u6642\u7522\u751f\u51fa\u5834\u8a0a\u865f\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>None</code> </p> <code>take_profit</code> <p>\u505c\u5229\u57fa\u6e96\uff0c\u9810\u8a2d\u70baNone\uff0c\u4e0d\u57f7\u884c\u505c\u5229\u3002\u7bc4\u4f8b\uff1a0.1\uff0c\u4ee3\u8868\u5f9e\u518d\u5e73\u8861\u958b\u59cb\uff0c 10% \u6642\u7522\u751f\u51fa\u5834\u8a0a\u865f\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>None</code> </p> <code>trail_stop</code> <p>\u79fb\u52d5\u505c\u640d\u505c\u5229\u57fa\u6e96\uff0c\u9810\u8a2d\u70baNone\uff0c\u4e0d\u57f7\u884c\u3002\u7bc4\u4f8b\uff1a0.1\uff0c\u4ee3\u8868\u5f9e\u6700\u9ad8\u9ede\u958b\u59cb\u4e0b\u8dcc\uff0c\u8dcc\u81f3 10% \u6642\u7522\u751f\u51fa\u5834\u8a0a\u865f\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>None</code> </p> <code>touched_exit</code> <p>\u662f\u5426\u5728\u56de\u6e2c\u6642\uff0c\u4f7f\u7528\u89f8\u50f9\u505c\u640d\u505c\u5229\uff1f\u9810\u8a2d\u70ba False\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> <code>retain_cost_when_rebalance</code> <p>\u7576\u6301\u80a1\u518d\u5e73\u8861\u6642\uff0c\u5982\u6709\u80a1\u7968\u7e7c\u7e8c\u6301\u6709\uff0c\u662f\u5426\u4fdd\u7559\u539f\u672c\u9032\u5834\u7684\u6210\u672c\uff0c\u7576\u6210\u505c\u640d\u505c\u5229\u7684\u53c3\u8003\uff1f\u9810\u8a2d\u70ba False\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> <code>stop_trading_next_period</code> <p>\u7576\u671f\u5df2\u7d93\u505c\u640d\u505c\u5229\uff0c\u5247\u4e0b\u4e00\u671f\u4e0d\u8cb7\u5165\uff0c\u9810\u8a2d\u70ba True\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> <code>live_performance_start</code> <p>\u7b56\u7565\u5efa\u69cb\u7684\u65e5\u671f\uff0c\u4f8b\u5982 <code>2022-01-01</code> \u6b64\u65e5\u671f\u4e4b\u524d\uff0c\u7b56\u7565\u672a\u64b0\u5beb\uff0c\u6b64\u65e5\u671f\u4e4b\u5f8c\u5247\u8996\u70ba\u8207\u5be6\u55ae\u6709\u985e\u4f3c\u6548\u679c\uff0c\u5be6\u969b\u4e0d\u5f71\u97ff\u56de\u6e2c\u7684\u7d50\u679c\uff0c\u55ae\u7d14\u7d00\u9304\u800c\u5df2\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>mae_mfe_window</code> <p>\u8a08\u7b97mae_mfe\u65bc\u9032\u5834\u5f8c\u65bc\u4e0d\u540c\u6301\u6709\u5929\u6578\u4e0b\u7684\u6578\u64da\u8b8a\u5316\uff0c\u4e3b\u8981\u61c9\u7528\u70baedge_ratio (\u512a\u52e2\u6bd4\u7387)\u8a08\u7b97\u3002\u9810\u8a2d\u70ba0\uff0c\u5247Report.display_mae_mfe_analysis(...)\u4e2d\u7684edge_ratio\u4e0d\u6703\u986f\u73fe\u3002</p> <p> TYPE: <code>int</code> DEFAULT: <code>0</code> </p> <code>mae_mfe_window_step</code> <p>\u8207mae_mfe_window\u53c3\u6578\u505a\u642d\u914d\uff0c\u70ba\u6642\u9593\u9593\u9694\u8a2d\u5b9a\uff0c\u9810\u8a2d\u70ba1\u3002\u82e5mae_mfe_window\u8a2d20\uff0cmae_mfe_window_step\u8a2d\u5b9a\u70ba2\uff0c\u76f8\u7576\u65bcpython\u7684range(0,20,2)\uff0c\u4ee52\u65e5\u70ba\u9593\u8ddd\u8a08\u7b97mae_mfe\u3002</p> <p> TYPE: <code>int</code> DEFAULT: <code>1</code> </p> <code>market</code> <p>\u53ef\u9078\u64c7<code>'TW_STOCK', 'US_STOCK'</code>\uff0c\u5206\u5225\u70ba\u53f0\u80a1\u6216\u52a0\u5bc6\u8ca8\u5e63\uff0c \u6216\u7e7c\u627f finlab.market.Market \u958b\u767c\u56de\u6e2c\u5e02\u5834\u985e\u5225\u3002</p> <p> TYPE: <code>str or Market</code> DEFAULT: <code>None</code> </p> <code>upload</code> <p>\u4e0a\u50b3\u7b56\u7565\uff0c\u9810\u8a2d\u70baTrue\uff0c\u4e0a\u50b3\u7b56\u7565\u3002 \u7bc4\u4f8b\uff1a False\uff0c\u4e0d\u4e0a\u50b3\uff0c\u53ef\u7528 finlab.backtest.sim(position, upload=False, ...).display() \u5feb\u901f\u6aa2\u8996\u7b56\u7565\u7e3e\u6548\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> <code>fast_mode</code> <p>\u9810\u8a2d\u70baFalse\uff0c\u82e5\u8a2d\u5b9a\u70baTrue\uff0c\u5247\u6703\u4f7f\u7528\u5feb\u901f\u6a21\u5f0f\uff0c\u5feb\u901f\u6a21\u5f0f\u6703\u5ffd\u7565\u6240\u6709\u7684\u505c\u5229\u505c\u640d\u8a2d\u5b9a\uff0c\u4e26\u4e14\u53ea\u6709\u63db\u80a1\u65e5\u9032\u884c\u5831\u916c\u7387\u6a21\u64ec\uff0c\u56e0\u6b64\u6703\u6709\u4e00\u4e9b\u8aa4\u5dee\uff0c\u7576\u6301\u6709\u8f03\u591a\u6a94\u80a1\u7968\u6642\uff0c\u53ef\u4ee5\u5927\u5e45\u52a0\u901f\u56de\u6e2c\u901f\u5ea6\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> RETURNS DESCRIPTION <code>Report</code> <p>\u56de\u6e2c\u6578\u64da\u5831\u544a</p> <p>Examples:</p> <p>Assume the history of portfolio is construct as follows: When market close on 2021-12-31, the portfolio {B: 0.2, C: 0.4} is calculated. When market close on 2022-03-31, the portfolio {A:1} is calculated.</p> Stock 2330 Stock 1101 Stock 2454 2021-12-31 0% 20% 40% 2022-03-31 100% 0% 0% 2022-06-30 100% 0% 0% <p>With the portfolio, one could backtest the equity history as follows:</p> <pre><code>import pandas as pd\nfrom finlab import backtest\n\nposition = pd.DataFrame({\n    '2330': [0, 1, 1],\n    '1101': [0.2, 0, 0],\n    '2454': [0.4, 0, 0]\n}, index=pd.to_datetime(['2021-12-31', '2022-03-31', '2022-06-30']))\n\nreport = backtest.sim(position)\n</code></pre>"}, {"location": "reference/backtest/#line_notify", "title": "line_notify()", "text": "<p>LINE \u901a\u77e5\u8a2d\u5b9a</p> <ol> <li>\u524d\u5f80 LINE Notify \u53d6\u5f97\u500b\u4eba token</li> <li>\u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\uff1a <pre><code>import os\nos.environ['LINE_NOTIFY_TOKEN'] = 'YOUR_TOKEN'\n</code></pre></li> <li>\u767c\u9001\u901a\u77e5\uff1a <pre><code>from finlab.backtest import line_notify\n\n# \u7b56\u7565\u57f7\u884c\u5f8c\u767c\u9001\u5831\u544a\nreport = sim(position, resample='M')\nline_notify(f\"\u7b56\u7565\u56de\u6e2c\u5b8c\u6210\\n\u5e74\u5316\u5831\u916c\uff1a{report.stats['annual_return']:.2%}\")\n</code></pre></li> </ol>"}, {"location": "reference/backtest/#finlab.backtest.line_notify", "title": "finlab.backtest.line_notify", "text": "<pre><code>line_notify(report=None, line_access_token='', test=False, name='')\n</code></pre> <p>\u50b3\u9001\u56de\u6e2c\u7d50\u679c\u4e4b\u76ee\u524d\u90e8\u4f4d\u3001\u8fd1\u671f\u63db\u80a1\u8a0a\u606f\u81f3Line\u804a\u5929\u5ba4\u3002</p> PARAMETER DESCRIPTION <code>report</code> <p>\u56de\u6e2c\u5b8c\u7684\u7d50\u679c\u5831\u544a\u3002</p> <p> TYPE: <code>Report</code> DEFAULT: <code>None</code> </p> <code>line_access_token</code> <p>\u65bcLine Notify\u53d6\u5f97\u7684access_token(\u6b0a\u6756)\u3002\u81f3Line Notify\u767b\u5165Line\u5e33\u865f\u5f8c\uff0c\u9ede\u9078\u500b\u4eba\u9801\u9762\uff0c\u9ede\u9078\u300c\u767c\u884c\u6b0a\u6756\u300d\uff0c\u9078\u64c7\u6b32\u63a5\u6536\u8a0a\u606f\u7684\u804a\u5929\u5ba4(\u53ef\u9078\u64c71\u5c0d1\u63a5\u6536Line Notify\u901a\u77e5\u3001\u6216\u662f\u9078\u64c7\u5176\u4ed6\u7fa4\u7d44\u804a\u5929\u5ba4)\uff0c\u5373\u53ef\u53d6\u5f97\u6b0a\u6756\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>''</code> </p> <code>test</code> <p>\u662f\u5426\u9032\u884c\u50b3\u9001\u8a0a\u606f\u6e2c\u8a66\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> <code>name</code> <p>\u7b56\u7565\u540d\u7a31\uff0c\u9810\u8a2d\u70ba\u7a7a\u5b57\u4e32\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>''</code> </p> <p>Examples:</p> <p>\u6b32\u9032\u884c\u6e2c\u8a66\uff0c\u5247\u8a2d\u5b9a<code>test</code>\u53c3\u6578\u70baTrue\u3002</p> <pre><code>from finlab import backtest\n\nline_access_token = 'xxxxxxxxxxxx'\nbacktest.line_notify(line_access_token=line_access_token, test=True)\n</code></pre> <p>\u82e5\u6210\u529f\u6536\u5230\u901a\u77e5\uff0c\u5247\u6b0a\u6756\u8a2d\u5b9a\u5df2\u5b8c\u7562\uff0c\u53ef\u76f4\u63a5\u5728<code>sim</code>\u56de\u6e2c\u6a21\u7d44\u4e2d\u958b\u555f\u4f7f\u7528\uff0c\u6216\u55ae\u7368\u8abf\u7528\u6b64\u51fd\u5f0f\u767c\u9001\u56de\u6e2c\u63db\u80a1\u8a0a\u606f\u3002 \u65bcsim\u4e2d\u4f7f\u7528:</p> <pre><code>from finlab import backtest\n\nline_access_token = 'xxxxxxxxxxxx'\nposition = ...\nreport = backtest.sim(position, notification_enable =True, line_access_token = line_access_token)\n</code></pre> <p>\u5df2\u56de\u6e2c\u5b8c\uff0c\u55ae\u7368\u50b3\u8a0a\u606f\u7528:</p> <pre><code>from finlab import backtest\n\nline_access_token = 'xxxxxxxxxxxx'\nreport = backtest.sim(position)\nbacktest.line_notify(report, line_access_token=line_access_token)\n</code></pre>"}, {"location": "reference/backtest/#_4", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/backtest/#q", "title": "Q: \u56de\u6e2c\u7d50\u679c\u8207\u5be6\u76e4\u6709\u843d\u5dee\u600e\u9ebc\u8fa6\uff1f", "text": "<p>\u5e38\u898b\u539f\u56e0\u8207\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <ol> <li> <p>\u56de\u6e2c\u672a\u8003\u616e\u6ed1\u50f9\uff1a    <pre><code># \u4f7f\u7528\u958b\u76e4\u50f9\u4ea4\u6613\uff08\u66f4\u4fdd\u5b88\uff09\nreport = sim(position, trade_at_price='open', resample='M')\n</code></pre></p> </li> <li> <p>\u6210\u4ea4\u91cf\u4e0d\u8db3\uff1a    <pre><code># \u4f7f\u7528 LiquidityAnalysis \u6aa2\u6e2c\u6d41\u52d5\u6027\nfrom finlab.analysis import LiquidityAnalysis\n\nliq = LiquidityAnalysis(report)\nliq.display()  # \u67e5\u770b\u6210\u4ea4\u91cf\u98a8\u96aa\n</code></pre></p> </li> <li> <p>\u672a\u4f86\u51fd\u6578\uff08\u8cc7\u6599\u6d29\u9732\uff09\uff1a    <pre><code># \u932f\u8aa4\uff1a\u7576\u65e5\u6536\u76e4\u50f9\u505a\u5224\u65b7\uff0c\u7576\u65e5\u6536\u76e4\u50f9\u4ea4\u6613\nposition = close &gt; close.average(20)  # \u274c \u4f7f\u7528\u7576\u65e5\u6536\u76e4\u50f9\nreport = sim(position, trade_at_price='close')  # \u274c \u7576\u65e5\u6536\u76e4\u50f9\u4ea4\u6613\n\n# \u6b63\u78ba\uff1a\u9694\u65e5\u958b\u76e4\u50f9\u4ea4\u6613\nposition = close &gt; close.average(20)\nreport = sim(position, trade_at_price='open')  # \u2705 \u9694\u65e5\u958b\u76e4\u50f9\u4ea4\u6613\n</code></pre></p> </li> </ol>"}, {"location": "reference/backtest/#q_1", "title": "Q: \u5982\u4f55\u8a2d\u5b9a\u81ea\u8a02\u624b\u7e8c\u8cbb\uff1f", "text": "<pre><code>report = sim(\n    position,\n    resample='M',\n    fee_ratio=0.001425,  # \u8cb7\u8ce3\u5404 0.1425%\uff08\u5238\u5546\u624b\u7e8c\u8cbb\uff09\n    tax_ratio=0.003      # \u8ce3\u51fa\u8b49\u4ea4\u7a05 0.3%\n)\n</code></pre>"}, {"location": "reference/backtest/#q_2", "title": "Q: \u5982\u4f55\u9650\u5236\u6700\u5927\u6301\u80a1\u6578\u91cf\uff1f", "text": "<pre><code># \u65b9\u6cd5 1: \u4f7f\u7528 is_largest() \u9650\u5236\u9032\u5834\u80a1\u7968\u6578\nposition = (close &gt; ma20).is_largest(30)  # \u6700\u591a\u6301\u6709 30 \u6a94\n\n# \u65b9\u6cd5 2: \u5728 sim() \u4e2d\u9650\u5236\nreport = sim(\n    position,\n    resample='M',\n    position_limit=0.1,   # \u55ae\u80a1\u4e0a\u9650 10%\n    # \u5982\u679c position \u4e2d\u6709 50 \u6a94\uff0c\u5be6\u969b\u6700\u591a\u6301\u6709 10 \u6a94\uff08100% / 10% = 10\uff09\n)\n</code></pre>"}, {"location": "reference/backtest/#q_3", "title": "Q: \u56de\u6e2c\u901f\u5ea6\u592a\u6162\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code># 1. \u4f7f\u7528\u66f4\u9577\u7684\u8abf\u5009\u9031\u671f\nreport = sim(position, resample='Q')  # \u5b63\u5ea6\u8abf\u5009\uff08\u6bd4\u6708\u7dda\u5feb 3 \u500d\uff09\n\n# 2. \u7e2e\u77ed\u56de\u6e2c\u671f\u9593\nimport finlab\nfinlab.truncate_start = '2018-01-01'  # \u53ea\u6e2c\u8a66\u8fd1 5 \u5e74\n\n# 3. \u6e1b\u5c11\u80a1\u7968\u6578\u91cf\nposition = (close &gt; ma20).is_largest(50)  # \u53ea\u6e2c\u8a66 50 \u6a94\n</code></pre>"}, {"location": "reference/backtest/#_5", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u6b77\u53f2\u56de\u6e2c\u5b8c\u6574\u6559\u5b78 - \u6df1\u5165\u7406\u89e3\u56de\u6e2c\u5f15\u64ce</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5f9e\u7814\u7a76\u5230\u5be6\u76e4</li> <li>\u7b56\u7565\u512a\u5316\u6307\u5357 - \u627e\u51fa\u6700\u4f73\u53c3\u6578</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357 - \u505c\u640d\u505c\u5229\u5be6\u6230</li> <li>GitHub \u539f\u59cb\u78bc</li> <li>\u7bc4\u4f8b\u7b56\u7565\u96c6 - \u5b78\u7fd2\u5be6\u6230\u7bc4\u4f8b</li> </ul>"}, {"location": "reference/data/", "title": "finlab.data", "text": "<p>\u8cc7\u6599\u4e0b\u8f09\u6838\u5fc3\u6a21\u7d44\uff0c\u63d0\u4f9b\u53f0\u80a1\u8207\u7f8e\u80a1\u7684\u6b77\u53f2\u8cc7\u6599\u4e0b\u8f09\u529f\u80fd\u3002</p>"}, {"location": "reference/data/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u4e0b\u8f09\u80a1\u50f9\u3001\u8ca1\u5831\u3001\u7c4c\u78bc\u7b49\u6b77\u53f2\u8cc7\u6599</li> <li>\u7be9\u9078\u7279\u5b9a\u5e02\u5834\u6216\u985e\u80a1\u7684\u8cc7\u6599</li> <li>\u641c\u5c0b\u53ef\u7528\u7684\u8cc7\u6599\u8868\u8207\u6b04\u4f4d</li> <li>\u8a2d\u5b9a\u8cc7\u6599\u5feb\u53d6\u7b56\u7565</li> <li>\u9650\u5236\u8cc7\u6599\u4e0b\u8f09\u7bc4\u570d\u4ee5\u7bc0\u7701\u8a18\u61b6\u9ad4</li> </ul>"}, {"location": "reference/data/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/data/#_3", "title": "\u57fa\u672c\u7528\u6cd5\uff1a\u4e0b\u8f09\u8cc7\u6599", "text": "<pre><code>from finlab import data\n\n# \u4e0b\u8f09\u6536\u76e4\u50f9\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u4e0b\u8f09\u672c\u76ca\u6bd4\npe_ratio = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\n\n# \u4e0b\u8f09\u6708\u71df\u6536\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n</code></pre>"}, {"location": "reference/data/#_4", "title": "\u641c\u5c0b\u53ef\u7528\u6b04\u4f4d", "text": "<pre><code># \u641c\u5c0b\u5305\u542b\u300c\u6536\u76e4\u300d\u7684\u6b04\u4f4d\ndata.search('\u6536\u76e4')\n# \u8f38\u51fa: ['price:\u6536\u76e4\u50f9', 'etl:\u4e0d\u542b\u9664\u6b0a\u606f\u6536\u76e4\u50f9', ...]\n\n# \u641c\u5c0b\u7f8e\u80a1\u8cc7\u6599\ndata.search('close', market='us')\n</code></pre>"}, {"location": "reference/data/#_5", "title": "\u9650\u5236\u5e02\u5834\u7bc4\u570d", "text": "<pre><code># \u53ea\u53d6\u4e0a\u5e02\u516c\u53f8\u8cc7\u6599\nwith data.universe(market='TSE'):\n    close = data.get('price:\u6536\u76e4\u50f9')\n\n# \u53ea\u53d6\u7279\u5b9a\u985e\u80a1\nwith data.universe(category=['\u6c34\u6ce5\u5de5\u696d', '\u98df\u54c1\u5de5\u696d']):\n    close = data.get('price:\u6536\u76e4\u50f9')\n</code></pre>"}, {"location": "reference/data/#_6", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u8cc7\u6599\u53d6\u5f97\u8a73\u7d30\u8aaa\u660e\uff0c\u4e86\u89e3\uff1a - \u5b8c\u6574\u8cc7\u6599\u4e0b\u8f09\u6559\u5b78 - \u8cc7\u6599\u8868\u7d50\u69cb\u8aaa\u660e - \u9032\u968e\u7be9\u9078\u6280\u5de7 - \u932f\u8aa4\u8655\u7406\u65b9\u6cd5</p>"}, {"location": "reference/data/#_7", "title": "\u5168\u57df\u8b8a\u6578\u914d\u7f6e", "text": ""}, {"location": "reference/data/#_8", "title": "\u5f37\u5236\u4f7f\u7528\u96f2\u7aef/\u672c\u5730\u8cc7\u6599", "text": "<pre><code>from finlab import data\n\n# \u5f37\u5236\u4f7f\u7528\u96f2\u7aef\u8cc7\u6599\uff08\u6bcf\u6b21\u90fd\u91cd\u65b0\u4e0b\u8f09\uff09\ndata.force_cloud_download = True\n\n# \u5f37\u5236\u4f7f\u7528\u672c\u5730\u5feb\u53d6\uff08\u7121\u7db2\u8def\u74b0\u5883\uff09\ndata.use_local_data_only = True\n</code></pre>"}, {"location": "reference/data/#_9", "title": "\u9650\u5236\u8cc7\u6599\u6642\u9593\u7bc4\u570d", "text": "<pre><code># \u53ea\u4e0b\u8f09 2020-2023 \u5e74\u7684\u8cc7\u6599\uff08\u7bc0\u7701\u8a18\u61b6\u9ad4\uff09\ndata.truncate_start = '2020-01-01'\ndata.truncate_end = '2023-12-31'\n\n# \u4e4b\u5f8c\u6240\u6709 data.get() \u90fd\u6703\u5957\u7528\u6b64\u7bc4\u570d\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u5efa\u8b70\u7528\u6cd5</p> <ul> <li>\u958b\u767c\u968e\u6bb5\uff1a\u4f7f\u7528 <code>truncate_start</code> \u9650\u5236\u8cc7\u6599\u7bc4\u570d\uff0c\u52a0\u5feb\u6e2c\u8a66\u901f\u5ea6</li> <li>\u6b63\u5f0f\u56de\u6e2c\uff1a\u79fb\u9664 truncate \u9650\u5236\uff0c\u4f7f\u7528\u5b8c\u6574\u6b77\u53f2\u8cc7\u6599</li> <li>\u8a18\u61b6\u9ad4\u4e0d\u8db3\uff1a\u8a2d\u5b9a <code>truncate_start</code> \u6216\u4f7f\u7528 <code>use_local_data_only</code></li> </ul>"}, {"location": "reference/data/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/data/#dataget", "title": "data.get()", "text": "<p>\u5e38\u7528\u8cc7\u6599\u8868</p> <p>\u80a1\u50f9\u8cc7\u6599\uff1a - <code>price:\u6536\u76e4\u50f9</code> - \u6bcf\u65e5\u6536\u76e4\u50f9 - <code>price:\u958b\u76e4\u50f9</code> - \u6bcf\u65e5\u958b\u76e4\u50f9 - <code>price:\u6700\u9ad8\u50f9</code> / <code>price:\u6700\u4f4e\u50f9</code> - \u65e5\u5167\u6975\u503c - <code>price:\u6210\u4ea4\u80a1\u6578</code> - \u6210\u4ea4\u91cf</p> <p>\u8ca1\u5831\u8cc7\u6599\uff1a - <code>price_earning_ratio:\u672c\u76ca\u6bd4</code> - P/E ratio - <code>price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4</code> - P/B ratio - <code>fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387</code> - ROE - <code>financial_statement:\u6bcf\u80a1\u76c8\u9918</code> - EPS</p> <p>\u7c4c\u78bc\u8cc7\u6599\uff1a - <code>institutional_investors_trading_summary:\u6295\u4fe1\u8cb7\u8ce3\u8d85\u80a1\u6578</code> - <code>margin_transactions:\u878d\u8cc7\u4f7f\u7528\u7387</code> - <code>etl:\u5916\u8cc7\u6301\u80a1\u6bd4\u4f8b</code></p> <p>\u6708\u71df\u6536\uff1a - <code>monthly_revenue:\u7576\u6708\u71df\u6536</code> - <code>monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)</code></p> <p>\u5b8c\u6574\u5217\u8868\u8acb\u81f3 \u8cc7\u6599\u5eab\u76ee\u9304 \u67e5\u8a62\u3002</p> <p>\u5e38\u898b\u932f\u8aa4</p> <ul> <li>KeyError: \u8cc7\u6599\u8868\u540d\u7a31\u932f\u8aa4\u6216 API token \u672a\u8a2d\u5b9a</li> <li>Empty DataFrame: \u67e5\u8a62\u689d\u4ef6\u904e\u56b4\u6216\u8cc7\u6599\u4e0d\u5b58\u5728</li> <li>\u8a18\u61b6\u9ad4\u4e0d\u8db3: \u4e0b\u8f09\u8cc7\u6599\u904e\u591a\uff0c\u4f7f\u7528 <code>truncate_start</code> \u9650\u5236\u7bc4\u570d</li> </ul>"}, {"location": "reference/data/#finlab.data.get", "title": "finlab.data.get", "text": "<pre><code>get(dataset, save_to_storage=True, force_download=False)\n</code></pre> <p>\u4e0b\u8f09\u6b77\u53f2\u8cc7\u6599</p> <p>\u8acb\u81f3\u6b77\u53f2\u8cc7\u6599\u76ee\u9304 \u4f86\u7372\u5f97\u6240\u6709\u6b77\u53f2\u8cc7\u6599\u7684\u540d\u7a31\uff0c\u5373\u53ef\u4f7f\u7528\u6b64\u51fd\u5f0f\u4f86\u7372\u53d6\u6b77\u53f2\u8cc7\u6599\u3002 \u5047\u8a2d <code>save_to_storage</code> \u70ba <code>True</code> \u5247\uff0c\u7a0b\u5f0f\u6703\u81ea\u52d5\u5728\u672c\u5730\u8907\u88fd\u4e00\u4efd\uff0c\u4ee5\u907f\u514d\u91cd\u8907\u4e0b\u8f09\u5927\u91cf\u6578\u64da\u3002</p> PARAMETER DESCRIPTION <code>dataset</code> <p>The name of dataset.</p> <p> TYPE: <code>str</code> </p> <code>save_to_storage</code> <p>Whether to save the dataset to storage for later use. Default is True. The argument will be removed in the future. Please use data.set_storage(FileStorage(use_cache=True)) instead.</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> <code>force_download</code> <p>Whether to force download the dataset from cloud. Default is False.</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>financial data</p> <p>Examples:</p> <p>\u6b32\u4e0b\u8f09\u6240\u6709\u4e0a\u5e02\u4e0a\u6ac3\u4e4b\u6536\u76e4\u50f9\u6b77\u53f2\u8cc7\u6599\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u6b64\u51fd\u5f0f\u5373\u53ef:</p> <pre><code>from finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\nclose\n</code></pre> date 0015 0050 0051 0052 0053 2007-04-23 9.54 57.85 32.83 38.4 nan 2007-04-24 9.54 58.1 32.99 38.65 nan 2007-04-25 9.52 57.6 32.8 38.59 nan 2007-04-26 9.59 57.7 32.8 38.6 nan 2007-04-27 9.55 57.5 32.72 38.4 nan <p>Note</p> <p>\u4f7f\u7528 <code>data.get</code> \u6642\uff0c\u6703\u9810\u8a2d\u512a\u5148\u4e0b\u8f09\u8fd1\u671f\u8cc7\u6599\uff0c\u4e26\u8207\u672c\u5730\u8cc7\u6599\u5408\u4f75\uff0c\u4ee5\u907f\u514d\u91cd\u8907\u4e0b\u8f09\u5927\u91cf\u6578\u64da\u3002</p> <p>\u5047\u5982\u60f3\u8981\u5f37\u5236\u4e0b\u8f09\u6240\u6709\u8cc7\u6599\uff0c\u53ef\u4ee5\u5728\u4e0b\u8f09\u8cc7\u6599\u524d\uff0c\u4f7f\u7528 <pre><code>data.force_cloud_download = True\n</code></pre> \u5047\u5982\u60f3\u8981\u5f37\u5236\u4f7f\u7528\u672c\u5730\u8cc7\u6599\uff0c\u4e0d\u984d\u5916\u4e0b\u8f09\uff0c\u53ef\u4ee5\u5728\u4e0b\u8f09\u8cc7\u6599\u524d\uff0c\u4f7f\u7528 <pre><code>data.use_local_data_only = True\n</code></pre></p>"}, {"location": "reference/data/#datasearch", "title": "data.search()", "text": "<p>\u7bc4\u4f8b\uff1a</p> <pre><code># \u641c\u5c0b\u5305\u542b\u300c\u80a1\u6771\u300d\u7684\u6b04\u4f4d\ndata.search('\u80a1\u6771')\n# ['fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387', 'internal_equity_pledge:\u767e\u5206\u4e4b\u5341\u4ee5\u4e0a\u5927\u80a1\u6771\u6301\u6709\u80a1\u6578', ...]\n\n# \u641c\u5c0b\u7f8e\u80a1 PE ratio\ndata.search('pe', market='us')\n\n# \u5217\u51fa\u6240\u6709\u53f0\u80a1\u6b04\u4f4d\nall_fields = data.search()\nprint(f\"\u5171 {len(all_fields)} \u500b\u6b04\u4f4d\")\n</code></pre>"}, {"location": "reference/data/#finlab.data.search", "title": "finlab.data.search", "text": "<pre><code>search(keyword=None, market='tw')\n</code></pre> <p>\u641c\u5c0b FinLab \u8cc7\u6599\u5eab\u53ef\u7528\u7684\u8cc7\u6599\u6b04\u4f4d\u3002</p> PARAMETER DESCRIPTION <code>keyword</code> <p>\u641c\u5c0b\u95dc\u9375\u5b57\u3002\u82e5\u70ba None \u5247\u5217\u51fa\u5168\u90e8\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>market</code> <p>\u5e02\u5834\u9078\u64c7 ('tw', 'us', 'all')\u3002\u9810\u8a2d 'tw'\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'tw'</code> </p> RETURNS DESCRIPTION <code>list</code> <p>\u53ef\u7528\u65bc data.get() \u7684\u8cc7\u6599\u540d\u7a31\u5217\u8868\uff0c\u683c\u5f0f\u70ba \"table:column\"</p> <p> TYPE: <code>list</code> </p> <p>Examples:</p> <pre><code># \u5217\u51fa\u5168\u90e8\u53f0\u80a1\u8cc7\u6599\ntw_data = data.search()\n\n# \u641c\u5c0b\u53f0\u80a1\u5305\u542b '\u6536\u76e4' \u7684\u6b04\u4f4d\nclose_data = data.search('\u6536\u76e4', market='tw')\n# ['price:\u6536\u76e4\u50f9']\n\n# \u641c\u5c0b\u7f8e\u80a1\u5305\u542b 'close' \u7684\u6b04\u4f4d\nus_close = data.search('close', market='us')\n# ['us_price:close', 'us_div_adj_price:adj_close', ...]\n\n# \u641c\u5c0b\u6240\u6709\u5e02\u5834\u5305\u542b 'price' \u7684\u6b04\u4f4d\nall_price = data.search('price', market='all')\n</code></pre>"}, {"location": "reference/data/#datauniverse", "title": "data.universe()", "text": "<p>\u7bc4\u4f8b\uff1a</p> <pre><code># \u7bc4\u4f8b 1\uff1a\u53ea\u53d6\u4e0a\u5e02\u516c\u53f8\nwith data.universe(market='TSE'):\n    close = data.get('price:\u6536\u76e4\u50f9')\n    print(f\"\u4e0a\u5e02\u516c\u53f8\u6578\u91cf: {len(close.columns)}\")\n\n# \u7bc4\u4f8b 2\uff1a\u7279\u5b9a\u985e\u80a1\nwith data.universe(category=['\u534a\u5c0e\u9ad4\u696d']):\n    close = data.get('price:\u6536\u76e4\u50f9')\n\n# \u7bc4\u4f8b 3\uff1a\u5e02\u503c\u524d 100 \u5927\nwith data.universe(size=100):\n    close = data.get('price:\u6536\u76e4\u50f9')\n\n# \u7bc4\u4f8b 4\uff1a\u7d44\u5408\u689d\u4ef6\nwith data.universe(market='TSE_OTC', category=['\u96fb\u5b50\u5de5\u696d'], size=50):\n    close = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u53ef\u7528 market \u53c3\u6578\uff1a - <code>'TSE'</code> - \u4e0a\u5e02 - <code>'OTC'</code> - \u4e0a\u6ac3 - <code>'TSE_OTC'</code> - \u4e0a\u5e02+\u4e0a\u6ac3 - <code>'ALL'</code> - \u5168\u90e8\uff08\u542b\u8208\u6ac3\uff09</p>"}, {"location": "reference/data/#finlab.data.universe", "title": "finlab.data.universe", "text": ""}, {"location": "reference/data/#finlab.data.universe.universe", "title": "universe", "text": "<pre><code>universe(market='ALL', category='ALL', exclude_category=None)\n</code></pre> <p>Context manager to set a global stock universe filter for data retrieval.</p> <p>This context manager limits the set of stocks returned by functions such as <code>finlab.data.get(...)</code> and <code>finlab.data.indicator(...)</code> to a specific market and category selection. The filter is applied globally within the context and is restored after the context exits.</p>"}, {"location": "reference/data/#finlab.data.universe.universe--parameters", "title": "Parameters", "text": "<p>market : str, default 'ALL'     Market scope to include. Supported values:     - 'ALL': no market filter     - 'TSE': TWSE (sii)     - 'OTC': TPEx (otc)     - 'TSE_OTC': include both TWSE and TPEx     - 'ETF': exchange-traded funds     - 'STOCK_FUTURE': underlying of single-stock futures/equity options</p> str | list[str], default 'ALL' <p>Category name(s) to include. Supports regex-like substring matching. For example, '\u96fb\u5b50' will match '\u96fb\u5b50\u5de5\u696d', '\u96fb\u5b50\u901a\u8def\u696d', etc. When a list is provided, the union of all matched categories is included.</p> str | list[str] | None, default None <p>Category name(s) to exclude from the resulting universe. Also supports regex-like substring matching. When None, no exclusion is applied.</p>"}, {"location": "reference/data/#finlab.data.universe.universe--notes", "title": "Notes", "text": "<ul> <li>The filter is applied to the internal <code>universe_stocks</code> set, which is then   used by the data processing pipeline to select columns/rows corresponding to   the chosen stocks.</li> <li>Inside the context, calls to <code>data.get(...)</code> will return data limited to the   specified universe whenever applicable.</li> <li>After exiting the <code>with</code> block, the previous universe is restored.</li> </ul>"}, {"location": "reference/data/#finlab.data.universe.universe--examples", "title": "Examples", "text": "<p>Limit to TSE/OTC and include only specific categories:</p> <p>from finlab import data with data.universe(market='TSE_OTC', category=['\u92fc\u9435\u5de5\u696d', '\u822a\u904b\u696d']): ...     close = data.get('price:\u6536\u76e4\u50f9')</p> <p>Include categories but exclude financial-related stocks:</p> <p>from finlab import data with data.universe('TSE_OTC', ['\u92fc\u9435\u5de5\u696d', '\u822a\u904b\u696d'], exclude_category=['\u91d1\u878d']): ...     close = data.get('price:\u6536\u76e4\u50f9')</p> <p>Equivalent global (non-context) usage:</p> <p>from finlab import data data.set_universe(market='TSE_OTC', category='\u6c34\u6ce5', exclude_category='ETF') close = data.get('price:\u6536\u76e4\u50f9')</p>"}, {"location": "reference/data/#finlab.data.universe.us_universe", "title": "us_universe", "text": "<pre><code>us_universe(market='ALL', sector='ALL', industry='ALL', exchange='ALL', exclude_delisted=True, exclude_special=True)\n</code></pre> <p>Context manager to set a global stock universe filter for US market data retrieval.</p> <p>This context manager limits the set of US stocks returned by data functions to a specific market category, sector, industry, and exchange selection. The filter is applied globally within the context and is restored after the context exits.</p>"}, {"location": "reference/data/#finlab.data.universe.us_universe--parameters", "title": "Parameters", "text": "<p>market : str, default 'ALL'     Market category to include. Supported values:     - 'ALL': include all categories (default)     - 'Common Stock': both ADR and Domestic common stocks     - 'Preferred Stock': both ADR and Domestic preferred stocks     - 'ADR': American Depositary Receipts     - 'Domestic': Domestic stocks</p> str | list[str], default 'ALL' <p>Sector name(s) to include. Supports regex-like substring matching. For example, 'Technology' will match 'Technology' sector. When a list is provided, the union of all matched sectors is included.</p> str | list[str], default 'ALL' <p>Industry name(s) to include. Supports regex-like substring matching. For example, 'Software' will match 'Software - Application', 'Software - Infrastructure', etc. When a list is provided, the union of all matched industries is included.</p> str | list[str], default 'ALL' <p>Exchange name(s) to include. Common values: 'NASDAQ', 'NYSE', 'AMEX'. When a list is provided, stocks from any of the listed exchanges are included.</p> bool, default True <p>Whether to exclude delisted stocks (isdelisted='Y'). Recommended to keep as True since 61% of stocks in the dataset are delisted.</p> bool, default True <p>Whether to exclude special categories: Warrants, Rights, Units, Closed-End Funds (CEF). These categories typically lack sector/industry information.</p>"}, {"location": "reference/data/#finlab.data.universe.us_universe--notes", "title": "Notes", "text": "<ul> <li>About 61% of stocks in the us_tickers dataset are delisted (isdelisted='Y').</li> <li>ETF and CEF categories typically have None values for sector and industry.</li> <li>After filtering with default settings, approximately 5,000-7,000 active common stocks remain.</li> <li>The filter modifies the global <code>universe_stocks</code> set used by the data processing pipeline.</li> </ul>"}, {"location": "reference/data/#finlab.data.universe.us_universe--examples", "title": "Examples", "text": "<p>Limit to active NASDAQ Technology stocks:</p> <p>from finlab import data with data.us_universe(sector='Technology', exchange='NASDAQ'): ...     close = data.get('price:\u6536\u76e4\u50f9')</p> <p>Include all active common stocks on major exchanges:</p> <p>from finlab import data with data.us_universe(market='Common Stock', exchange=['NASDAQ', 'NYSE']): ...     close = data.get('price:\u6536\u76e4\u50f9')</p> <p>Include delisted stocks for historical analysis:</p> <p>from finlab import data with data.us_universe(exclude_delisted=False): ...     close = data.get('price:\u6536\u76e4\u50f9')</p>"}, {"location": "reference/data/#finlab.data.universe.set_us_universe", "title": "set_us_universe", "text": "<pre><code>set_us_universe(market='ALL', sector='ALL', industry='ALL', exchange='ALL', exclude_delisted=True, exclude_special=True)\n</code></pre> <p>Set global US stock universe filter.</p> <p>This function updates the global <code>universe_stocks</code> set to limit data retrieval to a specific subset of US stocks based on market category, sector, industry, exchange, and exclusion criteria.</p>"}, {"location": "reference/data/#finlab.data.universe.set_us_universe--parameters", "title": "Parameters", "text": "<p>market : str, default 'ALL'     Market category filter (see us_universe class for details). sector : str | list[str], default 'ALL'     Sector filter with regex-like substring matching. industry : str | list[str], default 'ALL'     Industry filter with regex-like substring matching. exchange : str | list[str], default 'ALL'     Exchange filter (e.g., 'NASDAQ', 'NYSE', 'AMEX'). exclude_delisted : bool, default True     Exclude stocks with isdelisted='Y' (recommended, as 61% are delisted). exclude_special : bool, default True     Exclude Warrants, Rights, Units, and Closed-End Funds.</p>"}, {"location": "reference/data/#finlab.data.universe.set_us_universe--notes", "title": "Notes", "text": "<p>This function modifies the global <code>universe_stocks</code> variable.</p>"}, {"location": "reference/data/#dataus_universe", "title": "data.us_universe()", "text": "<p>\u7f8e\u80a1\u5e02\u5834\u7be9\u9078\uff1a</p> <pre><code># \u53d6\u5f97 S&amp;P 500 \u6210\u5206\u80a1\nwith data.us_universe(index='SPX'):\n    close = data.get('price:close')\n\n# \u53d6\u5f97 NASDAQ 100\nwith data.us_universe(index='NDX'):\n    close = data.get('price:close')\n</code></pre>"}, {"location": "reference/data/#finlab.data.us_universe", "title": "finlab.data.us_universe", "text": "<pre><code>us_universe(market='ALL', sector='ALL', industry='ALL', exchange='ALL', exclude_delisted=True, exclude_special=True)\n</code></pre> <p>Context manager to set a global stock universe filter for US market data retrieval.</p> <p>This context manager limits the set of US stocks returned by data functions to a specific market category, sector, industry, and exchange selection. The filter is applied globally within the context and is restored after the context exits.</p>"}, {"location": "reference/data/#finlab.data.us_universe--parameters", "title": "Parameters", "text": "<p>market : str, default 'ALL'     Market category to include. Supported values:     - 'ALL': include all categories (default)     - 'Common Stock': both ADR and Domestic common stocks     - 'Preferred Stock': both ADR and Domestic preferred stocks     - 'ADR': American Depositary Receipts     - 'Domestic': Domestic stocks</p> str | list[str], default 'ALL' <p>Sector name(s) to include. Supports regex-like substring matching. For example, 'Technology' will match 'Technology' sector. When a list is provided, the union of all matched sectors is included.</p> str | list[str], default 'ALL' <p>Industry name(s) to include. Supports regex-like substring matching. For example, 'Software' will match 'Software - Application', 'Software - Infrastructure', etc. When a list is provided, the union of all matched industries is included.</p> str | list[str], default 'ALL' <p>Exchange name(s) to include. Common values: 'NASDAQ', 'NYSE', 'AMEX'. When a list is provided, stocks from any of the listed exchanges are included.</p> bool, default True <p>Whether to exclude delisted stocks (isdelisted='Y'). Recommended to keep as True since 61% of stocks in the dataset are delisted.</p> bool, default True <p>Whether to exclude special categories: Warrants, Rights, Units, Closed-End Funds (CEF). These categories typically lack sector/industry information.</p>"}, {"location": "reference/data/#finlab.data.us_universe--notes", "title": "Notes", "text": "<ul> <li>About 61% of stocks in the us_tickers dataset are delisted (isdelisted='Y').</li> <li>ETF and CEF categories typically have None values for sector and industry.</li> <li>After filtering with default settings, approximately 5,000-7,000 active common stocks remain.</li> <li>The filter modifies the global <code>universe_stocks</code> set used by the data processing pipeline.</li> </ul>"}, {"location": "reference/data/#finlab.data.us_universe--examples", "title": "Examples", "text": "<p>Limit to active NASDAQ Technology stocks:</p> <p>from finlab import data with data.us_universe(sector='Technology', exchange='NASDAQ'): ...     close = data.get('price:\u6536\u76e4\u50f9')</p> <p>Include all active common stocks on major exchanges:</p> <p>from finlab import data with data.us_universe(market='Common Stock', exchange=['NASDAQ', 'NYSE']): ...     close = data.get('price:\u6536\u76e4\u50f9')</p> <p>Include delisted stocks for historical analysis:</p> <p>from finlab import data with data.us_universe(exclude_delisted=False): ...     close = data.get('price:\u6536\u76e4\u50f9')</p>"}, {"location": "reference/data/#dataindicator", "title": "data.indicator()", "text": "<p>\u6280\u8853\u6307\u6a19\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\n# \u53d6\u5f97 MACD \u6307\u6a19\nmacd = data.indicator('macd', data.get('price:\u6536\u76e4\u50f9'))\n\n# \u53d6\u5f97 RSI \u6307\u6a19\nrsi = data.indicator('rsi', data.get('price:\u6536\u76e4\u50f9'), period=14)\n</code></pre>"}, {"location": "reference/data/#finlab.data.indicator", "title": "finlab.data.indicator", "text": "<pre><code>indicator(indname, adjust_price=False, resample='D', **kwargs)\n</code></pre> <p>\u652f\u63f4 Talib \u548c pandas_ta \u4e0a\u767e\u7a2e\u6280\u8853\u6307\u6a19\uff0c\u8a08\u7b97 2000 \u6a94\u80a1\u7968\u300110\u5e74\u7684\u6240\u6709\u8cc7\u8a0a\u3002</p> <p>\u5728\u4f7f\u7528\u9019\u500b\u51fd\u5f0f\u524d\uff0c\u9700\u8981\u5b89\u88dd\u8a08\u7b97\u6280\u8853\u6307\u6a19\u7684 Packages</p> <ul> <li>Ta-Lib</li> <li>Pandas-ta</li> </ul> PARAMETER DESCRIPTION <code>indname</code> <p>\u6307\u6a19\u540d\u7a31\uff0c \u4ee5 TA-Lib \u8209\u4f8b\uff0c\u4f8b\u5982 SMA, STOCH, RSI \u7b49\uff0c\u53ef\u4ee5\u53c3\u8003 talib \u6587\u4ef6\u3002</p> <p>\u4ee5 Pandas-ta \u8209\u4f8b\uff0c\u4f8b\u5982 supertrend, ssf \u7b49\uff0c\u53ef\u4ee5\u53c3\u8003 Pandas-ta \u6587\u4ef6\u3002</p> <p> TYPE: <code>str</code> </p> <code>adjust_price</code> <p>\u662f\u5426\u4f7f\u7528\u9084\u539f\u80a1\u50f9\u8a08\u7b97\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> <code>resample</code> <p>\u6280\u8853\u6307\u6a19\u50f9\u683c\u9031\u671f\uff0cex: <code>D</code> \u4ee3\u8868\u65e5\u7dda, <code>W</code> \u4ee3\u8868\u9031\u7dda, <code>M</code> \u4ee3\u8868\u6708\u7dda\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'D'</code> </p> <code>market</code> <p>\u5e02\u5834\u9078\u64c7\uff0cex: <code>TW_STOCK</code> \u4ee3\u8868\u53f0\u80a1, <code>US_STOCK</code> \u4ee3\u8868\u7f8e\u80a1\u3002</p> <p> TYPE: <code>str</code> </p> <code>**kwargs</code> <p>\u6280\u8853\u6307\u6a19\u7684\u53c3\u6578\u8a2d\u5b9a\uff0cTA-Lib \u4e2d\u7684 RSI \u70ba\u4f8b\uff0c\u8abf\u6574\u9805\u70ba\u8a08\u7b97\u9031\u671f <code>timeperiod=14</code>\u3002</p> <p> TYPE: <code>dict</code> DEFAULT: <code>{}</code> </p> <p>\u5efa\u8b70\u4f7f\u7528\u8005\u53ef\u4ee5\u5148\u53c3\u8003\u4ee5\u4e0b\u7bc4\u4f8b\uff0c\u4e26\u4e14\u642d\u914d talib\u5b98\u65b9\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u638c\u63e1\u88fd\u4f5c\u6280\u8853\u6307\u6a19\u7684\u65b9\u6cd5\u4e86\u3002</p>"}, {"location": "reference/data/#_10", "title": "\u5feb\u53d6\u7ba1\u7406", "text": "<p>\u81ea\u8a02\u5feb\u53d6\u7b56\u7565\uff1a</p> <pre><code>from finlab.data import set_storage, FileStorage\n\n# \u4f7f\u7528\u81ea\u8a02\u8cc7\u6599\u593e\nstorage = FileStorage('/path/to/custom/cache')\nset_storage(storage)\n\n# \u4e4b\u5f8c\u6240\u6709\u8cc7\u6599\u6703\u5feb\u53d6\u5230\u6307\u5b9a\u4f4d\u7f6e\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre>"}, {"location": "reference/data/#finlab.data.set_storage", "title": "finlab.data.set_storage", "text": "<pre><code>set_storage(storage)\n</code></pre> <p>\u8a2d\u5b9a\u672c\u5730\u7aef\u5132\u5b58\u6b77\u53f2\u8cc7\u6599\u7684\u65b9\u5f0f \u5047\u8a2d\u4f7f\u7528 <code>data.get</code> \u7372\u53d6\u6b77\u53f2\u8cc7\u6599\u5247\uff0c\u5728\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0c\u7a0b\u5f0f\u6703\u81ea\u52d5\u5728\u672c\u5730\u8907\u88fd\u4e00\u4efd\uff0c\u4ee5\u907f\u514d\u91cd\u8907\u4e0b\u8f09\u5927\u91cf\u6578\u64da\u3002 storage \u5c31\u662f\u7528\u4f86\u5132\u5b58\u6b77\u53f2\u8cc7\u6599\u7684\u63a5\u53e3\u3002\u6211\u5011\u63d0\u4f9b\u5169\u7a2e <code>storage</code> \u63a5\u53e3\uff0c\u5206\u5225\u662f <code>finlab.data.CacheStorage</code> (\u9810\u8a2d) \u4ee5\u53ca <code>finlab.data.FileStorage</code>\u3002\u524d\u8005\u662f\u76f4\u63a5\u5b58\u5728\u8a18\u61b6\u9ad4\u4e2d\uff0c\u5f8c\u8005\u662f\u5b58\u5728\u6a94\u6848\u4e2d\u3002\u8a73\u60c5\u8acb\u53c3\u8003 <code>CacheStorage</code> \u548c <code>FileStorage</code> \u4f86\u7372\u5f97\u66f4\u8a73\u7d30\u7684\u8cc7\u8a0a\u3002 \u5728\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0c\u7a0b\u5f0f\u6703\u81ea\u52d5\u4f7f\u7528 <code>finlab.data.FileStorage</code> \u4e26\u5c07\u91cd\u8907\u7d22\u53d6\u4e4b\u6b77\u53f2\u8cc7\u6599\u5b58\u5728\u4f5c\u696d\u7cfb\u7d71\u9810\u8a2d\u300c\u66ab\u6642\u8cc7\u6599\u593e\u300d\u3002</p> PARAMETER DESCRIPTION <code>storage</code> <p>The interface of storage</p> <p> TYPE: <code>Storage</code> </p> <p>Examples:</p> <p>\u6b32\u5207\u63db\u6210\u4ee5\u6a94\u6848\u65b9\u5f0f\u5132\u5b58\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u4e4b\u65b9\u5f0f\uff1a</p> <pre><code>from finlab import data\ndata.set_storage(data.FileStorage())\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u53ef\u4ee5\u5728\u672c\u5730\u7aef\u7684 <code>./finlab_db/price#\u6536\u76e4\u50f9.pickle</code> \u4e2d\uff0c\u770b\u5230\u4e0b\u8f09\u7684\u8cc7\u6599\uff0c \u53ef\u4ee5\u4f7f\u7528 <code>pickle</code> \u8abf\u95b1\u6b77\u53f2\u8cc7\u6599\uff1a <pre><code>import pickle\nclose = pickle.load(open('finlab_db/price#\u6536\u76e4\u50f9.pickle', 'rb'))\n</code></pre></p>"}, {"location": "reference/data/#finlab.data.CacheStorage", "title": "finlab.data.CacheStorage", "text": "<pre><code>CacheStorage()\n</code></pre> <p>\u5c07\u6b77\u53f2\u8cc7\u6599\u5132\u5b58\u65bc\u5feb\u53d6\u4e2d</p> <p>Examples:</p> <p>\u6b32\u5207\u63db\u6210\u4ee5\u6a94\u6848\u65b9\u5f0f\u5132\u5b58\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u4e4b\u65b9\u5f0f\uff1a</p> <pre><code>from finlab import data\ndata.set_storage(data.CacheStorage())\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u53ef\u4ee5\u76f4\u63a5\u8abf\u95b1\u5feb\u53d6\u8cc7\u6599\uff1a</p> <pre><code>close = data._storage._cache['price:\u6536\u76e4\u50f9']\n</code></pre>"}, {"location": "reference/data/#finlab.data.FileStorage", "title": "finlab.data.FileStorage", "text": "<pre><code>FileStorage(path=None, use_cache=True)\n</code></pre> <p>\u5c07\u6b77\u53f2\u8cc7\u6599\u5132\u5b58\u65bc\u6a94\u6848\u4e2d</p> PARAMETER DESCRIPTION <code>path</code> <p>\u8cc7\u6599\u5132\u5b58\u7684\u8def\u5f91</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>use_cache</code> <p>\u662f\u5426\u984d\u5916\u4f7f\u7528\u5feb\u53d6\uff0c\u5c07\u8cc7\u6599\u8907\u88fd\u4e00\u4efd\u5230\u8a18\u61b6\u9ad4\u4e2d\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> <p>Examples:</p> <p>\u6b32\u5207\u63db\u6210\u4ee5\u6a94\u6848\u65b9\u5f0f\u5132\u5b58\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u4e4b\u65b9\u5f0f\uff1a</p> <pre><code>from finlab import data\ndata.set_storage(data.FileStorage())\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre> <p>\u53ef\u4ee5\u5728\u672c\u5730\u7aef\u7684 <code>./finlab_db/price#\u6536\u76e4\u50f9.pickle</code> \u4e2d\uff0c\u770b\u5230\u4e0b\u8f09\u7684\u8cc7\u6599\uff0c \u53ef\u4ee5\u4f7f\u7528 <code>pickle</code> \u8abf\u95b1\u6b77\u53f2\u8cc7\u6599\uff1a <pre><code>import pickle\nclose = pickle.load(open('finlab_db/price#\u6536\u76e4\u50f9.pickle', 'rb'))\n</code></pre></p>"}, {"location": "reference/data/#finlab.data.FileStorage.diagnose", "title": "diagnose", "text": "<pre><code>diagnose(dataset=None)\n</code></pre> <p>\u8a3a\u65b7\u672c\u5730\u5132\u5b58\u72c0\u614b</p> PARAMETER DESCRIPTION <code>dataset</code> <p>\u6307\u5b9a\u8981\u6aa2\u67e5\u7684\u8cc7\u6599\u96c6\u540d\u7a31\uff0c\u4f8b\u5982 'price:\u6536\u76e4\u50f9'\u3002\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u5247\u5217\u51fa\u6240\u6709\u672c\u5730\u8cc7\u6599\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <p>Examples:</p> <pre><code>from finlab import data\ndata._storage.diagnose()  # \u5217\u51fa\u6240\u6709\u672c\u5730\u8cc7\u6599\ndata._storage.diagnose('price:\u6536\u76e4\u50f9')  # \u6aa2\u67e5\u7279\u5b9a\u8cc7\u6599\u96c6\n</code></pre>"}, {"location": "reference/data/#_11", "title": "\u5176\u4ed6\u5de5\u5177", "text": ""}, {"location": "reference/data/#finlab.data.get_strategies", "title": "finlab.data.get_strategies", "text": "<pre><code>get_strategies(api_token=None)\n</code></pre> <p>\u53d6\u5f97\u5df2\u4e0a\u50b3\u91cf\u5316\u5e73\u53f0\u7684\u7b56\u7565\u56de\u50b3\u8cc7\u6599\u3002</p> <p>\u53ef\u53d6\u5f97\u81ea\u5df1\u7b56\u7565\u5100\u8868\u677f\u4e0a\u7684\u6578\u64da\uff0c\u4f8b\u5982\u6bcf\u500b\u7b56\u7565\u7684\u5831\u916c\u7387\u66f2\u7dda\u3001\u5831\u916c\u7387\u7d71\u8a08\u3001\u590f\u666e\u7387\u3001\u8fd1\u671f\u90e8\u4f4d\u3001\u8fd1\u671f\u63db\u80a1\u65e5...\uff0c \u9019\u4e9b\u6578\u64da\u53ef\u4ee5\u7528\u4f86\u9032\u884c\u591a\u7b56\u7565\u5f59\u6574\u7684\u61c9\u7528\u5594\uff01</p> PARAMETER DESCRIPTION <code>api_token</code> <p>\u82e5\u672a\u5e36\u5165finlab\u6a21\u7d44\u7684api_token\uff0c\u6703\u81ea\u52d5\u8df3\u51faGUI\u9801\u9762\uff0c              \u8907\u88fd\u7db2\u9801\u5167\u7684api_token\u8cbc\u81f3\u8f38\u5165\u6b04\u4f4d\u5373\u53ef\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <p>Returns:     (dict): strategies data Response detail:</p> <pre><code>``` py\n{\n  strategy1:{\n    'asset_type': '',\n    'drawdown_details': {\n       '2015-06-04': {\n         'End': '2015-11-03',\n         'Length': 152,\n         'drawdown': -0.19879090089478024\n         },\n         ...\n      },\n    'fee_ratio': 0.000475,\n    'last_trading_date': '2022-06-10',\n    'last_updated': 'Sun, 03 Jul 2022 12:02:27 GMT',\n    'ndays_return': {\n      '1': -0.01132480035770611,\n      '10': -0.0014737286933147464,\n      '20': -0.06658015749110646,\n      '5': -0.002292995729485159,\n      '60': -0.010108700314771735\n      },\n    'next_trading_date': '2022-06-10',\n    'positions': {\n      '1413 \u5b8f\u6d32': {\n        'entry_date': '2022-05-10',\n        'entry_price': 10.05,\n        'exit_date': '',\n        'next_weight': 0.1,\n        'return': -0.010945273631840613,\n        'status': '\u8cb7\u9032',\n        'weight': 0.1479332345384493\n        },\n      'last_updated': 'Sun, 03 Jul 2022 12:02:27 GMT',\n      'next_trading_date': '2022-06-10',\n      'trade_at': 'open',\n      'update_date': '2022-06-10'\n      },\n    'return_table': {\n      '2014': {\n        'Apr': 0.0,\n        'Aug': 0.06315180932606546,\n        'Dec': 0.0537589857541485,\n        'Feb': 0.0,\n        'Jan': 0.0,\n        'Jul': 0.02937490104459939,\n        'Jun': 0.01367930162104769,\n        'Mar': 0.0,\n        'May': 0.0,\n        'Nov': -0.0014734320286596825,\n        'Oct': -0.045082529665408266,\n        'Sep': 0.04630906972509852,\n        'YTD': 0.16626214846456966\n        },\n        ...\n      },\n    'returns': {\n      'time': [\n        '2014-06-10',\n        '2014-06-11',\n        '2014-06-12',\n        ...\n        ],\n      'value': [\n        100,\n        99.9,\n        100.2,\n        ...\n        ]\n      },\n    'stats': {\n      'avg_down_month': -0.03304015302646822,\n      'avg_drawdown': -0.0238021414698247,\n      'avg_drawdown_days': 19.77952755905512,\n      'avg_up_month': 0.05293384465715908,\n      'cagr': 0.33236021285588846,\n      'calmar': 1.65261094975066,\n      'daily_kurt': 4.008888367138843,\n      'daily_mean': 0.3090784769257415,\n      'daily_sharpe': 1.747909002374217,\n      'daily_skew': -0.6966018726321078,\n      'daily_sortino': 2.8300677082214034,\n      ...\n      },\n    'tax_ratio': 0.003,\n    'trade_at': 'open',\n    'update_date': '2022-06-10'\n    },\n  strategy2:{...},\n  ...}\n```\n</code></pre>"}, {"location": "reference/data/#_12", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/data/#q", "title": "Q: \u5982\u4f55\u77e5\u9053\u6709\u54ea\u4e9b\u8cc7\u6599\u53ef\u4ee5\u4e0b\u8f09\uff1f", "text": "<p>\u65b9\u6cd5 1\uff1a\u4f7f\u7528 search() <pre><code># \u5217\u51fa\u6240\u6709\u6b04\u4f4d\nall_fields = data.search()\nfor field in all_fields[:10]:\n    print(field)\n</code></pre></p> <p>\u65b9\u6cd5 2\uff1a\u67e5\u770b\u7dda\u4e0a\u8cc7\u6599\u5eab \u524d\u5f80 FinLab \u8cc7\u6599\u5eab\u76ee\u9304 \u700f\u89bd\u5b8c\u6574\u5217\u8868\u3002</p>"}, {"location": "reference/data/#q_1", "title": "Q: \u4e0b\u8f09\u8cc7\u6599\u5f88\u6162\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code># \u65b9\u6cd5 1\uff1a\u9650\u5236\u6642\u9593\u7bc4\u570d\ndata.truncate_start = '2020-01-01'\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528\u5feb\u53d6\uff08\u7b2c\u4e8c\u6b21\u6703\u5f88\u5feb\uff09\nclose = data.get('price:\u6536\u76e4\u50f9')  # \u7b2c\u4e00\u6b21\u6162\nclose = data.get('price:\u6536\u76e4\u50f9')  # \u7b2c\u4e8c\u6b21\u5feb\uff08\u4f7f\u7528\u5feb\u53d6\uff09\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 universe \u9650\u5236\u80a1\u7968\u6578\u91cf\nwith data.universe(size=100):\n    close = data.get('price:\u6536\u76e4\u50f9')  # \u53ea\u4e0b\u8f09 100 \u6a94\n</code></pre>"}, {"location": "reference/data/#q-keyerror-price", "title": "Q: KeyError: 'price:\u6536\u76e4\u50f9' \u600e\u9ebc\u8fa6\uff1f", "text": "<p>\u53ef\u80fd\u539f\u56e0\uff1a 1. \u672a\u767b\u5165 - \u57f7\u884c <code>finlab.login()</code> \u6216 <code>finlab.login('YOUR_TOKEN')</code> 2. \u6b04\u4f4d\u540d\u7a31\u932f\u8aa4 - \u4f7f\u7528 <code>data.search('\u6536\u76e4')</code> \u78ba\u8a8d\u6b63\u78ba\u540d\u7a31 3. API token \u7121\u6548 - \u91cd\u65b0\u53d6\u5f97 token</p> <pre><code>import finlab\n\n# \u6aa2\u67e5\u662f\u5426\u5df2\u767b\u5165\ntry:\n    token, token_type = finlab.get_token()\n    print(f\"\u2705 \u5df2\u767b\u5165\uff08{token_type}\uff09\")\nexcept:\n    print(\"\u274c \u672a\u767b\u5165\uff0c\u8acb\u57f7\u884c finlab.login()\")\n</code></pre>"}, {"location": "reference/data/#q_2", "title": "Q: \u5982\u4f55\u4e0b\u8f09\u7f8e\u80a1\u8cc7\u6599\uff1f", "text": "<pre><code>from finlab import data\n\n# \u7f8e\u80a1\u6536\u76e4\u50f9\nus_close = data.get('price:close', market='us')\n\n# \u641c\u5c0b\u7f8e\u80a1\u6b04\u4f4d\nus_fields = data.search(market='us')\n</code></pre>"}, {"location": "reference/data/#q_3", "title": "Q: \u8cc7\u6599\u6709\u7f3a\u5931\u503c\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code>close = data.get('price:\u6536\u76e4\u50f9')\n\n# \u6aa2\u67e5\u7f3a\u5931\u503c\nprint(f\"\u7f3a\u5931\u503c\u6bd4\u4f8b: {close.isna().sum().sum() / close.size:.2%}\")\n\n# \u586b\u88dc\u7f3a\u5931\u503c\nclose_filled = close.fillna(method='ffill')  # \u5411\u524d\u586b\u88dc\n\n# \u6216\u522a\u9664\u6709\u7f3a\u5931\u503c\u7684\u80a1\u7968\nclose_clean = close.dropna(axis=1, thresh=len(close)*0.8)  # \u4fdd\u7559 80% \u4ee5\u4e0a\u8cc7\u6599\u7684\u80a1\u7968\n</code></pre>"}, {"location": "reference/data/#q_4", "title": "Q: \u5982\u4f55\u7bc0\u7701\u8a18\u61b6\u9ad4\uff1f", "text": "<pre><code># \u65b9\u6cd5 1\uff1a\u9650\u5236\u6642\u9593\u7bc4\u570d\ndata.truncate_start = '2020-01-01'\n\n# \u65b9\u6cd5 2\uff1a\u5206\u6279\u8655\u7406\nall_stocks = close.columns\nfor batch in [all_stocks[i:i+100] for i in range(0, len(all_stocks), 100)]:\n    batch_close = close[batch]\n    # \u8655\u7406 100 \u6a94...\n\n# \u65b9\u6cd5 3\uff1a\u53ea\u4e0b\u8f09\u9700\u8981\u7684\u6b04\u4f4d\n# \u4e0d\u8981\u4e00\u6b21 data.get() \u592a\u591a\u8cc7\u6599\u8868\n</code></pre>"}, {"location": "reference/data/#_13", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u8cc7\u6599\u53d6\u5f97\u8a73\u7d30\u6559\u5b78 - \u5b8c\u6574\u4f7f\u7528\u6307\u5357</li> <li>FinLab \u8cc7\u6599\u5eab\u76ee\u9304 - \u6240\u6709\u53ef\u7528\u8cc7\u6599\u8868</li> <li>\u5feb\u901f\u4e0a\u624b\u6307\u5357 - \u65b0\u624b\u5165\u9580</li> <li>\u5e38\u898b\u554f\u984c FAQ - \u66f4\u591a\u7591\u96e3\u6392\u89e3</li> </ul>"}, {"location": "reference/dataframe/", "title": "finlab.dataframe", "text": "<p>FinlabDataFrame \u662f pandas DataFrame \u7684\u64f4\u5145\u985e\u5225\uff0c\u5c08\u70ba\u80a1\u7968\u7b56\u7565\u958b\u767c\u8a2d\u8a08\u3002</p>"}, {"location": "reference/dataframe/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u81ea\u52d5\u5c0d\u9f4a\u4e0d\u540c\u983b\u7387\u7684\u8cc7\u6599\uff08\u65e5\u3001\u9031\u3001\u6708\u3001\u5b63\uff09</li> <li>\u5feb\u901f\u9032\u884c\u9078\u80a1\u64cd\u4f5c\uff08\u6392\u540d\u3001\u7be9\u9078\u524d N \u540d\uff09</li> <li>\u8a08\u7b97\u79fb\u52d5\u5e73\u5747\u8207\u6280\u8853\u6307\u6a19</li> <li>\u7ba1\u7406\u9032\u51fa\u5834\u8a0a\u865f\uff08\u6301\u5009\u81f3\u505c\u640d/\u505c\u5229\uff09</li> <li>\u7522\u696d\u4e2d\u6027\u5316\uff08neutralize\uff09</li> </ul>"}, {"location": "reference/dataframe/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/dataframe/#_3", "title": "\u81ea\u52d5\u5c0d\u9f4a\u8207\u9078\u80a1", "text": "<pre><code>from finlab import data\n\n# data.get() \u56de\u50b3\u7684\u90fd\u662f FinlabDataFrame\nclose = data.get('price:\u6536\u76e4\u50f9')  # \u65e5\u983b\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')  # \u6708\u983b\n\n# \u81ea\u52d5\u5c0d\u9f4a\u65e5\u671f\uff08revenue \u6703\u81ea\u52d5\u586b\u88dc\u5230\u65e5\u983b\uff09\nposition = (close &gt; close.average(20)) &amp; (revenue &gt; 1e8)\n</code></pre>"}, {"location": "reference/dataframe/#_4", "title": "\u6392\u540d\u8207\u7be9\u9078", "text": "<pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nmarketcap = data.get('etl:market_value')\n\n# \u9078\u64c7\u5e02\u503c\u6700\u5c0f\u7684 30 \u6a94\nsmall_cap = marketcap.is_smallest(30)\n\n# \u9078\u64c7\u6f32\u5e45\u6700\u5927\u7684 20 \u6a94\nmomentum = (close / close.shift(20)).is_largest(20)\n\n# \u7d44\u5408\u7b56\u7565\nposition = small_cap &amp; momentum\n</code></pre>"}, {"location": "reference/dataframe/#_5", "title": "\u6301\u5009\u7ba1\u7406", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\n\n# \u6301\u5009\u81f3\u505c\u640d 10% \u6216\u505c\u5229 20%\nposition_with_stops = position.hold_until(stop_loss=0.1, take_profit=0.2)\n\n# \u56de\u6e2c\nreport = sim(position_with_stops, resample='M')\nreport.display()\n</code></pre>"}, {"location": "reference/dataframe/#finlabdataframe-vs-pandas-dataframe", "title": "FinlabDataFrame vs pandas DataFrame", "text": "\u7279\u6027 pandas DataFrame FinlabDataFrame \u57fa\u672c\u64cd\u4f5c \u2705 \u5b8c\u5168\u652f\u63f4 \u2705 \u5b8c\u5168\u652f\u63f4\uff08\u7e7c\u627f pandas\uff09 \u81ea\u52d5\u5c0d\u9f4a \u274c \u9700\u624b\u52d5\u8655\u7406 \u2705 \u81ea\u52d5\u5c0d\u9f4a\u4e0d\u540c\u983b\u7387\u8cc7\u6599 \u9078\u80a1\u65b9\u6cd5 \u274c \u9700\u81ea\u884c\u64b0\u5beb \u2705 \u5167\u5efa <code>is_largest()</code>, <code>is_smallest()</code> \u6280\u8853\u6307\u6a19 \u274c \u9700\u984d\u5916\u5957\u4ef6 \u2705 \u5167\u5efa <code>average()</code>, <code>rise()</code>, <code>fall()</code> \u6301\u5009\u7ba1\u7406 \u274c \u9700\u81ea\u884c\u64b0\u5beb \u2705 \u5167\u5efa <code>hold_until()</code>, <code>exit_when()</code> \u7522\u696d\u5206\u6790 \u274c \u9700\u81ea\u884c\u64b0\u5beb \u2705 \u5167\u5efa <code>industry_rank()</code>, <code>neutralize_industry()</code>"}, {"location": "reference/dataframe/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/dataframe/#finlabdataframe_1", "title": "FinlabDataFrame", "text": "<p>FinlabDataFrame \u4e3b\u8981\u65b9\u6cd5\uff1a</p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame", "title": "finlab.dataframe.FinlabDataFrame", "text": "<pre><code>FinlabDataFrame(*args, **kwargs)\n</code></pre> <p>               Bases: <code>DataFrame</code></p> <p>\u56de\u6e2c\u8a9e\u6cd5\u7cd6 \u9664\u4e86\u4f7f\u7528\u719f\u6089\u7684 Pandas \u8a9e\u6cd5\u5916\uff0c\u6211\u5011\u4e5f\u63d0\u4f9b\u5f88\u591a\u8a9e\u6cd5\u7cd6\uff0c\u8b93\u5927\u5bb6\u958b\u767c\u7a0b\u5f0f\u6642\uff0c\u53ef\u4ee5\u7528\u7c21\u6613\u7684\u8a9e\u6cd5\u5b8c\u6210\u8907\u96dc\u7684\u529f\u80fd\uff0c\u8b93\u958b\u767c\u7b56\u7565\u66f4\u7c21\u6f54\uff01 \u6211\u5011\u5c07\u6240\u6709\u7684\u8a9e\u6cd5\u7cd6\u5305\u88f9\u5728 <code>FinlabDataFrame</code> \u4e2d\uff0c\u7528\u8d77\u4f86\u8ddf <code>pd.DataFrame</code> \u4e00\u6a23\uff0c\u4f46\u662f\u591a\u4e86\u5f88\u591a\u529f\u80fd\uff01 \u53ea\u8981\u4f7f\u7528 <code>finlab.data.get()</code> \u6240\u7372\u5f97\u7684\u8cc7\u6599\uff0c\u7686\u70ba <code>FinlabDataFrame</code> \u683c\u5f0f\uff0c \u63a5\u4e0b\u4f86\u6211\u5011\u5c31\u4f86\u770b\u770b\uff0c <code>FinlabDataFrame</code> \u6709\u54ea\u4e9b\u597d\u7528\u7684\u8a9e\u6cd5\u7cd6\u5427\uff01</p> <p>\u7576\u8cc7\u6599\u65e5\u671f\u6c92\u6709\u5c0d\u9f4a\uff08\u4f8b\u5982: \u8ca1\u5831 vs \u6536\u76e4\u50f9 vs \u6708\u5831\uff09\u6642\uff0c\u5728\u4f7f\u7528\u4ee5\u4e0b\u904b\u7b97\u7b26\u865f\uff1a <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&amp;</code>, <code>|</code>, <code>~</code>\uff0c \u4e0d\u9700\u8981\u5148\u5c07\u8cc7\u6599\u5c0d\u9f4a\uff0c\u56e0\u70ba <code>FinlabDataFrame</code> \u6703\u81ea\u52d5\u5e6b\u4f60\u8655\u7406\uff0c\u4ee5\u4e0b\u662f\u793a\u610f\u5716\u3002</p> <p></p> <p>\u4ee5\u4e0b\u662f\u7bc4\u4f8b\uff1a<code>cond1</code> \u8207 <code>cond2</code> \u5206\u5225\u70ba\u300c\u6bcf\u5929\u300d\uff0c\u548c\u300c\u6bcf\u5b63\u300d\u7684\u8cc7\u6599\uff0c\u5047\u5982\u8981\u53d6\u4ea4\u96c6\u7684\u6642\u9593\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u8a9e\u6cd5\uff1a</p> <p><pre><code>from finlab import data\n# \u53d6\u5f97 FinlabDataFrame\nclose = data.get('price:\u6536\u76e4\u50f9')\nroa = data.get('fundamental_features:ROA\u7a05\u5f8c\u606f\u524d')\n\n# \u904b\u7b97\u5169\u500b\u9078\u80a1\u689d\u4ef6\u4ea4\u96c6\ncond1 = close &gt; 37\ncond2 = roa &gt; 0\ncond_1_2 = cond1 &amp; cond2\n</code></pre> \u64f7\u53d6 1101 \u53f0\u6ce5 \u7684\u8a0a\u865f\u5982\u4e0b\u5716\uff0c\u53ef\u4ee5\u770b\u5230 <code>cond1</code> \u8ddf <code>cond2</code> \u8a0a\u865f\u7684\u983b\u7387\u96d6\u7136\u4e0d\u76f8\u540c\uff0c \u4f46\u662f\u7531\u65bc <code>cond1</code> \u8ddf <code>cond2</code> \u662f <code>FinlabDataFrame</code>\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u53d6\u4ea4\u96c6\uff0c\u800c\u4e0d\u7528\u8655\u7406\u8cc7\u6599\u983b\u7387\u5c0d\u9f4a\u7684\u554f\u984c\u3002  </p> <p>\u7e3d\u7d50\u4f86\u8aaa\uff0cFinlabDataFrame \u8207\u4e00\u822c dataframe \u552f\u4e8c\u4e0d\u540c\u4e4b\u8655\uff1a 1. \u591a\u4e86\u4e00\u4e9b method\uff0c\u5982<code>df.is_largest()</code>, <code>df.sustain()</code>...\u7b49\u3002 2. \u5728\u505a\u56db\u5247\u904b\u7b97\u3001\u4e0d\u7b49\u5f0f\u904b\u7b97\u524d\uff0c\u6703\u5c07 df1\u3001df2 \u7684 index \u53d6\u806f\u96c6\uff0ccolumn \u53d6\u4ea4\u96c6\u3002</p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.average", "title": "average", "text": "<pre><code>average(n)\n</code></pre> <p>\u53d6 n \u7b46\u79fb\u52d5\u5e73\u5747</p> <p>\u82e5\u80a1\u7968\u5728\u6642\u9593\u7a97\u683c\u5167\uff0c\u6709 N/2 \u7b46 NaN\uff0c\u5247\u6703\u7522\u751f NaN\u3002 Args:   n (positive-int): \u8a2d\u5b9a\u79fb\u52d5\u7a97\u683c\u6578\u3002 Returns:   (pd.DataFrame): data Examples:     \u80a1\u50f9\u5728\u5747\u7dda\u4e4b\u4e0a     <pre><code>from finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\nsma = close.average(10)\ncond = close &gt; sma\n</code></pre>     \u53ea\u9700\u8981\u7c21\u55ae\u7684\u8a9e\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5c07\u5176\u4e2d\u4e00\u90e8\u5206\u7684\u8a0a\u865f\u7e6a\u88fd\u51fa\u4f86\u6aa2\u67e5\uff1a     <pre><code>import matplotlib.pyplot as plt\n\nclose.loc['2021', '2330'].plot()\nsma.loc['2021', '2330'].plot()\ncond.loc['2021', '2330'].mul(20).add(500).plot()\n\nplt.legend(['close', 'sma', 'cond'])\n</code></pre> </p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.deadline", "title": "deadline", "text": "<pre><code>deadline()\n</code></pre> <p>\u8ca1\u52d9\u7d22\u5f15\u8f49\u63db\u6210\u516c\u544a\u622a\u6b62\u65e5</p> <p>\u5c07\u8ca1\u52d9\u5b63\u5831 (ex:2022Q1) \u5f9e\u6587\u5b57\u683c\u5f0f\u8f49\u70ba\u516c\u544a\u622a\u6b62\u65e5\u7684datetime\u683c\u5f0f\uff0c \u901a\u5e38\u4f7f\u7528\u60c5\u5883\u70ba\u5c0d\u4e0d\u540c\u9031\u671f\u7684dataframe\u505areindex\uff0c\u5e38\u7528\u65bc\u4ee5\u516c\u544a\u622a\u6b62\u65e5\u4f5c\u70ba\u8a0a\u865f\u7522\u751f\u65e5\u3002 Returns:   (pd.DataFrame): data Examples:     <pre><code>data.get('financial_statement:\u73fe\u91d1\u53ca\u7d04\u7576\u73fe\u91d1').deadline()\ndata.get('monthly_revenue:\u7576\u6708\u71df\u6536').deadline()\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.fall", "title": "fall", "text": "<pre><code>fall(n=1)\n</code></pre> <p>\u6578\u503c\u4e0b\u964d\u4e2d</p> <p>\u53d6\u662f\u5426\u6bd4\u524d\u7b2cn\u7b46\u4f4e\uff0c\u82e5\u7b26\u5408\u689d\u4ef6\u7684\u503c\u5247\u70baTrue\uff0c\u53cd\u4e4b\u70baFalse\u3002  Args:   n (positive-int): \u8a2d\u5b9a\u6bd4\u8f03\u524d\u7b2cn\u7b46\u4f4e\u3002 Returns:   (pd.DataFrame): data Examples:     \u6536\u76e4\u50f9\u662f\u5426\u4f4e\u65bc10\u65e5\u524d\u80a1\u50f9     <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').fall(10)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.groupby_category", "title": "groupby_category", "text": "<pre><code>groupby_category()\n</code></pre> <p>\u8cc7\u6599\u6309\u7522\u696d\u5206\u7fa4</p> <p>\u985e\u4f3c <code>pd.DataFrame.groupby()</code>\u7684\u8655\u7406\u6548\u679c\u3002 Returns:   (pd.DataFrame): data Examples:   \u534a\u5c0e\u9ad4\u5e73\u5747\u80a1\u50f9\u6de8\u503c\u6bd4\u6642\u9593\u5e8f\u5217     <pre><code>from finlab import data\npe = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\npe.groupby_category().mean()['\u534a\u5c0e\u9ad4'].plot()\n</code></pre> </p> <pre><code>\u5168\u7403 2020 \u91cf\u5316\u5bec\u9b06\u52a0\u4e0a\u6676\u7247\u77ed\u7f3a\uff0c\u4f7f\u5f97\u534a\u5c0e\u9ad4\u80a1\u50f9\u6de8\u503c\u6bd4\u885d\u9ad8\u3002\n</code></pre>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.hold_until", "title": "hold_until", "text": "<pre><code>hold_until(exit, nstocks_limit=None, stop_loss=-np.inf, take_profit=np.inf, trade_at='close', rank=None)\n</code></pre> <p>\u8a0a\u865f\u9032\u51fa\u5834</p> <p>\u9019\u5927\u6982\u662f\u6240\u6709\u7b56\u7565\u64b0\u5beb\u4e2d\uff0c\u6700\u91cd\u8981\u7684\u8a9e\u6cd5\u7cd6\uff0c\u4e0a\u8ff0\u8a9e\u6cd5\u4e2d <code>entries</code> \u70ba\u9032\u5834\u8a0a\u865f\uff0c\u800c <code>exits</code> \u662f\u51fa\u5834\u8a0a\u865f\u3002\u6240\u4ee5 <code>entries.hold_until(exits)</code> \uff0c\u5c31\u662f\u9032\u5834\u8a0a\u865f\u70ba <code>True</code> \u6642\uff0c\u8cb7\u5165\u4e26\u6301\u6709\u8a72\u6a94\u80a1\u7968\uff0c\u76f4\u5230\u51fa\u5834\u8a0a\u865f\u70ba <code>True</code> \u5247\u8ce3\u51fa\u3002  \u6b64\u51fd\u5f0f\u6709\u5f88\u591a\u7d30\u90e8\u8a2d\u5b9a\uff0c\u53ef\u4ee5\u8b93\u4f60\u6700\u591a\u9078\u64c7 N \u6a94\u80a1\u7968\u505a\u8f2a\u52d5\u3002\u53e6\u5916\uff0c\u7576\u8d85\u904e N \u6a94\u9032\u5834\u8a0a\u865f\u767c\u751f\uff0c\u4e5f\u53ef\u4ee5\u6309\u7167\u5ba2\u5236\u5316\u7684\u6392\u5e8f\uff0c\u9078\u64c7\u512a\u5148\u9078\u5165\u7684\u80a1\u7968\u3002\u6700\u5f8c\uff0c\u53ef\u4ee5\u8a2d\u5b9a\u50f9\u683c\u6ce2\u52d5\u7576\u8f2a\u52d5\u8a0a\u865f\uff0c\u4f86\u589e\u52a0\u51fa\u5834\u7684\u6642\u6a5f\u9ede\u3002</p> PARAMETER DESCRIPTION <code>exit</code> <p>\u51fa\u5834\u8a0a\u865f\u3002</p> <p> TYPE: <code>Dataframe</code> </p> <code>nstocks_limit (int)`</code> <p>\u8f2a\u52d5\u6a94\u6578\u4e0a\u9650\uff0c\u9810\u8a2d\u70baNone\u3002</p> <p> </p> <code>stop_loss</code> <p>\u50f9\u683c\u6ce2\u52d5\u8f2a\u52d5\u8a0a\u865f\uff0c\u9810\u8a2d\u70baNone\uff0c\u4e0d\u751f\u6210\u8f2a\u52d5\u8a0a\u865f\u3002\u7bc4\u4f8b\uff1a0.1\uff0c\u4ee3\u8868\u6210\u672c\u50f9\u4e0b\u8dcc 10% \u6642\u7522\u751f\u51fa\u5834\u8a0a\u865f\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>-inf</code> </p> <code>take_profit</code> <p>\u50f9\u683c\u6ce2\u52d5\u8f2a\u52d5\u8a0a\u865f\uff0c\u9810\u8a2d\u70baNone\uff0c\u4e0d\u751f\u6210\u8f2a\u52d5\u8a0a\u865f\u3002\u7bc4\u4f8b\uff1a0.1\uff0c\u4ee3\u8868\u6210\u672c\u50f9\u4e0a\u6f32 10% \u6642\u7522\u751f\u51fa\u5834\u8a0a\u865f\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>inf</code> </p> <code>trade_at</code> <p>\u50f9\u683c\u6ce2\u52d5\u8f2a\u52d5\u8a0a\u865f\u53c3\u8003\u50f9\uff0c\u9810\u8a2d\u70ba'close'\u3002\u53ef\u9078 <code>close</code> \u6216 <code>open</code>\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'close'</code> </p> <code>rank</code> <p>\u7576\u5929\u9032\u5834\u8a0a\u865f\u6578\u91cf\u8d85\u904e nstocks_limit \u6642\uff0c\u4ee5 rank \u6578\u503c\u8d8a\u5927\u7684\u80a1\u7968\u512a\u5148\u9032\u5834\u3002</p> <p> TYPE: <code>Dataframe</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>data</p> <p>Examples:</p> <p>\u50f9\u683c &gt; 20 \u65e5\u5747\u7dda\u5165\u5834, \u50f9\u683c &lt; 60 \u65e5\u5747\u7dda\u51fa\u5834\uff0c\u6700\u591a\u6301\u670910\u6a94\uff0c\u8d85\u904e 10 \u500b\u9032\u5834\u8a0a\u865f\uff0c\u5247\u4ee5\u80a1\u50f9\u6de8\u503c\u6bd4\u5c0f\u7684\u80a1\u7968\u512a\u5148\u9078\u5165\u3002 <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\n\nsma20 = close.average(20)\nsma60 = close.average(60)\n\nentries = close &gt; sma20\nexits = close &lt; sma60\n\n#pb\u524d10\u5c0f\u7684\u6a19\u7684\u505a\u8f2a\u52d5\nposition = entries.hold_until(exits, nstocks_limit=10, rank=-pb)\nsim(position)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.index_str_to_date", "title": "index_str_to_date", "text": "<pre><code>index_str_to_date()\n</code></pre> <p>\u8ca1\u52d9\u6708\u5b63\u5831\u7d22\u5f15\u683c\u5f0f\u8f49\u63db</p> <p>\u5c07\u4ee5\u4e0b\u8cc7\u6599\u7684\u7d22\u5f15\u8f49\u63db\u6210datetime\u683c\u5f0f:</p> <p>\u8ca1\u52d9\u5b63\u5831 (ex:2022-Q1) \u5f9e\u6587\u5b57\u683c\u5f0f\u8f49\u70ba\u8ca1\u5831\u96fb\u5b50\u6a94\u8cc7\u6599\u4e0a\u50b3\u65e5\u3002</p> <p>\u901a\u5e38\u4f7f\u7528\u60c5\u5883\u70ba\u5c0d\u4e0d\u540c\u9031\u671f\u7684dataframe\u505areindex\uff0c\u5e38\u7528\u65bc\u4ee5\u516c\u544a\u622a\u6b62\u65e5\u4f5c\u70ba\u8a0a\u865f\u7522\u751f\u65e5\u3002</p> RETURNS DESCRIPTION <code>DataFrame</code> <p>data</p> <p>Examples:</p> <pre><code>data.get('financial_statement:\u73fe\u91d1\u53ca\u7d04\u7576\u73fe\u91d1').index_str_to_date()\n</code></pre>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.industry_rank", "title": "industry_rank", "text": "<pre><code>industry_rank(categories=None)\n</code></pre> <p>\u8a08\u7b97\u7522\u696d ranking \u6392\u540d\uff0c0 \u4ee3\u8868\u7522\u696d\u5167\u6700\u4f4e\uff0c1 \u4ee3\u8868\u7522\u696d\u5167\u6700\u9ad8 Args:   categories (list of str): \u6b32\u8003\u616e\u7684\u7522\u696d\uff0cex: ['\u8cbf\u6613\u767e\u8ca8', '\u96f2\u7aef\u904b\u7b97']\uff0c\u9810\u8a2d\u70ba\u5168\u7522\u696d\uff0c\u8acb\u53c3\u8003 <code>data.get('security_industry_themes')</code> \u4e2d\u7684\u7522\u696d\u9805\u76ee\u3002 Examples:     \u672c\u610f\u6bd4\u7522\u696d\u6392\u540d\u5206\u6578     <pre><code>from finlab import data\n\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\npe_rank = pe.industry_rank()\nprint(pe_rank)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.is_entry", "title": "is_entry", "text": "<pre><code>is_entry()\n</code></pre> <p>\u9032\u5834\u9ede</p> <p>\u53d6\u9032\u5834\u8a0a\u865f\u9ede\uff0c\u82e5\u7b26\u5408\u689d\u4ef6\u7684\u503c\u5247\u70baTrue\uff0c\u53cd\u4e4b\u70baFalse\u3002 Returns:   (pd.DataFrame): data Examples:   \u7b56\u7565\u70ba\u6bcf\u65e5\u6536\u76e4\u50f9\u524d10\u9ad8\uff0c\u53d6\u9032\u5834\u9ede\u3002     <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').is_largest(10).is_entry()\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.is_exit", "title": "is_exit", "text": "<pre><code>is_exit()\n</code></pre> <p>\u51fa\u5834\u9ede</p> <p>\u53d6\u51fa\u5834\u8a0a\u865f\u9ede\uff0c\u82e5\u7b26\u5408\u689d\u4ef6\u7684\u503c\u5247\u70ba True\uff0c\u53cd\u4e4b\u70ba False\u3002 Returns:   (pd.DataFrame): data Examples:   \u7b56\u7565\u70ba\u6bcf\u65e5\u6536\u76e4\u50f9\u524d10\u9ad8\uff0c\u53d6\u51fa\u5834\u9ede\u3002     <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').is_largest(10).is_exit()\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.is_largest", "title": "is_largest", "text": "<pre><code>is_largest(n)\n</code></pre> <p>\u53d6\u6bcf\u5217\u524d n \u7b46\u5927\u7684\u6578\u503c</p> <p>\u82e5\u7b26\u5408 <code>True</code> \uff0c\u53cd\u4e4b\u70ba <code>False</code> \u3002\u7528\u4f86\u7be9\u9078\u6bcf\u5929\u6578\u503c\u6700\u5927\u7684\u80a1\u7968\u3002</p> <p> Args:   n (positive-int): \u8a2d\u5b9a\u6bcf\u5217\u524d n \u7b46\u5927\u7684\u6578\u503c\u3002 Returns:   (pd.DataFrame): data Examples:     \u6bcf\u5b63 ROA \u524d 10 \u540d\u7684\u80a1\u7968     <pre><code>from finlab import data\n\nroa = data.get('fundamental_features:ROA\u7a05\u5f8c\u606f\u524d')\ngood_stocks = roa.is_largest(10)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.is_smallest", "title": "is_smallest", "text": "<pre><code>is_smallest(n)\n</code></pre> <p>\u53d6\u6bcf\u5217\u524d n \u7b46\u5c0f\u7684\u6578\u503c</p> <p>\u82e5\u7b26\u5408 <code>True</code> \uff0c\u53cd\u4e4b\u70ba <code>False</code> \u3002\u7528\u4f86\u7be9\u9078\u6bcf\u5929\u6578\u503c\u6700\u5c0f\u7684\u80a1\u7968\u3002 Args:   n (positive-int): \u8a2d\u5b9a\u6bcf\u5217\u524d n \u7b46\u5c0f\u7684\u6578\u503c\u3002 Returns:   (pd.DataFrame): data Examples:     \u80a1\u50f9\u6de8\u503c\u6bd4\u6700\u5c0f\u7684 10 \u6a94\u80a1\u7968     <pre><code>from finlab import data\n\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\ncheap_stocks = pb.is_smallest(10)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.neutralize", "title": "neutralize", "text": "<pre><code>neutralize(neutralizers, add_const=True)\n</code></pre> <p>Multi-factor cross-sectional neutralization</p> <p>Performs cross-sectional regression to neutralize factors from the data. The residuals from regressing self on the neutralizers are returned.</p> PARAMETER DESCRIPTION <code>neutralizers</code> <p>Factor(s) to neutralize against. Can be: - A single DataFrame - A list of DataFrames - A dict of DataFrames (keys are factor names)</p> <p> TYPE: <code>Union[DataFrame, list[DataFrame], dict[str, DataFrame]]</code> </p> <code>add_const</code> <p>Whether to add a constant term to the regression. Default True.</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> RETURNS DESCRIPTION <code>FinlabDataFrame</code> <p>Neutralized data (regression residuals)</p> <p>Examples:</p> <p>Neutralize a factor against size: <pre><code>from finlab import data\n\nfactor = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nsize = data.get('fundamental_features:\u5e02\u503c')\n\nneutralized = factor.neutralize(size)\n</code></pre></p> <p>Neutralize against multiple factors using a list: <pre><code>neutralized = factor.neutralize([size, beta])\n</code></pre></p> <p>Neutralize against multiple factors using a dict: <pre><code>neutralized = factor.neutralize({\n    'size': size,\n    'size2': size ** 2,\n    'beta': beta,\n})\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.neutralize_industry", "title": "neutralize_industry", "text": "<pre><code>neutralize_industry(categories=None, add_const=True)\n</code></pre> <p>Industry neutralization using dummy variables</p> <p>Performs cross-sectional regression to neutralize industry effects from the data. Each stock is assigned to an industry, and the factor is regressed on industry dummy variables. The residuals (industry-neutral factor) are returned.</p> PARAMETER DESCRIPTION <code>categories</code> <p>Optional DataFrame with 'stock_id' and 'category' columns. If not provided, uses <code>data.get('security_categories')</code>.</p> <p> TYPE: <code>DataFrame</code> DEFAULT: <code>None</code> </p> <code>add_const</code> <p>Whether to add a constant term to the regression. Default True. Note: When using industry dummies, adding a constant creates multicollinearity, so one industry dummy is automatically dropped when add_const=True.</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> RETURNS DESCRIPTION <code>FinlabDataFrame</code> <p>Industry-neutralized data (regression residuals)</p> <p>Examples:</p> <p>Neutralize a factor against industry: <pre><code>from finlab import data\n\nfactor = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nneutralized = factor.neutralize_industry()\n</code></pre></p> <p>Using custom categories: <pre><code>custom_cats = pd.DataFrame({\n    'stock_id': ['2330', '2317', '1101'],\n    'category': ['\u534a\u5c0e\u9ad4', '\u96fb\u5b50', '\u6c34\u6ce5']\n})\nneutralized = factor.neutralize_industry(categories=custom_cats)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.quantile_row", "title": "quantile_row", "text": "<pre><code>quantile_row(c)\n</code></pre> <p>\u80a1\u7968\u7576\u5929\u6578\u503c\u5206\u4f4d\u6578</p> <p>\u53d6\u5f97\u6bcf\u5217c\u5b9a\u5206\u4f4d\u6578\u7684\u503c\u3002 Args:   c (positive-int): \u8a2d\u5b9a\u6bcf\u5217 n \u5b9a\u5206\u4f4d\u6578\u7684\u503c\u3002 Returns:   (pd.DataFrame): data Examples:     \u53d6\u6bcf\u65e5\u80a1\u50f9\u524d90\uff05\u5206\u4f4d\u6578     <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').quantile_row(0.9)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.rank", "title": "rank", "text": "<pre><code>rank(*args, valid=None, **kwargs)\n</code></pre> <p>Cross-sectional or time-series ranking.</p> PARAMETER DESCRIPTION <code>valid</code> <p>\u53ea\u6709 valid \u70ba True \u7684 cell \u624d\u53c3\u8207\u6392\u540d\u3002 valid \u70ba False/NaN \u7684 cell \u5728\u6392\u540d\u524d\u8a2d\u70ba NaN\uff0c \u56e0\u6b64\u4e0d\u5f71\u97ff pct=True \u7684\u5206\u6bcd\u3002 \u5e38\u898b\u7528\u6cd5\uff1afillna \u5f8c\u50b3\u5165\u539f\u59cb notna() mask\uff0c \u907f\u514d\u65b0\u4e0a\u5e02\u6216\u6b77\u53f2\u4e0d\u8db3\u7684\u80a1\u7968\u6c61\u67d3\u767e\u5206\u4f4d\u6392\u540d\u3002</p> <p> TYPE: <code>DataFrame or Series of bool</code> DEFAULT: <code>None</code> </p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.rise", "title": "rise", "text": "<pre><code>rise(n=1)\n</code></pre> <p>\u6578\u503c\u4e0a\u5347\u4e2d</p> <p>\u53d6\u662f\u5426\u6bd4\u524d\u7b2cn\u7b46\u9ad8\uff0c\u82e5\u7b26\u5408\u689d\u4ef6\u7684\u503c\u5247\u70baTrue\uff0c\u53cd\u4e4b\u70baFalse\u3002  Args:   n (positive-int): \u8a2d\u5b9a\u6bd4\u8f03\u524d\u7b2cn\u7b46\u9ad8\u3002 Returns:   (pd.DataFrame): data Examples:     \u6536\u76e4\u50f9\u662f\u5426\u9ad8\u65bc10\u65e5\u524d\u80a1\u50f9     <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').rise(10)\n</code></pre></p>"}, {"location": "reference/dataframe/#finlab.dataframe.FinlabDataFrame.sustain", "title": "sustain", "text": "<pre><code>sustain(nwindow, nsatisfy=None)\n</code></pre> <p>\u6301\u7e8c N \u5929\u6eff\u8db3\u689d\u4ef6</p> <p>\u53d6\u79fb\u52d5 nwindow \u7b46\u52a0\u7e3d\u5927\u65bc\u7b49\u65bcnsatisfy\uff0c\u82e5\u7b26\u5408\u689d\u4ef6\u7684\u503c\u5247\u70baTrue\uff0c\u53cd\u4e4b\u70baFalse\u3002</p> PARAMETER DESCRIPTION <code>nwindow</code> <p>\u8a2d\u5b9a\u79fb\u52d5\u7a97\u683c\u3002</p> <p> TYPE: <code>positive - int</code> </p> <code>nsatisfy</code> <p>\u8a2d\u5b9a\u79fb\u52d5\u7a97\u683c\u8a08\u7b97\u5f8c\u6700\u4f4e\u6eff\u8db3\u6578\u503c\u3002</p> <p> TYPE: <code>positive - int</code> DEFAULT: <code>None</code> </p> <p>Returns:   (pd.DataFrame): data Examples:     \u6536\u76e4\u50f9\u662f\u5426\u9023\u5169\u65e5\u4e0a\u6f32     <pre><code>from finlab import data\ndata.get('price:\u6536\u76e4\u50f9').rise().sustain(2)\n</code></pre></p>"}, {"location": "reference/dataframe/#_6", "title": "\u9078\u80a1\u8207\u6392\u540d", "text": "\u65b9\u6cd5 \u8aaa\u660e \u7bc4\u4f8b <code>is_largest(n)</code> \u9078\u64c7\u6700\u5927\u7684 N \u500b\u503c <code>marketcap.is_largest(30)</code> <code>is_smallest(n)</code> \u9078\u64c7\u6700\u5c0f\u7684 N \u500b\u503c <code>pe_ratio.is_smallest(20)</code> <code>rank()</code> \u8a08\u7b97\u6392\u540d\uff08\u652f\u63f4\u7522\u696d\u6392\u540d\uff09 <code>close.rank(pct=True)</code> <code>industry_rank()</code> \u7522\u696d\u5167\u6392\u540d <code>close.industry_rank()</code>"}, {"location": "reference/dataframe/#_7", "title": "\u6280\u8853\u6307\u6a19", "text": "\u65b9\u6cd5 \u8aaa\u660e \u7bc4\u4f8b <code>average(n)</code> N \u671f\u79fb\u52d5\u5e73\u5747 <code>close.average(20)</code> <code>rise(n)</code> \u9023\u7e8c N \u671f\u4e0a\u6f32 <code>close.rise(3)</code> <code>fall(n)</code> \u9023\u7e8c N \u671f\u4e0b\u8dcc <code>close.fall(2)</code> <code>sustain(n)</code> \u689d\u4ef6\u6301\u7e8c N \u671f <code>(close &gt; ma20).sustain(5)</code>"}, {"location": "reference/dataframe/#_8", "title": "\u6301\u5009\u7ba1\u7406", "text": "\u65b9\u6cd5 \u8aaa\u660e \u7bc4\u4f8b <code>hold_until()</code> \u6301\u5009\u81f3\u505c\u640d/\u505c\u5229 <code>position.hold_until(stop_loss=0.1)</code> <code>exit_when()</code> \u9047\u5230\u689d\u4ef6\u51fa\u5834 <code>position.exit_when(close &lt; ma20)</code> <code>entry_price()</code> \u53d6\u5f97\u9032\u5834\u50f9\u683c <code>position.entry_price('close')</code>"}, {"location": "reference/dataframe/#_9", "title": "\u7522\u696d\u5206\u6790", "text": "\u65b9\u6cd5 \u8aaa\u660e \u7bc4\u4f8b <code>neutralize_industry()</code> \u7522\u696d\u4e2d\u6027\u5316 <code>factor.neutralize_industry()</code> <code>groupby_category()</code> \u6309\u7522\u696d\u5206\u7d44 <code>close.groupby_category().mean()</code>"}, {"location": "reference/dataframe/#average", "title": "average()", "text": "<p>\u8a08\u7b97\u79fb\u52d5\u5e73\u5747\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# 20 \u65e5\u5747\u7dda\nma20 = close.average(20)\n\n# 60 \u65e5\u5747\u7dda\nma60 = close.average(60)\n\n# \u5747\u7dda\u4ea4\u53c9\u7b56\u7565\ngolden_cross = ma20 &gt; ma60\n</code></pre> <p>\u8207 pandas rolling() \u7684\u5dee\u7570</p> <ul> <li><code>average(20)</code> \u7b49\u540c\u65bc <code>rolling(20).mean()</code></li> <li>\u66f4\u7c21\u6f54\u6613\u8b80</li> <li>\u56de\u50b3\u503c\u4ecd\u70ba FinlabDataFrame\uff0c\u53ef\u7e7c\u7e8c\u4e32\u63a5\u5176\u4ed6\u65b9\u6cd5</li> </ul>"}, {"location": "reference/dataframe/#is_largest-is_smallest", "title": "is_largest() / is_smallest()", "text": "<p>\u9078\u64c7\u6392\u540d\u524d/\u5f8c N \u540d\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nmarketcap = data.get('etl:market_value')\n\n# \u9078\u64c7\u5e02\u503c\u6700\u5c0f\u7684 30 \u6a94\uff08\u5c0f\u578b\u80a1\uff09\nsmall_cap = marketcap.is_smallest(30)\n\n# \u9078\u64c7\u6f32\u5e45\u6700\u5927\u7684 20 \u6a94\uff08\u52d5\u80fd\u80a1\uff09\nmomentum = (close / close.shift(20)).is_largest(20)\n\n# \u7d44\u5408\uff1a\u5c0f\u578b\u80a1\u4e2d\u7684\u52d5\u80fd\u80a1\nposition = small_cap &amp; momentum\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9805</p> <ul> <li><code>is_largest(n)</code> \u6bcf\u671f\uff08\u6bcf\u65e5/\u6bcf\u6708\uff09\u90fd\u6703\u91cd\u65b0\u6392\u540d</li> <li>\u82e5\u80a1\u7968\u6578\u5c11\u65bc N\uff0c\u5247\u5168\u9078</li> <li>\u56de\u50b3 Boolean DataFrame\uff08True \u8868\u793a\u9078\u4e2d\uff09</li> </ul>"}, {"location": "reference/dataframe/#rank", "title": "rank()", "text": "<p>\u8a08\u7b97\u6392\u540d\uff08\u652f\u63f4\u767e\u5206\u6bd4\u6392\u540d\uff09\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nmarketcap = data.get('etl:market_value')\n\n# \u8a08\u7b97\u767e\u5206\u4f4d\u6392\u540d\uff080-1\uff09\ncap_rank = marketcap.rank(pct=True, axis=1)\n\n# \u9078\u64c7\u5e02\u503c\u524d 30%\nposition = cap_rank &gt; 0.7\n\n# \u6216\u4f7f\u7528 is_largest\uff08\u66f4\u76f4\u89c0\uff09\nposition = marketcap.is_largest(int(len(marketcap.columns) * 0.3))\n</code></pre>"}, {"location": "reference/dataframe/#industry_rank", "title": "industry_rank()", "text": "<p>\u7522\u696d\u5167\u6392\u540d\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u8a08\u7b97\u7522\u696d\u5167\u6392\u540d\uff080-1\uff09\nindustry_rank = close.industry_rank()\n\n# \u9078\u64c7\u5404\u7522\u696d\u6f32\u5e45\u524d 30%\nposition = industry_rank &gt; 0.7\n</code></pre> <p>\u7522\u696d\u5206\u985e\u4f86\u6e90</p> <ul> <li>\u4f7f\u7528 TEJ \u7522\u696d\u5206\u985e</li> <li>\u81ea\u52d5\u8655\u7406\u7522\u696d\u8b8a\u66f4</li> </ul>"}, {"location": "reference/dataframe/#rise-fall", "title": "rise() / fall()", "text": "<p>\u5224\u65b7\u9023\u7e8c\u4e0a\u6f32/\u4e0b\u8dcc\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u9023\u7e8c 3 \u65e5\u4e0a\u6f32\nrising = close.rise(3)\n\n# \u9023\u7e8c 2 \u65e5\u4e0b\u8dcc\nfalling = close.fall(2)\n\n# \u7b56\u7565\uff1a\u9023\u7e8c\u4e0a\u6f32\u5f8c\u53cd\u624b\u505a\u7a7a\nposition = ~rising  # \u53cd\u5411\u8a0a\u865f\n</code></pre>"}, {"location": "reference/dataframe/#sustain", "title": "sustain()", "text": "<p>\u5224\u65b7\u689d\u4ef6\u6301\u7e8c N \u671f\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nma20 = close.average(20)\n\n# \u9023\u7e8c 5 \u65e5\u7ad9\u7a69 20 \u65e5\u5747\u7dda\nsustained_above_ma = (close &gt; ma20).sustain(5)\n\n# \u7b56\u7565\nposition = sustained_above_ma\n</code></pre> <p>sustain vs rise</p> <ul> <li><code>rise(n)</code>: \u9023\u7e8c n \u671f\u6578\u503c\u4e0a\u6f32</li> <li><code>sustain(n)</code>: \u9023\u7e8c n \u671f\u689d\u4ef6\u70ba True</li> </ul>"}, {"location": "reference/dataframe/#hold_until", "title": "hold_until()", "text": "<p>\u6301\u5009\u81f3\u505c\u640d/\u505c\u5229\u89f8\u767c\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\n\n# \u57fa\u790e\u7528\u6cd5\uff1a\u505c\u640d 10%\nposition_with_sl = position.hold_until(stop_loss=0.1)\n\n# \u505c\u640d 10% + \u505c\u5229 20%\nposition_with_stops = position.hold_until(stop_loss=0.1, take_profit=0.2)\n\n# \u56de\u6e2c\nreport = sim(position_with_stops, resample='M')\nreport.display()\n\n# \u79fb\u52d5\u505c\u5229\uff08trailing stop\uff09\u9700\u5728 sim() \u4e2d\u8a2d\u5b9a\nreport = sim(position, resample='M', trail_stop=0.2)\n</code></pre> <p>\u91cd\u8981\u6982\u5ff5</p> <ul> <li><code>hold_until()</code> \u6703\u5ef6\u9577\u6301\u5009\u81f3\u89f8\u767c\u689d\u4ef6</li> <li>\u505c\u640d/\u505c\u5229\u4ee5\u9032\u5834\u50f9\u683c\u70ba\u57fa\u6e96\u8a08\u7b97</li> <li>\u79fb\u52d5\u505c\u5229\u9700\u900f\u904e <code>sim(trail_stop=...)</code> \u8a2d\u5b9a\uff0c\u5f9e\u6700\u9ad8\u50f9\u56de\u843d\u6307\u5b9a\u6bd4\u4f8b\u6642\u51fa\u5834</li> </ul>"}, {"location": "reference/dataframe/#exit_when", "title": "exit_when()", "text": "<p>\u9047\u5230\u7279\u5b9a\u689d\u4ef6\u51fa\u5834\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nma20 = close.average(20)\nma60 = close.average(60)\n\n# \u9032\u5834\uff1a\u77ed\u5747\u7dda\u5411\u4e0a\u7a81\u7834\u9577\u5747\u7dda\nentry = ma20 &gt; ma60\n\n# \u51fa\u5834\uff1a\u77ed\u5747\u7dda\u5411\u4e0b\u8dcc\u7834\u9577\u5747\u7dda\nexit_signal = ma20 &lt; ma60\n\n# \u6301\u5009\u81f3\u51fa\u5834\u8a0a\u865f\nposition = entry.exit_when(exit_signal)\n</code></pre> <p>exit_when vs hold_until</p> <ul> <li><code>exit_when()</code>: \u81ea\u8a02\u51fa\u5834\u689d\u4ef6\uff08\u5982\u6280\u8853\u6307\u6a19\uff09</li> <li><code>hold_until()</code>: \u56fa\u5b9a\u505c\u640d/\u505c\u5229\u6bd4\u4f8b</li> </ul>"}, {"location": "reference/dataframe/#neutralize_industry", "title": "neutralize_industry()", "text": "<p>\u7522\u696d\u4e2d\u6027\u5316\uff0c\u79fb\u9664\u7522\u696d\u56e0\u5b50\u5f71\u97ff\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\n\n# \u539f\u59cb\u56e0\u5b50\uff08\u542b\u7522\u696d\u5f71\u97ff\uff09\nfactor = data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\n\n# \u7522\u696d\u4e2d\u6027\u5316\uff08\u79fb\u9664\u7522\u696d\u5e73\u5747\uff09\nneutral_factor = factor.neutralize_industry()\n\n# \u4f7f\u7528\u4e2d\u6027\u5316\u56e0\u5b50\nposition = neutral_factor.is_largest(30)\n</code></pre> <p>\u70ba\u4ec0\u9ebc\u8981\u4e2d\u6027\u5316\uff1f</p> <ul> <li>\u67d0\u4e9b\u7522\u696d\u5929\u751f ROE \u9ad8\uff08\u5982\u91d1\u878d\u696d\uff09</li> <li>\u4e2d\u6027\u5316\u53ef\u907f\u514d\u904e\u5ea6\u96c6\u4e2d\u55ae\u4e00\u7522\u696d</li> <li>\u63d0\u5347\u7b56\u7565\u7a69\u5b9a\u6027</li> </ul>"}, {"location": "reference/dataframe/#_10", "title": "\u5b8c\u6574\u7bc4\u4f8b\uff1a\u591a\u91cd\u7be9\u9078\u7b56\u7565", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u6b65\u9a5f 1\uff1a\u8f09\u5165\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nroe = data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\n\n# \u6b65\u9a5f 2\uff1a\u5b9a\u7fa9\u7be9\u9078\u689d\u4ef6\ncond1 = marketcap.is_smallest(100)  # \u5c0f\u578b\u80a1\ncond2 = (revenue.average(3) / revenue.average(12)) &gt; 1.2  # \u71df\u6536\u6210\u9577\ncond3 = roe.rank(pct=True, axis=1) &gt; 0.7  # ROE \u524d 30%\ncond4 = (close &gt; close.average(20)).sustain(3)  # \u9023\u7e8c 3 \u65e5\u7ad9\u7a69 20MA\n\n# \u6b65\u9a5f 3\uff1a\u7d44\u5408\u689d\u4ef6\nposition = cond1 &amp; cond2 &amp; cond3 &amp; cond4\n\n# \u6b65\u9a5f 4\uff1a\u52a0\u5165\u505c\u640d\u505c\u5229\nposition = position.hold_until(stop_loss=0.1, take_profit=0.2)\n\n# \u6b65\u9a5f 5\uff1a\u9650\u5236\u6301\u80a1\u6578\nposition = position.is_largest(20)  # \u6700\u591a 20 \u6a94\n\n# \u6b65\u9a5f 6\uff1a\u56de\u6e2c\nreport = sim(position, resample='M')\nreport.display()\n\n# \u6b65\u9a5f 7\uff1a\u5206\u6790\u7e3e\u6548\nmetrics = report.get_metrics()\nprint(f\"\u5e74\u5316\u5831\u916c: {metrics['annual_return']:.2%}\")\nprint(f\"\u590f\u666e\u7387: {metrics['daily_sharpe']:.2f}\")\nprint(f\"\u6700\u5927\u56de\u64a4: {metrics['max_drawdown']:.2%}\")\n</code></pre>"}, {"location": "reference/dataframe/#_11", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/dataframe/#q-finlabdataframe", "title": "Q: FinlabDataFrame \u5982\u4f55\u81ea\u52d5\u5c0d\u9f4a\u4e0d\u540c\u983b\u7387\u7684\u8cc7\u6599\uff1f", "text": "<pre><code>from finlab import data\n\n# \u65e5\u983b\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')  # \u6bcf\u5929\u66f4\u65b0\nprint(close.index[0])  # 2010-01-04\n\n# \u6708\u983b\u8cc7\u6599\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')  # \u6bcf\u6708 10 \u865f\u516c\u544a\nprint(revenue.index[0])  # 2010-01-10\n\n# \u76f4\u63a5\u904b\u7b97\u6703\u81ea\u52d5\u5c0d\u9f4a\uff08revenue \u5411\u524d\u586b\u88dc\u5230\u65e5\u983b\uff09\nposition = (close &gt; 100) &amp; (revenue &gt; 1e8)\n# position \u662f\u65e5\u983b\u8cc7\u6599\uff0crevenue \u5df2\u81ea\u52d5\u586b\u88dc\n</code></pre> <p>\u5c0d\u9f4a\u898f\u5247\uff1a - \u4f4e\u983b \u2192 \u9ad8\u983b\uff1a\u5411\u524d\u586b\u88dc\uff08forward fill\uff09 - \u5b63\u5831\uff08\u8ca1\u5831\uff09\uff1a\u81ea\u52d5\u5ef6\u9072\u81f3\u8ca1\u5831\u516c\u544a\u65e5</p>"}, {"location": "reference/dataframe/#q-finlabdataframe_1", "title": "Q: \u5982\u4f55\u4e32\u63a5\u591a\u500b FinlabDataFrame \u65b9\u6cd5\uff1f", "text": "<pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u4e32\u63a5\u65b9\u6cd5\uff08\u985e\u4f3c pandas method chaining\uff09\nposition = (\n    close\n    .average(20)           # \u8a08\u7b97 20MA\n    .rank(pct=True, axis=1)  # \u6392\u540d\n    .is_largest(30)        # \u53d6\u524d 30 \u540d\n)\n\n# \u7b49\u540c\u65bc\nma20 = close.average(20)\nranked = ma20.rank(pct=True, axis=1)\nposition = ranked.is_largest(30)\n</code></pre>"}, {"location": "reference/dataframe/#q-is_largest-rank", "title": "Q: is_largest() \u548c rank() + \u95be\u503c\u6709\u4ec0\u9ebc\u5dee\u5225\uff1f", "text": "<pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u65b9\u6cd5 1\uff1ais_largest\uff08\u56fa\u5b9a\u6578\u91cf\uff09\nposition1 = close.is_largest(30)  # \u6c38\u9060\u9078 30 \u6a94\n\n# \u65b9\u6cd5 2\uff1arank + \u95be\u503c\uff08\u56fa\u5b9a\u6bd4\u4f8b\uff09\nposition2 = close.rank(pct=True, axis=1) &gt; 0.8  # \u9078\u524d 20%\uff08\u6578\u91cf\u6703\u8b8a\uff09\n\n# \u5dee\u7570\uff1a\n# - \u65b9\u6cd5 1\uff1a\u6301\u80a1\u6578\u56fa\u5b9a\uff08\u9069\u5408\u56fa\u5b9a\u8cc7\u91d1\u914d\u7f6e\uff09\n# - \u65b9\u6cd5 2\uff1a\u6301\u80a1\u6578\u6d6e\u52d5\uff08\u9069\u5408\u5e02\u5834\u72c0\u6cc1\u8abf\u6574\uff09\n</code></pre>"}, {"location": "reference/dataframe/#q-trail_stop", "title": "Q: \u79fb\u52d5\u505c\u5229\uff08trail_stop\uff09\u5982\u4f55\u904b\u4f5c\uff1f", "text": "<p>\u79fb\u52d5\u505c\u5229\u9700\u900f\u904e <code>sim()</code> \u7684 <code>trail_stop</code> \u53c3\u6578\u8a2d\u5b9a\uff0c<code>hold_until()</code> \u4e0d\u652f\u63f4\u6b64\u529f\u80fd\u3002</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\n\n# \u7bc4\u4f8b\uff1a\u9032\u5834\u50f9 100 \u5143\n# - stop_loss=0.1: \u8dcc\u7834 90 \u5143\u51fa\u5834\n# - take_profit=0.2: \u6f32\u5230 120 \u5143\u51fa\u5834\uff08\u56fa\u5b9a\u505c\u5229\uff09\n# - trail_stop=0.2: \u5f9e\u6700\u9ad8\u50f9\u56de\u843d 20% \u51fa\u5834\uff08\u79fb\u52d5\u505c\u5229\uff09\n\n# \u60c5\u5883\uff1a\u9032\u5834 100 \u2192 \u6f32\u5230 150 \u2192 \u56de\u843d\u5230 120\n# - take_profit=0.2: \u6f32\u5230 120 \u5373\u51fa\u5834\uff0c\u4e0d\u6703\u7b49\u5230 150\n# - trail_stop=0.2: \u5f9e\u6700\u9ad8\u50f9 150 \u56de\u843d 20% = 120 \u6642\u51fa\u5834\n\n# \u56fa\u5b9a\u505c\u5229\nreport_fixed = sim(position, resample='M', stop_loss=0.1, take_profit=0.2)\n\n# \u79fb\u52d5\u505c\u5229\nreport_trailing = sim(position, resample='M', stop_loss=0.1, trail_stop=0.2)\n</code></pre>"}, {"location": "reference/dataframe/#q-finlabdataframe-pandas", "title": "Q: \u5982\u4f55\u5728 FinlabDataFrame \u4e0a\u4f7f\u7528 pandas \u65b9\u6cd5\uff1f", "text": "<pre><code>from finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# FinlabDataFrame \u5b8c\u5168\u517c\u5bb9 pandas\nclose.rolling(20).mean()  # pandas \u65b9\u6cd5\nclose.fillna(0)           # pandas \u65b9\u6cd5\nclose.dropna()            # pandas \u65b9\u6cd5\n\n# \u6240\u6709 pandas \u65b9\u6cd5\u90fd\u53ef\u7528\n# \u904b\u7b97\u7d50\u679c\u4ecd\u70ba FinlabDataFrame\uff08\u4fdd\u7559\u64f4\u5145\u529f\u80fd\uff09\n</code></pre>"}, {"location": "reference/dataframe/#_12", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u9078\u80a1\u689d\u4ef6\u6559\u5b78 - FinlabDataFrame \u5be6\u6230\u61c9\u7528</li> <li>\u6b77\u53f2\u56de\u6e2c\u6559\u5b78 - \u5b8c\u6574\u56de\u6e2c\u6d41\u7a0b</li> <li>\u6280\u8853\u6307\u6a19\u9078\u80a1\u7bc4\u4f8b - \u5be6\u6230\u7b56\u7565\u7bc4\u4f8b</li> <li>pandas \u5b98\u65b9\u6587\u6a94 - pandas \u57fa\u790e\u77e5\u8b58</li> </ul>"}, {"location": "reference/finlab/", "title": "finlab", "text": "<p>FinLab \u6838\u5fc3\u6a21\u7d44\uff0c\u63d0\u4f9b\u767b\u5165\u8a8d\u8b49\u548c Token \u7ba1\u7406\u529f\u80fd\u3002</p>"}, {"location": "reference/finlab/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u9996\u6b21\u4f7f\u7528 FinLab \u6642\u9032\u884c\u767b\u5165\u8a8d\u8b49</li> <li>\u5728\u8173\u672c\u4e2d\u81ea\u52d5\u8a2d\u5b9a API Token</li> <li>\u5728\u4e0d\u540c\u74b0\u5883\uff08\u672c\u5730\u3001Colab\u3001\u4f3a\u670d\u5668\uff09\u9032\u884c\u8a8d\u8b49</li> <li>\u67e5\u8a62\u7576\u524d\u767b\u5165\u72c0\u614b</li> </ul>"}, {"location": "reference/finlab/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/finlab/#1", "title": "\u65b9\u5f0f 1\uff1a\u700f\u89bd\u5668\u767b\u5165\uff08\u63a8\u85a6\uff09", "text": "<pre><code>import finlab\n\n# \u555f\u52d5\u700f\u89bd\u5668\u767b\u5165\uff08\u6703\u81ea\u52d5\u958b\u555f\u700f\u89bd\u5668\uff09\nfinlab.login()\n\n# \u767b\u5165\u6210\u529f\u5f8c\uff0c\u6191\u8b49\u6703\u5132\u5b58\u5728 ~/.finlab/credentials.json\n# \u4e4b\u5f8c\u4f7f\u7528\u4e0d\u9700\u8981\u518d\u6b21\u767b\u5165\n</code></pre>"}, {"location": "reference/finlab/#2api-token", "title": "\u65b9\u5f0f 2\uff1aAPI Token \u767b\u5165\uff08\u820a\u7248\uff0c\u4ecd\u53ef\u7528\uff09", "text": "<pre><code>import finlab\n\n# \u4f7f\u7528 API Token \u767b\u5165\nfinlab.login('YOUR_API_TOKEN')\n\n# \u53d6\u5f97 API Token\uff1ahttps://ai.finlab.tw/account\n</code></pre>"}, {"location": "reference/finlab/#3", "title": "\u65b9\u5f0f 3\uff1a\u74b0\u5883\u8b8a\u6578\u767b\u5165", "text": "<pre><code>import os\n\n# \u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\uff08\u9069\u5408\u8173\u672c\u81ea\u52d5\u5316\uff09\nos.environ['FINLAB_API_TOKEN'] = 'YOUR_API_TOKEN'\n\n# \u4e4b\u5f8c\u4f7f\u7528 finlab \u6703\u81ea\u52d5\u8b80\u53d6\u74b0\u5883\u8b8a\u6578\nfrom finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre>"}, {"location": "reference/finlab/#_3", "title": "\u8a8d\u8b49\u65b9\u5f0f\u6bd4\u8f03", "text": "\u65b9\u5f0f \u512a\u9ede \u7f3a\u9ede \u9069\u7528\u5834\u666f \u700f\u89bd\u5668\u767b\u5165 \u5b89\u5168\u3001\u65b9\u4fbf\u3001\u81ea\u52d5\u66f4\u65b0 Token \u9700\u8981\u700f\u89bd\u5668\u74b0\u5883 \u672c\u5730\u958b\u767c\u3001Jupyter Notebook API Token \u7c21\u55ae\u3001\u9069\u5408\u81ea\u52d5\u5316 Token \u904e\u671f\u9700\u624b\u52d5\u66f4\u65b0 \u8173\u672c\u81ea\u52d5\u5316\u3001CI/CD \u74b0\u5883\u8b8a\u6578 \u5b89\u5168\u3001\u4e0d\u5beb\u5165\u7a0b\u5f0f\u78bc \u9700\u8981\u984d\u5916\u8a2d\u5b9a \u751f\u7522\u74b0\u5883\u3001Docker"}, {"location": "reference/finlab/#_4", "title": "\u8a8d\u8b49\u512a\u5148\u9806\u5e8f", "text": "<p>FinLab \u6703\u6309\u7167\u4ee5\u4e0b\u9806\u5e8f\u5c0b\u627e\u8a8d\u8b49\u8cc7\u8a0a\uff1a</p> <ol> <li><code>~/.finlab/credentials.json</code> - \u700f\u89bd\u5668\u767b\u5165\u7522\u751f\u7684\u6191\u8b49\uff08\u65b0\u7248\uff09</li> <li><code>FINLAB_API_TOKEN</code> \u74b0\u5883\u8b8a\u6578 - \u624b\u52d5\u8a2d\u5b9a\u7684 API Token\uff08\u820a\u7248\uff09</li> <li>\u4e92\u52d5\u5f0f\u767b\u5165 - \u5982\u679c\u4ee5\u4e0a\u90fd\u6c92\u6709\uff0c\u6703\u63d0\u793a\u767b\u5165</li> </ol>"}, {"location": "reference/finlab/#_5", "title": "\u8a73\u7d30\u6559\u5b78", "text": ""}, {"location": "reference/finlab/#_6", "title": "\u700f\u89bd\u5668\u767b\u5165\u6d41\u7a0b", "text": "<pre><code>import finlab\n\n# 1. \u547c\u53eb login() \u4e0d\u5e36\u53c3\u6578\nfinlab.login()\n\n# 2. \u700f\u89bd\u5668\u6703\u81ea\u52d5\u958b\u555f FinLab \u767b\u5165\u9801\u9762\n# 3. \u767b\u5165\u6210\u529f\u5f8c\uff0c\u6191\u8b49\u6703\u81ea\u52d5\u5132\u5b58\n# 4. \u4e4b\u5f8c\u4f7f\u7528\u4e0d\u9700\u8981\u518d\u6b21\u767b\u5165\n</code></pre> <p>\u6191\u8b49\u5132\u5b58\u4f4d\u7f6e\uff1a<code>~/.finlab/credentials.json</code></p> <p>\u6709\u6548\u671f\u9650\uff1a60 \u5929\uff08\u81ea\u52d5\u66f4\u65b0\uff09</p>"}, {"location": "reference/finlab/#api-token", "title": "\u53d6\u5f97 API Token", "text": "<p>\u5982\u679c\u4f7f\u7528 API Token \u65b9\u5f0f\u767b\u5165\uff1a</p> <ol> <li>\u524d\u5f80 FinLab \u6703\u54e1\u4e2d\u5fc3</li> <li>\u8907\u88fd\u60a8\u7684 API Token</li> <li>\u5728\u7a0b\u5f0f\u4e2d\u4f7f\u7528 <code>finlab.login('YOUR_API_TOKEN')</code></li> </ol>"}, {"location": "reference/finlab/#_7", "title": "\u5728\u4e0d\u540c\u74b0\u5883\u4f7f\u7528", "text": ""}, {"location": "reference/finlab/#google-colab", "title": "Google Colab", "text": "<pre><code># \u65b9\u5f0f 1\uff1a\u4f7f\u7528\u700f\u89bd\u5668\u767b\u5165\uff08\u63a8\u85a6\uff09\nimport finlab\nfinlab.login()\n\n# \u65b9\u5f0f 2\uff1a\u4f7f\u7528 Colab Secrets\uff08\u907f\u514d Token \u5916\u6d29\uff09\nfrom google.colab import userdata\nimport finlab\nfinlab.login(userdata.get('FINLAB_API_TOKEN'))\n</code></pre>"}, {"location": "reference/finlab/#docker", "title": "Docker / \u751f\u7522\u74b0\u5883", "text": "<pre><code># \u4f7f\u7528\u74b0\u5883\u8b8a\u6578\uff08\u5728 docker-compose.yml \u6216 .env \u8a2d\u5b9a\uff09\nexport FINLAB_API_TOKEN='YOUR_API_TOKEN'\n</code></pre> <pre><code># Python \u8173\u672c\u6703\u81ea\u52d5\u8b80\u53d6\u74b0\u5883\u8b8a\u6578\nfrom finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre>"}, {"location": "reference/finlab/#jupyter-notebook", "title": "Jupyter Notebook / \u672c\u5730\u958b\u767c", "text": "<pre><code># \u9996\u6b21\u767b\u5165\nimport finlab\nfinlab.login()  # \u700f\u89bd\u5668\u767b\u5165\n\n# \u4e4b\u5f8c\u4f7f\u7528\u4e0d\u9700\u8981\u518d\u6b21\u767b\u5165\uff08\u6191\u8b49\u5df2\u5132\u5b58\uff09\nfrom finlab import data\nclose = data.get('price:\u6536\u76e4\u50f9')\n</code></pre>"}, {"location": "reference/finlab/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/finlab/#finlablogin", "title": "finlab.login()", "text": "<p>\u63a8\u85a6\u4f7f\u7528\u65b9\u5f0f</p> <ul> <li>\u672c\u5730\u958b\u767c\uff1a\u4f7f\u7528 <code>finlab.login()</code> \u700f\u89bd\u5668\u767b\u5165\uff08\u65b9\u4fbf\u4e14\u5b89\u5168\uff09</li> <li>\u81ea\u52d5\u5316\u8173\u672c\uff1a\u4f7f\u7528\u74b0\u5883\u8b8a\u6578 <code>FINLAB_API_TOKEN</code>\uff08\u907f\u514d Token \u5beb\u5165\u7a0b\u5f0f\u78bc\uff09</li> <li>\u6e2c\u8a66\u74b0\u5883\uff1a\u4f7f\u7528 <code>finlab.login('token')</code> \u5feb\u901f\u9a57\u8b49</li> </ul> <p>API Token \u6ce8\u610f\u4e8b\u9805</p> <ul> <li>\u4e0d\u8981\u5c07 API Token \u4e0a\u50b3\u5230 GitHub \u7b49\u516c\u958b\u5e73\u53f0</li> <li>\u4f7f\u7528\u74b0\u5883\u8b8a\u6578\u6216 <code>.env</code> \u6587\u4ef6\u7ba1\u7406 Token</li> <li>Token \u904e\u671f\u6642\u9700\u8981\u91cd\u65b0\u53d6\u5f97</li> </ul>"}, {"location": "reference/finlab/#finlab.login", "title": "finlab.login", "text": "<pre><code>login(api_token=None)\n</code></pre> <p>\u767b\u9304\u91cf\u5316\u5e73\u53f0\u3002</p> <p>\u53ef\u4ee5\u81f3 api_token\u67e5\u8a62\u9801\u9762 \u7372\u53d6api_token\uff0c\u50b3\u5165\u51fd\u6578\u5f8c\u57f7\u884c\u767b\u9304\u52d5\u4f5c\u3002 \u4e4b\u5f8c\u4f7f\u7528Finlab\u6a21\u7d44\u7684\u6703\u54e1\u529f\u80fd\u6642\uff0c\u7cfb\u7d71\u5c31\u4e0d\u6703\u81ea\u52d5\u8df3\u51fa\u8acb\u6c42\u8f38\u5165api_token\u7684GUI\u9801\u9762\u3002 \u82e5\u50b3\u5165\u7684api_toke\u683c\u5f0f\u6709\u8aa4\uff0c\u7cfb\u7d71\u6703\u8981\u6c42\u518d\u6b21\u8f38\u5165\u3002</p> <p>\u82e5\u4e0d\u50b3\u5165 api_token\uff0c\u6703\u555f\u52d5\u700f\u89bd\u5668\u767b\u5165\u6d41\u7a0b\uff08\u65b0\u7248\uff09\u3002</p> PARAMETER DESCRIPTION <code>api_token</code> <p>FinLab api_token</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p>"}, {"location": "reference/finlab/#finlabget_token", "title": "finlab.get_token()", "text": ""}, {"location": "reference/finlab/#finlab.get_token", "title": "finlab.get_token", "text": "<pre><code>get_token()\n</code></pre> <p>\u53d6\u5f97\u767b\u9304\u6703\u54e1\u7684\u8a8d\u8b49 token\u3002</p> <p>\u8a8d\u8b49\u512a\u5148\u9806\u5e8f\uff1a 1. ~/.finlab/credentials.json (\u65b0\u7248 Firebase auth) \u2192 \u8fd4\u56de id_token 2. FINLAB_API_TOKEN \u74b0\u5883\u8b8a\u6578 (\u820a\u7248) \u2192 \u8fd4\u56de api_token 3. \u4e92\u52d5\u5f0f\u767b\u5165</p> RETURNS DESCRIPTION <code>tuple</code> <p>(token_string, token_type) where token_type is 'id_token' or 'api_token'</p>"}, {"location": "reference/finlab/#_8", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/finlab/#q", "title": "Q: \u5982\u4f55\u6aa2\u67e5\u662f\u5426\u5df2\u767b\u5165\uff1f", "text": "<pre><code>import finlab\n\ntry:\n    token, token_type = finlab.get_token()\n    print(f\"\u2705 \u5df2\u767b\u5165\uff08{token_type}\uff09\")\n    print(f\"Token: {token[:10]}...\")\nexcept Exception as e:\n    print(\"\u274c \u672a\u767b\u5165\")\n</code></pre>"}, {"location": "reference/finlab/#q_1", "title": "Q: \u700f\u89bd\u5668\u767b\u5165\u5931\u6557\u600e\u9ebc\u8fa6\uff1f", "text": "<p>\u53ef\u80fd\u539f\u56e0\u8207\u89e3\u6c7a\u65b9\u6cd5\uff1a</p> <ol> <li> <p>\u7f3a\u5c11 cryptography \u5957\u4ef6 <pre><code>pip install cryptography\n</code></pre></p> </li> <li> <p>\u7121\u700f\u89bd\u5668\u74b0\u5883\uff08\u5982\u4f3a\u670d\u5668\uff09</p> </li> <li> <p>\u6539\u7528 API Token \u65b9\u5f0f\uff1a<code>finlab.login('YOUR_API_TOKEN')</code></p> </li> <li> <p>\u9632\u706b\u7246\u963b\u64cb</p> </li> <li>\u6aa2\u67e5\u7db2\u8def\u8a2d\u5b9a</li> <li>\u6539\u7528 API Token \u65b9\u5f0f</li> </ol>"}, {"location": "reference/finlab/#q-api-token", "title": "Q: API Token \u904e\u671f\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code># \u91cd\u65b0\u53d6\u5f97 Token \u4e26\u767b\u5165\nimport finlab\nfinlab.login('NEW_API_TOKEN')\n\n# \u6216\u4f7f\u7528\u700f\u89bd\u5668\u767b\u5165\uff08\u6703\u81ea\u52d5\u66f4\u65b0\uff09\nfinlab.login()\n</code></pre>"}, {"location": "reference/finlab/#q-token", "title": "Q: \u5982\u4f55\u5728\u591a\u500b\u5c08\u6848\u4f7f\u7528\u4e0d\u540c\u7684 Token\uff1f", "text": "<p>\u4f7f\u7528\u74b0\u5883\u8b8a\u6578\u65b9\u5f0f\uff1a</p> <pre><code>import os\nimport finlab\n\n# \u5c08\u6848 A\nos.environ['FINLAB_API_TOKEN'] = 'TOKEN_A'\n# \u4f7f\u7528 finlab...\n\n# \u5c08\u6848 B\nos.environ['FINLAB_API_TOKEN'] = 'TOKEN_B'\n# \u4f7f\u7528 finlab...\n</code></pre>"}, {"location": "reference/finlab/#q_2", "title": "Q: \u5982\u4f55\u767b\u51fa\uff1f", "text": "<pre><code>import os\n\n# \u6e05\u9664\u74b0\u5883\u8b8a\u6578\nos.environ.pop('FINLAB_API_TOKEN', None)\nos.environ.pop('finlab_id_token', None)\n\n# \u522a\u9664\u6191\u8b49\u6a94\u6848\uff08\u700f\u89bd\u5668\u767b\u5165\u7522\u751f\u7684\uff09\nimport os\ncredentials_path = os.path.expanduser('~/.finlab/credentials.json')\nif os.path.exists(credentials_path):\n    os.remove(credentials_path)\n    print(\"\u5df2\u767b\u51fa\")\n</code></pre>"}, {"location": "reference/finlab/#_9", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>FinLab \u6703\u54e1\u4e2d\u5fc3 - \u53d6\u5f97 API Token</li> <li>\u5feb\u901f\u4e0a\u624b\u6307\u5357 - \u5b8c\u6574\u5b89\u88dd\u8207\u767b\u5165\u6559\u5b78</li> <li>\u5e38\u898b\u554f\u984c FAQ - \u66f4\u591a\u767b\u5165\u76f8\u95dc\u554f\u984c</li> </ul>"}, {"location": "reference/machine_learning/", "title": "finlab.ml", "text": "<p>\u6a5f\u5668\u5b78\u7fd2\u6a21\u7d44\uff0c\u63d0\u4f9b\u7279\u5fb5\u5de5\u7a0b\u3001\u6a19\u7c64\u751f\u6210\u8207\u6a21\u578b\u8a13\u7df4\u6574\u5408\u529f\u80fd\u3002</p>"}, {"location": "reference/machine_learning/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u5efa\u7acb ML \u9078\u80a1\u7b56\u7565\u7684\u7279\u5fb5\u96c6</li> <li>\u751f\u6210\u6280\u8853\u6307\u6a19\uff08TA-Lib \u6574\u5408\uff09</li> <li>\u8a2d\u8a08\u8a13\u7df4\u6a19\u7c64\uff08\u5831\u916c\u3001\u98a8\u96aa\u6307\u6a19\uff09</li> <li>\u6574\u5408 qlib \u6846\u67b6\u9032\u884c\u6a21\u578b\u8a13\u7df4</li> <li>\u9810\u6e2c\u80a1\u7968\u672a\u4f86\u8868\u73fe</li> </ul>"}, {"location": "reference/machine_learning/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/machine_learning/#_3", "title": "\u7279\u5fb5\u5de5\u7a0b", "text": "<pre><code>from finlab import data\nfrom finlab.ml import feature as mlf\n\n# \u5408\u4f75\u57fa\u672c\u9762\u7279\u5fb5\nfeatures = mlf.combine({\n    'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n    'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4'),\n    'roe': data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\n}, resample='W')\n\n# \u52a0\u5165\u6280\u8853\u6307\u6a19\nfeatures_ta = mlf.combine({\n    'fundamental': features,\n    'technical': mlf.ta(mlf.ta_names(n=10))\n}, resample='W')\n</code></pre>"}, {"location": "reference/machine_learning/#_4", "title": "\u6a19\u7c64\u751f\u6210", "text": "<pre><code>from finlab.ml import label as mll\n\n# \u751f\u6210\u672a\u4f86 1 \u9031\u5831\u916c\u7387\u6a19\u7c64\nlabel = mll.daytrading_percentage(\n    features.index,\n    period=1,\n    resample='W'\n)\n</code></pre>"}, {"location": "reference/machine_learning/#qlib", "title": "qlib \u6a21\u578b\u8a13\u7df4", "text": "<pre><code>import finlab.ml.qlib as q\n\n# \u5207\u5206\u8a13\u7df4/\u6e2c\u8a66\u96c6\nis_train = features.index.get_level_values('datetime') &lt; '2023-01-01'\nX_train, y_train = features[is_train], label[is_train]\nX_test = features[~is_train]\n\n# \u8a13\u7df4 LightGBM \u6a21\u578b\nmodel = q.LGBModel()\nmodel.fit(X_train, y_train)\n\n# \u9810\u6e2c\u4e26\u8f49\u63db\u70ba\u6301\u5009\u6b0a\u91cd\npred = model.predict(X_test)\nposition = pred.is_largest(30)  # \u8cb7\u5165\u524d 30 \u540d\n</code></pre>"}, {"location": "reference/machine_learning/#_5", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u958b\u767c\uff0c\u4e86\u89e3\uff1a - \u5b8c\u6574 ML \u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u7279\u5fb5\u5de5\u7a0b\u6700\u4f73\u5be6\u8e10 - \u6a19\u7c64\u8a2d\u8a08\u6280\u5de7 - \u6a21\u578b\u8a13\u7df4\u8207\u512a\u5316 - \u904e\u5ea6\u914d\u9069\u9632\u7bc4</p>"}, {"location": "reference/machine_learning/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/machine_learning/#finlabmlfeature", "title": "finlab.ml.feature", "text": "<p>\u7279\u5fb5\u5de5\u7a0b\u6a21\u7d44\uff0c\u7528\u65bc\u5408\u4f75\u8207\u8655\u7406\u5404\u985e\u7279\u5fb5\u3002</p>"}, {"location": "reference/machine_learning/#combine", "title": "combine()", "text": "<p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.ml import feature as mlf\n\n# \u7bc4\u4f8b 1\uff1a\u5408\u4f75\u57fa\u672c\u9762\u7279\u5fb5\nfeatures = mlf.combine({\n    'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n    'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4'),\n    'roe': data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\n}, resample='W')\n\n# \u7bc4\u4f8b 2\uff1a\u5408\u4f75\u6280\u8853\u6307\u6a19\nfeatures = mlf.combine({\n    'talib': mlf.ta(['talib.RSI__period14__', 'talib.MACD__fastperiod12_slowperiod26_signalperiod9__macd__'])\n}, resample='D')\n\n# \u7bc4\u4f8b 3\uff1a\u6df7\u5408\u591a\u7a2e\u7279\u5fb5\nfeatures = mlf.combine({\n    'fundamental': mlf.combine({'pb': pb, 'pe': pe}),\n    'technical': mlf.ta(mlf.ta_names(n=5)),\n    'custom': custom_feature_df\n}, resample='W')\n</code></pre> <p>resample \u53c3\u6578</p> <ul> <li><code>'D'</code> - \u6bcf\u65e5</li> <li><code>'W'</code> - \u6bcf\u9031\uff08\u9031\u4e94\uff09</li> <li><code>'M'</code> - \u6bcf\u6708\uff08\u6708\u5e95\uff09</li> <li>\u7279\u5fb5\u8207\u6a19\u7c64\u7684 resample \u5fc5\u9808\u4e00\u81f4\uff01</li> </ul>"}, {"location": "reference/machine_learning/#finlab.ml.feature.combine", "title": "finlab.ml.feature.combine", "text": "<pre><code>combine(features, resample=None, sample_filter=None, **kwargs)\n</code></pre> <p>The combine function takes a dictionary of features as input and combines them into a single pandas DataFrame. combine \u51fd\u6578\u63a5\u53d7\u4e00\u500b\u7279\u5fb5\u5b57\u5178\u4f5c\u70ba\u8f38\u5165\uff0c\u4e26\u5c07\u5b83\u5011\u5408\u4f75\u6210\u4e00\u500b pandas DataFrame\u3002</p> PARAMETER DESCRIPTION <code>features</code> <p>a dictionary where values are dataframes or callables returning dataframes. \u7d22\u5f15\u70ba\u65e5\u671f\u6642\u9593\uff0c\u6b04\u4f4d \u70ba\u8b49\u5238\u4ee3\u78bc\u7684 DataFrame\uff0c\u6216\u53ef\u547c\u53eb\u4ee5\u53d6\u5f97 DataFrame \u7684\u51fd\u5f0f\u3002</p> <p> TYPE: <code>Dict[str, DataFrame | Callable]</code> </p> <code>resample</code> <p>Optional argument to resample the data in the features. Default is None. \u9078\u64c7\u6027\u7684\u53c3\u6578\uff0c\u7528\u65bc\u91cd\u65b0\u53d6\u6a23\u7279\u5fb5\u4e2d\u7684\u8cc7\u6599\u3002\u9810\u8a2d\u70ba None\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>sample_filter</code> <p>a boolean dictionary where index is date and columns are instrument representing the filter of features.</p> <p> TYPE: <code>DataFrame</code> DEFAULT: <code>None</code> </p> <code>**kwargs</code> <p>Additional keyword arguments to pass to the resampler function. \u50b3\u905e\u7d66\u91cd\u65b0\u53d6\u6a23\u51fd\u6578 resampler \u7684\u5176\u4ed6\u95dc\u9375\u5b57\u5f15\u6578\u3002</p> <p> DEFAULT: <code>{}</code> </p> RETURNS DESCRIPTION <p>A pandas DataFrame containing all the input features combined. \u4e00\u500b\u5305\u542b\u6240\u6709\u8f38\u5165\u7279\u5fb5\u5408\u4f75\u5f8c\u7684 pandas DataFrame\u3002</p> <p>Examples:</p> <p>\u9019\u6bb5\u7a0b\u5f0f\u78bc\u6559\u6211\u5011\u5982\u4f55\u4f7f\u7528finlab.ml.feature\u548cfinlab.data\u6a21\u7d44\uff0c\u4f86\u5408\u4f75\u5169\u500b\u7279\u5fb5\uff1aRSI\u548c\u80a1\u50f9\u6de8\u503c\u6bd4\u3002\u6211\u5011\u4f7f\u7528f.combine\u51fd\u6578\u4f86\u9032\u884c\u5408\u4f75\uff0c\u5176\u4e2d\u7279\u5fb5\u7684\u540d\u7a31\u662f\u5b57\u5178\u7684\u9375\uff0c\u5c0d\u61c9\u7684\u8cc7\u6599\u662f\u503c\u3002 \u6211\u5011\u5f9edata.indicator('RSI')\u53d6\u5f97'rsi'\u7279\u5fb5\uff0c\u9019\u500b\u51fd\u6578\u8a08\u7b97\u76f8\u5c0d\u5f37\u5f31\u6307\u6578\u3002\u6211\u5011\u5f9edata.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\u53d6\u5f97'pb'\u7279\u5fb5\uff0c\u9019\u500b\u51fd\u6578\u7372\u53d6\u80a1\u50f9\u6de8\u503c\u6bd4\u3002\u6700\u5f8c\uff0c\u6211\u5011\u5f97\u5230\u4e00\u500b\u5305\u542b\u9019\u5169\u500b\u7279\u5fb5\u7684DataFrame\u3002</p> <pre><code>from finlab import data\nimport finlab.ml.feature as f\nimport finlab.ml.qlib as q\n\nfeatures = f.combine({\n\n    # \u7528 data.get \u7c21\u55ae\u7522\u751f\u51fa\u6280\u8853\u6307\u6a19\n    'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n\n    # \u7528 data.indicator \u7522\u751f\u6280\u8853\u6307\u6a19\u7684\u7279\u5fb5\n    'rsi': data.indicator('RSI'),\n\n    # \u7528 f.ta \u679a\u8209\u8d85\u591a\u7a2e talib \u6307\u6a19\n    'talib': f.ta(f.ta_names()),\n\n    # \u5229\u7528 qlib alph158 \u7522\u751f\u6280\u8853\u6307\u6a19\u7684\u7279\u5fb5(\u8acb\u5148\u57f7\u884c q.init(), q.dump() \u624d\u80fd\u4f7f\u7528)\n    'qlib158': q.alpha('Alpha158')\n\n    })\n\nfeatures.head()\n</code></pre> datetime instrument rsi pb 2020-01-01 1101 0 2 2020-01-02 1102 100 3 2020-01-03 1108 100 4"}, {"location": "reference/machine_learning/#ta", "title": "ta()", "text": "<p>\u6280\u8853\u6307\u6a19\u8a08\u7b97\uff1a</p> <pre><code>from finlab.ml import feature as mlf\n\n# \u8a08\u7b97\u7279\u5b9a\u6307\u6a19\nindicators = mlf.ta([\n    'talib.RSI__period14__',\n    'talib.MACD__fastperiod12_slowperiod26_signalperiod9__macd__',\n    'talib.BBANDS__timeperiod20_nbdevup2_nbdevdn2__upperband__'\n], resample='W')\n\n# \u81ea\u52d5\u751f\u6210\u96a8\u6a5f\u6307\u6a19\u7d44\u5408\nrandom_indicators = mlf.ta(mlf.ta_names(n=10), resample='W')\n</code></pre>"}, {"location": "reference/machine_learning/#finlab.ml.feature.ta", "title": "finlab.ml.feature.ta", "text": "<pre><code>ta(feature_names, factories=None, resample=None, start_time=None, end_time=None, adj=False, cpu=-1, **kwargs)\n</code></pre> <p>Calculate technical indicator values for a list of feature names.</p> PARAMETER DESCRIPTION <code>feature_names</code> <p>A list of technical indicator feature names. Defaults to None.</p> <p> TYPE: <code>Optional[List[str]]</code> </p> <code>factories</code> <p>A dictionary of factories to generate technical indicators. Defaults to {\"talib\": TalibIndicatorFactory()}.</p> <p> TYPE: <code>Optioanl[Dict[str, TalibIndicatorFactory]]</code> DEFAULT: <code>None</code> </p> <code>resample</code> <p>The frequency to resample the data to. Defaults to None.</p> <p> TYPE: <code>Optional[str]</code> DEFAULT: <code>None</code> </p> <code>start_time</code> <p>The start time of the data. Defaults to None.</p> <p> TYPE: <code>Optional[str]</code> DEFAULT: <code>None</code> </p> <code>end_time</code> <p>The end time of the data. Defaults to None.</p> <p> TYPE: <code>Optional[str]</code> DEFAULT: <code>None</code> </p> <code>**kwargs</code> <p>Additional keyword arguments to pass to the resampler function.</p> <p> DEFAULT: <code>{}</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>pd.DataFrame: technical indicator feature names and their corresponding values.</p>"}, {"location": "reference/machine_learning/#ta_names", "title": "ta_names()", "text": "<p>\u751f\u6210\u6307\u6a19\u540d\u7a31\u5217\u8868\uff1a</p> <pre><code>from finlab.ml import feature as mlf\n\n# \u751f\u6210 10 \u7a2e\u96a8\u6a5f\u53c3\u6578\u7d44\u5408\u7684\u6240\u6709 TA-Lib \u6307\u6a19\nindicator_names = mlf.ta_names(n=10)\nprint(f\"\u5171 {len(indicator_names)} \u500b\u6307\u6a19\")\n\n# \u67e5\u770b\u7bc4\u4f8b\nfor name in indicator_names[:5]:\n    print(name)\n# \u8f38\u51fa:\n# talib.RSI__period14__\n# talib.RSI__period7__\n# talib.MACD__fastperiod12_slowperiod26_signalperiod9__macd__\n# ...\n</code></pre> <p>n \u53c3\u6578\u5efa\u8b70</p> <ul> <li>n=1: \u6bcf\u500b\u6307\u6a19\u4f7f\u7528\u9810\u8a2d\u53c3\u6578\uff08~100 \u500b\u6307\u6a19\uff09</li> <li>n=5: \u6bcf\u500b\u6307\u6a19\u96a8\u6a5f\u751f\u6210 5 \u7d44\u53c3\u6578\uff08~500 \u500b\u6307\u6a19\uff09</li> <li>n=10: \u66f4\u591a\u8b8a\u5316\u4f46\u8a08\u7b97\u6642\u9593\u8f03\u9577\uff08~1000 \u500b\u6307\u6a19\uff09</li> <li>\u5efa\u8b70\u5148\u7528 n=1 \u6e2c\u8a66\uff0c\u78ba\u8a8d\u53ef\u884c\u5f8c\u518d\u589e\u52a0</li> </ul> <p>\u6ce8\u610f\u4e8b\u9805</p> <ul> <li>\u6307\u6a19\u6578\u91cf\u904e\u591a\u6703\u5c0e\u81f4\uff1a<ul> <li>\u8a08\u7b97\u6642\u9593\u9577</li> <li>\u8a18\u61b6\u9ad4\u4f54\u7528\u5927</li> <li>\u6a21\u578b\u904e\u5ea6\u914d\u9069\u98a8\u96aa\u9ad8</li> </ul> </li> <li>\u5efa\u8b70\u4f7f\u7528\u7279\u5fb5\u9078\u64c7\uff08feature selection\uff09\u6e1b\u5c11\u6307\u6a19\u6578\u91cf</li> </ul>"}, {"location": "reference/machine_learning/#finlab.ml.feature.ta_names", "title": "finlab.ml.feature.ta_names", "text": "<pre><code>ta_names(lb=1, ub=10, n=1, factory=None)\n</code></pre> <p>Generate a list of technical indicator feature names.</p> PARAMETER DESCRIPTION <code>lb</code> <p>The lower bound of the multiplier of the default parameter for the technical indicators.</p> <p> TYPE: <code>int</code> DEFAULT: <code>1</code> </p> <code>ub</code> <p>The upper bound of the multiplier of the default parameter for the technical indicators.</p> <p> TYPE: <code>int</code> DEFAULT: <code>10</code> </p> <code>n</code> <p>The number of random samples for each technical indicator.</p> <p> TYPE: <code>int</code> DEFAULT: <code>1</code> </p> <code>factory</code> <p>A factory object to generate technical indicators. Defaults to TalibIndicatorFactory.</p> <p> TYPE: <code>IndicatorFactory</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <code>List[str]</code> <p>List[str]: A list of technical indicator feature names.</p> <p>Examples:</p> <pre><code>import finlab.ml.feature as f\n\n\n# method 1: generate each indicator with random parameters\nfeatures = f.ta()\n\n# method 2: generate specific indicator\nfeature_names = ['talib.MACD__macdhist__fastperiod__52__slowperiod__212__signalperiod__75__']\nfeatures = f.ta(feature_names, resample='W')\n\n# method 3: generate some indicator\nfeature_names = f.ta_names()\nfeatures = f.ta(feature_names)\n</code></pre>"}, {"location": "reference/machine_learning/#finlabmllabel", "title": "finlab.ml.label", "text": "<p>\u6a19\u7c64\u751f\u6210\u6a21\u7d44\uff0c\u7528\u65bc\u8a2d\u8a08\u6a5f\u5668\u5b78\u7fd2\u7684\u76ee\u6a19\u8b8a\u6578\u3002</p>"}, {"location": "reference/machine_learning/#daytrading_percentage", "title": "daytrading_percentage()", "text": "<p>\u9810\u6e2c\u672a\u4f86 N \u671f\u5831\u916c\u7387\uff1a</p> <pre><code>from finlab.ml import feature as mlf, label as mll\n\n# \u5efa\u7acb\u7279\u5fb5\nfeatures = mlf.combine({...}, resample='W')\n\n# \u751f\u6210\u6a19\u7c64\uff1a\u9810\u6e2c\u672a\u4f86 1 \u9031\u5831\u916c\u7387\nlabel = mll.daytrading_percentage(\n    features.index,\n    period=1,\n    resample='W'\n)\n\n# \u751f\u6210\u6a19\u7c64\uff1a\u9810\u6e2c\u672a\u4f86 4 \u9031\u5831\u916c\u7387\nlabel_4w = mll.daytrading_percentage(\n    features.index,\n    period=4,\n    resample='W'\n)\n</code></pre> <p>period \u53c3\u6578\u9078\u64c7</p> <ul> <li>period=1: \u77ed\u671f\u9810\u6e2c\uff08\u9069\u5408\u9031/\u6708\u8abf\u5009\u7b56\u7565\uff09</li> <li>period=4: \u4e2d\u671f\u9810\u6e2c\uff08\u9069\u5408\u5b63\u5ea6\u8abf\u5009\uff09</li> <li>period \u8d8a\u5927: \u9810\u6e2c\u8d8a\u7a69\u5b9a\u4f46\u4fe1\u865f\u8d8a\u9072\u920d</li> <li>\u5efa\u8b70: \u8207\u7b56\u7565\u8abf\u5009\u983b\u7387\u4e00\u81f4</li> </ul>"}, {"location": "reference/machine_learning/#finlab.ml.label.daytrading_percentage", "title": "finlab.ml.label.daytrading_percentage", "text": "<pre><code>daytrading_percentage(index, **kwargs)\n</code></pre> <p>Calculate the percentage change of market prices over a given period.</p> PARAMETER DESCRIPTION <code>index</code> <p>A multi-level index of datetime and instrument.</p> <p> TYPE: <code>Index</code> </p> <code>resample</code> <p>The resample frequency for the output data. Defaults to None.</p> <p> TYPE: <code>Optional[str]</code> </p> <code>period</code> <p>The number of periods to calculate the percentage change over. Defaults to 1.</p> <p> TYPE: <code>int</code> </p> <code>trade_at_price</code> <p>The price for execution. Defaults to <code>close</code>.</p> <p> TYPE: <code>str</code> </p> <code>**kwargs</code> <p>Additional arguments to be passed to the resampler function.</p> <p> DEFAULT: <code>{}</code> </p> RETURNS DESCRIPTION <code>Series</code> <p>pd.Series: A pd.Series containing the percentage change of stock prices.</p>"}, {"location": "reference/machine_learning/#maximum_adverse_excursion", "title": "maximum_adverse_excursion()", "text": "<p>\u6700\u5927\u4e0d\u5229\u504f\u79fb\uff08\u98a8\u96aa\u6307\u6a19\uff09\uff1a</p> <pre><code>from finlab.ml import label as mll\n\n# \u8a08\u7b97\u672a\u4f86 N \u671f\u7684\u6700\u5927\u8dcc\u5e45\nmae_label = mll.maximum_adverse_excursion(\n    features.index,\n    period=5\n)\n\n# \u53ef\u7528\u65bc\u8a13\u7df4\u98a8\u96aa\u9810\u6e2c\u6a21\u578b\n# \u8ca0\u503c\u8d8a\u5927\u8868\u793a\u98a8\u96aa\u8d8a\u9ad8\n</code></pre>"}, {"location": "reference/machine_learning/#finlab.ml.label.maximum_adverse_excursion", "title": "finlab.ml.label.maximum_adverse_excursion", "text": "<pre><code>maximum_adverse_excursion(index, period=1, trade_at_price='close')\n</code></pre> <p>Calculate the maximum adverse excursion of market prices over a given period.</p> PARAMETER DESCRIPTION <code>index</code> <p>A multi-level index of datetime and instrument.</p> <p> TYPE: <code>Index</code> </p> <code>resample</code> <p>The resample frequency for the output data. Defaults to None.</p> <p> TYPE: <code>Optional[str]</code> </p> <code>period</code> <p>The number of periods to calculate the percentage change over. Defaults to 1.</p> <p> TYPE: <code>int</code> DEFAULT: <code>1</code> </p> <code>trade_at_price</code> <p>The price for execution. Defaults to <code>close</code>.</p> <p> TYPE: <code>str</code> DEFAULT: <code>'close'</code> </p> <code>**kwargs</code> <p>Additional arguments to be passed to the resampler function.</p> <p> </p> RETURNS DESCRIPTION <code>Series</code> <p>pd.Series: A pd.Series containing the percentage change of stock prices.</p>"}, {"location": "reference/machine_learning/#finlabmlqlib", "title": "finlab.ml.qlib", "text": "<p>qlib \u6846\u67b6\u6574\u5408\u6a21\u7d44\uff0c\u63d0\u4f9b\u591a\u7a2e\u6a5f\u5668\u5b78\u7fd2\u6a21\u578b\u7528\u65bc\u80a1\u7968\u9810\u6e2c\u3002</p>"}, {"location": "reference/machine_learning/#_6", "title": "\u6a21\u578b\u985e\u5225", "text": "<p>finlab.ml.qlib \u63d0\u4f9b\u4ee5\u4e0b\u6a21\u578b\uff1a</p> <p>\u57fa\u790e\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.ml import feature as mlf, label as mll\nimport finlab.ml.qlib as q\n\n# 1. \u6e96\u5099\u7279\u5fb5\nfeatures = mlf.combine({\n    'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n    'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\n}, resample='W')\n\n# 2. \u6e96\u5099\u6a19\u7c64\nlabel = mll.return_percentage(features.index, resample='W', period=1)\n\n# 3. \u5207\u5206\u8a13\u7df4/\u6e2c\u8a66\u96c6\nis_train = features.index.get_level_values('datetime') &lt; '2020-01-01'\nX_train, y_train = features[is_train], label[is_train]\nX_test = features[~is_train]\n\n# 4. \u5efa\u7acb\u4e26\u8a13\u7df4\u6a21\u578b\nmodel = q.XGBModel()  # \u53ef\u9078: q.LGBModel(), q.CatBoostModel(), q.LinearModel()\nmodel.fit(X_train, y_train)\n\n# 5. \u9810\u6e2c\ny_pred = model.predict(X_test)\n</code></pre> <p>\u652f\u63f4\u7684\u6a21\u578b\u985e\u578b\uff1a</p> \u6a21\u578b \u8aaa\u660e \u512a\u9ede \u7f3a\u9ede <code>LGBModel()</code> LightGBM \u5feb\u901f\u3001\u6548\u80fd\u597d\u3001\u8a18\u61b6\u9ad4\u4f54\u7528\u5c0f \u9700\u5b89\u88dd lightgbm <code>XGBModel()</code> XGBoost \u7a69\u5b9a\u3001\u53ef\u89e3\u91cb\u6027\u9ad8 \u8a13\u7df4\u8f03\u6162 <code>CatBoostModel()</code> CatBoost \u8655\u7406\u985e\u5225\u7279\u5fb5\u4f73\u3001\u904e\u64ec\u5408\u98a8\u96aa\u4f4e \u8a18\u61b6\u9ad4\u4f54\u7528\u5927 <code>LinearModel()</code> \u7dda\u6027\u56de\u6b78 \u7c21\u55ae\u3001\u5feb\u901f\u3001\u4e0d\u6613\u904e\u64ec\u5408 \u8868\u73fe\u901a\u5e38\u8f03\u5dee <p>\u6a21\u578b\u9078\u64c7\u5efa\u8b70</p> <ul> <li>\u521d\u5b78\u8005\u63a8\u85a6: <code>LGBModel()</code>\uff08\u5e73\u8861\u901f\u5ea6\u8207\u6548\u80fd\uff09</li> <li>\u8ffd\u6c42\u7a69\u5b9a: <code>XGBModel()</code></li> <li>\u6709\u985e\u5225\u7279\u5fb5: <code>CatBoostModel()</code></li> <li>\u5feb\u901f\u9a57\u8b49\u60f3\u6cd5: <code>LinearModel()</code></li> <li>\u907f\u514d\u904e\u64ec\u5408: \u5148\u7528 <code>LinearModel()</code> \u5efa\u7acb\u57fa\u6e96\uff0c\u518d\u5617\u8a66\u8907\u96dc\u6a21\u578b</li> </ul> <p>\u5e38\u898b\u932f\u8aa4</p> <ul> <li>\u8cc7\u6599\u6d29\u9732: \u78ba\u8a8d\u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6\u65e5\u671f\u4e0d\u91cd\u758a\uff08\u7528\u6642\u9593\u5207\u5206\uff0c\u4e0d\u8981\u96a8\u6a5f\u5207\u5206\uff09</li> <li>\u904e\u5ea6\u914d\u9069: \u6e2c\u8a66\u96c6\u8868\u73fe\u9060\u5dee\u65bc\u8a13\u7df4\u96c6\uff08IC &lt; 0.02 \u53ef\u80fd\u662f\u904e\u64ec\u5408\uff09</li> <li>\u672a\u4f86\u51fd\u6578: \u6a19\u7c64\u4f7f\u7528 <code>.shift(-1)</code> \u6216 <code>period=1</code> \u78ba\u4fdd\u4e0d\u6d29\u9732\u672a\u4f86\u8cc7\u8a0a</li> </ul>"}, {"location": "reference/machine_learning/#finlab.ml.qlib.LGBModel", "title": "finlab.ml.qlib.LGBModel", "text": "<pre><code>LGBModel()\n</code></pre> <p>LGBModel is a wrapper model for LightGBM model. <pre><code>import finlab.ml.qlib as q\n\n# build X_train, y_train, X_test\n\nmodel = q.LGBModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre></p>"}, {"location": "reference/machine_learning/#finlab.ml.qlib.XGBModel", "title": "finlab.ml.qlib.XGBModel", "text": "<pre><code>XGBModel()\n</code></pre> <p>XGBModel is a wrapper model for XGBoost model. <pre><code>import finlab.ml.qlib as q\n\n# build X_train, y_train, X_test\n\nmodel = q.XGBModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre></p>"}, {"location": "reference/machine_learning/#finlab.ml.qlib.CatBoostModel", "title": "finlab.ml.qlib.CatBoostModel", "text": "<pre><code>CatBoostModel()\n</code></pre> <p>CatBoostModel is a wrapper model for CatBoost model. <pre><code>import finlab.ml.qlib as q\n\n# build X_train, y_train, X_test\n\nmodel = q.CatBoostModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre></p>"}, {"location": "reference/machine_learning/#finlab.ml.qlib.LinearModel", "title": "finlab.ml.qlib.LinearModel", "text": "<pre><code>LinearModel()\n</code></pre> <p>LinearModel is a wrapper model for Linear model. <pre><code>import finlab.ml.qlib as q\n\n# build X_train, y_train, X_test\n\nmodel = q.LinearModel()\nmodel.fit(X_train, y_train)\ny_pred = model.predict(X_test)\n</code></pre></p>"}, {"location": "reference/machine_learning/#_7", "title": "\u5b8c\u6574\u7bc4\u4f8b", "text": ""}, {"location": "reference/machine_learning/#ml", "title": "\u5efa\u7acb ML \u9078\u80a1\u7b56\u7565", "text": "<pre><code>from finlab import data\nfrom finlab.ml import feature as mlf, label as mll, qlib\nfrom finlab.backtest import sim\n\n# \u6b65\u9a5f 1\uff1a\u5efa\u7acb\u7279\u5fb5\u96c6\nprint(\"\u5efa\u7acb\u7279\u5fb5...\")\nfeatures = mlf.combine({\n    # \u57fa\u672c\u9762\u7279\u5fb5\n    'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n    'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4'),\n    'roe': data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387'),\n\n    # \u6280\u8853\u6307\u6a19\uff08\u4f7f\u7528\u5c11\u91cf\u6307\u6a19\u907f\u514d\u904e\u64ec\u5408\uff09\n    'technical': mlf.ta(mlf.ta_names(n=1)[:20])  # \u53ea\u53d6\u524d 20 \u500b\n}, resample='W')\n\n# \u6b65\u9a5f 2\uff1a\u751f\u6210\u6a19\u7c64\nprint(\"\u751f\u6210\u6a19\u7c64...\")\nlabel = mll.daytrading_percentage(\n    features.index,\n    period=1,\n    resample='W'\n)\n\n# \u6b65\u9a5f 3\uff1a\u5207\u5206\u8a13\u7df4/\u6e2c\u8a66\u96c6\nprint(\"\u5207\u5206\u8cc7\u6599...\")\nis_train = features.index.get_level_values('datetime') &lt; '2023-01-01'\nX_train, y_train = features[is_train], label[is_train]\nX_test = features[~is_train]\n\n# \u6b65\u9a5f 4\uff1a\u8a13\u7df4\u6a21\u578b\nprint(\"\u8a13\u7df4\u6a21\u578b...\")\nmodel = q.LGBModel()\nmodel.fit(X_train, y_train)\n\n# \u6b65\u9a5f 5\uff1a\u9810\u6e2c\nprint(\"\u751f\u6210\u9810\u6e2c...\")\npred = model.predict(X_test)\n\n# \u6b65\u9a5f 6\uff1a\u8f49\u63db\u70ba\u4ea4\u6613\u8a0a\u865f\nprint(\"\u751f\u6210\u4ea4\u6613\u8a0a\u865f...\")\nposition = pred.is_largest(30)  # \u8cb7\u5165\u9810\u6e2c\u5831\u916c\u7387\u6700\u9ad8\u7684 30 \u6a94\n\n# \u6b65\u9a5f 7\uff1a\u56de\u6e2c\nprint(\"\u57f7\u884c\u56de\u6e2c...\")\nreport = sim(position, resample='W')\nreport.display()\n\n# \u6b65\u9a5f 8\uff1a\u5206\u6790\u7279\u5fb5\u91cd\u8981\u6027\uff08\u5982\u679c\u662f\u6a39\u6a21\u578b\uff09\nif hasattr(model, 'feature_importances_'):\n    import pandas as pd\n    feature_importance = pd.Series(\n        model.feature_importances_,\n        index=features.columns.get_level_values(1).unique()\n    ).sort_values(ascending=False)\n\n    print(\"\\n\u524d 10 \u91cd\u8981\u7279\u5fb5:\")\n    print(feature_importance.head(10))\n</code></pre>"}, {"location": "reference/machine_learning/#_8", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/machine_learning/#q-resample", "title": "Q: \u7279\u5fb5\u548c\u6a19\u7c64\u7684 resample \u4e0d\u4e00\u81f4\u6703\u600e\u6a23\uff1f", "text": "<p>\u6703\u5c0e\u81f4\u65e5\u671f\u932f\u4f4d\uff0c\u7121\u6cd5\u6b63\u78ba\u914d\u5c0d\u7279\u5fb5\u8207\u6a19\u7c64\uff1a</p> <pre><code># \u274c \u932f\u8aa4\uff1aresample \u4e0d\u4e00\u81f4\nfeatures = mlf.combine({...}, resample='W')  # \u9031\nlabel = mll.daytrading_percentage(features.index, period=1, resample='D')  # \u65e5\n# \u2192 \u6703\u51fa\u73fe shape \u4e0d\u5339\u914d\u932f\u8aa4\n\n# \u2705 \u6b63\u78ba\uff1aresample \u4e00\u81f4\nfeatures = mlf.combine({...}, resample='W')\nlabel = mll.daytrading_percentage(features.index, period=1, resample='W')\n</code></pre>"}, {"location": "reference/machine_learning/#q", "title": "Q: \u5982\u4f55\u907f\u514d\u904e\u5ea6\u914d\u9069\uff1f", "text": "<pre><code># \u65b9\u6cd5 1\uff1a\u6e1b\u5c11\u7279\u5fb5\u6578\u91cf\nfeatures = mlf.ta(mlf.ta_names(n=1)[:20])  # \u53ea\u7528 20 \u500b\u6307\u6a19\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528\u6b63\u5247\u5316\uff08\u964d\u4f4e\u6a21\u578b\u8907\u96dc\u5ea6\uff09\n# LightGBM \u652f\u63f4 L1/L2 \u6b63\u5247\u5316\u3001\u6a39\u6df1\u5ea6\u9650\u5236\u7b49\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528\u7c21\u55ae\u6a21\u578b\nmodel = q.LinearModel()  # \u7dda\u6027\u6a21\u578b\u4e0d\u6613\u904e\u64ec\u5408\n\n# \u65b9\u6cd5 4\uff1a\u6a23\u672c\u5916\u6e2c\u8a66\n# \u78ba\u4fdd\u6e2c\u8a66\u96c6\u8868\u73fe\u63a5\u8fd1\u8a13\u7df4\u96c6\uff08\u4e0d\u8981\u76f8\u5dee\u8d85\u904e 50%\uff09\n</code></pre>"}, {"location": "reference/machine_learning/#q_1", "title": "Q: \u8a13\u7df4\u5f88\u6162\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code># \u65b9\u6cd5 1\uff1a\u6e1b\u5c11\u8cc7\u6599\u7bc4\u570d\ndata.truncate_start = '2020-01-01'\n\n# \u65b9\u6cd5 2\uff1a\u6e1b\u5c11\u7279\u5fb5\u6578\u91cf\nfeatures = mlf.ta(mlf.ta_names(n=1)[:10])  # \u53ea\u7528 10 \u500b\u6307\u6a19\n\n# \u65b9\u6cd5 3\uff1a\u4f7f\u7528 resample='W' \u6216 'M'\uff08\u800c\u975e 'D'\uff09\nfeatures = mlf.combine({...}, resample='W')  # \u9031\u5ea6\u8cc7\u6599\u66f4\u5feb\n</code></pre>"}, {"location": "reference/machine_learning/#q_2", "title": "Q: \u5982\u4f55\u8655\u7406\u7f3a\u5931\u503c\uff1f", "text": "<pre><code># \u5148\u6aa2\u67e5\u7f3a\u5931\u503c\u72c0\u6cc1\nprint(f\"\u7279\u5fb5\u7f3a\u5931\u503c\u6bd4\u4f8b: {features.isna().sum().sum() / features.size:.2%}\")\nprint(f\"\u6a19\u7c64\u7f3a\u5931\u503c\u6bd4\u4f8b: {label.isna().sum() / len(label):.2%}\")\n\n# \u65b9\u6cd5 1\uff1a\u522a\u9664\u6709\u7f3a\u5931\u503c\u7684\u6a23\u672c\nfeatures_clean = features.dropna()\nlabel_clean = label.dropna()\n\n# \u65b9\u6cd5 2\uff1a\u5411\u524d\u586b\u88dc\uff08\u9069\u5408\u6642\u9593\u5e8f\u5217\uff09\nfeatures_filled = features.fillna(method='ffill')\nlabel_filled = label.fillna(method='ffill')\n\n# \u65b9\u6cd5 3\uff1a\u586b 0\uff08\u9069\u5408\u6280\u8853\u6307\u6a19\uff09\nfeatures_zero = features.fillna(0)\n</code></pre>"}, {"location": "reference/machine_learning/#q_3", "title": "Q: \u9810\u6e2c\u7d50\u679c\u5982\u4f55\u8f49\u63db\u70ba\u4ea4\u6613\u8a0a\u865f\uff1f", "text": "<pre><code># \u65b9\u6cd5 1\uff1a\u8cb7\u5165\u524d N \u540d\nposition = pred.is_largest(30)\n\n# \u65b9\u6cd5 2\uff1a\u8a2d\u5b9a\u95be\u503c\nposition = pred &gt; pred.quantile(0.8)  # \u8cb7\u5165\u524d 20%\n\n# \u65b9\u6cd5 3\uff1a\u591a\u7a7a\u7b56\u7565\nlong_position = pred.is_largest(20)   # \u505a\u591a\u524d 20 \u540d\nshort_position = pred.is_smallest(20)  # \u505a\u7a7a\u5f8c 20 \u540d\nposition = long_position - short_position\n\n# \u65b9\u6cd5 4\uff1a\u6839\u64da\u9810\u6e2c\u503c\u5206\u914d\u6b0a\u91cd\nposition = pred / pred.sum()  # \u6309\u9810\u6e2c\u503c\u6bd4\u4f8b\u5206\u914d\n</code></pre>"}, {"location": "reference/machine_learning/#_9", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u5b8c\u6574\u6d41\u7a0b - \u7aef\u5230\u7aef\u958b\u767c\u6307\u5357</li> <li>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u958b\u767c - \u8a73\u7d30\u6559\u5b78</li> <li>qlib \u5b98\u65b9\u6587\u6a94 - qlib \u6846\u67b6\u8aaa\u660e</li> <li>TA-Lib \u6307\u6a19\u5217\u8868 - \u6240\u6709\u6280\u8853\u6307\u6a19</li> </ul>"}, {"location": "reference/market/", "title": "finlab.market", "text": "<p>\u5e02\u5834\u7269\u4ef6(Market)\u5b9a\u7fa9\u4e86\u56de\u6e2c\u7cfb\u7d71\u5982\u4f55\u53d6\u5f97\u50f9\u683c\u8cc7\u6599\u3001\u5c0d\u7167\u6307\u6578\u3001\u5e02\u5834\u7279\u6027\u7b49\u8cc7\u8a0a\u3002FinLab \u5167\u5efa\u652f\u63f4\u53f0\u80a1\u3001\u7f8e\u80a1\u3001\u8208\u6ac3,\u4e5f\u53ef\u4ee5\u900f\u904e\u7e7c\u627f <code>Market</code> \u985e\u5225\u81ea\u8a02\u5e02\u5834\u3002</p>"}, {"location": "reference/market/#_1", "title": "\u5e02\u5834\u7269\u4ef6\u7684\u6982\u5ff5", "text": "<p>\u6bcf\u500b\u5e02\u5834\u6709\u4e0d\u540c\u7684\u7279\u6027:</p> <ul> <li>\u50f9\u683c\u8cc7\u6599\u4f86\u6e90: \u5f9e\u54ea\u88e1\u53d6\u5f97\u958b\u76e4\u50f9\u3001\u6536\u76e4\u50f9\u3001\u6210\u4ea4\u91cf\u7b49\u8cc7\u6599</li> <li>\u5c0d\u7167\u6307\u6578: \u7528\u65bc\u7e3e\u6548\u6bd4\u8f03\u7684\u57fa\u6e96(\u5982\u53f0\u80a1\u7528\u52a0\u6b0a\u6307\u6578\u3001\u7f8e\u80a1\u7528 S&amp;P 500)</li> <li>\u4ea4\u6613\u6642\u9593: \u958b\u76e4\u3001\u6536\u76e4\u6642\u9593\u8207\u6642\u5340</li> <li>\u5e02\u5834\u898f\u5247: \u6f32\u8dcc\u5e45\u9650\u5236\u3001\u4ea4\u6613\u6210\u672c\u3001\u7279\u6b8a\u80a1\u7968\u985e\u5225</li> </ul> <p>\u900f\u904e\u5e02\u5834\u7269\u4ef6,\u56de\u6e2c\u5f15\u64ce\u53ef\u4ee5:</p> <ol> <li>\u53d6\u5f97\u6b63\u78ba\u7684\u50f9\u683c\u8cc7\u6599</li> <li>\u8a08\u7b97\u6b63\u78ba\u7684\u5831\u916c\u7387</li> <li>\u986f\u793a\u5c0d\u7167\u6307\u6578\u7684\u7e3e\u6548\u6bd4\u8f03</li> <li>\u652f\u63f4\u5be6\u76e4\u4ea4\u6613\u7684\u6642\u9593\u5224\u65b7</li> </ol>"}, {"location": "reference/market/#_2", "title": "\u5167\u5efa\u5e02\u5834\u5c0d\u6bd4", "text": "\u7279\u6027 TWMarket USMarket ROTCMarket \u5e02\u5834\u540d\u7a31 <code>'tw_stock'</code> <code>'us_stock'</code> <code>'rotc_stock'</code> \u8cc7\u6599\u983b\u7387 \u6bcf\u65e5(<code>'1d'</code>) \u6bcf\u65e5(<code>'1d'</code>) \u6bcf\u65e5(<code>'1d'</code>) \u5c0d\u7167\u6307\u6578 \u52a0\u6b0a\u6307\u6578 S&amp;P 500 (\u7121) \u6642\u5340 Asia/Taipei US/Eastern Asia/Taipei \u6536\u76e4\u6642\u9593 15:00 16:00 14:00 \u6f32\u8dcc\u5e45\u9650\u5236 10% \u7121 \u7121 \u7279\u6b8a\u80a1\u7968\u985e\u5225 \u8655\u7f6e\u80a1/\u5168\u984d\u4ea4\u5272 \u7121 \u7121 \u8cc7\u6599\u4f86\u6e90 <code>finlab.data</code> <code>finlab.data</code> <code>finlab.data</code>"}, {"location": "reference/market/#_3", "title": "\u4f7f\u7528\u60c5\u5883", "text": ""}, {"location": "reference/market/#1", "title": "1. \u4f7f\u7528\u5167\u5efa\u5e02\u5834", "text": "<pre><code>from finlab import data, backtest\nfrom finlab.markets.tw import TWMarket\nfrom finlab.markets.us import USMarket\n\n# \u53f0\u80a1\u56de\u6e2c(\u9810\u8a2d)\ntw_close = data.get('price:\u6536\u76e4\u50f9')\ntw_position = tw_close &gt; tw_close.average(20)\nreport = backtest.sim(tw_position, resample='M')\n# \u7b49\u540c\u65bc\nreport = backtest.sim(tw_position, resample='M', market=TWMarket())\n\n# \u7f8e\u80a1\u56de\u6e2c\nus_close = data.get('etl:us_adj_close')\nus_position = us_close &gt; us_close.average(50)\nreport = backtest.sim(us_position, resample='W', market=USMarket())\n</code></pre>"}, {"location": "reference/market/#2-", "title": "2. \u81ea\u8a02\u5e02\u5834 - \u52a0\u5bc6\u8ca8\u5e63", "text": "<pre><code>from finlab.market import Market\nimport pandas as pd\n\nclass CryptoMarket(Market):\n\n    @staticmethod\n    def get_name():\n        return 'crypto'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        df = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\n        return df\n\n    @staticmethod\n    def get_benchmark():\n        df = pd.read_csv('crypto_close.csv', index_col=0, parse_dates=True)\n        return df['BTC']  # \u4f7f\u7528 BTC \u7576\u5c0d\u7167\n\n# \u4f7f\u7528\nreport = backtest.sim(position, market=CryptoMarket())\n</code></pre>"}, {"location": "reference/market/#3-", "title": "3. \u81ea\u8a02\u5e02\u5834 - \u671f\u8ca8(\u542b\u69d3\u687f)", "text": "<pre><code>class FuturesMarket(Market):\n\n    def __init__(self, leverage=10):\n        self.leverage = leverage\n        self.prices = pd.read_csv('futures_price.csv', index_col=0, parse_dates=True)\n\n    @staticmethod\n    def get_name():\n        return 'futures'\n\n    def get_price(self, trade_at_price='close', adj=True):\n        price = self.prices[trade_at_price]\n        daily_return = price.pct_change() * self.leverage\n        leveraged_price = (1 + daily_return).fillna(1).cumprod() * 100\n        return leveraged_price\n\n# \u4f7f\u7528 10 \u500d\u69d3\u687f\nreport = backtest.sim(position, market=FuturesMarket(leverage=10))\n</code></pre>"}, {"location": "reference/market/#_4", "title": "\u81ea\u8a02\u5e02\u5834\u7684\u5178\u578b\u5834\u666f", "text": "\u5834\u666f \u8aaa\u660e \u7bc4\u4f8b \u52a0\u5bc6\u8ca8\u5e63 24 \u5c0f\u6642\u4ea4\u6613,\u7121\u6f32\u8dcc\u5e45\u9650\u5236 BTC, ETH, BNB \u671f\u8ca8 \u6709\u69d3\u687f\u6548\u679c,\u9700\u6a21\u64ec\u69d3\u687f\u5831\u916c \u53f0\u6307\u671f\u3001\u7f8e\u80a1\u671f\u8ca8 \u6d77\u5916\u80a1\u7968 \u4e0d\u5728 FinLab \u8cc7\u6599\u5eab\u7684\u5e02\u5834 \u65e5\u80a1\u3001\u6e2f\u80a1\u3001\u9678\u80a1 \u81ea\u8a02\u8cc7\u6599 \u5f9e CSV\u3001API \u8f09\u5165\u50f9\u683c \u79c1\u6709\u8cc7\u6599\u3001\u6a21\u64ec\u8cc7\u6599 \u6df7\u5408\u5e02\u5834 \u540c\u6642\u56de\u6e2c\u591a\u500b\u5e02\u5834\u7684\u7d44\u5408 \u53f0\u80a1 + \u7f8e\u80a1 + \u52a0\u5bc6\u8ca8\u5e63"}, {"location": "reference/market/#_5", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u81ea\u8a02\u5e02\u5834\u7269\u4ef6\u5b8c\u6574\u6307\u5357\uff0c\u4e86\u89e3:</p> <ul> <li>Market \u985e\u5225\u5b8c\u6574 API \u8aaa\u660e</li> <li>\u5fc5\u9808\u5be6\u4f5c vs \u9078\u7528\u7684\u65b9\u6cd5</li> <li>\u5982\u4f55\u8655\u7406\u591a\u6642\u5340</li> <li>\u5982\u4f55\u5be6\u4f5c\u5e02\u5834\u4f11\u5e02\u908f\u8f2f</li> <li>\u5f9e CSV\u3001API\u3001FinLab \u8cc7\u6599\u5eab\u6df7\u5408\u8f09\u5165\u8cc7\u6599</li> <li>3 \u500b\u5be6\u6230\u6848\u4f8b(\u9ec3\u91d1 ETF\u3001\u5168\u7403\u5e02\u5834\u3001\u52a0\u5bc6\u8ca8\u5e63 4H)</li> </ul>"}, {"location": "reference/market/#api-reference", "title": "API Reference", "text": "<p>\u5feb\u901f\u958b\u767c\u6280\u5de7</p> <p>\u6700\u7c21\u55ae\u7684\u81ea\u8a02\u5e02\u5834\u53ea\u9700\u5be6\u4f5c\u5169\u500b\u65b9\u6cd5:</p> <ol> <li><code>get_name()</code>: \u56de\u50b3\u5e02\u5834\u540d\u7a31</li> <li><code>get_price()</code>: \u56de\u50b3\u50f9\u683c DataFrame</li> </ol> <p>\u5176\u4ed6\u65b9\u6cd5\u90fd\u662f\u9078\u7528\u7684,\u53ef\u6839\u64da\u9700\u6c42\u5be6\u4f5c\u3002</p> <p>\u5e38\u898b\u932f\u8aa4</p> <ul> <li><code>get_price()</code> \u56de\u50b3\u7684 DataFrame \u5fc5\u9808 index \u70ba DatetimeIndex</li> <li>columns \u70ba\u80a1\u7968\u4ee3\u865f(str)</li> <li>\u7f3a\u5931\u503c\u5efa\u8b70\u4f7f\u7528 forward fill \u8655\u7406</li> </ul>"}, {"location": "reference/market/#finlab.market.Market", "title": "finlab.market.Market", "text": "<p>               Bases: <code>ABC</code></p> <p>\u5e02\u5834\u985e\u5225 \u5047\u5982\u5e0c\u671b\u958b\u767c\u65b0\u7684\u4ea4\u6613\u5e02\u5834\u5957\u7528\u5230\u56de\u6e2c\u7cfb\u7d71\uff0c\u53ef\u4ee5\u7e7c\u627f <code>finlab.market.Market</code> \u4f86\u5be6\u505a\u65b0\u985e\u5225\u3002</p>"}, {"location": "reference/market/#finlab.market.Market.get_asset_id_to_name", "title": "get_asset_id_to_name  <code>staticmethod</code>", "text": "<pre><code>get_asset_id_to_name()\n</code></pre> <p>\u8a2d\u5b9a\u5c0d\u6a19\u5831\u916c\u7387\u7684\u6642\u9593\u5e8f\u5217 Returns:   (dict): \u80a1\u865f\u8207\u80a1\u540d\u5c0d\u7167\u8868\uff0cex:<code>{'2330':'\u53f0\u7a4d\u96fb'}</code></p>"}, {"location": "reference/market/#finlab.market.Market.get_benchmark", "title": "get_benchmark  <code>staticmethod</code>", "text": "<pre><code>get_benchmark()\n</code></pre> <p>\u8a2d\u5b9a\u5c0d\u6a19\u5831\u916c\u7387\u7684\u6642\u9593\u5e8f\u5217</p> <p>\u9019\u500b\u51fd\u6578\u7528\u65bc\u8a2d\u5b9a\u5c0d\u6a19\u5831\u916c\u7387\u7684\u6642\u9593\u5e8f\u5217\u3002</p> RETURNS DESCRIPTION <code>Series</code> <p>pd.Series: \u6642\u9593\u5e8f\u5217\u7684\u5831\u916c\u7387\u3002</p> RAISES DESCRIPTION <code>ExceptionType</code> <p>Description of conditions under which the exception is raised.</p> <p>Examples:</p> date 0050 2007-04-23 100 2007-04-24 100.1 2007-04-25 99 2007-04-26 98.3 2007-04-27 99.55"}, {"location": "reference/market/#finlab.market.Market.get_board_lot_size", "title": "get_board_lot_size  <code>staticmethod</code>", "text": "<pre><code>get_board_lot_size()\n</code></pre> <p>Returns the board lot size of the market.</p> RETURNS DESCRIPTION <code>int</code> <p>The board lot size of the market.</p> <p> TYPE: <code>int</code> </p>"}, {"location": "reference/market/#finlab.market.Market.get_freq", "title": "get_freq  <code>staticmethod</code>", "text": "<pre><code>get_freq()\n</code></pre> <p>Returns the frequency of the data. Used to determine how to resample the data when the data is not daily. The freq will be saved in <code>finlab.core.report</code>.</p> <p>Returns: str: The frequency of the data.</p>"}, {"location": "reference/market/#finlab.market.Market.get_market_value", "title": "get_market_value  <code>staticmethod</code>", "text": "<pre><code>get_market_value()\n</code></pre> <p>\u53d6\u5f97\u56de\u6e2c\u7528\u5e02\u503c\u6578\u64da</p> RETURNS DESCRIPTION <code>DataFrame</code> <p>\u5e02\u503c\u6578\u64da\uff0c\u5176\u4e2d index \u70ba\u65e5\u671f\uff0c\u800c columns \u662f\u80a1\u7968\u4ee3\u865f\u3002</p>"}, {"location": "reference/market/#finlab.market.Market.get_name", "title": "get_name  <code>staticmethod</code>", "text": "<pre><code>get_name()\n</code></pre> <p>Returns the name of the market data source.</p> <p>This function is used to get the name of the market data source.</p>"}, {"location": "reference/market/#finlab.market.Market.get_odd_lot", "title": "get_odd_lot  <code>staticmethod</code>", "text": "<pre><code>get_odd_lot()\n</code></pre> <p>Returns the odd lot size of the market.</p> RETURNS DESCRIPTION <code>int</code> <p>The odd lot size of the market.</p> <p> TYPE: <code>int</code> </p>"}, {"location": "reference/market/#finlab.market.Market.get_price", "title": "get_price  <code>abstractmethod</code>", "text": "<pre><code>get_price(trade_at_price, adj=True)\n</code></pre> <p>\u53d6\u5f97\u56de\u6e2c\u7528\u50f9\u683c\u6216\u6210\u4ea4\u91cf\u6578\u64da</p> PARAMETER DESCRIPTION <code>trade_at_price</code> <p>\u50f9\u683c\u985e\u578b\u6216\u81ea\u8a02\u8cc7\u6599  - str: \u53ef\u9078 'open', 'close', 'high', 'low', 'volume'  - pd.Series: \u81ea\u8a02\u50f9\u683c\u5e8f\u5217\uff08\u55ae\u4e00\u80a1\u7968\u6216\u6642\u9593\u5e8f\u5217\uff09  - pd.DataFrame: \u81ea\u8a02\u50f9\u683c\u8cc7\u6599\uff08\u591a\u6a94\u80a1\u7968\uff09</p> <p> TYPE: <code>Union[str, Series, DataFrame]</code> </p> <code>adj</code> <p>\u662f\u5426\u4f7f\u7528\u9084\u539f\u80a1\u50f9\u8a08\u7b97\u3002\u50c5\u5c0d\u50f9\u683c\u8cc7\u6599\u6709\u6548\uff0cvolume \u6703\u5ffd\u7565\u6b64\u53c3\u6578\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>\u50f9\u683c\u6216\u6210\u4ea4\u91cf\u6578\u64da\uff0cindex \u70ba\u65e5\u671f\uff0ccolumns \u70ba\u80a1\u7968\u4ee3\u865f\u3002</p> Note <p>\u5fc5\u9808\u5be6\u4f5c\u7684 trade_at_price \u503c\uff1a</p> <ul> <li>'open', 'close', 'high', 'low': \u57fa\u672c\u50f9\u683c\u8cc7\u6599\uff08\u5fc5\u9808\u5be6\u4f5c\uff09</li> <li>\u7528\u65bc <code>get_trading_price()</code> \u8a08\u7b97\u7d44\u5408\u50f9\u683c</li> <li> <p>\u7528\u65bc\u56de\u6e2c\u7684\u4ea4\u6613\u50f9\u683c</p> </li> <li> <p>'volume': \u6210\u4ea4\u91cf\u8cc7\u6599\uff08\u5f37\u70c8\u5efa\u8b70\u5be6\u4f5c\uff09</p> </li> <li><code>LiquidityAnalysis</code>: \u6d41\u52d5\u6027\u5206\u6790\u9700\u8981\u8a08\u7b97\u6210\u4ea4\u91d1\u984d</li> <li><code>ml/qlib.py</code>: \u6a5f\u5668\u5b78\u7fd2\u7279\u5fb5\u751f\u6210</li> <li><code>portfolio_sync_manager.py</code>: \u5be6\u6642 portfolio \u7ba1\u7406</li> <li> <p>\u82e5\u4e0d\u5be6\u4f5c\uff0c\u76f8\u95dc\u5206\u6790\u529f\u80fd\u6703\u5931\u6548</p> </li> <li> <p>pd.Series, pd.DataFrame: \u81ea\u8a02\u8cc7\u6599\uff08\u5efa\u8b70\u652f\u63f4\uff09</p> </li> <li>\u7528\u65bc\u5f48\u6027\u56de\u6e2c\uff0c\u5141\u8a31\u50b3\u5165\u81ea\u8a02\u50f9\u683c\u8cc7\u6599</li> <li>Series \u6703\u81ea\u52d5\u8f49\u63db\u70ba\u55ae\u6b04 DataFrame</li> </ul> <p>Examples:</p> <p>\u56de\u50b3\u683c\u5f0f\u7bc4\u4f8b\uff1a</p> date 0015 0050 0051 0052 2007-04-23 9.54 57.85 32.83 38.4 2007-04-24 9.54 58.1 32.99 38.65 2007-04-25 9.52 57.6 32.8 38.59 2007-04-26 9.59 57.7 32.8 38.6 2007-04-27 9.55 57.5 32.72 38.4 <p>\u5be6\u4f5c\u7bc4\u4f8b\uff1a</p> <pre><code>def get_price(self, trade_at_price, adj=True):\n    # \u8655\u7406\u81ea\u8a02\u8cc7\u6599\n    if isinstance(trade_at_price, pd.Series):\n        return trade_at_price.to_frame()\n    if isinstance(trade_at_price, pd.DataFrame):\n        return trade_at_price\n\n    # \u8655\u7406\u5b57\u4e32\n    if isinstance(trade_at_price, str):\n        if trade_at_price == 'volume':\n            return data.get('your_volume_data')  # \u5fc5\u9808\u5be6\u4f5c\n\n        # \u8655\u7406 open/close/high/low\n        if adj:\n            return data.get(f'adj_{trade_at_price}')\n        else:\n            return data.get(trade_at_price)\n\n    raise ValueError(f'Unsupported trade_at_price: {trade_at_price}')\n</code></pre> <p>\u8a73\u7d30\u5be6\u4f5c\u53ef\u53c3\u8003 <code>finlab.markets.tw.TWMarket.get_price()</code></p>"}, {"location": "reference/market/#finlab.market.Market.get_reference_price", "title": "get_reference_price", "text": "<pre><code>get_reference_price()\n</code></pre> <p>Returns the most recent reference price of the market.</p> RETURNS DESCRIPTION <code>Dict[str, float]</code> <p>pandas.Series: The most recent reference price of the market.</p>"}, {"location": "reference/market/#finlab.market.Market.get_trading_price", "title": "get_trading_price", "text": "<pre><code>get_trading_price(name, adj=True)\n</code></pre> <p>\u53d6\u5f97\u56de\u6e2c\u7528\u50f9\u683c\u6578\u64da</p> PARAMETER DESCRIPTION <code>name</code> <p>\u9078\u64c7\u56de\u6e2c\u4e4b\u9084\u539f\u80a1\u50f9\u4ee5\u6536\u76e4\u50f9\u6216\u958b\u76e4\u50f9\u8a08\u7b97\uff0c\u9810\u8a2d\u70ba'close'\u3002\u53ef\u9078 'open'\u3001'close'\u3001'high'\u3001'low'\u3001'open_close_avg'\u3001'high_low_avg'\u3001\u6216 'price_avg'\u3002</p> <p> TYPE: <code>str</code> </p> <p>Returns:     (pd.DataFrame): \u50f9\u683c\u6578\u64da</p>"}, {"location": "reference/market/#finlab.market.Market.market_close_at_timestamp", "title": "market_close_at_timestamp", "text": "<pre><code>market_close_at_timestamp(timestamp=None)\n</code></pre> <p>Returns the timestamp of the market close of the given timestamp.</p> PARAMETER DESCRIPTION <code>timestamp</code> <p>The timestamp to find the market close to.</p> <p> TYPE: <code>datetime</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <code>datetime</code> <p>The timestamp of the closest market close.</p>"}, {"location": "reference/market/#finlab.market.Market.market_open_time", "title": "market_open_time  <code>staticmethod</code>", "text": "<pre><code>market_open_time()\n</code></pre> <p>Returns (hour, minute) of market open in local timezone.</p>"}, {"location": "reference/market/#finlab.market.Market.tzinfo", "title": "tzinfo  <code>staticmethod</code>", "text": "<pre><code>tzinfo()\n</code></pre> <p>Returns the timezone of the market.</p> RETURNS DESCRIPTION <code>Union[timezone, None]</code> <p>datetime.timezone: The timezone of the market.</p>"}, {"location": "reference/market/#_6", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/market/#q-adjtrue", "title": "Q: \u5982\u4f55\u8655\u7406\u8abf\u6574\u5f8c\u50f9\u683c(adj=True)?", "text": "<pre><code>def get_price(self, trade_at_price='close', adj=True):\n    if adj:\n        # \u56de\u50b3\u8003\u616e\u9664\u6b0a\u606f\u7684\u8abf\u6574\u5f8c\u50f9\u683c\n        return pd.read_csv('adj_close.csv', index_col=0, parse_dates=True)\n    else:\n        # \u56de\u50b3\u539f\u59cb\u6536\u76e4\u50f9\n        return pd.read_csv('raw_close.csv', index_col=0, parse_dates=True)\n</code></pre>"}, {"location": "reference/market/#q-get_benchmark", "title": "Q: \u70ba\u4ec0\u9ebc\u9700\u8981 get_benchmark()?", "text": "<p>\u5c0d\u7167\u6307\u6578\u7528\u65bc\u7e3e\u6548\u6bd4\u8f03,\u5728 <code>report.display()</code> \u6642\u6703\u986f\u793a\u7b56\u7565 vs \u5c0d\u7167\u6307\u6578\u7684\u5831\u916c\u66f2\u7dda\u3002\u5982\u679c\u4e0d\u9700\u8981\u5c0d\u7167,\u56de\u50b3\u7a7a Series \u5373\u53ef:</p> <pre><code>@staticmethod\ndef get_benchmark():\n    return pd.Series([])  # \u4e0d\u986f\u793a\u5c0d\u7167\u6307\u6578\n</code></pre>"}, {"location": "reference/market/#q-get_price-finlabdataget", "title": "Q: \u53ef\u4ee5\u5728 get_price() \u4e2d\u4f7f\u7528 finlab.data.get() \u55ce?", "text": "<p>\u53ef\u4ee5!\u9019\u662f\u6df7\u5408\u4f7f\u7528 FinLab \u8cc7\u6599\u7684\u6a19\u6e96\u505a\u6cd5:</p> <pre><code>from finlab import data\n\nclass MixedMarket(Market):\n    def get_price(self, trade_at_price='close', adj=True):\n        tw_close = data.get('price:\u6536\u76e4\u50f9')[['2330', '2317']]\n        us_close = data.get('etl:us_adj_close')[['AAPL', 'TSLA']]\n        return pd.concat([tw_close, us_close], axis=1)\n</code></pre>"}, {"location": "reference/market/#q", "title": "Q: \u5982\u4f55\u6a21\u64ec\u4ea4\u6613\u6210\u672c?", "text": "<p>\u4ea4\u6613\u6210\u672c\u5728 <code>backtest.sim()</code> \u51fd\u6578\u4e2d\u8a2d\u5b9a,\u4e0d\u5728 Market \u7269\u4ef6:</p> <pre><code># \u52a0\u5bc6\u8ca8\u5e63\u901a\u5e38\u624b\u7e8c\u8cbb\u8f03\u4f4e,\u7a05\u7387\u70ba 0\nreport = backtest.sim(\n    position,\n    market=CryptoMarket(),\n    fee_ratio=0.001,  # 0.1% \u624b\u7e8c\u8cbb\n    tax_ratio=0       # \u7121\u4ea4\u6613\u7a05\n)\n</code></pre>"}, {"location": "reference/market/#_7", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u81ea\u8a02\u5e02\u5834\u7269\u4ef6\u5b8c\u6574\u6307\u5357</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>TWMarket \u539f\u59cb\u78bc</li> <li>USMarket \u539f\u59cb\u78bc</li> </ul>"}, {"location": "reference/online/", "title": "finlab.online", "text": "<p>\u5be6\u76e4\u4ea4\u6613\u6a21\u7d44\uff0c\u7528\u65bc\u5c07\u56de\u6e2c\u7b56\u7565\u90e8\u7f72\u81f3\u771f\u5be6\u5238\u5546\u5e33\u6236\uff0c\u57f7\u884c\u81ea\u52d5\u4e0b\u55ae\u3002</p> <p>\u26a0\ufe0f \u91cd\u8981\u98a8\u96aa\u8b66\u544a</p> <p>\u5be6\u76e4\u4ea4\u6613\u6d89\u53ca\u771f\u5be6\u91d1\u9322\uff0c\u932f\u8aa4\u53ef\u80fd\u5c0e\u81f4\u8ca1\u52d9\u640d\u5931\uff01</p> <p>\u5fc5\u9808\u9075\u5b88\u7684\u5b89\u5168\u539f\u5247\uff1a</p> <ol> <li>\u2705 \u52d9\u5fc5\u5148\u7528\u6a21\u64ec\u5e33\u6236\u6e2c\u8a66\u81f3\u5c11 1 \u500b\u6708</li> <li>\u2705 \u521d\u671f\u8cc7\u91d1\u4e0d\u8d85\u904e\u7e3d\u8cc7\u91d1\u7684 10-20%</li> <li>\u2705 \u6bcf\u65e5\u76e3\u63a7\u6301\u5009\u8207\u8a02\u55ae\u72c0\u614b</li> <li>\u2705 \u8a2d\u5b9a\u505c\u640d\u6a5f\u5236\uff0c\u907f\u514d\u55ae\u6b21\u5de8\u5927\u8667\u640d</li> <li>\u2705 \u5728\u958b\u767c/\u6e2c\u8a66\u74b0\u5883\u8207\u751f\u7522\u74b0\u5883\u4f7f\u7528\u4e0d\u540c\u5e33\u6236</li> <li>\u274c \u7d55\u5c0d\u4e0d\u8981\u5728\u672a\u6e2c\u8a66\u7684\u7b56\u7565\u4e0a\u4f7f\u7528\u5168\u90e8\u8cc7\u91d1</li> <li>\u274c \u4e0d\u8981\u5ffd\u7565\u932f\u8aa4\u8a0a\u606f\u6216\u7570\u5e38\u72c0\u614b</li> </ol>"}, {"location": "reference/online/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u81ea\u52d5\u5316\u4ea4\u6613: \u6839\u64da\u7b56\u7565\u81ea\u52d5\u4e0b\u55ae\u3001\u8abf\u5009\uff0c\u7121\u9700\u624b\u52d5\u64cd\u4f5c</li> <li>\u591a\u5e33\u6236\u7ba1\u7406: \u540c\u6642\u7ba1\u7406\u591a\u500b\u5238\u5546\u5e33\u6236\uff08\u6c38\u8c50\u3001\u5bcc\u90a6\u7b49\uff09</li> <li>\u5be6\u76e4\u8ffd\u8e64: \u8a18\u9304\u5be6\u969b\u4ea4\u6613\u7e3e\u6548\uff0c\u8207\u56de\u6e2c\u7d50\u679c\u5c0d\u6bd4</li> <li>\u98a8\u96aa\u63a7\u5236: \u81ea\u52d5\u6aa2\u6e2c\u6301\u5009\u7570\u5e38\u3001\u55ae\u80a1\u904e\u91cd\u3001\u8cc7\u91d1\u4e0d\u8db3\u7b49\u554f\u984c</li> </ul>"}, {"location": "reference/online/#_2", "title": "\u5f9e\u56de\u6e2c\u5230\u5be6\u76e4\u7684\u904e\u6e21\u6d41\u7a0b", "text": "<pre><code>graph LR\n    A[\u7b56\u7565\u56de\u6e2c] --&gt; B[\u6a23\u672c\u5916\u6e2c\u8a66]\n    B --&gt; C[\u4e0a\u50b3\u81f3\u96f2\u7aef]\n    C --&gt; D[\u6a21\u64ec\u5e33\u6236\u6e2c\u8a66]\n    D --&gt; E{\u6e2c\u8a66\u901a\u904e?}\n    E --&gt;|\u662f| F[\u5c0f\u8cc7\u91d1\u5be6\u76e4]\n    E --&gt;|\u5426| A\n    F --&gt; G[\u9010\u6b65\u589e\u52a0\u8cc7\u91d1]</code></pre> <p>\u5efa\u8b70\u6642\u7a0b\uff1a 1. \u7b56\u7565\u56de\u6e2c\uff081-2 \u9031\uff09\uff1a\u78ba\u8a8d\u908f\u8f2f\u6b63\u78ba 2. \u6a23\u672c\u5916\u6e2c\u8a66\uff082-4 \u9031\uff09\uff1a\u4f7f\u7528\u672a\u898b\u904e\u7684\u8cc7\u6599 3. \u6a21\u64ec\u5e33\u6236\uff084-8 \u9031\uff09\uff1a\u771f\u5be6\u5e02\u5834\u689d\u4ef6\uff0c\u4f46\u4e0d\u7528\u771f\u9322 4. \u5c0f\u8cc7\u91d1\u5be6\u76e4\uff088-12 \u9031\uff09\uff1a10-20% \u8cc7\u91d1\u6e2c\u8a66 5. \u9010\u6b65\u64f4\u5927\uff08\u8996\u60c5\u6cc1\uff09\uff1a\u78ba\u8a8d\u7a69\u5b9a\u5f8c\u624d\u589e\u52a0\u8cc7\u91d1</p>"}, {"location": "reference/online/#_3", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/online/#_4", "title": "\u57fa\u790e\u7528\u6cd5\uff1a\u81ea\u52d5\u4e0b\u55ae", "text": "<pre><code>from finlab.online.order_executor import Position, OrderExecutor\nfrom finlab.online.base_account import Account\n\n# 1. \u8a2d\u5b9a\u5238\u5546\u5e33\u6236\uff08\u7bc4\u4f8b\u4f7f\u7528\u6c38\u8c50\u8b49\u5238\uff09\naccount = Account(\n    broker='shioaji',            # \u6c38\u8c50\u8b49\u5238\n    account='YOUR_ACCOUNT_ID',   # \u5e33\u865f\n    password='YOUR_PASSWORD'     # \u5bc6\u78bc\uff08\u5efa\u8b70\u4f7f\u7528\u74b0\u5883\u8b8a\u6578\uff09\n)\n\n# 2. \u5efa\u7acb\u8a02\u55ae\u57f7\u884c\u5668\nexecutor = OrderExecutor(\n    account=account,\n    market='TW',                 # \u53f0\u80a1\n    base_currency='TWD'          # \u53f0\u5e63\n)\n\n# 3. \u5f9e\u96f2\u7aef\u53d6\u5f97\u6700\u65b0\u6301\u5009\nposition = Position.from_report(\n    report_id='YOUR_REPORT_ID',  # \u96f2\u7aef\u7b56\u7565 ID\n    total_funds=1000000          # \u7e3d\u8cc7\u91d1 100 \u842c\n)\n\n# 4. \u57f7\u884c\u4e0b\u55ae\uff08\u8acb\u5728\u6a21\u64ec\u5e33\u6236\u6e2c\u8a66\uff01\uff09\nexecutor.create_orders(position)\n</code></pre>"}, {"location": "reference/online/#_5", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003\u4ee5\u4e0b\u6559\u5b78\u4e86\u89e3\u5b8c\u6574\u6d41\u7a0b\uff1a</p> <ul> <li>\u5be6\u76e4\u4e0b\u55ae\u6559\u5b78\uff08\u55ae\u7b56\u7565\uff09 - \u57fa\u790e\u4e0b\u55ae\u6d41\u7a0b</li> <li>\u5be6\u76e4\u4e0b\u55ae\u6559\u5b78\uff08\u591a\u7b56\u7565\uff09 - \u7d44\u5408\u4e0b\u55ae\u7ba1\u7406</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357 - \u5be6\u76e4\u98a8\u96aa\u63a7\u5236</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5f9e\u7814\u7a76\u5230\u5be6\u76e4</li> </ul>"}, {"location": "reference/online/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/online/#account", "title": "Account", "text": "<p>\u5e33\u6236\u5b89\u5168\u6700\u4f73\u5be6\u8e10</p> <p>\u4f7f\u7528\u74b0\u5883\u8b8a\u6578\u5b58\u5132\u654f\u611f\u8cc7\u8a0a: <pre><code>import os\n\naccount = Account(\n    broker='shioaji',\n    account=os.environ.get('BROKER_ACCOUNT'),\n    password=os.environ.get('BROKER_PASSWORD')\n)\n# \u4e0d\u8981\u5728\u7a0b\u5f0f\u78bc\u4e2d\u786c\u7de8\u78bc\u5e33\u5bc6\uff01\n</code></pre></p> <p>\u5206\u96e2\u958b\u767c/\u751f\u7522\u74b0\u5883: <pre><code># \u958b\u767c\u74b0\u5883\uff1a\u4f7f\u7528\u6a21\u64ec\u5e33\u6236\nif os.environ.get('ENV') == 'development':\n    account = Account(broker='shioaji', simulate=True)\nelse:\n    # \u751f\u7522\u74b0\u5883\uff1a\u4f7f\u7528\u771f\u5be6\u5e33\u6236\n    account = Account(\n        broker='shioaji',\n        account=os.environ.get('PROD_ACCOUNT'),\n        password=os.environ.get('PROD_PASSWORD')\n    )\n</code></pre></p>"}, {"location": "reference/online/#finlab.online.base_account.Account", "title": "finlab.online.base_account.Account", "text": "<p>               Bases: <code>ABC</code></p>"}, {"location": "reference/online/#finlab.online.base_account.Account.module_version", "title": "module_version  <code>class-attribute</code> <code>instance-attribute</code>", "text": "<pre><code>module_version = ''\n</code></pre> <p>\u80a1\u7968\u5e33\u6236\u7684 abstract class \u53ef\u4ee5\u7e7c\u627f\u6b64 Account\uff0c\u4f86\u5be6\u505a\u5238\u5546\u7684\u5e33\u6236\u8cb7\u8ce3\u52d5\u4f5c\uff0c\u76ee\u524d\u5df2\u7d93\u5be6\u505a SinopacAccount (\u6c38\u8c50\u8b49\u5238) \u4ee5\u53ca FugleAccount (\u7389\u5c71\u5bcc\u679c)\uff0c\u4f86\u9032\u884c\u4ea4\u6613\u3002\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u5f0f\u5efa\u69cb\u7269\u4ef6\u4e26\u7528\u4f86\u4ea4\u6613\uff1a</p> <p>\u6c38\u8c50\u8b49\u5238 <pre><code>import os\nfrom finlab.online.sinopac_account import SinopacAccount\n\n\n# \u820a\u7248\u8acb\u4f7f\u7528\n# shioaji &lt; 1.0.0 and finlab &lt; 0.3.18\nos.environ['SHIOAJI_ACCOUNT']= '\u6c38\u8c50\u8b49\u5238\u5e33\u865f'\nos.environ['SHIOAJI_PASSWORD']= '\u6c38\u8c50\u8b49\u5238\u5bc6\u78bc'\n\n# \u65b0\u7248\u8acb\u4f7f\u7528\n# shioaji &gt;= 1.0.0 and finlab &gt;= 0.3.18\nos.environ['SHIOAJI_API_KEY'] = '\u6c38\u8c50\u8b49\u5238API_KEY'\nos.environ['SHIOAJI_SECRET_KEY'] = '\u6c38\u8c50\u8b49\u5238SECRET_KEY'\nos.environ['SHIOAJI_CERT_PERSON_ID']= '\u8eab\u4efd\u8b49\u5b57\u865f'\n\n# shioaji\nos.environ['SHIOAJI_CERT_PATH']= '\u6c38\u8c50\u8b49\u5238\u6191\u8b49\u8def\u5f91'\nos.environ['SHIOAJI_CERT_PASSWORD'] = '\u6c38\u8c50\u8b49\u5238\u6191\u8b49\u5bc6\u78bc' # \u9810\u8a2d\u8207\u8eab\u4efd\u8b49\u5b57\u865f\n\nacc = SinopacAccount()\n</code></pre> \u7389\u5c71\u5bcc\u679c: <pre><code>from finlab.online.fugle_account import FugleAccount\nimport os\nos.environ['FUGLE_CONFIG_PATH'] = '\u7389\u5c71\u5bcc\u679c\u4ea4\u6613\u8a2d\u5b9a\u6a94(config.ini.example)\u8def\u5f91'\nos.environ['FUGLE_MARKET_API_KEY'] = '\u7389\u5c71\u5bcc\u679c\u7684\u884c\u60c5API Token'\n\nacc = FugleAccount()\n</code></pre></p>"}, {"location": "reference/online/#finlab.online.base_account.Account.cancel_order", "title": "cancel_order  <code>abstractmethod</code>", "text": "<pre><code>cancel_order(order_id)\n</code></pre> <p>\u522a\u9664\u59d4\u8a17\u55ae</p> <p>\u5efa\u8b70\u4f7f\u7528 \u522a\u9664\u59d4\u8a17\u55ae\u6b64\u529f\u80fd\u524d\uff0c\u5148\u4f7f\u7528 update_order() \u4f86\u66f4\u65b0\u59d4\u8a17\u55ae\u7684\u72c0\u6cc1\uff01\u5982\u4e0b <pre><code>acc.update_order()\nacc.cancel_order('ORDER_ID')\n</code></pre></p> ATTRIBUTE DESCRIPTION <code>order_id</code> <p>\u5238\u5546\u6240\u63d0\u4f9b\u7684\u59d4\u8a17\u55ae ID</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>None</code> <p>\u4ee3\u8868\u6210\u529f\u66f4\u65b0\u59d4\u8a17\u55ae</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.create_order", "title": "create_order  <code>abstractmethod</code>", "text": "<pre><code>create_order(action, stock_id, quantity, price=None, odd_lot=False, market_order=False, best_price_limit=None, order_cond=OrderCondition.CASH)\n</code></pre> <p>\u7522\u751f\u65b0\u7684\u59d4\u8a17\u55ae</p> PARAMETER DESCRIPTION <code>action</code> <p>\u8cb7\u8ce3\u65b9\u5411\uff0c\u901a\u5e38\u70ba 'BUY' \u6216\u662f 'SELL'</p> <p> TYPE: <code>Action</code> </p> <code>stock_id</code> <p>\u80a1\u7968\u4ee3\u865f ex: '2330'</p> <p> TYPE: <code>str</code> </p> <code>quantity</code> <p>\u59d4\u8a17\u80a1\u7968\u7684\u7e3d\u6578\u91cf\uff08\u5f35\u6578\uff09\uff0c\u5141\u8a31\u5c0f\u6578\u9ede</p> <p> TYPE: <code>Number</code> </p> <code>price</code> <p>\u80a1\u7968\u8cb7\u8ce3\u7684\u50f9\u683c(\u9650\u50f9\u55ae)</p> <p> TYPE: <code>Number</code> DEFAULT: <code>None</code> </p> <code>force</code> <p>\u662f\u5426\u7528\u6700\u5dee\u4e4b\u50f9\u683c\uff08\u9577\u8dcc\u505c\uff09\u5f37\u5236\u6210\u4ea4? \u7576\u6210\u4ea4\u91cf\u8db3\u5920\u6642\uff0c\u53ef\u4ee5\u6bd4\u8f03\u5feb\u6210\u4ea4\uff0c\u7136\u800c\u7576\u6210\u4ea4\u91cf\u4f4e\u6642\uff0c\u5bb9\u6613\u6709\u5927\u7684\u6ed1\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>wait_for_best_price</code> <p>\u662f\u5426\u7528\u6700\u4f73\u4e4b\u50f9\u683c\uff08\u9577\u8dcc\u505c\uff09\uff0c\u7121\u9650\u6642\u9593\u7b49\u5f85\uff1f\u7576\u4eca\u5929\u8981\u51fa\u5834\u6642\uff0c\u53ef\u4ee5\u958b\u555f\u7b49\u6f32\u505c\u50f9\u4f86\u8cfc\u8cb7\uff0c\u7576\u4eca\u5929\u8981\u8cb7\u5165\u6642\uff0c\u53ef\u4ee5\u639b\u8dcc\u505c\u50f9\u7b49\u5f85\u8cb7\u5165\u6642\u6a5f\u3002</p> <p> TYPE: <code>bool</code> </p> RETURNS DESCRIPTION <code>str</code> <p>order id \u5238\u5546\u63d0\u4f9b\u7684\u59d4\u8a17\u55ae\u7de8\u865f</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_cash", "title": "get_cash  <code>abstractmethod</code>", "text": "<pre><code>get_cash()\n</code></pre> <p>\u62ff\u5230\u7576\u524d\u5e33\u6236\u7684\u73fe\u91d1</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_market", "title": "get_market", "text": "<pre><code>get_market()\n</code></pre> <p>\u62ff\u5230\u7576\u524d\u5e33\u6236\u7684\u5e02\u5834</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_orders", "title": "get_orders  <code>abstractmethod</code>", "text": "<pre><code>get_orders()\n</code></pre> <p>\u62ff\u5230\u73fe\u5728\u6240\u6709\u59d4\u8a17\u55ae</p> RETURNS DESCRIPTION <code>Dict[str, Order]</code> <p>\u6240\u6709\u59d4\u8a17\u55ae id \u8207\u59d4\u8a17\u55ae\u8cc7\u6599</p> <p>Example</p> <p><code>{'12345A': Order(order_id='12345A', stock_id='5410',...),...}</code></p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_position", "title": "get_position  <code>abstractmethod</code>", "text": "<pre><code>get_position()\n</code></pre> <p>\u62ff\u5230\u7576\u524d\u5e33\u6236\u7684\u80a1\u7968\u90e8\u4f4d</p> RETURNS DESCRIPTION <code>Position</code> <p>\u7576\u524d\u80a1\u7968\u90e8\u4f4d</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_settlement", "title": "get_settlement  <code>abstractmethod</code>", "text": "<pre><code>get_settlement()\n</code></pre> <p>\u62ff\u5230\u7576\u524d\u5e33\u6236\u7684\u7d50\u7b97\u8cc7\u6599</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_stocks", "title": "get_stocks  <code>abstractmethod</code>", "text": "<pre><code>get_stocks(stock_ids)\n</code></pre> <p>\u62ff\u5230\u73fe\u5728\u80a1\u7968\u5831\u50f9</p> ATTRIBUTE DESCRIPTION <code>stock_ids</code> <p>\u4e00\u6b21\u62ff\u53d6\u6240\u6709\u80a1\u7968\u7684\u5831\u50f9\uff0cex: ['1101', '2330']</p> <p> TYPE: <code>`list` of `str`</code> </p> RETURNS DESCRIPTION <code>dict</code> <p>\u5831\u50f9\u8cc7\u6599\uff0c</p> <p>Example</p> <p><code>{'1101': Stock(stock_id='1101', open=31.15, high=31.85, low=31.1, close=31.65, bid_price=31.6, bid_volume=728.0, ask_price=31.65, ask_volume=202)}</code></p>"}, {"location": "reference/online/#finlab.online.base_account.Account.get_total_balance", "title": "get_total_balance  <code>abstractmethod</code>", "text": "<pre><code>get_total_balance()\n</code></pre> <p>\u62ff\u5230\u7576\u524d\u5e33\u6236\u7684\u80a1\u7968\u90e8\u4f4d\u6de8\u503c</p>"}, {"location": "reference/online/#finlab.online.base_account.Account.update_order", "title": "update_order  <code>abstractmethod</code>", "text": "<pre><code>update_order(order_id, price=None, quantity=None)\n</code></pre> <p>\u7522\u751f\u65b0\u7684\u59d4\u8a17\u55ae</p> ATTRIBUTE DESCRIPTION <code>order_id</code> <p>\u5238\u5546\u6240\u63d0\u4f9b\u7684\u59d4\u8a17\u55ae ID</p> <p> TYPE: <code>str</code> </p> <code>price</code> <p>\u66f4\u65b0\u7684\u9650\u50f9</p> <p> TYPE: <code>Number</code> </p> <code>quantity</code> <p>\u66f4\u65b0\u7684\u5f85\u6210\u4ea4\u91cf</p> <p> TYPE: <code>Number</code> </p> RETURNS DESCRIPTION <code>None</code> <p>\u7121\u8df3\u51fa erorr \u4ee3\u8868\u6210\u529f\u66f4\u65b0\u59d4\u8a17\u55ae</p>"}, {"location": "reference/online/#position", "title": "Position", "text": ""}, {"location": "reference/online/#finlab.online.order_executor.Position", "title": "finlab.online.order_executor.Position", "text": "<pre><code>Position(stocks, weights=None, margin_trading=False, short_selling=False, day_trading_long=False, day_trading_short=False)\n</code></pre> <p>\u4f7f\u7528\u8005\u53ef\u4ee5\u5229\u7528 Position \u8f15\u9b06\u5efa\u69cb\u80a1\u7968\u7684\u90e8\u4f4d\uff0c\u4e26\u4e14\u5229\u7528 OrderExecuter \u5c07\u6b64\u90e8\u4f4d\u540c\u6b65\u65bc\u5be6\u969b\u7684\u80a1\u7968\u5e33\u6236\u3002</p> <p>\u5efa\u69cb\u80a1\u7968\u90e8\u4f4d</p> ATTRIBUTE DESCRIPTION <code>stocks</code> <p><code>number.Number</code>): \u80a1\u7968\u4ee3\u865f\u8207\u5f35\u6578 ex: {'1101': 1} \u662f\u6307\u6301\u6709\u4e00\u5f35 1101 \u53f0\u6ce5\uff0c\u53ef\u4ee5\u63a5\u53d7\u8ca0\u6578\uff0c\u4ee3\u8868\u505a\u7a7a\u3002</p> <p> TYPE: <code>`dict` of `str`</code> </p> <code>margin_trading</code> <p>\u505a\u591a\u90e8\u4f4d\u662f\u5426\u4f7f\u7528\u878d\u8cc7</p> <p> TYPE: <code>bool</code> </p> <code>short_selling</code> <p>\u505a\u7a7a\u90e8\u4f4d\u662f\u5426\u4f7f\u7528\u878d\u5238</p> <p> TYPE: <code>bool</code> </p> <code>day_trading_long</code> <p>\u505a\u591a\u90e8\u4f4d\u70ba\u7576\u6c96\u5148\u505a\u591a</p> <p> TYPE: <code>bool</code> </p> <code>day_trading_short</code> <p>\u505a\u7a7a\u90e8\u4f4d\u70ba\u7576\u6c96\u5148\u505a\u7a7a</p> <p> TYPE: <code>bool</code> </p> <p>Examples:</p> <p>\u8a2d\u8a08\u90e8\u4f4d\uff0c\u6301\u6709\u4e00\u5f35\u548c 100 \u80a1 1101 <pre><code>from finlab.online.order_executor import Position\n\nPosition({'1101': 1.1})\n</code></pre> output <pre><code>[\n    {'stock_id': '1101',\n     'quantity': 1.1,\n     'order_condition': &lt;OrderCondition.CASH: 1&gt;\n    }\n]\n</code></pre></p> <p>\u5c07\u5169\u500b\u90e8\u4f4d\u76f8\u52a0 <pre><code>from finlab.online.order_executor import Position\n\np1 = Position({'1101': 1})\np2 = Position({'2330': 1})\np1 + p2\n</code></pre> output <pre><code>[\n    {'stock_id': '1101', 'quantity': 1.0, 'order_condition': &lt;OrderCondition.CASH: 1&gt;},\n    {'stock_id': '2330', 'quantity': 1.0, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}\n]\n</code></pre></p>"}, {"location": "reference/online/#finlab.online.order_executor.Position.from_json", "title": "from_json  <code>classmethod</code>", "text": "<pre><code>from_json(path)\n</code></pre> <p>Load a JSON file from the given path and convert it to a list of positions.</p> PARAMETER DESCRIPTION <code>path</code> <p>The path to the JSON file.</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/online/#finlab.online.order_executor.Position.from_list", "title": "from_list  <code>classmethod</code>", "text": "<pre><code>from_list(position)\n</code></pre> <p>\u5229\u7528 <code>dict</code> \u5efa\u69cb\u80a1\u7968\u90e8\u4f4d</p> ATTRIBUTE DESCRIPTION <code>position</code> <p>\u80a1\u7968\u8a73\u7d30\u90e8\u4f4d <pre><code>from finlab.online.enums import OrderCondition\nfrom finlab.online.order_executor import Position\n\nPosition.from_list(\n[{\n  'stock_id': '1101', # \u80a1\u7968\u4ee3\u865f\n  'quantity': 1.1, # \u5f35\u6578\n  'order_condition': OrderCondition.CASH # \u73fe\u80a1\u878d\u8cc7\u878d\u5238\u3001\u5148\u8cb7\u5f8c\u8ce3\n}])\n</code></pre></p> <p>\u5176\u4e2d OrderCondition \u9664\u4e86 <code>CASH</code> \u5916\uff0c\u9084\u6709 <code>MARGIN_TRADING</code>\u3001<code>DAY_TRADING_LONG</code>\u3001<code>SHORT_SELLING</code>\u3001<code>DAY_TRADING_SHORT</code>\u3002</p> <p> TYPE: <code>`list` of `dict`</code> </p>"}, {"location": "reference/online/#finlab.online.order_executor.Position.from_report", "title": "from_report  <code>classmethod</code>", "text": "<pre><code>from_report(report, fund, **kwargs)\n</code></pre> <p>\u5229\u7528\u56de\u6e2c\u5b8c\u7684\u5831\u544a <code>finlab.report.Report</code> \u5efa\u69cb\u80a1\u7968\u90e8\u4f4d\u3002</p> ATTRIBUTE DESCRIPTION <code>report</code> <p>\u56de\u6e2c\u5b8c\u7684\u7d50\u679c\u5831\u544a\u3002</p> <p> TYPE: <code>Report</code> </p> <code>fund</code> <p>\u5e0c\u671b\u90e8\u5c6c\u7684\u8cc7\u91d1\u3002</p> <p> TYPE: <code>int</code> </p> <code>price</code> <p>\u80a1\u7968\u4ee3\u865f\u5c0d\u61c9\u5230\u7684\u50f9\u683c\uff0c\u82e5\u7121\u5247\u4f7f\u7528\u6700\u8fd1\u500b\u4ea4\u6613\u65e5\u7684\u6536\u76e4\u50f9\u3002</p> <p> TYPE: <code>pd.Series or `dict` of `float`</code> </p> <code>odd_lot</code> <p>\u662f\u5426\u8003\u616e\u96f6\u80a1\u3002\u9810\u8a2d\u70ba False\uff0c\u53ea\u4f7f\u7528\u6574\u5f35\u64cd\u4f5c\u3002</p> <p> TYPE: <code>bool</code> </p> <code>board_lot_size</code> <p>\u4e00\u5f35\u80a1\u7968\u7b49\u65bc\u5e7e\u80a1\u3002\u9810\u8a2d\u70ba1000\uff0c\u4e00\u5f35\u7b49\u65bc1000\u80a1\u3002</p> <p> TYPE: <code>int</code> </p> <code>allocation</code> <p>\u8cc7\u7522\u914d\u7f6e\u6f14\u7b97\u6cd5\u9078\u5b9a\uff0c\u9810\u8a2d\u70ba<code>finlab.online.utils.greedy_allocation</code>\uff08\u6700\u5927\u8cc7\u91d1\u90e8\u5c6c\u8caa\u5a6a\u6cd5\uff09\u3002</p> <p> TYPE: <code>func</code> </p> <code>margin_trading</code> <p>\u505a\u591a\u90e8\u4f4d\u662f\u5426\u4f7f\u7528\u878d\u8cc7</p> <p> TYPE: <code>bool</code> </p> <code>short_selling</code> <p>\u505a\u7a7a\u90e8\u4f4d\u662f\u5426\u4f7f\u7528\u878d\u5238</p> <p> TYPE: <code>bool</code> </p> <code>day_trading_long</code> <p>\u505a\u591a\u90e8\u4f4d\u70ba\u7576\u6c96\u5148\u505a\u591a</p> <p> TYPE: <code>bool</code> </p> <code>day_trading_short</code> <p>\u505a\u7a7a\u90e8\u4f4d\u70ba\u7576\u6c96\u5148\u505a\u7a7a</p> <p> TYPE: <code>bool</code> </p> <code>leverage</code> <p>\u76ee\u6a19\u69d3\u687f\u500d\u6578\uff0c\u9810\u8a2d\u70ba1.0\uff08\u4e0d\u4f7f\u7528\u878d\u8cc7\uff09\u3002\u82e5&gt;1.0\uff0c\u6703\u6839\u64da\u6ce2\u52d5\u5ea6\u5206\u914d\u878d\u8cc7\u3002</p> <p> TYPE: <code>float</code> </p> <p>Example</p> <pre><code>from finlab import backtest\nfrom finlab.online.order_executor import Position\n\nreport1 = backtest.sim(...)\nreport2 = backtest.sim(...)\n\nposition1 = Position.from_report(report1, 1000000) # \u7b56\u7565\u64cd\u4f5c\u91d1\u984d\u4e00\u767e\u842c\nposition2 = Position.from_report(report2, 1000000) # \u7b56\u7565\u64cd\u4f5c\u91d1\u984d\u4e00\u767e\u842c\n\ntotal_position = position1 + position2\n</code></pre>"}, {"location": "reference/online/#finlab.online.order_executor.Position.from_weight", "title": "from_weight  <code>classmethod</code>", "text": "<pre><code>from_weight(weights, fund, price=None, odd_lot=False, board_lot_size=None, allocation=greedy_allocation, precision=None, leverage=1.0, price_history=None, **kwargs)\n</code></pre> <p>\u5229\u7528 <code>weight</code> \u5efa\u69cb\u80a1\u7968\u90e8\u4f4d</p> ATTRIBUTE DESCRIPTION <code>weights</code> <p>\u80a1\u7968\u8a73\u7d30\u90e8\u4f4d\uff0c\u80a1\u7968\u4ee3\u865f\u5c0d\u61c9\u6b0a\u91cd</p> <p> TYPE: <code>dict[str, float] \u6216 pd.Series</code> </p> <code>fund</code> <p>\u8cc7\u91d1\u5927\u5c0f</p> <p> TYPE: <code>int</code> </p> <code>price</code> <p>\u80a1\u7968\u4ee3\u865f\u5c0d\u61c9\u5230\u7684\u50f9\u683c\uff0c\u82e5\u7121\u5247\u4f7f\u7528\u6700\u8fd1\u500b\u4ea4\u6613\u65e5\u7684\u6536\u76e4\u50f9\u3002</p> <p> TYPE: <code>None \u6216 pd.Series \u6216 dict[str, float]</code> </p> <code>odd_lot</code> <p>\u662f\u5426\u8003\u616e\u96f6\u80a1</p> <p> TYPE: <code>bool</code> </p> <code>board_lot_size</code> <p>\u4e00\u5f35\u80a1\u7968\u7b49\u65bc\u5e7e\u80a1</p> <p> TYPE: <code>None \u6216 int</code> </p> <code>allocation</code> <p>\u8cc7\u7522\u914d\u7f6e\u6f14\u7b97\u6cd5\u9078\u5b9a\uff0c\u9810\u8a2d\u70ba<code>finlab.online.utils.greedy_allocation</code>\uff08\u6700\u5927\u8cc7\u91d1\u90e8\u5c6c\u8caa\u5a6a\u6cd5\uff09</p> <p> TYPE: <code>function</code> </p> <code>precision</code> <p>\u8a08\u7b97\u5f35\u6578\u6642\u7684\u7cbe\u5ea6\uff0c\u9810\u8a2d\u70ba None \u4ee3\u8868\u4f9d\u7167 board_lot_size \u800c\u5b9a\uff0c\u800c 1 \u4ee3\u8868 0.1 \u5f35\uff0c2 \u4ee3\u8868 0.01 \u5f35\uff0c\u4ee5\u6b64\u985e\u63a8\u3002</p> <p> TYPE: <code>None \u6216 int</code> </p> <code>leverage</code> <p>\u76ee\u6a19\u69d3\u687f\u500d\u6578\uff0c\u9810\u8a2d\u70ba1.0\uff08\u4e0d\u4f7f\u7528\u878d\u8cc7\uff09\u3002\u82e5&gt;1.0\uff0c\u6703\u6839\u64da\u6ce2\u52d5\u5ea6\u5206\u914d\u878d\u8cc7\u3002</p> <p> TYPE: <code>float</code> </p> <code>price_history</code> <p>\u80a1\u7968\u6b77\u53f2\u50f9\u683c\uff0c\u82e5 leverage &gt; 1.0 \u6642\u5fc5\u9808\u63d0\u4f9b\u3002</p> <p> TYPE: <code>None \u6216 pd.DataFrame</code> </p> <code>margin_trading</code> <p>\u505a\u591a\u90e8\u4f4d\u662f\u5426\u4f7f\u7528\u878d\u8cc7</p> <p> TYPE: <code>bool</code> </p> <code>short_selling</code> <p>\u505a\u7a7a\u90e8\u4f4d\u662f\u5426\u4f7f\u7528\u878d\u5238</p> <p> TYPE: <code>bool</code> </p> <code>day_trading_long</code> <p>\u505a\u591a\u90e8\u4f4d\u70ba\u7576\u6c96\u5148\u505a\u591a</p> <p> TYPE: <code>bool</code> </p> <p>Examples:</p> <p>\u4f8b\u5982\uff0c\u7528 100 \u842c\u7684\u8cc7\u91d1\uff0c\u5168\u90e8\u6295\u5165\uff0c\u6301\u6709 1101 \u548c 2330 \u5404\u4e00\u534a\uff1a <pre><code>from finlab.online.order_executor import Position\n\nPosition.from_weight({\n'1101': 0.5,\n'2330': 0.5,\n}, fund=1000000)\n</code></pre> output ``` [</p> <pre><code>{'stock_id': '1101', 'quantity': 13, 'order_condition': &lt;OrderCondition.CASH: 1&gt;},\n{'stock_id': '2330', 'quantity': 1, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}\n  ]\n  ```\n</code></pre>"}, {"location": "reference/online/#finlab.online.order_executor.Position.to_json", "title": "to_json", "text": "<pre><code>to_json(path)\n</code></pre> <p>Converts the position dictionary to a JSON file and saves it to the specified path.</p> PARAMETER DESCRIPTION <code>path</code> <p>The path where the JSON file will be saved.</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/online/#orderexecutor", "title": "OrderExecutor", "text": "<p>\u4e0b\u55ae\u6700\u4f73\u5be6\u8e10</p> <p>\u76e4\u4e2d\u4e0b\u55ae\uff08\u4f7f\u7528\u9650\u50f9\u55ae\uff09: <pre><code># \u907f\u514d\u6ed1\u50f9\uff0c\u4f7f\u7528\u9650\u50f9\u55ae\nexecutor.create_orders(\n    position,\n    order_type='limit',          # \u9650\u50f9\u55ae\n    price_offset=-0.01           # \u6bd4\u7576\u524d\u50f9\u683c\u4f4e 1% \u639b\u55ae\n)\n</code></pre></p> <p>\u6536\u76e4\u4e0b\u55ae\uff08\u8207\u56de\u6e2c\u4e00\u81f4\uff09: <pre><code># \u4f7f\u7528\u6536\u76e4\u50f9\uff0c\u8207\u56de\u6e2c\u7d50\u679c\u66f4\u4e00\u81f4\nexecutor.create_orders(\n    position,\n    order_type='market_close'    # \u6536\u76e4\u5e02\u50f9\u55ae\n)\n</code></pre></p> <p>\u5206\u6279\u4e0b\u55ae\uff08\u5927\u984d\u8a02\u55ae\uff09: <pre><code># \u5c07\u5927\u984d\u8a02\u55ae\u5206 3 \u6b21\u57f7\u884c\nfor i in range(3):\n    executor.create_orders(\n        position,\n        quantity_ratio=1/3       # \u6bcf\u6b21 1/3 \u6578\u91cf\n    )\n    time.sleep(60)               # \u9593\u9694 1 \u5206\u9418\n</code></pre></p> <p>\u5e38\u898b\u932f\u8aa4\u8207\u98a8\u96aa</p> <p>1. \u672a\u6aa2\u67e5\u8655\u7f6e\u80a1 <pre><code># \u932f\u8aa4\uff1a\u76f4\u63a5\u4e0b\u55ae\u53ef\u80fd\u8cb7\u5230\u8655\u7f6e\u80a1\nexecutor.create_orders(position)  # \u274c\n\n# \u6b63\u78ba\uff1a\u904e\u6ffe\u8655\u7f6e\u80a1\ndisposal_stocks = data.get('etl:\u8655\u7f6e\u80a1')\n# \u5c07\u8655\u7f6e\u80a1\u5f9e position \u4e2d\u79fb\u9664\n# position = position[~position.index.isin(disposal_stocks)]\nexecutor.create_orders(position)  # \u2705\n</code></pre></p> <p>2. \u8d85\u904e\u53ef\u7528\u8cc7\u91d1 <pre><code># \u6aa2\u67e5\u53ef\u7528\u8cc7\u91d1\navailable_cash = account.get_balance()\nrequired_cash = position.total_value\n\nif required_cash &gt; available_cash:\n    print(f\"\u274c \u8cc7\u91d1\u4e0d\u8db3\uff01\u9700\u8981 {required_cash:,.0f}\uff0c\u53ef\u7528 {available_cash:,.0f}\")\n    # \u8abf\u6574 position \u6216\u8ffd\u52a0\u8cc7\u91d1\nelse:\n    executor.create_orders(position)\n</code></pre></p> <p>3. \u6f32\u8dcc\u505c\u9396\u6b7b\u7121\u6cd5\u6210\u4ea4 <pre><code># \u6aa2\u67e5\u662f\u5426\u63a5\u8fd1\u6f32\u8dcc\u505c\nclose = data.get('price:\u6536\u76e4\u50f9')\nlimit_up = data.get('price:\u6f32\u505c\u50f9')\nlimit_down = data.get('price:\u8dcc\u505c\u50f9')\n\n# \u904e\u6ffe\u63a5\u8fd1\u6f32\u8dcc\u505c\u7684\u80a1\u7968\uff08\u5982\u5dee\u8ddd &lt; 2%\uff09\nnear_limit = (\n    (close &gt; limit_up * 0.98) |  # \u63a5\u8fd1\u6f32\u505c\n    (close &lt; limit_down * 1.02)   # \u63a5\u8fd1\u8dcc\u505c\n)\nposition = position[~near_limit]\n</code></pre></p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor", "title": "finlab.online.order_executor.OrderExecutor", "text": "<pre><code>OrderExecutor(target_position, account)\n</code></pre> <p>\u5c0d\u6bd4\u5be6\u969b\u5e33\u6236\u8207\u6b32\u90e8\u5c6c\u7684\u80a1\u7968\u90e8\u4f4d\uff0c\u9032\u884c\u540c\u6b65 Arguments:     target_position (Position): \u60f3\u8981\u90e8\u5c6c\u7684\u80a1\u7968\u90e8\u4f4d\u3002     account (Account): \u76ee\u524d\u652f\u63f4\u6c38\u8c50\u8207\u5bcc\u679c\u5e33\u6236\uff0c\u8acb\u53c3\u8003 Account \u4f86\u5be6\u505a\u3002</p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor.cancel_orders", "title": "cancel_orders", "text": "<pre><code>cancel_orders()\n</code></pre> <p>\u522a\u9664\u6240\u6709\u672a\u5be6\u73fe\u59d4\u8a17\u55ae</p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor.create_orders", "title": "create_orders", "text": "<pre><code>create_orders(market_order=False, best_price_limit=False, view_only=False, extra_bid_pct=0, progress=1, progress_precision=0, buy_only=False, sell_only=False)\n</code></pre> <p>\u7522\u751f\u59d4\u8a17\u55ae\uff0c\u5c07\u90e8\u4f4d\u540c\u6b65\u6210 self.target_position \u9810\u8a2d\u4ee5\u8a72\u5546\u54c1\u6700\u5f8c\u4e00\u7b46\u6210\u4ea4\u50f9\u8a2d\u5b9a\u70ba\u9650\u50f9\u4f86\u4e0b\u55ae</p> ATTRIBUTE DESCRIPTION <code>market_order</code> <p>\u4ee5\u985e\u5e02\u50f9\u76e1\u91cf\u5373\u523b\u6210\u4ea4\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u6f32\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u8dcc\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>best_price_limit</code> <p>\u639b\u82ad\u6a02\u50f9\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u8dcc\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u6f32\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>view_only</code> <p>\u9810\u8a2d\u70ba False\uff0c\u6703\u5be6\u969b\u4e0b\u55ae\u3002\u82e5\u8a2d\u70ba True\uff0c\u4e0d\u6703\u4e0b\u55ae\uff0c\u53ea\u6703\u56de\u50b3\u6b32\u57f7\u884c\u7684\u59d4\u8a17\u55ae\u8cc7\u6599(dict)</p> <p> TYPE: <code>bool</code> </p> <code>extra_bid_pct</code> <p>\u4ee5\u8a72\u767e\u5206\u6bd4\u503c\u4e58\u4ee5\u50f9\u683c\u9032\u884c\u8ffd\u50f9\u4e0b\u55ae\uff0c\u5982\u8a2d\u5b9a\u70ba 0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 +(-)5% \u7684\u9650\u50f9\u9032\u8cb7\u5165(\u8ce3\u51fa)\uff0c\u4e5f\u5c31\u662f\u66f4\u6709\u6a5f\u6703\u53ef\u4ee5\u6210\u4ea4\uff0c\u4f46\u662f\u6210\u4ea4\u50f9\u683c\u53ef\u80fd\u4e0d\u7406\u60f3\uff1b \u5047\u5982\u8a2d\u5b9a\u70ba -0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 -(+)5% \u9032\u884c\u8cb7\u5165\u8ce3\u51fa\uff0c\u4e5f\u5c31\u662f\u9650\u50f9\u55ae\u5c07\u4e0d\u6703\u7acb\u5373\u6210\u4ea4\uff0c\u7136\u800c\u5047\u5982\u6210\u4ea4\u5f8c\uff0c\u50f9\u683c\u6bd4\u8f03\u7406\u60f3\u3002\u53c3\u6578\u6709\u6548\u7bc4\u570d\u70ba -0.1 \u5230 0.1 \u5167\u3002</p> <p> TYPE: <code>float</code> </p> <code>progress</code> <p>\u9032\u5ea6\uff0c\u9810\u8a2d\u70ba 1\uff0c\u5373\u5168\u90e8\u4e0b\u55ae\u3002\u82e5\u8a2d\u5b9a\u70ba 0.5\uff0c\u5247\u53ea\u4e0b\u4e00\u534a\u7684\u55ae\u3002</p> <p> TYPE: <code>float</code> </p> <code>progress_precision</code> <p>\u9032\u5ea6\u7684\u7cbe\u5ea6\uff0c\u9810\u8a2d\u70ba 0\uff0c\u5373\u53ea\u4e0b\u6574\u6578\u5f35\u3002\u82e5\u8a2d\u5b9a\u70ba 1\uff0c\u5247\u4e0b\u5230 0.1 \u5f35\u3002</p> <p> TYPE: <code>int</code> </p> <code>buy_only</code> <p>\u82e5\u8a2d\u70ba True\uff0c\u53ea\u4e0b\u8cb7\u55ae</p> <p> TYPE: <code>bool</code> </p> <code>sell_only</code> <p>\u82e5\u8a2d\u70ba True\uff0c\u53ea\u4e0b\u8ce3\u55ae</p> <p> TYPE: <code>bool</code> </p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor.execute_orders", "title": "execute_orders", "text": "<pre><code>execute_orders(orders, market_order=False, best_price_limit=False, view_only=False, extra_bid_pct=0, cancel_orders=True, buy_only=False, sell_only=False)\n</code></pre> <p>\u7522\u751f\u59d4\u8a17\u55ae\uff0c\u5c07\u90e8\u4f4d\u540c\u6b65\u6210 self.target_position \u9810\u8a2d\u4ee5\u8a72\u5546\u54c1\u6700\u5f8c\u4e00\u7b46\u6210\u4ea4\u50f9\u8a2d\u5b9a\u70ba\u9650\u50f9\u4f86\u4e0b\u55ae</p> ATTRIBUTE DESCRIPTION <code>orders</code> <p>\u6b32\u4e0b\u55ae\u7684\u90e8\u4f4d\uff0c\u901a\u5e38\u662f\u7531 <code>self.generate_orders</code> \u7522\u751f\u3002</p> <p> TYPE: <code>list</code> </p> <code>market_order</code> <p>\u4ee5\u985e\u5e02\u50f9\u76e1\u91cf\u5373\u523b\u6210\u4ea4\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u6f32\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u8dcc\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>best_price_limit</code> <p>\u639b\u82ad\u6a02\u50f9\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u8dcc\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u6f32\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>view_only</code> <p>\u9810\u8a2d\u70ba False\uff0c\u6703\u5be6\u969b\u4e0b\u55ae\u3002\u82e5\u8a2d\u70ba True\uff0c\u4e0d\u6703\u4e0b\u55ae\uff0c\u53ea\u6703\u56de\u50b3\u6b32\u57f7\u884c\u7684\u59d4\u8a17\u55ae\u8cc7\u6599(dict)</p> <p> TYPE: <code>bool</code> </p> <code>extra_bid_pct</code> <p>\u4ee5\u8a72\u767e\u5206\u6bd4\u503c\u4e58\u4ee5\u50f9\u683c\u9032\u884c\u8ffd\u50f9\u4e0b\u55ae\uff0c\u5982\u8a2d\u5b9a\u70ba 0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 +(-)5% \u7684\u9650\u50f9\u9032\u8cb7\u5165(\u8ce3\u51fa)\uff0c\u4e5f\u5c31\u662f\u66f4\u6709\u6a5f\u6703\u53ef\u4ee5\u6210\u4ea4\uff0c\u4f46\u662f\u6210\u4ea4\u50f9\u683c\u53ef\u80fd\u4e0d\u7406\u60f3\uff1b \u5047\u5982\u8a2d\u5b9a\u70ba -0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 -(+)5% \u9032\u884c\u8cb7\u5165\u8ce3\u51fa\uff0c\u4e5f\u5c31\u662f\u9650\u50f9\u55ae\u5c07\u4e0d\u6703\u7acb\u5373\u6210\u4ea4\uff0c\u7136\u800c\u5047\u5982\u6210\u4ea4\u5f8c\uff0c\u50f9\u683c\u6bd4\u8f03\u7406\u60f3\u3002\u53c3\u6578\u6709\u6548\u7bc4\u570d\u70ba -0.1 \u5230 0.1 \u5167\u3002</p> <p> TYPE: <code>float</code> </p> <code>buy_only</code> <p>\u82e5\u8a2d\u70ba True\uff0c\u53ea\u4e0b\u8cb7\u55ae</p> <p> TYPE: <code>bool</code> </p> <code>sell_only</code> <p>\u82e5\u8a2d\u70ba True\uff0c\u53ea\u4e0b\u8ce3\u55ae</p> <p> TYPE: <code>bool</code> </p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor.generate_orders", "title": "generate_orders", "text": "<pre><code>generate_orders(progress=1, progress_precision=0)\n</code></pre> <p>Generate orders based on the difference between target position and present position.</p> <p>Returns: orders (dict): Orders to be executed.</p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor.show_alerting_stocks", "title": "show_alerting_stocks", "text": "<pre><code>show_alerting_stocks()\n</code></pre> <p>\u7522\u751f\u4e0b\u55ae\u90e8\u4f4d\u662f\u5426\u6709\u8b66\u793a\u80a1\uff0c\u4ee5\u53ca\u76f8\u95dc\u8cc7\u8a0a</p>"}, {"location": "reference/online/#finlab.online.order_executor.OrderExecutor.update_order_price", "title": "update_order_price", "text": "<pre><code>update_order_price(extra_bid_pct=0)\n</code></pre> <p>\u66f4\u65b0\u59d4\u8a17\u55ae\uff0c\u5c07\u59d4\u8a17\u55ae\u7684\u9650\u50f9\u8abf\u6574\u6210\u7576\u5929\u6700\u5f8c\u4e00\u7b46\u50f9\u683c\u3002 \uff08\u8b93\u6c92\u6210\u4ea4\u7684\u9650\u50f9\u55ae\u53bb\u8ffd\u50f9\uff09 Attributes:     extra_bid_pct (float): \u4ee5\u8a72\u767e\u5206\u6bd4\u503c\u4e58\u4ee5\u50f9\u683c\u9032\u884c\u8ffd\u50f9\u4e0b\u55ae\uff0c\u5982\u8a2d\u5b9a\u70ba 0.1 \u6642\uff0c\u5c07\u4ee5\u8d85\u51fa(\u4f4e\u65bc)\u73fe\u50f9\u4e4b10%\u50f9\u683c\u4e0b\u55ae\uff0c\u4ee5\u6f32\u505c(\u8dcc\u505c)\u50f9\u70ba\u9650\u3002\u53c3\u6578\u6709\u6548\u7bc4\u570d\u70ba 0 \u5230 0.1 \u5167</p>"}, {"location": "reference/online/#order", "title": "Order", "text": ""}, {"location": "reference/online/#finlab.online.base_account.Order", "title": "finlab.online.base_account.Order  <code>dataclass</code>", "text": "<pre><code>Order(order_id, stock_id, action, price, quantity, filled_quantity, status, order_condition, time, org_order=None)\n</code></pre> <p>Order status</p> <p>\u59d4\u8a17\u55ae\u7684\u72c0\u614b</p> ATTRIBUTE DESCRIPTION <code>order_id</code> <p>\u59d4\u8a17\u55ae\u7684 id\uff0c\u8207\u5238\u5546 API \u6240\u63d0\u4f9b\u7684 id \u4e00\u81f4</p> <p> TYPE: <code>str</code> </p> <code>stock_id</code> <p>\u80a1\u7968\u4ee3\u865f ex: '2330' (\u4ea6\u53ef\u900f\u904e symbol \u5c6c\u6027\u5b58\u53d6)</p> <p> TYPE: <code>str</code> </p> <code>action</code> <p>\u8cb7\u8ce3\u65b9\u5411\uff0c\u901a\u5e38\u70ba 'BUY' \u6216\u662f 'SELL'</p> <p> TYPE: <code>Action</code> </p> <code>price</code> <p>\u80a1\u7968\u8cb7\u8ce3\u7684\u50f9\u683c(\u9650\u50f9\u55ae)</p> <p> TYPE: <code>Number</code> </p> <code>quantity</code> <p>\u59d4\u8a17\u80a1\u7968\u7684\u7e3d\u6578\u91cf\uff08\u5f35\u6578\uff09\uff0c\u5141\u8a31\u5c0f\u6578\u9ede</p> <p> TYPE: <code>Number</code> </p> <code>filled_quantity</code> <p>\u4ee5\u6210\u4ea4\u80a1\u7968\u7684\u6578\u91cf\uff08\u5f35\u6578\uff09\uff0c\u5141\u8a31\u5c0f\u6578\u9ede</p> <p> TYPE: <code>Number</code> </p> <code>status</code> <p>\u59d4\u8a17\u72c0\u614b\uff0c\u53ef\u4ee5\u8a2d\u5b9a\u70ba\uff1a'NEW', 'PARTIALLY_FILLED', 'FILLED', 'CANCEL'</p> <p> TYPE: <code>OrderStatus</code> </p> <code>time</code> <p>\u59d4\u8a17\u6642\u9593</p> <p> TYPE: <code>datetime</code> </p> <code>org_order</code> <p>\u5238\u5546\u6240\u63d0\u4f9b\u7684\u59d4\u8a17\u7269\u4ef6\u683c\u5f0f</p> <p> TYPE: <code>Any = None</code> </p>"}, {"location": "reference/online/#order_panel", "title": "order_panel()", "text": ""}, {"location": "reference/online/#finlab.online.panel.order_panel", "title": "finlab.online.panel.order_panel", "text": "<pre><code>order_panel(account)\n</code></pre> <p>\u4e0b\u55ae GUI \u4ecb\u9762 Arguments:     account (Account): \u8acb\u53c3\u8003 Account \u91dd\u5c0d\u4e0d\u540c\u5238\u5546\u4f86\u5efa\u69cb\u76f8\u5c0d\u61c9\u7684\u64cd\u4f5c\u5e33\u6236</p>"}, {"location": "reference/online/#_6", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/online/#q", "title": "Q: \u5982\u4f55\u78ba\u4fdd\u4e0b\u55ae\u5b89\u5168\uff1f", "text": "<p>\u5be6\u65bd\u4ee5\u4e0b\u6aa2\u67e5\u6a5f\u5236\uff1a</p> <pre><code>def safe_order_check(position, account, max_stocks=50, max_weight=0.15):\n    \"\"\"\u4e0b\u55ae\u524d\u5b89\u5168\u6aa2\u67e5\"\"\"\n\n    # 1. \u6aa2\u67e5\u6301\u5009\u6578\u91cf\n    if len(position) &gt; max_stocks:\n        raise ValueError(f\"\u274c \u6301\u5009\u904e\u591a\uff08{len(position)} \u6a94\uff09\uff0c\u8d85\u904e\u9650\u5236 {max_stocks} \u6a94\")\n\n    # 2. \u6aa2\u67e5\u55ae\u4e00\u6301\u80a1\u6b0a\u91cd\n    max_stock_weight = position.max()\n    if max_stock_weight &gt; max_weight:\n        raise ValueError(f\"\u274c \u55ae\u80a1\u6b0a\u91cd\u904e\u9ad8\uff08{max_stock_weight:.1%}\uff09\uff0c\u8d85\u904e\u9650\u5236 {max_weight:.0%}\")\n\n    # 3. \u6aa2\u67e5\u53ef\u7528\u8cc7\u91d1\n    available = account.get_balance()\n    required = position.total_value\n    if required &gt; available * 1.1:  # \u7559 10% \u7de9\u885d\n        raise ValueError(f\"\u274c \u8cc7\u91d1\u4e0d\u8db3\uff01\u9700\u8981 {required:,.0f}\uff0c\u53ef\u7528 {available:,.0f}\")\n\n    print(\"\u2705 \u5b89\u5168\u6aa2\u67e5\u901a\u904e\")\n    return True\n\n# \u4f7f\u7528\nif safe_order_check(position, account):\n    executor.create_orders(position)\n</code></pre>"}, {"location": "reference/online/#q_1", "title": "Q: \u5be6\u76e4\u8207\u56de\u6e2c\u6709\u843d\u5dee\u600e\u9ebc\u8fa6\uff1f", "text": "<p>\u5e38\u898b\u539f\u56e0\uff1a</p> <ol> <li>\u6ed1\u50f9\uff1a\u5be6\u76e4\u6210\u4ea4\u50f9\u8207\u9810\u671f\u4e0d\u7b26</li> <li> <p>\u89e3\u6c7a\uff1a\u4f7f\u7528\u9650\u50f9\u55ae\uff0c\u6216\u8abf\u6574 <code>price_offset</code></p> </li> <li> <p>\u6210\u4ea4\u91cf\u4e0d\u8db3\uff1a\u7121\u6cd5\u5168\u90e8\u6210\u4ea4</p> </li> <li> <p>\u89e3\u6c7a\uff1a\u4f7f\u7528 LiquidityAnalysis \u4e8b\u5148\u6aa2\u6e2c</p> </li> <li> <p>\u4ea4\u6613\u6642\u9593\u5dee\u7570\uff1a\u56de\u6e2c\u5047\u8a2d\u5373\u6642\u6210\u4ea4</p> </li> <li>\u89e3\u6c7a\uff1a\u8a2d\u5b9a\u5408\u7406\u7684\u4e0b\u55ae\u6642\u9593\uff08\u5982\u6536\u76e4\u524d 30 \u5206\u9418\uff09</li> </ol>"}, {"location": "reference/online/#q_2", "title": "Q: \u5982\u4f55\u8a2d\u5b9a\u81ea\u52d5\u4e0b\u55ae\u6392\u7a0b\uff1f", "text": "<pre><code>import schedule\nimport time\n\ndef auto_trade():\n    \"\"\"\u6bcf\u65e5\u81ea\u52d5\u4e0b\u55ae\"\"\"\n    try:\n        # 1. \u53d6\u5f97\u6700\u65b0\u7b56\u7565\n        position = Position.from_report(\n            report_id='YOUR_REPORT_ID',\n            total_funds=1000000\n        )\n\n        # 2. \u5b89\u5168\u6aa2\u67e5\n        if safe_order_check(position, account):\n            # 3. \u57f7\u884c\u4e0b\u55ae\n            executor.create_orders(position)\n            print(f\"\u2705 \u4e0b\u55ae\u5b8c\u6210\uff1a{time.strftime('%Y-%m-%d %H:%M:%S')}\")\n    except Exception as e:\n        # 4. \u932f\u8aa4\u901a\u77e5\uff08LINE/Email\uff09\n        print(f\"\u274c \u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n        # line_notify(f\"\u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n\n# \u6bcf\u65e5 14:30 \u57f7\u884c\uff08\u6536\u76e4\u524d 30 \u5206\u9418\uff09\nschedule.every().day.at(\"14:30\").do(auto_trade)\n\nwhile True:\n    schedule.run_pending()\n    time.sleep(60)\n</code></pre>"}, {"location": "reference/online/#q_3", "title": "Q: \u5982\u4f55\u8655\u7406\u4e0b\u55ae\u5931\u6557\uff1f", "text": "<pre><code>try:\n    executor.create_orders(position)\n    print(\"\u2705 \u4e0b\u55ae\u6210\u529f\")\nexcept Exception as e:\n    print(f\"\u274c \u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n\n    # \u8a18\u9304\u932f\u8aa4\n    with open('order_errors.log', 'a') as f:\n        f.write(f\"{time.strftime('%Y-%m-%d %H:%M:%S')} - {e}\\n\")\n\n    # \u767c\u9001\u901a\u77e5\n    # line_notify(f\"\u4e0b\u55ae\u5931\u6557\uff1a{e}\")\n\n    # \u6839\u64da\u932f\u8aa4\u985e\u578b\u6c7a\u5b9a\u662f\u5426\u91cd\u8a66\n    if \"network\" in str(e).lower():\n        time.sleep(30)  # \u7db2\u8def\u554f\u984c\uff0c30 \u79d2\u5f8c\u91cd\u8a66\n        executor.create_orders(position)\n</code></pre>"}, {"location": "reference/online/#_7", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u5be6\u76e4\u4e0b\u55ae\u6559\u5b78\uff08\u55ae\u7b56\u7565\uff09 - \u8a73\u7d30\u6b65\u9a5f</li> <li>\u5be6\u76e4\u4e0b\u55ae\u6559\u5b78\uff08\u591a\u7b56\u7565\uff09 - \u7d44\u5408\u7ba1\u7406</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357 - \u98a8\u96aa\u63a7\u5236</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5b8c\u6574\u6d41\u7a0b</li> <li>GitHub \u539f\u59cb\u78bc</li> </ul> <p>\u6700\u5f8c\u63d0\u9192</p> <p>\u8acb\u52d9\u5fc5\u5728\u6a21\u64ec\u5e33\u6236\u5145\u5206\u6e2c\u8a66\u5f8c\uff0c\u624d\u4f7f\u7528\u771f\u5be6\u8cc7\u91d1\uff01</p> <p>\u5efa\u8b70\u6e2c\u8a66\u6e05\u55ae\uff1a - \u2705 \u4e0b\u55ae\u6d41\u7a0b\u5b8c\u6574\u57f7\u884c\u7121\u932f\u8aa4 - \u2705 \u6301\u5009\u8a08\u7b97\u6b63\u78ba\uff08\u8207\u9810\u671f\u4e00\u81f4\uff09 - \u2705 \u8cc7\u91d1\u63a7\u5236\u6b63\u5e38\uff08\u4e0d\u8d85\u652f\uff09 - \u2705 \u7570\u5e38\u8655\u7406\u6a5f\u5236\u6709\u6548 - \u2705 \u901a\u77e5\u6a5f\u5236\u6b63\u5e38\u904b\u4f5c - \u2705 \u9023\u7e8c\u904b\u884c 1 \u500b\u6708\u7121\u554f\u984c</p> <p>\u53ea\u6709\u5728\u4ee5\u4e0a\u9805\u76ee\u5168\u90e8\u78ba\u8a8d\u5f8c\uff0c\u624d\u8003\u616e\u4f7f\u7528\u771f\u5be6\u8cc7\u91d1\uff01</p>"}, {"location": "reference/optimize/", "title": "finlab.optimize", "text": "<p>\u7b56\u7565\u53c3\u6578\u512a\u5316\u8207\u7d44\u5408\u6e2c\u8a66\u6a21\u7d44\u3002</p>"}, {"location": "reference/optimize/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u6e2c\u8a66\u591a\u500b\u689d\u4ef6\u7684\u6240\u6709\u7d44\u5408:\u7576\u4f60\u6709\u591a\u500b\u9078\u80a1\u689d\u4ef6(\u5982\u6280\u8853\u9762\u3001\u57fa\u672c\u9762\u3001\u7c4c\u78bc\u9762),\u60f3\u627e\u51fa\u6700\u4f73\u7684\u689d\u4ef6\u4ea4\u96c6</li> <li>\u5feb\u901f\u627e\u51fa\u6700\u4f73\u7b56\u7565\u7d44\u5408:\u81ea\u52d5\u5316\u6e2c\u8a66\u6240\u6709\u53ef\u80fd\u7684\u7d44\u5408,\u5f9e\u6578\u5341\u7a2e\u7b56\u7565\u4e2d\u627e\u51fa\u7e3e\u6548\u6700\u597d\u7684</li> <li>\u8996\u89ba\u5316\u5c0d\u6bd4\u4e0d\u540c\u7b56\u7565\u7684\u7e3e\u6548:\u900f\u904e\u71b1\u529b\u5716\u3001\u68d2\u72c0\u5716\u3001\u6298\u7dda\u5716\u5feb\u901f\u6bd4\u8f03\u5404\u7d44\u5408\u7684\u8868\u73fe</li> </ul>"}, {"location": "reference/optimize/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": "<pre><code>from finlab import data\nfrom finlab.optimize.combinations import sim_conditions\n\nclose = data.get(\"price:\u6536\u76e4\u50f9\")\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\u71df\u696d\u5229\u76ca\u6210\u9577\u7387 = data.get('fundamental_features:\u71df\u696d\u5229\u76ca\u6210\u9577\u7387')\n\n# \u5b9a\u7fa9 3 \u500b\u689d\u4ef6\nc1 = (close &gt; close.average(20)) &amp; (close &gt; close.average(60))\nc2 = \u71df\u696d\u5229\u76ca\u6210\u9577\u7387 &gt; 0\nc3 = rev.average(3) / rev.average(12) &gt; 1.1\n\nexits = close &lt; close.average(20)\nconditions = {'c1': c1, 'c2': c2, 'c3': c3}\n\n# \u6e2c\u8a66\u6240\u6709\u7d44\u5408(\u5171 7 \u7a2e: c1, c2, c3, c1&amp;c2, c1&amp;c3, c2&amp;c3, c1&amp;c2&amp;c3)\nreport_collection = sim_conditions(\n    conditions=conditions,\n    hold_until={'exit': exits, 'stop_loss': 0.1},\n    resample='M',\n    position_limit=0.1,\n    upload=False\n)\n\n# \u8996\u89ba\u5316\u6bd4\u8f03\nreport_collection.plot_stats('heatmap')  # \u71b1\u529b\u5716\nreport_collection.plot_stats('bar').show()  # \u68d2\u72c0\u5716\nreport_collection.plot_creturns().show()  # \u7d2f\u7a4d\u5831\u916c\u7387\u6298\u7dda\u5716\n</code></pre>"}, {"location": "reference/optimize/#_3", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u7b56\u7565\u53c3\u6578\u512a\u5316\u5b8c\u6574\u6307\u5357\uff0c\u4e86\u89e3:</p> <ul> <li>\u70ba\u4ec0\u9ebc\u9700\u8981\u7b56\u7565\u512a\u5316</li> <li>\u5982\u4f55\u89e3\u8b80 12 \u7a2e\u7e3e\u6548\u6307\u6a19</li> <li>\u5982\u4f55\u907f\u514d\u904e\u5ea6\u914d\u9069(overfitting)</li> <li>\u7d50\u5408\u505c\u640d\u505c\u5229\u7684\u512a\u5316\u6280\u5de7</li> <li>\u5be6\u6230\u5de5\u4f5c\u6d41\u7a0b\u5efa\u8b70</li> </ul>"}, {"location": "reference/optimize/#api-reference", "title": "API Reference", "text": "<p>\u9032\u968e\u7528\u6cd5</p> <ul> <li>\u7be9\u9078\u7279\u5b9a\u6307\u6a19: <code>report_collection.plot_stats('bar', indicators=['daily_sharpe', 'win_ratio'])</code></li> <li>\u81ea\u8a02\u6392\u5e8f: <code>report_collection.plot_stats('heatmap', heatmap_sort_by='daily_sharpe')</code></li> <li>\u5b58\u53d6\u7279\u5b9a\u7d44\u5408: <code>report = report_collection.reports['c1 &amp; c3']</code></li> </ul> <p>\u6548\u80fd\u63d0\u793a</p> <p>\u7576\u689d\u4ef6\u6578\u91cf &gt; 6 \u6642,\u7d44\u5408\u6578\u6703\u8d85\u904e 63 \u7a2e,\u8a08\u7b97\u6642\u9593\u8f03\u9577\u3002\u5efa\u8b70:</p> <ol> <li>\u5148\u7528\u55ae\u4e00\u689d\u4ef6\u56de\u6e2c,\u79fb\u9664\u7e3e\u6548\u904e\u5dee\u7684\u689d\u4ef6</li> <li>\u5206\u6279\u6e2c\u8a66(\u6280\u8853\u9762\u3001\u57fa\u672c\u9762\u5206\u958b)</li> <li>\u4f7f\u7528\u66f4\u9577\u7684 resample \u9031\u671f(\u5982 'Q')</li> </ol>"}, {"location": "reference/optimize/#finlab.optimize.combinations.sim_conditions", "title": "finlab.optimize.combinations.sim_conditions", "text": "<pre><code>sim_conditions(conditions, hold_until={}, *args, **kwargs)\n</code></pre> <p>\u53d6\u5f97\u56de\u6e2c\u5831\u544a\u96c6\u5408</p> <p>\u5c07\u9078\u80a1\u689d\u4ef6\u6392\u51fa\u6240\u6709\u7684\u7d44\u5408\u4e26\u9032\u884c\u56de\u6e2c\uff0c\u65b9\u4fbf\u627e\u51fa\u6700\u597d\u689d\u4ef6\u7684\u4ea4\u96c6\u7d50\u679c\u3002</p> PARAMETER DESCRIPTION <code>conditions</code> <p>\u9078\u80a1\u689d\u4ef6\u96c6\u5408\uff0ckey \u70ba\u689d\u4ef6\u540d\u7a31\uff0cvalue \u70ba\u689d\u4ef6\u8b8a\u6578\uff0cex:<code>{'c1':c1, 'c2':c2}</code></p> <p> TYPE: <code>dict</code> </p> <code>hold_until</code> <p>\u8a2d\u5b9a\u8a0a\u865f\u9032\u51fa\u5834\u8a9e\u6cd5\u7cd6\u53c3\u6578\uff0c\u9810\u8a2d\u70ba\u4e0d\u4f7f\u7528\u3002ex:<code>{'exit':exit, 'stop_loss':0.1}</code></p> <p> TYPE: <code>dict</code> DEFAULT: <code>{}</code> </p> <code>*args</code> <p><code>finlab.backtest.sim()</code> \u56de\u6e2c\u53c3\u6578\u8a2d\u5b9a\u3002</p> <p> TYPE: <code>tuple</code> DEFAULT: <code>()</code> </p> <code>**kwargs</code> <p><code>finlab.backtest.sim()</code> \u56de\u6e2c\u53c3\u6578\u8a2d\u5b9a\u3002</p> <p> TYPE: <code>dict</code> DEFAULT: <code>{}</code> </p> RETURNS DESCRIPTION <code>ReportCollection</code> <p>\u56de\u6e2c\u6578\u64da\u5831\u544a</p> <p>Examples:</p> <p><pre><code>from finlab import data\nfrom finlab.backtest import sim\nfrom finlab.optimize.combinations import sim_conditions\n\nclose = data.get(\"price:\u6536\u76e4\u50f9\")\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nrev=data.get('monthly_revenue:\u7576\u6708\u71df\u6536').index_str_to_date()\nrev_ma3=rev.average(3)\nrev_ma12=rev.average(12)\n\nc1 = (close &gt; close.average(20)) &amp; (close &gt; close.average(60))\nc2 = (close == close.rolling(20).max())\nc3 = pe &lt; 15\nc4 = rev_ma3/rev_ma12 &gt; 1.1\nc5 = rev/rev.shift(1) &gt; 0.9\nexits = close &lt; close.average(20)\nconditions = {'c1':c1, 'c2':c2, 'c3':c3, 'c4':c4, 'c5':c5}\nreport_collection = sim_conditions(conditions=conditions, hold_until={'exit':exits, 'stop_loss':0.1}, resample='M', position_limit=0.1, upload=False)\n# \u7b56\u7565\u5206\u7d44\u6307\u6a19\u5831\u544a\n# print(report_collection.stats)\nreport_collection.plot_creturns().show()\nreport_collection.plot_stats('bar').show()\nreport_collection.plot_stats('heatmap')\n</code></pre> \u8996\u89ba\u5316\u7bc4\u4f8b</p> <p>ex1:</p> <p><code>report_collection.plot_creturns().show()</code></p> <p>\u7e6a\u88fd\u6298\u7dda\u5716\u6307\u6a19\u5206\u7fa4\u68d2\u72c0\u5716</p> <p></p> <p>ex2:</p> <p><code>report_collection.plot_stats('bar').show()</code></p> <p>\u7e6a\u88fd\u6307\u6a19\u5206\u7fa4\u68d2\u72c0\u5716</p> <p></p> <p>ex3:</p> <p><code>report_collection.plot_stats('heatmap')</code></p> <p>\u7e6a\u88fd\u6307\u6a19\u5206\u7d1a\u71b1\u529b\u5716\uff0c\u6578\u503c\u8d8a\u5927\u70ba\u6392\u540d\u8d8a\u524d\u9762\uff0cavg_score\u70ba\u6307\u6a19\u5e73\u5747\u5206\u6578\uff0c\u5206\u6578\u8d8a\u9ad8\u70ba\u8a55\u50f9\u8f03\u6b63\u5411\u7684\u7b56\u7565\u3002</p> <p></p>"}, {"location": "reference/optimize/#finlab.optimize.combinations.ReportCollection", "title": "finlab.optimize.combinations.ReportCollection", "text": "<pre><code>ReportCollection(reports)\n</code></pre> <p>\u56de\u6e2c\u7d44\u5408\u6bd4\u8f03\u5831\u544a</p> <p>\u5224\u65b7\u7b56\u7565\u7d44\u5408\u6578\u64da\u512a\u52a3\uff0c\u5f9e\u7b56\u7565\u6d77\u4e2d\u5feb\u901f\u627e\u5230\u9ad4\u8cea\u6700\u5f37\u7684\u7b56\u7565\u3002 \u4e5f\u53ef\u4ee5\u89c0\u5bdf\u5728\u540c\u689d\u4ef6\u4e0b\u7684\u7b56\u7565\u758a\u52a0\u66f4\u591a\u689d\u4ef6\u5f8c\u6703\u6709\u4ec0\u9ebc\u8b8a\u5316\uff1f Args:   reports (dict): \u56de\u6e2c\u7269\u4ef6\u96c6\u5408\uff0cex:<code>{'strategy1': finlab.backtest.sim(),'strategy2': finlab.backtest.sim()}</code></p>"}, {"location": "reference/optimize/#finlab.optimize.combinations.ReportCollection.get_stats", "title": "get_stats", "text": "<pre><code>get_stats()\n</code></pre> <p>\u53d6\u5f97\u7b56\u7565\u6307\u6a19\u6bd4\u8f03\u8868</p> <p>\u6307\u6a19\u6b04\u4f4d\u8aaa\u660e\uff1a</p> <ul> <li><code>'daily_mean'</code>: \u7b56\u7565\u5e74\u5316\u5831\u916c</li> <li><code>'daily_sharpe'</code>: \u7b56\u7565\u5e74\u5316\u590f\u666e\u7387</li> <li><code>'daily_sortino'</code>: \u7b56\u7565\u5e74\u5316\u7d22\u63d0\u8afe\u6bd4\u7387</li> <li><code>'max_drawdown'</code>: \u7b56\u7565\u5831\u916c\u7387\u6700\u5927\u56de\u64a4\u7387(\u8ca0\u5411)</li> <li><code>'avg_drawdown'</code>: \u7b56\u7565\u5e73\u5747\u56de\u64a4(\u8ca0\u5411)</li> <li><code>'ytd'</code>: \u4eca\u5e74\u5ea6\u7b56\u7565\u5831\u916c\u7387</li> <li><code>'win_ratio'</code>: \u6bcf\u7b46\u4ea4\u6613\u52dd\u7387</li> <li><code>'avg_return'</code>: \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u7372\u5229\u7387</li> <li><code>'avg_mae'</code>: \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u6700\u5927\u4e0d\u5229\u65b9\u5411\u5e45\u5ea6(\u8ca0\u5411)</li> <li><code>'avg_bmfe'</code>: \u6700\u5927\u4e0d\u5229\u65b9\u5411\u767c\u751f\u524d\u7684\"\u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u6700\u5927\u6709\u5229\u65b9\u5411\u5e45\u5ea6\"\uff0c\u82e5\u6578\u503c\u8d8a\u9ad8\uff0c\u8d8a\u6709\u6a5f\u6703\u5728\u505c\u640d\u4e4b\u524d\u64cd\u4f5c\u505c\u5229\u3002</li> <li><code>'avg_gmfe'</code>: \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u6700\u5927\u6709\u5229\u65b9\u5411\u5e45\u5ea6</li> <li><code>'avg_mdd'</code>: \u6bcf\u7b46\u4ea4\u6613\u5e73\u5747\u7684\u6700\u5927\u56de\u64a4\u7387(\u8ca0\u5411)</li> </ul> RETURNS DESCRIPTION <code>DataFrame</code> <p>\u7b56\u7565\u6307\u6a19\u6bd4\u8f03\u5831\u8868</p>"}, {"location": "reference/optimize/#finlab.optimize.combinations.ReportCollection.plot_creturns", "title": "plot_creturns", "text": "<pre><code>plot_creturns()\n</code></pre> <p>\u7e6a\u88fd\u7b56\u7565\u7d2f\u7a4d\u5831\u916c\u7387</p> <p>\u6bd4\u8f03\u7b56\u7565\u6de8\u503c\u66f2\u7dda\u8b8a\u5316</p> RETURNS DESCRIPTION <code>Figure</code> <p>\u6298\u7dda\u5716</p> <p>Examples:</p> <p></p>"}, {"location": "reference/optimize/#finlab.optimize.combinations.ReportCollection.plot_stats", "title": "plot_stats", "text": "<pre><code>plot_stats(mode='bar', heatmap_sort_by='avg_score', indicators=[])\n</code></pre> <p>\u7b56\u7565\u6307\u6a19\u6bd4\u8f03\u5831\u8868\u8996\u89ba\u5316</p> PARAMETER DESCRIPTION <code>mode</code> <p>\u7e6a\u5716\u6a21\u5f0f\u3002<code>'bar'</code> - \u6307\u6a19\u5206\u7fa4\u68d2\u72c0\u5716\u3002<code>'heatmap'</code> - \u6307\u6a19\u5206\u7d1a\u71b1\u529b\u5716\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'bar'</code> </p> <code>heatmap_sort_by</code> <p>heatmap \u964d\u51aa\u6392\u5e8f\u7684\u6c7a\u5b9a\u6b04\u4f4d</p> <p> TYPE: <code>str or list of str</code> DEFAULT: <code>'avg_score'</code> </p> <code>indicators</code> <p>\u8981\u986f\u793a\u7684\u7279\u5b9a\u6307\u6a19\u6b04\u4f4d\uff0c\u9810\u8a2d\u70ba\u5c07\u6307\u6a19\u5168\u90e8\u986f\u793a</p> <p> TYPE: <code>list</code> DEFAULT: <code>[]</code> </p> RETURNS DESCRIPTION <code>Figure</code> <p>\u9577\u689d\u5716</p> <code>DataFrame</code> <p>\u71b1\u529b\u5716</p> <p>Examples:</p> <p>ex1:</p> <p>\u7e6a\u88fd\u6307\u6a19\u5206\u7fa4\u68d2\u72c0\u5716</p> <p></p> <p>ex2:</p> <p>\u7e6a\u88fd\u6307\u6a19\u5206\u7d1a\u71b1\u529b\u5716\u3002</p> <p><code>'avg_score'</code>: \u5404\u6307\u6a19\u52a0\u7e3d\u5f8c\u7684\u5e73\u5747\u5206\u6578\uff0c\u5206\u6578\u8d8a\u9ad8\u70ba\u6574\u9ad4\u8a55\u50f9\u8f03\u6b63\u5411\u7684\u7b56\u7565\u3002</p> <p>\u9810\u8a2d\u4ee5avg_score\u70ba\u6392\u5e8f\uff0c\u6578\u503c\u8d8a\u5927\u70ba\u6392\u540d\u8d8a\u524d\u9762\uff0c\u5206\u6578\u8d8a\u9ad8\u70ba\u6574\u9ad4\u8a55\u50f9\u8f03\u512a\u7684\u7b56\u7565\u3002</p> <p></p>"}, {"location": "reference/optimize/#_4", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u7b56\u7565\u53c3\u6578\u512a\u5316\u5b8c\u6574\u6307\u5357</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>GitHub \u539f\u59cb\u78bc</li> </ul>"}, {"location": "reference/plot/", "title": "finlab.plot", "text": "<p>\u8cc7\u6599\u8996\u89ba\u5316\u6a21\u7d44\uff0c\u63d0\u4f9b\u53f0\u80a1\u5e02\u5834\u5c08\u7528\u7684\u591a\u7a2e\u8996\u89ba\u5316\u5de5\u5177\u3002</p>"}, {"location": "reference/plot/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u7e6a\u88fd\u80a1\u7968 K \u7dda\u5716\u8207\u6280\u8853\u6307\u6a19</li> <li>\u8996\u89ba\u5316\u5e02\u5834\u71b1\u5ea6\uff08\u6a39\u72c0\u5716\uff09</li> <li>\u5c0d\u6bd4\u591a\u6a94\u80a1\u7968\u8ca1\u52d9\u6307\u6a19\uff08\u96f7\u9054\u5716\uff09</li> <li>\u89c0\u5bdf\u80a1\u50f9\u8207\u4f30\u503c\u95dc\u4fc2\uff08\u6cb3\u6d41\u5716\uff09</li> <li>\u5206\u6790\u7b56\u7565\u6301\u5009\u5206\u5e03\uff08\u65ed\u65e5\u5716\uff09</li> <li>\u5c55\u793a\u7b56\u7565\u7e3e\u6548\u7d71\u8a08</li> </ul>"}, {"location": "reference/plot/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/plot/#k", "title": "K \u7dda\u5716\u8207\u6280\u8853\u6307\u6a19", "text": "<pre><code>from finlab.plot import plot_tw_stock_candles\n\n# \u7e6a\u88fd\u53f0\u7a4d\u96fb K \u7dda\u5716\nplot_tw_stock_candles(\n    stock_id='2330',\n    recent_days=200\n).show()\n</code></pre>"}, {"location": "reference/plot/#_3", "title": "\u5e02\u5834\u71b1\u5ea6\u6a39\u72c0\u5716", "text": "<pre><code>from finlab.plot import plot_tw_stock_treemap\n\n# \u8996\u89ba\u5316 2024-01-01 \u7684\u5e02\u5834\u71b1\u5ea6\nplot_tw_stock_treemap(\n    start='2024-01-01',\n    end='2024-01-01',\n    area_ind='market_value',  # \u65b9\u584a\u5927\u5c0f\uff1a\u5e02\u503c\n    item='return_ratio'        # \u984f\u8272\uff1a\u5831\u916c\u7387\n).show()\n</code></pre>"}, {"location": "reference/plot/#_4", "title": "\u8ca1\u52d9\u6307\u6a19\u96f7\u9054\u5716", "text": "<pre><code>from finlab.plot import plot_tw_stock_radar\n\n# \u5c0d\u6bd4\u591a\u6a94\u80a1\u7968\u7684\u8ca1\u52d9\u6307\u6a19\nplot_tw_stock_radar(\n    portfolio=['2330', '2454', '2317'],\n    feats=[\n        'fundamental_features:\u71df\u696d\u6bdb\u5229\u7387',\n        'fundamental_features:\u71df\u696d\u5229\u76ca\u7387',\n        'fundamental_features:\u7a05\u5f8c\u6de8\u5229\u7387'\n    ],\n    mode='bar_polar'\n).show()\n</code></pre>"}, {"location": "reference/plot/#_5", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u8cc7\u6599\u8996\u89ba\u5316\u6559\u5b78\uff0c\u4e86\u89e3\uff1a - \u6240\u6709\u8996\u89ba\u5316\u5de5\u5177\u7684\u5b8c\u6574\u7bc4\u4f8b - \u81ea\u8a02\u5716\u8868\u6a23\u5f0f\u8207\u914d\u8272 - \u4e92\u52d5\u5f0f\u5716\u8868\u4f7f\u7528\u6280\u5de7 - \u532f\u51fa\u5716\u8868\u70ba\u5716\u7247</p>"}, {"location": "reference/plot/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/plot/#plot_tw_stock_candles", "title": "plot_tw_stock_candles()", "text": "<p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab.plot import plot_tw_stock_candles\nfrom finlab.data import indicator\n\n# \u57fa\u790e\u7528\u6cd5\uff1a\u7e6a\u88fd K \u7dda\u5716\nplot_tw_stock_candles('2330', recent_days=200).show()\n\n# \u52a0\u5165\u6280\u8853\u6307\u6a19\nfig = plot_tw_stock_candles('2330', recent_days=200)\n# \u53ef\u4ee5\u4f7f\u7528 fig.add_trace() \u6dfb\u52a0\u81ea\u8a02\u6307\u6a19\nfig.show()\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e</p> <ul> <li>stock_id: \u80a1\u7968\u4ee3\u865f\uff08\u5b57\u4e32\uff09</li> <li>recent_days: \u986f\u793a\u6700\u8fd1 N \u5929\u7684\u8cc7\u6599</li> <li>\u56de\u50b3 plotly.graph_objects.Figure \u7269\u4ef6\uff0c\u53ef\u9032\u4e00\u6b65\u5ba2\u88fd\u5316</li> </ul> <p>\u6ce8\u610f\u4e8b\u9805</p> <ul> <li>\u9700\u5b89\u88dd <code>plotly</code> \u5957\u4ef6\uff1a<code>pip install plotly</code></li> <li>K \u7dda\u5716\u9810\u8a2d\u986f\u793a\u6536\u76e4\u50f9\u3001\u958b\u76e4\u50f9\u3001\u6700\u9ad8\u50f9\u3001\u6700\u4f4e\u50f9</li> <li>\u82e5\u8981\u5728 Jupyter Notebook \u986f\u793a\uff0c\u9700\u547c\u53eb <code>.show()</code></li> </ul>"}, {"location": "reference/plot/#finlab.plot.plot_tw_stock_candles", "title": "finlab.plot.plot_tw_stock_candles", "text": "<pre><code>plot_tw_stock_candles(symbol, recent_days=400, adjust_price=False, resample='D', overlay_func=None, technical_func=None)\n</code></pre> <p>\u7e6a\u88fd\u53f0\u80a1\u6280\u8853\u7dda\u5716\u5716\u7d44 Args:     symbol (str): \u53f0\u80a1\u80a1\u865f\uff0cex:<code>'2330'</code>\u3002     recent_days (int):\u53d6\u8fd1n\u500b\u4ea4\u6613\u65e5\u8cc7\u6599\u3002     adjust_price (bool):\u662f\u5426\u4f7f\u7528\u9084\u539f\u80a1\u50f9\u8a08\u7b97\u3002     resample (str): \u6280\u8853\u6307\u6a19\u50f9\u683c\u9031\u671f\uff0cex: <code>D</code> \u4ee3\u8868\u65e5\u7dda, <code>W</code> \u4ee3\u8868\u9031\u7dda, <code>M</code> \u4ee3\u8868\u6708\u7dda\u3002     overlay_func (dict):         K\u7dda\u5716\u8f14\u52a9\u7dda\uff0c\u9810\u8a2d\u4f7f\u7528\u5e03\u6797\u901a\u9053\u3002          <pre><code>from finlab.data import indicator\n\noverlay_func={\n             'ema_5':indicator('EMA',timeperiod=5),\n             'ema_10':indicator('EMA',timeperiod=10),\n             'ema_20':indicator('EMA',timeperiod=20),\n             'ema_60':indicator('EMA',timeperiod=60),\n            }\n</code></pre>     technical_func (list):         \u6280\u8853\u6307\u6a19\u5b50\u5716\uff0c\u9810\u8a2d\u4f7f\u7528KD\u6280\u8853\u6307\u6a19\u55ae\u7d44\u5b50\u5716\u3002</p> <pre><code>    \u8a2d\u5b9a\u591a\u7d44\u6280\u8853\u6307\u6a19\uff1a\n    ```py\n    from finlab.data import indicator\n\n    k,d = indicator('STOCH')\n    rsi = indicator('RSI')\n    technical_func = [{'K':k,'D':d},{'RSI':rsi}]\n    ```\n</code></pre> RETURNS DESCRIPTION <code>Figure</code> <p>\u6280\u8853\u7dda\u5716</p> <p>Examples:</p> <pre><code>from finlab.plot import plot_tw_stock_candles\nfrom finlab.data import indicator\n\noverlay_func={\n              'ema_5':indicator('EMA',timeperiod=5),\n              'ema_10':indicator('EMA',timeperiod=10),\n              'ema_20':indicator('EMA',timeperiod=20),\n              'ema_60':indicator('EMA',timeperiod=60),\n             }\nk,d = indicator('STOCH')\nrsi = indicator('RSI')\ntechnical_func = [{'K':k,'D':d},{'RSI':rsi}]\nplot_tw_stock_candles(symbol='2330',recent_days=600,adjust_price=False,overlay_func=overlay_func,technical_func=technical_func)\n</code></pre>"}, {"location": "reference/plot/#plot_tw_stock_treemap", "title": "plot_tw_stock_treemap()", "text": "<p>\u5e02\u5834\u71b1\u5ea6\u8996\u89ba\u5316\uff1a</p> <pre><code>from finlab.plot import plot_tw_stock_treemap\n\n# \u7bc4\u4f8b 1\uff1a\u8996\u89ba\u5316\u55ae\u65e5\u5e02\u5834\u5831\u916c\u7387\nplot_tw_stock_treemap(\n    start='2024-01-01',\n    end='2024-01-01',\n    area_ind='market_value',  # \u65b9\u584a\u5927\u5c0f\uff1a\u5e02\u503c\n    item='return_ratio'        # \u984f\u8272\uff1a\u5831\u916c\u7387\n).show()\n\n# \u7bc4\u4f8b 2\uff1a\u8996\u89ba\u5316\u6210\u4ea4\u91cf\nplot_tw_stock_treemap(\n    start='2024-01-01',\n    end='2024-01-01',\n    area_ind='turnover',       # \u65b9\u584a\u5927\u5c0f\uff1a\u6210\u4ea4\u91cf\n    item='turnover_ratio'      # \u984f\u8272\uff1a\u6210\u4ea4\u91cf\u6bd4\u7387\n).show()\n\n# \u7bc4\u4f8b 3\uff1a\u8996\u89ba\u5316\u672c\u76ca\u6bd4\u5206\u5e03\nplot_tw_stock_treemap(\n    start='2024-01-01',\n    end='2024-01-01',\n    area_ind='market_value',\n    item='price_earning_ratio:\u672c\u76ca\u6bd4',\n    clip=(0, 50),  # \u9650\u5236\u672c\u76ca\u6bd4\u7bc4\u570d 0-50\n    color_continuous_scale='RdBu_r'  # \u7d05\u85cd\u914d\u8272\n).show()\n</code></pre> <p>\u5e38\u7528\u53c3\u6578\u7d44\u5408</p> <ul> <li>\u5e02\u5834\u71b1\u5ea6\uff1a<code>area_ind='market_value'</code>, <code>item='return_ratio'</code></li> <li>\u4ea4\u6613\u6d3b\u8e8d\u5ea6\uff1a<code>area_ind='turnover'</code>, <code>item='turnover_ratio'</code></li> <li>\u4f30\u503c\u5206\u5e03\uff1a<code>area_ind='market_value'</code>, <code>item='price_earning_ratio:\u672c\u76ca\u6bd4'</code></li> </ul> <p>\u8cc7\u6599\u7bc4\u570d\u9650\u5236</p> <ul> <li><code>start</code> \u548c <code>end</code> \u901a\u5e38\u8a2d\u70ba\u540c\u4e00\u5929\uff08\u55ae\u65e5\u5feb\u7167\uff09</li> <li>\u82e5\u8a2d\u70ba\u4e0d\u540c\u65e5\u671f\uff0c\u6703\u986f\u793a\u8a72\u671f\u9593\u7684\u5e73\u5747\u503c</li> </ul>"}, {"location": "reference/plot/#finlab.plot.plot_tw_stock_treemap", "title": "finlab.plot.plot_tw_stock_treemap", "text": "<pre><code>plot_tw_stock_treemap(start=None, end=None, area_ind='market_value', item='return_ratio', clip=None, color_continuous_scale='Temps', treemap_data=None)\n</code></pre> <p>\u7e6a\u88fd\u53f0\u80a1\u677f\u584a\u5716\u8cc7\u6599</p> <p>\u5de2\u72c0\u6a39\u72c0\u5716\u53ef\u4ee5\u986f\u793a\u591a\u7dad\u5ea6\u8cc7\u6599\uff0c\u5c07\u4f9d\u7167\u7522\u696d\u5206\u985e\u7684\u53f0\u80a1\u8cc7\u6599\u7d62\u9e97\u986f\u793a\u3002</p> PARAMETER DESCRIPTION <code>start</code> <p>\u8cc7\u6599\u958b\u59cb\u65e5\uff0cex:<code>'2021-01-02'</code>\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>end</code> <p>\u8cc7\u6599\u7d50\u675f\u65e5\uff0cex:<code>'2021-01-05'</code>\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>area_ind</code> <p>\u6c7a\u5b9a\u677f\u584a\u9762\u7a4d\u6578\u503c\u7684\u6307\u6a19\u3002               \u53ef\u9078\u64c7<code>[\"market_value\",\"turnover\"]</code>\uff0c\u6578\u503c\u4ee3\u8868\u542b\u7fa9\u5206\u5225\u70ba\u5e02\u503c\u3001\u6210\u4ea4\u91d1\u984d\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'market_value'</code> </p> <code>item</code> <p>\u6c7a\u5b9a\u677f\u584a\u984f\u8272\u6df1\u6dfa\u7684\u6307\u6a19\u3002           \u9664\u4e86\u53ef\u9078\u64c7\u4f9d\u7167 start \u8207 end \u8a08\u7b97\u7684<code>\"return_ratio\"</code>(\u5831\u916c\u7387)\uff0c           \u4ea6\u53ef\u9078\u64c7FinLab\u8cc7\u6599\u5eab\u5167\u7684\u6307\u6a19\u986f\u793a\u8fd1\u4e00\u671f\u8cc7\u6599\u3002   example:</p> <ul> <li><code>'price_earning_ratio:\u672c\u76ca\u6bd4'</code> - \u986f\u793a\u8fd1\u65e5\u7522\u696d\u7684\u672c\u76ca\u6bd4\u9ad8\u4f4e\u3002</li> <li><code>'monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)'</code> - \u986f\u793a\u8fd1\u6708\u7684\u55ae\u6708\u71df\u6536\u5e74\u589e\u7387\u3002</li> </ul> <p> TYPE: <code>str</code> DEFAULT: <code>'return_ratio'</code> </p> <code>clip</code> <p>\u5c07 item \u908a\u754c\u5916\u7684\u503c\u5206\u914d\u7d66\u908a\u754c\u503c\uff0c\u9632\u6b62\u8cc7\u6599\u4e0a\u9650\u503c\u904e\u5927\u6216\u904e\u5c0f\uff0c\u9020\u6210\u984f\u8272\u6df1\u6dfa\u8b8a\u5316\u4e0d\u660e\u986f\u3002             ex:(0,100)\uff0c\u5c07\u6578\u503c\u4f4e\u9ad8\u754c\u7dda\uff0c\u8a2d\u70ba 0~100\uff0c\u8d85\u904e\u7684\u6578\u503c\u3002</p> <p>Note</p> <p>\u53c3\u8003pandas\u6587\u4ef6\u66f4\u4e86\u89e3<code>pd.clip</code>\u7d30\u7bc0\u3002</p> <p> TYPE: <code>tuple</code> DEFAULT: <code>None</code> </p> <code>color_continuous_scale</code> <p>\u984f\u8272\u8b8a\u5316\u5e8f\u5217\u7684\u6a23\u5f0f\u540d\u7a31</p> <p> TYPE: <code>str</code> DEFAULT: <code>'Temps'</code> </p> <code>treemap_data</code> <p>\u5ba2\u88fd\u5316\u8cc7\u6599\uff0c\u683c\u5f0f\u53c3\u7167 <code>create_treemap_data()</code> \u8fd4\u56de\u503c\u3002</p> <p> TYPE: <code>DataFrame</code> DEFAULT: <code>None</code> </p> <p>Returns:     (plotly.graph_objects.Figure): \u6a39\u72c0\u677f\u584a\u5716 Examples:     ex1:     \u677f\u584a\u9762\u7a4d\u986f\u793a\u6210\u4ea4\u91d1\u984d\uff0c\u984f\u8272\u986f\u793a'2021-07-01'\uff5e'2021-07-02'\u7684\u5831\u916c\u7387\u8b8a\u5316\uff0c\u53ef\u4ee5\u89c0\u5bdf\u5e02\u5834\u8cc7\u91d1\u96c6\u4e2d\u7684\u7522\u696d\u8207\u6f32\u8dcc\u5f37\u5f31\u3002     <pre><code>from finlab.plot import plot_tw_stock_treemap\nplot_tw_stock_treemap(start= '2021-07-01',end = '2021-07-02',area_ind=\"turnover\",item=\"return_ratio\")\n</code></pre>      ex2:     \u677f\u584a\u9762\u7a4d\u986f\u793a\u5e02\u503c(\u80a1\u672c*\u6536\u76e4\u50f9)\uff0c\u984f\u8272\u986f\u793a\u8fd1\u671f\u672c\u76ca\u6bd4\uff0c\u53ef\u4ee5\u89c0\u5bdf\u5168\u5e02\u5834\u54ea\u4e9b\u662f\u6b0a\u503c\u80a1\uff1f\u54ea\u4e9b\u7522\u696d\u672c\u76ca\u6bd4\u8a55\u50f9\u9ad8\uff1f\u9650\u5236\u6578\u503c\u7bc4\u570d\u5728(0,50)\uff0c     \u5c07\u904e\u9ad8\u672c\u76ca\u6bd4\u7684\u6578\u503c\u58d3\u572850\uff0c\u4e0d\u8b93\u984f\u8272\u8b8a\u5316\u7a81\u5140\uff0c\u80fd\u5206\u51fa\u9ad8\u4f4e\u968e\u5c64\u5373\u53ef\u3002     <pre><code>from finlab.plot import plot_tw_stock_treemap\nplot_tw_stock_treemap(area_ind=\"market_value\",item=\"price_earning_ratio:\u672c\u76ca\u6bd4\",clip=(0,50), color_continuous_scale='RdBu_r')\n</code></pre> </p>"}, {"location": "reference/plot/#plot_tw_stock_radar", "title": "plot_tw_stock_radar()", "text": "<p>\u591a\u80a1\u7968\u8ca1\u52d9\u6307\u6a19\u5c0d\u6bd4\uff1a</p> <pre><code>from finlab.plot import plot_tw_stock_radar\n\n# \u7bc4\u4f8b 1\uff1a\u5c0d\u6bd4\u4e09\u6a94\u534a\u5c0e\u9ad4\u80a1\u7684\u7372\u5229\u80fd\u529b\nplot_tw_stock_radar(\n    portfolio=['2330', '2454', '2317'],\n    feats=[\n        'fundamental_features:\u71df\u696d\u6bdb\u5229\u7387',\n        'fundamental_features:\u71df\u696d\u5229\u76ca\u7387',\n        'fundamental_features:\u7a05\u5f8c\u6de8\u5229\u7387',\n        'fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387'\n    ],\n    mode='bar_polar'  # \u67f1\u72c0\u96f7\u9054\u5716\n).show()\n\n# \u7bc4\u4f8b 2\uff1a\u5206\u6790\u55ae\u4e00\u80a1\u7968\u7684\u591a\u7dad\u5ea6\u6307\u6a19\nplot_tw_stock_radar(\n    portfolio=['9939'],\n    feats=[\n        'fundamental_features:\u71df\u696d\u6bdb\u5229\u7387',\n        'fundamental_features:\u71df\u696d\u5229\u76ca\u7387',\n        'fundamental_features:\u7a05\u5f8c\u6de8\u5229\u7387',\n        'fundamental_features:\u73fe\u91d1\u6d41\u91cf\u6bd4\u7387',\n        'fundamental_features:\u8ca0\u50b5\u6bd4\u7387'\n    ],\n    mode='line_polar',  # \u7dda\u72c0\u96f7\u9054\u5716\n    cut_bins=8          # \u5c07\u6307\u6a19\u503c\u5207\u5206\u70ba 8 \u500b\u7b49\u7d1a\n).show()\n</code></pre> <p>mode \u53c3\u6578\u9078\u64c7</p> <ul> <li>'bar_polar': \u67f1\u72c0\u96f7\u9054\u5716\uff08\u63a8\u85a6\u7528\u65bc 2-5 \u6a94\u80a1\u7968\u5c0d\u6bd4\uff09</li> <li>'line_polar': \u7dda\u72c0\u96f7\u9054\u5716\uff08\u9069\u5408\u55ae\u4e00\u80a1\u7968\u591a\u6307\u6a19\u5c55\u793a\uff09</li> <li>'scatter_polar': \u6563\u9ede\u96f7\u9054\u5716\uff08\u9069\u5408\u67e5\u770b\u539f\u59cb\u6578\u64da\u9ede\uff09</li> </ul>"}, {"location": "reference/plot/#finlab.plot.plot_tw_stock_radar", "title": "finlab.plot.plot_tw_stock_radar", "text": "<pre><code>plot_tw_stock_radar(portfolio, feats=None, mode='line_polar', line_polar_fill=None, period=None, cut_bins=10, title=None, custom_data=None)\n</code></pre> <p>\u7e6a\u88fd\u53f0\u80a1\u96f7\u9054\u5716</p> <p>\u6bd4\u8f03\u6301\u80a1\u7d44\u5408\u7684\u6307\u6a19\u5206\u7d1a\u7279\u6027\u3002\u82e5\u6578\u503c\u70banan\uff0c\u5247\u4e0d\u986f\u793a\u5206\u7d1a\u3002</p> PARAMETER DESCRIPTION <code>portfolio</code> <p>\u6301\u80a1\u7d44\u5408\uff0cex:<code>['1101','1102']</code>\u3002</p> <p> TYPE: <code>list</code> </p> <code>feats</code> <p>\u9078\u5b9aFinLab\u8cc7\u6599\u5eab\u5167\u7684\u6307\u6a19\u7d44\u6210\u8cc7\u6599\u96c6\u3002\u9810\u8a2d\u70ba18\u9805\u8ca1\u52d9\u6307\u6a19\u3002             ex:['fundamental_features:\u71df\u696d\u6bdb\u5229\u7387','fundamental_features:\u71df\u696d\u5229\u76ca\u7387']</p> <p> TYPE: <code>list</code> DEFAULT: <code>None</code> </p> <code>mode</code> <p>\u96f7\u9054\u5716\u6a21\u5f0f \uff0cex:'bar_polar','scatter_polar','line_polar'`\u3002</p> <p>Note</p> <p>\u53c3\u8003\u4e0d\u540c\u6a21\u5f0f\u7684\u5dee\u7570</p> <p> TYPE: <code>str</code> DEFAULT: <code>'line_polar'</code> </p> <code>line_polar_fill</code> <p>\u5c07\u5340\u57df\u8a2d\u7f6e\u70ba\u7528\u7d14\u8272\u586b\u5145 \u3002ex:<code>None,'toself','tonext'</code> <code>'toself'</code>\u5c07\u8de1\u7dda\u7684\u7aef\u9ede\uff08\u6216\u8de1\u7dda\u7684\u6bcf\u4e00\u6bb5\uff0c\u5982\u679c\u5b83\u6709\u9593\u9699\uff09\u9023\u63a5\u6210\u4e00\u500b\u5c01\u9589\u7684\u5f62\u72c0\u3002                    \u5982\u679c\u4e00\u689d\u5b8c\u5168\u5305\u570d\u53e6\u4e00\u689d\uff08\u4f8b\u5982\u9023\u7e8c\u7684\u7b49\u9ad8\u7dda\uff09\uff0c\u5247<code>'tonext'</code>\u586b\u5145\u5169\u689d\u8de1\u7dda\u4e4b\u9593\u7684\u7a7a\u9593\uff0c\u5982\u679c\u4e4b\u524d\u6c92\u6709\u8de1\u7dda\uff0c                    \u5247\u5176\u884c\u70ba\u985e\u4f3c\u65bc<code>'toself'</code>\u3002\u5982\u679c\u4e00\u689d\u8de1\u7dda\u4e0d\u5305\u542b\u53e6\u4e00\u689d\u8de1\u7dda\uff0c\u5247\u4e0d\u61c9\u4f7f\u7528<code>'tonext'</code>\u3002 \u6b32\u4f7f\u7528 line_polar\uff0c\u8acb\u5c07pandas\u7248\u672c\u964d\u81f3 1.4.4\u3002</p> <p>Note</p> <p>\u53c3\u8003plotly.graph_objects.Scatterpolar.fill</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>period</code> <p>\u9078\u64c7\u7b2c\u5e7e\u671f\u7684\u7279\u5fb5\u8cc7\u6599\uff0c\u9810\u8a2d\u70ba\u8fd1\u4e00\u5b63\u3002             ex: \u8a2d\u5b9a\u6578\u503c\u70ba'2020-Q2\uff0c\u53d6\u5f972020\u5e74\u7b2c\u4e8c\u5b63\u8cc7\u6599\u6bd4\u8f03\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>cut_bins</code> <p>\u7279\u5fb5\u5206\u7d1a\u7d1a\u8ddd\u3002</p> <p> TYPE: <code>int</code> DEFAULT: <code>10</code> </p> <code>title</code> <p>\u5716\u7247\u6a19\u984c\u540d\u7a31\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>custom_data</code> <p>\u5ba2\u88fd\u5316\u6307\u6a19\u5206\u7d1a\uff0c\u6b04\u540d\u70ba\u7279\u5fb5             \u683c\u5f0f\u7bc4\u4f8b:</p> stock_id \u71df\u696d\u6bdb\u5229\u7387 \u71df\u696d\u5229\u76ca\u7387 \u7a05\u5f8c\u6de8\u5229\u7387 1101 2 5 3 1102 1 8 4 <p> TYPE: <code>DataFrame</code> DEFAULT: <code>None</code> </p> <p>Returns:     (plotly.graph_objects.Figure): \u96f7\u9054\u5716 Examples:     ex1:\u6bd4\u8f03\u6301\u80a1\u7d44\u5408\u7d2f\u8a08\u5206\u6578\uff0c\u770b\u6301\u80a1\u7d44\u5408\u504f\u91cd\u54ea\u50cf\u7279\u5fb5\u3002     <pre><code>from finlab.plot import plot_tw_stock_radar\nplot_tw_stock_radar(portfolio=[\"1101\", \"2330\", \"8942\", \"6263\"], mode=\"bar_polar\", line_polar_fill='None')\n</code></pre>      ex2:\u770b\u55ae\u4e00\u500b\u80a1\u7279\u5fb5\u5206\u7d1a\u843d\u9ede\u3002     <pre><code>from finlab.plot import plot_tw_stock_radar\nfeats = ['fundamental_features:\u71df\u696d\u6bdb\u5229\u7387', 'fundamental_features:\u71df\u696d\u5229\u76ca\u7387', 'fundamental_features:\u7a05\u5f8c\u6de8\u5229\u7387',\n         'fundamental_features:\u73fe\u91d1\u6d41\u91cf\u6bd4\u7387', 'fundamental_features:\u8ca0\u50b5\u6bd4\u7387']\nplot_tw_stock_radar(portfolio=[\"9939\"], feats=feats, mode=\"line_polar\", line_polar_fill='toself', cut_bins=8)\n</code></pre> </p>"}, {"location": "reference/plot/#plot_tw_stock_river", "title": "plot_tw_stock_river()", "text": "<p>\u80a1\u50f9\u8207\u4f30\u503c\u95dc\u4fc2\u8996\u89ba\u5316\uff1a</p> <pre><code>from finlab.plot import plot_tw_stock_river\n\n# \u7bc4\u4f8b 1\uff1a\u89c0\u5bdf\u53f0\u7a4d\u96fb\u7684\u672c\u76ca\u6bd4\u6cb3\u6d41\u5716\nplot_tw_stock_river(\n    stock_id='2330',\n    start='2015-01-01',\n    end='2024-01-01',\n    mode='pe',        # \u672c\u76ca\u6bd4\u6a21\u5f0f\n    split_range=10    # \u5c07\u672c\u76ca\u6bd4\u5206\u70ba 10 \u500b\u5340\u9593\n).show()\n\n# \u7bc4\u4f8b 2\uff1a\u89c0\u5bdf\u80a1\u50f9\u6de8\u503c\u6bd4\u6cb3\u6d41\u5716\nplot_tw_stock_river(\n    stock_id='2330',\n    start='2015-01-01',\n    end='2024-01-01',\n    mode='pb',        # \u80a1\u50f9\u6de8\u503c\u6bd4\u6a21\u5f0f\n    split_range=8\n).show()\n</code></pre> <p>mode \u53c3\u6578\u8aaa\u660e</p> <ul> <li>'pe': \u672c\u76ca\u6bd4\u6cb3\u6d41\u5716\uff08Price-to-Earnings Ratio\uff09</li> <li>'pb': \u80a1\u50f9\u6de8\u503c\u6bd4\u6cb3\u6d41\u5716\uff08Price-to-Book Ratio\uff09</li> <li><code>split_range</code> \u8d8a\u5927\uff0c\u984f\u8272\u5206\u7d1a\u8d8a\u7d30</li> </ul> <p>\u8cc7\u6599\u9700\u6c42</p> <ul> <li>\u9700\u8981\u8db3\u5920\u9577\u7684\u6b77\u53f2\u8cc7\u6599\uff08\u5efa\u8b70\u81f3\u5c11 2 \u5e74\uff09</li> <li>\u8ca1\u5831\u8cc7\u6599\u6709\u5ef6\u9072\uff0c\u6700\u65b0\u4e00\u5b63\u53ef\u80fd\u7121\u6578\u64da</li> </ul>"}, {"location": "reference/plot/#finlab.plot.plot_tw_stock_river", "title": "finlab.plot.plot_tw_stock_river", "text": "<pre><code>plot_tw_stock_river(symbol='2330', start=None, end=None, mode='pe', split_range=8)\n</code></pre> <p>\u7e6a\u88fd\u53f0\u80a1\u6cb3\u6d41\u5716</p> <p>\u4f7f\u7528 PE or PB \u7684\u6700\u9ad8\u8207\u6700\u4f4e\u503c\u7e6a\u88fd\u6cb3\u6d41\u5716\uff0c\u5224\u65b7\u6307\u6a19\u6240\u8655\u4f4d\u968e\u3002</p> PARAMETER DESCRIPTION <code>symbol</code> <p>\u53f0\u80a1\u80a1\u865f\uff0cex:<code>'2330'</code>\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'2330'</code> </p> <code>start</code> <p>\u8cc7\u6599\u958b\u59cb\u65e5\uff0cex:<code>'2020-01-02'</code>\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>end</code> <p>\u8cc7\u6599\u7d50\u675f\u65e5\uff0cex:<code>'2022-01-05'</code>\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>mode</code> <p><code>'pe'</code> or <code>'pb'</code> (\u672c\u76ca\u6bd4\u6216\u80a1\u50f9\u6de8\u503c\u6bd4)\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>'pe'</code> </p> <code>split_range</code> <p>\u6cb3\u6d41\u968e\u5c64\u6578\u3002</p> <p> TYPE: <code>int</code> DEFAULT: <code>8</code> </p> <p>Returns:     (plotly.graph_objects.Figure): \u6cb3\u6d41\u5716 Examples:   <pre><code>from finlab.plot import plot_tw_stock_river\nplot_tw_stock_river(symbol='2330', start='2015-1-1', end='2022-7-1', mode='pe', split_range=10)\n</code></pre> </p>"}, {"location": "reference/plot/#create_treemap_data", "title": "create_treemap_data()", "text": "<p>\u7522\u751f\u6a39\u72c0\u5716\u8cc7\u6599\uff08\u9032\u968e\u7528\u6cd5\uff09\uff1a</p> <pre><code>from finlab.plot import create_treemap_data\n\n# \u81ea\u8a02\u6a39\u72c0\u5716\u8cc7\u6599\ndata = create_treemap_data(\n    start='2024-01-01',\n    end='2024-01-01',\n    area_ind='market_value',\n    item='return_ratio'\n)\n\n# \u53ef\u9032\u4e00\u6b65\u8655\u7406\u8cc7\u6599\u6216\u4f7f\u7528\u5176\u4ed6\u7e6a\u5716\u5de5\u5177\nprint(data.head())\n</code></pre>"}, {"location": "reference/plot/#finlab.plot.create_treemap_data", "title": "finlab.plot.create_treemap_data", "text": "<pre><code>create_treemap_data(start, end, item='return_ratio', clip=None)\n</code></pre> <p>\u7522\u751f\u53f0\u80a1\u677f\u584a\u5716\u8cc7\u6599</p> <p>\u7522\u751f\u7e6a\u88fd\u6a39\u72c0\u5716\u6240\u7528\u7684\u8cc7\u6599\uff0c\u53ef\u518d\u5916\u52a0FinLab\u8cc7\u6599\u5eab\u4ee5\u5916\u7684\u6307\u6a19\u88fd\u4f5c\u5ba2\u88fd\u5316DataFrame\uff0c \u4e26\u50b3\u5165<code>plot_tw_stock_treemap(treemap_data=treemap_data)\u3002</code></p> PARAMETER DESCRIPTION <code>start</code> <p>\u8cc7\u6599\u958b\u59cb\u65e5\uff0cex:<code>\"2021-01-02\"</code>\u3002</p> <p> TYPE: <code>str</code> </p> <code>end</code> <p>\u8cc7\u6599\u7d50\u675f\u65e5\uff0cex:<code>\"2021-01-05\"</code>\u3002</p> <p> TYPE: <code>str</code> </p> <code>item</code> <p>\u6c7a\u5b9a\u677f\u584a\u984f\u8272\u6df1\u6dfa\u7684\u6307\u6a19\u3002           \u9664\u4e86\u53ef\u9078\u64c7\u4f9d\u7167 start \u8207 end \u8a08\u7b97\u7684<code>\"return_ratio\"</code>(\u5831\u916c\u7387)\uff0c           \u4ea6\u53ef\u9078\u64c7FinLab\u8cc7\u6599\u5eab\u5167\u7684\u6307\u6a19\u986f\u793a\u8fd1\u4e00\u671f\u8cc7\u6599\u3002   example:</p> <ul> <li><code>'price_earning_ratio:\u672c\u76ca\u6bd4'</code> - \u986f\u793a\u8fd1\u65e5\u7522\u696d\u7684\u672c\u76ca\u6bd4\u9ad8\u4f4e\u3002</li> <li><code>'monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)'</code> - \u986f\u793a\u8fd1\u6708\u7684\u55ae\u6708\u71df\u6536\u5e74\u589e\u7387\u3002</li> </ul> <p> TYPE: <code>str</code> DEFAULT: <code>'return_ratio'</code> </p> <code>clip</code> <p>\u5c07item\u908a\u754c\u5916\u7684\u503c\u5206\u914d\u7d66\u908a\u754c\u503c\uff0c\u9632\u6b62\u8cc7\u6599\u4e0a\u9650\u503c\u904e\u5927\u6216\u904e\u5c0f\uff0c\u9020\u6210\u984f\u8272\u6df1\u6dfa\u8b8a\u5316\u4e0d\u660e\u986f\u3002             ex:(0,100)\uff0c\u5c07\u6578\u503c\u4f4e\u9ad8\u754c\u7dda\uff0c\u8a2d\u70ba0~100\uff0c\u8d85\u904e\u7684\u6578\u503c\u3002</p> <p>Note</p> <p>\u53c3\u8003pandas\u6587\u4ef6\u66f4\u4e86\u89e3<code>pd.clip</code>\u7d30\u7bc0\u3002</p> <p> TYPE: <code>tuple</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>\u53f0\u80a1\u500b\u80a1\u6307\u6a19</p> <p>Examples:</p> <pre><code>\u6b32\u4e0b\u8f09\u6240\u6709\u4e0a\u5e02\u4e0a\u6ac3\u4e4b\u50f9\u91cf\u6b77\u53f2\u8cc7\u6599\u8207\u7522\u696d\u5206\u985e\uff0c\u53ea\u9700\u57f7\u884c\u6b64\u51fd\u5f0f:\n\n``` py\nfrom finlab.plot import create_treemap_data\ncreate_treemap_data(start= '2021-07-01',end = '2021-07-02')\n```\n\n| stock_id   |  close |turnover|category|market|market_value|return_ratio|country|\n|:-----------|-------:|-------:|-------:|-------:|-------:|-------:|-------:|\n| 1101       |   20 |  57.85 |  \u6c34\u6ce5\u5de5\u696d |  sii   |    111  |    0.1  |  TW-Stock|\n| 1102       |  20 |  58.1  |  \u6c34\u6ce5\u5de5\u696d |  sii    |    111  |    -0.1 |  TW-Stock|\n</code></pre>"}, {"location": "reference/plot/#strategysunburst", "title": "StrategySunburst", "text": "<p>\u7b56\u7565\u6301\u5009\u65ed\u65e5\u5716\uff08\u9700\u642d\u914d\u96f2\u7aef\u7b56\u7565\uff09\uff1a</p> <pre><code>from finlab.plot import StrategySunburst\n\n# \u5be6\u4f8b\u5316\u4e26\u7e6a\u88fd\u7b56\u7565\u6301\u5009\u5206\u5e03\nstrategies = StrategySunburst()\nstrategies.plot().show()\n</code></pre> <p>\u4f7f\u7528\u524d\u63d0</p> <ul> <li>\u9700\u8981\u6709\u5df2\u4e0a\u50b3\u81f3 FinLab \u96f2\u7aef\u7684\u7b56\u7565</li> <li>\u9700\u767b\u5165 FinLab \u5e33\u865f\uff08<code>finlab.login()</code>\uff09</li> <li>\u986f\u793a\u5404\u7b56\u7565\u6301\u5009\u5728\u7522\u696d\u985e\u5225\u7684\u5206\u5e03</li> </ul>"}, {"location": "reference/plot/#finlab.plot.StrategySunburst", "title": "finlab.plot.StrategySunburst", "text": "<pre><code>StrategySunburst()\n</code></pre> <p>\u7e6a\u88fd\u7b56\u7565\u90e8\u4f4d\u65ed\u65e5\u5716</p> <p>\u76e3\u63a7\u591a\u7b56\u7565\u3002</p>"}, {"location": "reference/plot/#finlab.plot.StrategySunburst.get_strategy_df", "title": "get_strategy_df", "text": "<pre><code>get_strategy_df(select_strategy=None)\n</code></pre> <p>\u7372\u53d6\u7b56\u7565\u90e8\u4f4d\u8207\u5206\u914d\u6b0a\u91cd\u5f8c\u8a08\u7b97\u7684\u8cc7\u6599</p> PARAMETER DESCRIPTION <code>select_strategy</code> <p>\u9078\u64c7\u7b56\u7565\u540d\u7a31\u4e26\u8a2d\u5b9a\u6b0a\u91cd\uff0c\u9810\u8a2d\u662f\u6293\u53d6\u6b0a\u7b56\u7565\u4e26\u5e73\u5206\u8cc7\u91d1\u6bd4\u4f8b\u5230\u5404\u7b56\u7565\u3002                      ex:<code>{'\u4f4e\u6ce2\u52d5\u672c\u76ca\u6210\u9577\u6bd4':0.5,'\u7814\u767c\u9b54\u4eba':0.2, '\u73fe\u91d1':0.2}</code></p> <p> TYPE: <code>dict</code> DEFAULT: <code>None</code> </p> <p>Returns:     (pd.DataFrame): strategies data</p>"}, {"location": "reference/plot/#finlab.plot.StrategySunburst.plot", "title": "plot", "text": "<pre><code>plot(select_strategy=None, path=None, color_continuous_scale='RdBu_r')\n</code></pre> <p>\u7e6a\u5716</p> PARAMETER DESCRIPTION <code>select_strategy</code> <p>\u9078\u64c7\u7b56\u7565\u540d\u7a31\u4e26\u8a2d\u5b9a\u6b0a\u91cd\uff0c\u9810\u8a2d\u662f\u6293\u53d6\u6b0a\u7b56\u7565\u4e26\u5e73\u5206\u8cc7\u91d1\u6bd4\u4f8b\u5230\u5404\u7b56\u7565\u3002                      ex:<code>{'\u4f4e\u6ce2\u52d5\u672c\u76ca\u6210\u9577\u6bd4':0.5,'\u7814\u767c\u9b54\u4eba':0.2, '\u73fe\u91d1':0.2}</code></p> <p> TYPE: <code>dict</code> DEFAULT: <code>None</code> </p> <code>path</code> <p>\u65ed\u65e5\u5716\u7531\u88e1\u5230\u5916\u7684\u986f\u793a\u8def\u5f91\uff0c\u9810\u8a2d\u70ba<code>['s_name', 'market', 'category', 'stock_id']</code>\u3002            <code>['market', 'category','stock_id','s_name']</code>\u4e5f\u662f\u5e38\u7528\u9078\u9805\u3002</p> <p> TYPE: <code>list</code> DEFAULT: <code>None</code> </p> <code>color_continuous_scale</code> <p>\u984f\u8272\u8b8a\u5316\u5e8f\u5217\u7684\u6a23\u5f0f\u540d\u7a31</p> <p> TYPE: <code>str</code> DEFAULT: <code>'RdBu_r'</code> </p> RETURNS DESCRIPTION <code>Figure</code> <p>\u7b56\u7565\u90e8\u4f4d\u65ed\u65e5\u5716</p> <p>Examples:     <pre><code>from finlab.plot import StrategySunburst\n\n# \u5be6\u4f8b\u5316\u7269\u4ef6\nstrategies = StrategySunburst()\nstrategies.plot().show()\nstrategies.plot(select_strategy={'\u9ad8\u6b96\u5229\u7387\u70cf\u9f9c':0.4,'\u71df\u6536\u5f37\u52e2\u52d5\u80fd\u760b\u72d7':0.25,'\u4f4e\u6ce2\u52d5\u672c\u76ca\u6210\u9577\u6bd4':0.2,'\u73fe\u91d1':0.15},path =  ['market', 'category','stock_id','s_name']).show()\n</code></pre> ex1:\u7b56\u7565\u9078\u5230\u54ea\u4e9b\u6a19\u7684? </p> <p>ex2:\u90e8\u4f4d\u88ab\u54ea\u4e9b\u7b56\u7565\u9078\u5230\uff0c\u6a19\u7684\u82e5\u88ab\u4e0d\u540c\u7b56\u7565\u9078\u5230\uff0c\u53ef\u80fd\u6709\u7368\u7279\u4e4b\u8655\u5594\uff01 </p>"}, {"location": "reference/plot/#strategyreturnstats", "title": "StrategyReturnStats", "text": "<p>\u7b56\u7565\u7e3e\u6548\u7d71\u8a08\u5716\u8868\uff08\u9700\u642d\u914d\u96f2\u7aef\u7b56\u7565\uff09\uff1a</p> <pre><code>from finlab.plot import StrategyReturnStats\n\n# \u5be6\u4f8b\u5316\u4e26\u7e6a\u88fd\u7b56\u7565\u7e3e\u6548\nstats = StrategyReturnStats()\nstats.plot().show()\n</code></pre> <p>\u4f7f\u7528\u524d\u63d0</p> <ul> <li>\u9700\u8981\u6709\u5df2\u4e0a\u50b3\u81f3 FinLab \u96f2\u7aef\u7684\u7b56\u7565</li> <li>\u9700\u767b\u5165 FinLab \u5e33\u865f\uff08<code>finlab.login()</code>\uff09</li> <li>\u986f\u793a\u5404\u7b56\u7565\u7684\u5e74\u5316\u5831\u916c\u3001\u590f\u666e\u7387\u7b49\u7d71\u8a08\u6307\u6a19</li> </ul>"}, {"location": "reference/plot/#finlab.plot.StrategyReturnStats", "title": "finlab.plot.StrategyReturnStats", "text": "<pre><code>StrategyReturnStats(start_date, end_date, strategy_names=[], benchmark_return=None)\n</code></pre> <p>\u7e6a\u88fd\u7b56\u7565\u5831\u916c\u7387\u7d71\u8a08\u6bd4\u8f03\u5716</p> <p>\u76e3\u63a7\u7b56\u7565\u7fa4\u9ad4\u76f8\u5c0d\u5c0d\u6a19\u6307\u6578\u7684\u8868\u73fe\u3002</p> PARAMETER DESCRIPTION <code>start_date</code> <p>\u5831\u916c\u7387\u8a08\u7b97\u958b\u59cb\u65e5</p> <p> TYPE: <code>str</code> </p> <code>end_date</code> <p>\u5831\u916c\u7387\u8a08\u7b97\u7d50\u675f\u65e5</p> <p> TYPE: <code>str</code> </p> <code>strategy_names</code> <p>\u7528\u6236\u672c\u4eba\u7684\u7b56\u7565\u96c6\u8a2d\u5b9a\uff0c\u586b\u5165\u6b32\u7d0d\u5165\u7d71\u8a08\u7684\u7b56\u7565\u540d\u7a31\uff0c\u53ea\u9650\u5b9a\u81ea\u5df1\u7684\u7b56\u7565\u3002ex:<code>['\u81bd\u5c0f\u8c93','\u4e09\u983b\u7387RSI\u7b56\u7565', '\u4e8c\u6b21\u5275\u9ad8\u80a1\u7968',...]</code>\uff0c\u9810\u8a2d\u70ba\u5168\u90e8\u5df2\u4e0a\u50b3\u7684\u7b56\u7565\u3002</p> <p> TYPE: <code>list</code> DEFAULT: <code>[]</code> </p> <code>benchmark_return</code> <p>\u7b56\u7565\u6bd4\u5c0d\u57fa\u6e96\u5e8f\u5217\uff0c\u9810\u8a2d\u70ba\u53f0\u80a1\u52a0\u6b0a\u5831\u916c\u6307\u6578\u3002</p> <p> TYPE: <code>Series</code> DEFAULT: <code>None</code> </p> <p>Examples:</p> <pre><code>\u7d71\u8a082022-12-31~2023-07-31\u7684\u5831\u916c\u7387\u6578\u64da\n``` py\n# \u56de\u6e2c\u8d77\u59cb\u6642\u9593\nstart_date = '2022-12-31'\nend_date  = '2023-07-31'\n\n# \u9078\u5b9a\u7b56\u7565\u7bc4\u570d\nstrategy_names = ['\u81bd\u5c0f\u8c93','\u4e09\u983b\u7387RSI\u7b56\u7565', '\u4e8c\u6b21\u5275\u9ad8\u80a1\u7968', '\u4f4e\u6ce2\u52d5\u672c\u76ca\u6210\u9577\u6bd4', '\u5408\u7d04\u8ca0\u50b5\u5efa\u7bc9\u5de5', '\u591a\u7522\u696d\u50f9\u6295', '\u5c0f\u8766\u7c73\u8ddf\u5927\u9be8\u9b5a', '\u5c0f\u8cc7\u65cf\u8cc7\u512a\u751f\u7b56\u7565', '\u672c\u76ca\u6210\u9577\u6bd4', '\u71df\u6536\u80a1\u50f9\u96d9\u6e26\u8f2a', '\u73fe\u91d1\u6d41\u50f9\u503c\u6210\u9577', '\u7814\u767c\u9b54\u4eba', '\u80a1\u50f9\u6de8\u503c\u6bd4\u7b56\u7565', '\u85cf\u7352', '\u9ad8\u6b96\u5229\u7387\u70cf\u9f9c','\u76e3\u7344\u5154', '\u8ca1\u5831\u6307\u6a1920\u5927']\n\nreport = StrategyReturnStats(start_date ,end_date, strategy_names)\n# \u7e6a\u88fd\u7b56\u7565\u5831\u916c\u7387\u8fd1\u671f\u5831\u916c\u7387\u9577\u689d\u5716\nreport.plot_strategy_last_return().show()\n# \u7e6a\u88fd\u7b56\u7565\u7d2f\u7a4d\u5831\u916c\u7387\u6642\u9593\u5e8f\u5217\nreport.plot_strategy_creturn().show()\n```\n</code></pre>"}, {"location": "reference/plot/#finlab.plot.StrategyReturnStats.get_benchmark_return", "title": "get_benchmark_return", "text": "<pre><code>get_benchmark_return()\n</code></pre> <p>\u8a2d\u5b9a\u5c0d\u6a19\u6307\u6578 Returns:     (pandas.Series): \u5c0d\u6a19\u6307\u6578\u6642\u9593\u5e8f\u5217</p>"}, {"location": "reference/plot/#finlab.plot.StrategyReturnStats.plot_strategy_creturn", "title": "plot_strategy_creturn", "text": "<pre><code>plot_strategy_creturn()\n</code></pre> <p>\u7e6a\u88fd\u7b56\u7565\u7d2f\u7a4d\u5831\u916c\u7387\u6642\u9593\u5e8f\u5217 Returns:     (plotly.graph_objects.Figure): \u5716\u8868\u7269\u4ef6 </p>"}, {"location": "reference/plot/#finlab.plot.StrategyReturnStats.plot_strategy_last_return", "title": "plot_strategy_last_return", "text": "<pre><code>plot_strategy_last_return()\n</code></pre> <p>\u7e6a\u88fd\u7b56\u7565\u5831\u916c\u7387\u8fd1\u671f\u5831\u916c\u7387\u9577\u689d\u5716 Returns:     (plotly.graph_objects.Figure): \u5716\u8868\u7269\u4ef6 </p>"}, {"location": "reference/plot/#_6", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/plot/#q", "title": "Q: \u5716\u8868\u7121\u6cd5\u986f\u793a\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code># \u539f\u56e0 1\uff1a\u5fd8\u8a18\u547c\u53eb .show()\nfig = plot_tw_stock_candles('2330')\n# \u274c \u6c92\u6709\u986f\u793a\n\nfig = plot_tw_stock_candles('2330')\nfig.show()  # \u2705 \u6b63\u78ba\n\n# \u539f\u56e0 2\uff1a\u7f3a\u5c11 plotly \u5957\u4ef6\n# \u89e3\u6c7a\uff1apip install plotly\n\n# \u539f\u56e0 3\uff1aJupyter Notebook \u74b0\u5883\u554f\u984c\n# \u5728 notebook \u958b\u982d\u52a0\u5165\uff1a\nimport plotly.io as pio\npio.renderers.default = 'notebook'\n</code></pre>"}, {"location": "reference/plot/#q_1", "title": "Q: \u5982\u4f55\u532f\u51fa\u5716\u8868\u70ba\u5716\u7247\uff1f", "text": "<pre><code>fig = plot_tw_stock_candles('2330', recent_days=200)\n\n# \u532f\u51fa\u70ba PNG\nfig.write_image('chart.png', width=1200, height=800)\n\n# \u532f\u51fa\u70ba HTML\uff08\u53ef\u4e92\u52d5\uff09\nfig.write_html('chart.html')\n\n# \u6ce8\u610f\uff1a\u532f\u51fa PNG \u9700\u5b89\u88dd kaleido\n# pip install kaleido\n</code></pre>"}, {"location": "reference/plot/#q_2", "title": "Q: \u5982\u4f55\u5ba2\u88fd\u5316\u5716\u8868\u6a23\u5f0f\uff1f", "text": "<pre><code>fig = plot_tw_stock_candles('2330', recent_days=200)\n\n# \u4fee\u6539\u6a19\u984c\nfig.update_layout(title='\u53f0\u7a4d\u96fb\u80a1\u50f9\u8d70\u52e2')\n\n# \u4fee\u6539\u984f\u8272\u4e3b\u984c\nfig.update_layout(template='plotly_dark')  # \u6df1\u8272\u4e3b\u984c\n\n# \u8abf\u6574\u5716\u8868\u5927\u5c0f\nfig.update_layout(width=1200, height=600)\n\nfig.show()\n</code></pre>"}, {"location": "reference/plot/#q-item", "title": "Q: \u6a39\u72c0\u5716\u7684 item \u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b\u6b04\u4f4d\uff1f", "text": "<pre><code># \u6240\u6709 data.get() \u53ef\u53d6\u5f97\u7684\u6b04\u4f4d\u90fd\u53ef\u4ee5\u4f7f\u7528\n# \u5e38\u7528\u6b04\u4f4d\uff1a\n# - 'return_ratio' - \u5831\u916c\u7387\n# - 'turnover_ratio' - \u6210\u4ea4\u91cf\u6bd4\u7387\n# - 'price_earning_ratio:\u672c\u76ca\u6bd4' - \u672c\u76ca\u6bd4\n# - 'price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4' - \u80a1\u50f9\u6de8\u503c\u6bd4\n# - 'fundamental_features:\u71df\u696d\u6bdb\u5229\u7387' - \u71df\u696d\u6bdb\u5229\u7387\n\n# \u67e5\u8a62\u53ef\u7528\u6b04\u4f4d\nfrom finlab import data\ndata.search('fundamental')  # \u641c\u5c0b\u57fa\u672c\u9762\u6b04\u4f4d\n</code></pre>"}, {"location": "reference/plot/#q_3", "title": "Q: \u96f7\u9054\u5716\u986f\u793a\u6578\u503c\u5dee\u7570\u5f88\u5927\u600e\u9ebc\u8fa6\uff1f", "text": "<pre><code># \u4f7f\u7528 cut_bins \u53c3\u6578\u5c07\u6578\u503c\u6a19\u6e96\u5316\nplot_tw_stock_radar(\n    portfolio=['2330', '2454'],\n    feats=[\n        'fundamental_features:\u71df\u696d\u6bdb\u5229\u7387',      # \u7bc4\u570d 0-100\n        'fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387',  # \u7bc4\u570d 0-100\n        'fundamental_features:\u8ca0\u50b5\u6bd4\u7387'         # \u7bc4\u570d 0-300\n    ],\n    cut_bins=10  # \u5c07\u6240\u6709\u6307\u6a19\u5207\u5206\u70ba 10 \u500b\u7b49\u7d1a\uff080-10\uff09\n).show()\n</code></pre>"}, {"location": "reference/plot/#_7", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u8cc7\u6599\u8996\u89ba\u5316\u5b8c\u6574\u6559\u5b78 - Jupyter Notebook \u4e92\u52d5\u5f0f\u7bc4\u4f8b</li> <li>Plotly \u5b98\u65b9\u6587\u6a94 - \u9032\u968e\u5ba2\u88fd\u5316\u6280\u5de7</li> <li>\u56de\u6e2c\u5831\u544a\u8996\u89ba\u5316 - Report \u7269\u4ef6\u5167\u5efa\u7684\u5716\u8868</li> </ul>"}, {"location": "reference/portfolio/", "title": "finlab.portfolio", "text": "<p>\u591a\u7b56\u7565\u6295\u8cc7\u7d44\u5408\u7ba1\u7406\u6a21\u7d44\uff0c\u7528\u65bc\u5c07\u591a\u500b\u7b56\u7565\u7d44\u5408\u6210\u4e00\u500b\u6295\u8cc7\u7d44\u5408\uff0c\u4e26\u652f\u63f4\u96f2\u7aef\u540c\u6b65\u8207\u81ea\u52d5\u8abf\u5009\u3002</p>"}, {"location": "reference/portfolio/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u5206\u6563\u98a8\u96aa: \u7d44\u5408\u4e0d\u540c\u985e\u578b\u7b56\u7565\uff08\u52d5\u80fd + \u50f9\u503c + \u6210\u9577\uff09\uff0c\u964d\u4f4e\u55ae\u4e00\u7b56\u7565\u5931\u6548\u7684\u98a8\u96aa</li> <li>\u63d0\u5347\u7a69\u5b9a\u6027: \u55ae\u4e00\u7b56\u7565\u6ce2\u52d5\u5927\uff0c\u591a\u7b56\u7565\u7d44\u5408\u5f8c\u53ef\u6709\u6548\u964d\u4f4e\u6700\u5927\u56de\u64a4</li> <li>\u52d5\u614b\u8abf\u6574\u6b0a\u91cd: \u6839\u64da\u5e02\u5834\u72c0\u6cc1\u6216\u7b56\u7565\u8868\u73fe\uff0c\u5f48\u6027\u8abf\u6574\u5404\u7b56\u7565\u6bd4\u4f8b</li> <li>\u5be6\u76e4\u540c\u6b65: \u4f7f\u7528 PortfolioSyncManager \u81ea\u52d5\u66f4\u65b0\u6301\u5009\uff0c\u7121\u9700\u624b\u52d5\u7ba1\u7406</li> </ul>"}, {"location": "reference/portfolio/#vs", "title": "\u6295\u8cc7\u7d44\u5408 vs \u55ae\u7b56\u7565\u56de\u6e2c", "text": "\u7279\u6027 \u55ae\u7b56\u7565\u56de\u6e2c (sim) \u6295\u8cc7\u7d44\u5408 (Portfolio) \u9069\u7528\u5834\u666f \u55ae\u4e00\u7b56\u7565\u7814\u7a76 \u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406 \u8f38\u5165 position DataFrame \u591a\u500b Report \u7269\u4ef6 \u6b0a\u91cd\u5206\u914d \u81ea\u52d5\u7b49\u6b0a \u53ef\u81ea\u8a02\u5404\u7b56\u7565\u6b0a\u91cd \u98a8\u96aa\u63a7\u5236 \u55ae\u4e00\u7b56\u7565\u5c64\u7d1a \u7d44\u5408\u5c64\u7d1a\u518d\u5e73\u8861 \u96f2\u7aef\u540c\u6b65 \u4e0d\u652f\u63f4 \u652f\u63f4\uff08PortfolioSyncManager\uff09 \u8907\u96dc\u5ea6 \u2b50 \u7c21\u55ae \u2b50\u2b50\u2b50 \u4e2d\u7b49"}, {"location": "reference/portfolio/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/portfolio/#_3", "title": "\u57fa\u790e\u7528\u6cd5\uff1a\u7d44\u5408\u4e09\u500b\u7b56\u7565", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\nfrom finlab.portfolio import Portfolio\n\n# \u7b56\u7565 1\uff1a\u52d5\u80fd\u7b56\u7565\uff08\u7a81\u7834\u5747\u7dda\uff09\nclose = data.get('price:\u6536\u76e4\u50f9')\nma20 = close.average(20)\nposition1 = close &gt; ma20\nreport1 = sim(position1, resample='M', upload=False)\n\n# \u7b56\u7565 2\uff1a\u50f9\u503c\u7b56\u7565\uff08\u4f4e\u672c\u76ca\u6bd4\uff09\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\nposition2 = pb.is_smallest(100)  # \u9078\u6700\u5c0f 100 \u6a94\nreport2 = sim(position2, resample='M', upload=False)\n\n# \u7b56\u7565 3\uff1a\u71df\u6536\u6210\u9577\u7b56\u7565\nrev_yoy = data.get('monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)')\nposition3 = rev_yoy &gt; 20\nreport3 = sim(position3, resample='M', upload=False)\n\n# \u5efa\u7acb\u6295\u8cc7\u7d44\u5408\uff08\u6b0a\u91cd\uff1a40%, 30%, 30%\uff09\nportfolio = Portfolio({\n    '\u52d5\u80fd\u7b56\u7565': (report1, 0.4),\n    '\u50f9\u503c\u7b56\u7565': (report2, 0.3),\n    '\u71df\u6536\u6210\u9577': (report3, 0.3)\n})\n\n# \u56de\u6e2c\u7d44\u5408\u7e3e\u6548\nportfolio_report = portfolio.create_report()\nportfolio_report.display()\n\n# \u67e5\u770b\u7d44\u5408\u7d71\u8a08\nprint(f\"\u7d44\u5408\u5e74\u5316\u5831\u916c: {portfolio_report.stats['annual_return']:.2%}\")\nprint(f\"\u7d44\u5408\u590f\u666e\u7387: {portfolio_report.stats['daily_sharpe']:.2f}\")\nprint(f\"\u7d44\u5408\u6700\u5927\u56de\u64a4: {portfolio_report.stats['max_drawdown']:.2%}\")\n</code></pre>"}, {"location": "reference/portfolio/#_4", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406\u5b8c\u6574\u6d41\u7a0b\uff0c\u4e86\u89e3\uff1a</p> <ul> <li>\u7b56\u7565\u6b0a\u91cd\u512a\u5316\u65b9\u6cd5\uff08\u7b49\u6b0a\u3001\u98a8\u96aa\u5e73\u50f9\u3001\u6700\u5c0f\u6ce2\u52d5\uff09</li> <li>\u52d5\u614b\u8abf\u6574\u6b0a\u91cd\u7b56\u7565\uff08\u6839\u64da\u8fd1\u671f\u7e3e\u6548\uff09</li> <li>\u5be6\u76e4\u540c\u6b65\u5b8c\u6574\u6d41\u7a0b\uff08PortfolioSyncManager\uff09</li> <li>\u907f\u514d\u7b56\u7565\u76f8\u95dc\u6027\u904e\u9ad8\u7684\u6280\u5de7</li> </ul>"}, {"location": "reference/portfolio/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/portfolio/#portfolio", "title": "Portfolio", "text": "<p>\u6b0a\u91cd\u914d\u7f6e\u5efa\u8b70</p> <p>\u7b49\u6b0a\u914d\u7f6e\uff08\u9069\u5408\u7b56\u7565\u7279\u6027\u76f8\u4f3c\u6642\uff09: <pre><code># 3 \u500b\u7b56\u7565\u5404 1/3\nportfolio = Portfolio({\n    '\u7b56\u7565A': (report1, 1/3),\n    '\u7b56\u7565B': (report2, 1/3),\n    '\u7b56\u7565C': (report3, 1/3)\n})\n</code></pre></p> <p>\u98a8\u96aa\u5e73\u50f9\uff08\u6839\u64da\u7b56\u7565\u6ce2\u52d5\u5ea6\u53cd\u5411\u914d\u7f6e\uff09: <pre><code># \u8a08\u7b97\u5404\u7b56\u7565\u6ce2\u52d5\u5ea6\nvol1 = report1.get_returns().std()\nvol2 = report2.get_returns().std()\nvol3 = report3.get_returns().std()\n\n# \u53cd\u5411\u6b0a\u91cd\uff08\u6ce2\u52d5\u5c0f\u7684\u914d\u7f6e\u591a\uff09\ntotal_inv_vol = 1/vol1 + 1/vol2 + 1/vol3\nw1, w2, w3 = (1/vol1)/total_inv_vol, (1/vol2)/total_inv_vol, (1/vol3)/total_inv_vol\n\nportfolio = Portfolio({\n    '\u7b56\u7565A': (report1, w1),\n    '\u7b56\u7565B': (report2, w2),\n    '\u7b56\u7565C': (report3, w3)\n})\n</code></pre></p> <p>\u76ee\u6a19\u6ce2\u52d5\uff08\u8a2d\u5b9a\u7d44\u5408\u76ee\u6a19\u6ce2\u52d5\u7387\uff09: <pre><code># \u5148\u5efa\u7acb\u7b49\u6b0a\u7d44\u5408\nportfolio = Portfolio({\n    '\u7b56\u7565A': (report1, 0.5),\n    '\u7b56\u7565B': (report2, 0.5)\n})\n\n# \u8a08\u7b97\u7d44\u5408\u6ce2\u52d5\nport_report = portfolio.create_report()\nport_vol = port_report.get_returns().std()\n\n# \u8abf\u6574\u6b0a\u91cd\u4ee5\u9054\u6210\u76ee\u6a19\u6ce2\u52d5\uff08\u5982 15%\uff09\ntarget_vol = 0.15\nleverage = target_vol / port_vol  # \u69d3\u687f\u500d\u6578\n\n# \u91cd\u65b0\u914d\u7f6e\uff08\u9700\u78ba\u4fdd\u7e3d\u6b0a\u91cd &lt;= 1\uff09\nif leverage &lt;= 1:\n    portfolio = Portfolio({\n        '\u7b56\u7565A': (report1, 0.5 * leverage),\n        '\u7b56\u7565B': (report2, 0.5 * leverage)\n    })\n</code></pre></p> <p>\u5e38\u898b\u932f\u8aa4</p> <p>1. \u6b0a\u91cd\u7e3d\u548c\u4e0d\u70ba 1 <pre><code># \u932f\u8aa4\uff1a\u6b0a\u91cd\u7e3d\u548c = 0.9\nportfolio = Portfolio({\n    '\u7b56\u7565A': (report1, 0.4),\n    '\u7b56\u7565B': (report2, 0.5)  # \u274c \u7e3d\u548c 0.9\n})\n\n# \u6b63\u78ba\uff1a\u78ba\u4fdd\u6b0a\u91cd\u7e3d\u548c = 1\nportfolio = Portfolio({\n    '\u7b56\u7565A': (report1, 0.4),\n    '\u7b56\u7565B': (report2, 0.6)  # \u2705 \u7e3d\u548c 1.0\n})\n</code></pre></p> <p>2. \u7b56\u7565\u672a\u4e0a\u50b3\u81f3\u96f2\u7aef\uff08PortfolioSyncManager \u9700\u8981\uff09 <pre><code># \u932f\u8aa4\uff1areport \u672a\u4e0a\u50b3\nreport1 = sim(position1, resample='M', upload=False)  # \u274c\n\n# \u6b63\u78ba\uff1a\u4e0a\u50b3\u81f3\u96f2\u7aef\nreport1 = sim(position1, resample='M', upload=True)  # \u2705\n</code></pre></p> <p>3. \u7b56\u7565\u8abf\u5009\u6642\u9593\u4e0d\u4e00\u81f4 <pre><code># \u932f\u8aa4\uff1a\u4e0d\u540c\u8abf\u5009\u983b\u7387\nreport1 = sim(position1, resample='M')   # \u6708\u7dda\nreport2 = sim(position2, resample='W')   # \u9031\u7dda \u274c\n\n# \u6b63\u78ba\uff1a\u7d71\u4e00\u8abf\u5009\u983b\u7387\nreport1 = sim(position1, resample='M')   # \u6708\u7dda\nreport2 = sim(position2, resample='M')   # \u6708\u7dda \u2705\n</code></pre></p>"}, {"location": "reference/portfolio/#finlab.portfolio.Portfolio", "title": "finlab.portfolio.Portfolio", "text": "<pre><code>Portfolio(reports)\n</code></pre> <p>               Bases: <code>Report</code></p> <p>\u5efa\u69cb Portfolio \u7269\u4ef6\u3002</p> PARAMETER DESCRIPTION <code>- reports</code> <p>\u4ee3\u8868\u6295\u8cc7\u7d44\u5408\u7684\u5b57\u5178\uff0ckey \u70ba\u8cc7\u7522\u540d\u7a31\uff0cvalue \u662f\u56de\u6e2c\u5831\u544a\u8207\u90e8\u4f4d\u3002</p> <p> TYPE: <code>Dict[str, Tuple[Report, float]]</code> </p> Example <p>\u7d44\u5408\u591a\u500b\u7b56\u7565 <pre><code>from finlab import sim\nfrom finlab.portfolio import Portfolio\n\n# \u8acb\u53c3\u95b1 sim \u51fd\u6578\u7684\u6587\u4ef6\u4ee5\u7372\u53d6\u66f4\u591a\u4fe1\u606f\n# https://doc.finlab.tw/getting-start/\n\nreport_strategy1 = sim(...)\nreport_strategy2 = sim(...)\nreport_strategy3 = sim(...)\n\nportfolio = Portfolio({\n    'strategy1': (report_strategy1, 0.3),\n    'strategy2': (report_strategy2, 0.4),\n    'strategy3': (report_strategy3, 0.3),\n})\n</code></pre></p>"}, {"location": "reference/portfolio/#create_multi_asset_report", "title": "create_multi_asset_report()", "text": ""}, {"location": "reference/portfolio/#finlab.portfolio.create_multi_asset_report", "title": "finlab.portfolio.create_multi_asset_report", "text": "<pre><code>create_multi_asset_report(stock_list, **kwargs)\n</code></pre> <p>\u6839\u64da\u63d0\u4f9b\u7684\u80a1\u7968\u6e05\u55ae\u5275\u5efa\u591a\u8cc7\u7522\u5831\u544a\u3002 Create a multi-asset report based on the stock list provided.</p> PARAMETER DESCRIPTION <code>stock_list</code> <p>\u4e00\u500b\u4ee5\u80a1\u7968\u4ee3\u865f\u70ba key\uff0c\u6b0a\u91cd\u5927\u5c0f\u70ba value\u3002 A dictionary with stock id as key and weight as value.</p> <p> TYPE: <code>dict</code> </p> RETURNS DESCRIPTION <code>Report</code> <p>\u4e00\u500b\u5305\u542b\u56de\u6e2c\u7d50\u679c\u7684\u5831\u544a\u5c0d\u8c61\u3002A report object with the backtest result.</p> <p>Example:</p> <pre><code>&gt;&gt;&gt; from finlab.portfolio import create_multi_asset_report\n...\n...\n&gt;&gt;&gt; report = create_multi_asset_report({'2330': 0.5, '1101': 0.5})\n</code></pre>"}, {"location": "reference/portfolio/#create_report_from_cloud", "title": "create_report_from_cloud()", "text": ""}, {"location": "reference/portfolio/#finlab.portfolio.create_report_from_cloud", "title": "finlab.portfolio.create_report_from_cloud", "text": "<pre><code>create_report_from_cloud(strategy_id, user_id=None, market=None)\n</code></pre> <p>\u6839\u64da\u63d0\u4f9b\u7684\u7528\u6236ID\u548c\u7b56\u7565ID\u5275\u5efa\u5728\u7dda\u5831\u544a\u3002 Create an online report based on the user id and strategy id provided.</p> PARAMETER DESCRIPTION <code>user_id</code> <p>The user id.</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>strategy_id</code> <p>The</p> <p> TYPE: <code>str</code> </p>"}, {"location": "reference/portfolio/#portfoliosyncmanager", "title": "PortfolioSyncManager", "text": "<p>\u5be6\u76e4\u540c\u6b65\u6700\u4f73\u5be6\u8e10</p> <p>\u57fa\u672c\u8a2d\u5b9a: <pre><code>from finlab.portfolio import PortfolioSyncManager\n\n# \u521d\u59cb\u5316\uff08\u9700\u8981\u5148\u4e0a\u50b3\u7b56\u7565\u81f3\u96f2\u7aef\uff09\nmanager = PortfolioSyncManager(\n    report_ids=['report_id_1', 'report_id_2'],  # \u96f2\u7aef\u7b56\u7565 ID\n    weights=[0.5, 0.5],                         # \u6b0a\u91cd\n    total_balance=1000000                        # \u7e3d\u8cc7\u91d1 100 \u842c\n)\n\n# \u53d6\u5f97\u7576\u524d\u61c9\u6301\u6709\u7684\u80a1\u7968\u8207\u5f35\u6578\ncurrent_position = manager.get_position()\nprint(current_position)\n</code></pre></p> <p>\u5b9a\u6642\u66f4\u65b0\uff08\u5efa\u8b70\u6bcf\u65e5\u6536\u76e4\u5f8c\u57f7\u884c\uff09: <pre><code>import schedule\nimport time\n\ndef sync_portfolio():\n    manager = PortfolioSyncManager(\n        report_ids=['xxx', 'yyy'],\n        weights=[0.6, 0.4],\n        total_balance=1000000\n    )\n    position = manager.get_position()\n    # \u57f7\u884c\u4e0b\u55ae\u908f\u8f2f\uff08\u53c3\u8003 finlab.online\uff09\n    print(f\"\u66f4\u65b0\u6642\u9593: {time.strftime('%Y-%m-%d %H:%M:%S')}\")\n    print(position)\n\n# \u6bcf\u65e5\u6536\u76e4\u5f8c\u57f7\u884c\uff08\u5047\u8a2d 15:00\uff09\nschedule.every().day.at(\"15:00\").do(sync_portfolio)\n\nwhile True:\n    schedule.run_pending()\n    time.sleep(60)\n</code></pre></p> <p>\u96f2\u7aef\u540c\u6b65\u6ce8\u610f\u4e8b\u9805</p> <ol> <li>\u78ba\u4fdd\u7b56\u7565\u5df2\u4e0a\u50b3: \u4f7f\u7528 <code>report.upload()</code> \u6216 <code>sim(..., upload=True)</code></li> <li>\u6aa2\u67e5\u6301\u5009\u885d\u7a81: \u591a\u7b56\u7565\u53ef\u80fd\u540c\u6642\u6301\u6709/\u653e\u7a7a\u540c\u4e00\u80a1\u7968 <pre><code># Portfolio \u6703\u81ea\u52d5\u8655\u7406\u885d\u7a81\uff1a\n# - \u7b56\u7565 A: \u6301\u6709 2330 (20% \u6b0a\u91cd\uff0c\u7b56\u7565\u914d\u7f6e 40%)\n# - \u7b56\u7565 B: \u6301\u6709 2330 (15% \u6b0a\u91cd\uff0c\u7b56\u7565\u914d\u7f6e 60%)\n# \u2192 \u7d44\u5408\u5f8c\uff1a2330 \u7e3d\u6b0a\u91cd = 0.4 * 20% + 0.6 * 15% = 17%\n</code></pre></li> <li>\u5b9a\u671f\u6aa2\u67e5\u540c\u6b65\u72c0\u614b: \u78ba\u4fdd\u96f2\u7aef\u8cc7\u6599\u8207\u672c\u5730\u4e00\u81f4</li> </ol>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager", "title": "finlab.portfolio.PortfolioSyncManager", "text": "<pre><code>PortfolioSyncManager(data=None, start_with_empty=False)\n</code></pre> <p>\u6295\u8cc7\u7d44\u5408\u985e\u5225\uff0c\u7528\u65bc\u8a2d\u5b9a\u548c\u7372\u53d6\u6295\u8cc7\u7d44\u5408\u8cc7\u8a0a\u3002</p> ATTRIBUTE DESCRIPTION <code>path</code> <p>\u6295\u8cc7\u7d44\u5408\u8cc7\u8a0a\u7684\u5132\u5b58\u8def\u5f91\u3002</p> <p> TYPE: <code>str</code> </p> METHOD DESCRIPTION <code>set</code> <p>Dict[str, Tuple[int, Report]]): \u8a2d\u5b9a\u6295\u8cc7\u7d44\u5408\u7684\u51fd\u6578\u3002</p> <code>get_position</code> <p>\u7372\u53d6\u6301\u5009\u8cc7\u8a0a\u3002</p> <p>Examples:</p> <pre><code>from finlab.portfolio import Portfolio, PortfolioSyncManager\n\n# \u521d\u59cb\u5316\u6295\u8cc7\u7d44\u5408\nport = Portfolio({'\u7b56\u7565A': (report1, 0.3), '\u7b56\u7565B': (report2, 0.7)})\n\n# \u8a2d\u5b9a\u6295\u8cc7\u7d44\u5408\n# pm = PortfolioSyncManager.from_local() or \n# pm = PortfolioSyncManager.from_cloud()\npm = PortfolioSyncManager() \npm.update(port, total_balance=1000000)\npm.to_cloud() # pm.to_local()\n\nprint(pm)\n\n# \u4e0b\u55ae\naccount = ... # \u8acb\u53c3\u8003 Account \u7522\u751f\u65b9\u5f0f\npm.sync(account) # \u5e73\u76e4\u50f9\u683c\u4e0b\u55ae\n</code></pre> <p>\u5efa\u69cb\u6295\u8cc7\u7d44\u5408\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.clear", "title": "clear", "text": "<pre><code>clear()\n</code></pre> <p>\u6e05\u9664\u6301\u5009\u8cc7\u8a0a\u3002</p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.create_order_executor", "title": "create_order_executor", "text": "<pre><code>create_order_executor(account, at='close', consider_margin_as_asset=False, market_name=None, **kwargs)\n</code></pre> <p>\u540c\u6b65\u6301\u5009\u8cc7\u8a0a\u3002</p> PARAMETER DESCRIPTION <code>account</code> <p>\u4ea4\u6613\u5e33\u6236\u3002</p> <p> TYPE: <code>Account</code> </p> <code>consider_margin_as_asset</code> <p>\u662f\u5426\u5c07\u878d\u8cc7\u878d\u5238\u8996\u70ba\u8cc7\u7522\u3002\u9810\u8a2d\u70ba True\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> <code>market_name</code> <p>\u6307\u5b9a\u5e02\u5834\u540d\u7a31\u3002\u9810\u8a2d\u70ba None\uff0c\u4e5f\u5c31\u662f\u7372\u53d6\u6240\u6709\u5e02\u5834\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>market_order</code> <p>\u4ee5\u985e\u5e02\u50f9\u76e1\u91cf\u5373\u523b\u6210\u4ea4\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u6f32\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u8dcc\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>best_price_limit</code> <p>\u639b\u82ad\u6a02\u50f9\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u8dcc\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u6f32\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>view_only</code> <p>\u9810\u8a2d\u70ba False\uff0c\u6703\u5be6\u969b\u4e0b\u55ae\u3002\u82e5\u8a2d\u70ba True\uff0c\u4e0d\u6703\u4e0b\u55ae\uff0c\u53ea\u6703\u56de\u50b3\u6b32\u57f7\u884c\u7684\u59d4\u8a17\u55ae\u8cc7\u6599(dict)</p> <p> TYPE: <code>bool</code> </p> <code>extra_bid_pct</code> <p>\u4ee5\u8a72\u767e\u5206\u6bd4\u503c\u4e58\u4ee5\u50f9\u683c\u9032\u884c\u8ffd\u50f9\u4e0b\u55ae\uff0c\u5982\u8a2d\u5b9a\u70ba 0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 +(-)5% \u7684\u9650\u50f9\u9032\u8cb7\u5165(\u8ce3\u51fa)\uff0c\u4e5f\u5c31\u662f\u66f4\u6709\u6a5f\u6703\u53ef\u4ee5\u6210\u4ea4\uff0c\u4f46\u662f\u6210\u4ea4\u50f9\u683c\u53ef\u80fd\u4e0d\u7406\u60f3\uff1b \u5047\u5982\u8a2d\u5b9a\u70ba -0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 -(+)5% \u9032\u884c\u8cb7\u5165\u8ce3\u51fa\uff0c\u4e5f\u5c31\u662f\u9650\u50f9\u55ae\u5c07\u4e0d\u6703\u7acb\u5373\u6210\u4ea4\uff0c\u7136\u800c\u5047\u5982\u6210\u4ea4\u5f8c\uff0c\u50f9\u683c\u6bd4\u8f03\u7406\u60f3\u3002\u53c3\u6578\u6709\u6548\u7bc4\u570d\u70ba -0.1 \u5230 0.1 \u5167\u3002</p> <p> TYPE: <code>float</code> </p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.from_cloud", "title": "from_cloud  <code>classmethod</code>", "text": "<pre><code>from_cloud(name='default')\n</code></pre> <p>\u5f9e\u96f2\u7aef\u6a94\u6848\u521d\u59cb\u5316\u6295\u8cc7\u7d44\u5408\u3002</p> PARAMETER DESCRIPTION <code>path</code> <p>\u96f2\u7aef\u6a94\u6848\u7684\u8def\u5f91\u3002\u9810\u8a2d\u70ba 'default'\u3002</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>PortfolioSyncManager</code> <p>\u6295\u8cc7\u7d44\u5408\u985e\u5225\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.from_local", "title": "from_local  <code>classmethod</code>", "text": "<pre><code>from_local(name='default')\n</code></pre> <p>\u5f9e\u672c\u5730\u6a94\u6848\u521d\u59cb\u5316\u6295\u8cc7\u7d44\u5408\u3002</p> PARAMETER DESCRIPTION <code>path</code> <p>\u672c\u5730\u6a94\u6848\u7684\u8def\u5f91\u3002</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>PortfolioSyncManager</code> <p>\u6295\u8cc7\u7d44\u5408\u985e\u5225\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.from_path", "title": "from_path  <code>classmethod</code>", "text": "<pre><code>from_path(path)\n</code></pre> <p>\u5f9e\u672c\u5730\u6a94\u6848\u521d\u59cb\u5316\u6295\u8cc7\u7d44\u5408\u3002</p> PARAMETER DESCRIPTION <code>path</code> <p>\u672c\u5730\u6a94\u6848\u7684\u8def\u5f91\u3002</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>PortfolioSyncManager</code> <p>\u6295\u8cc7\u7d44\u5408\u985e\u5225\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.get_position", "title": "get_position", "text": "<pre><code>get_position(at='close', market_name=None)\n</code></pre> <p>\u7372\u53d6\u6301\u5009\u8cc7\u8a0a\u3002</p> PARAMETER DESCRIPTION <code>market_name</code> <p>\u6307\u5b9a\u5e02\u5834\u540d\u7a31\u3002\u9810\u8a2d\u70ba None\uff0c\u4e5f\u5c31\u662f\u7372\u53d6\u6240\u6709\u5e02\u5834\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <p>dict or Position: \u82e5 combined \u70ba True\uff0c\u5247\u8fd4\u56de\u5408\u4f75\u5f8c\u7684\u6301\u5009\u8cc7\u8a0a\uff08Position \u7269\u4ef6\uff09\uff1b                 \u82e5 combined \u70ba False\uff0c\u5247\u8fd4\u56de\u539f\u59cb\u6301\u5009\u8cc7\u8a0a\uff08dict\uff09\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.get_strategy_position", "title": "get_strategy_position", "text": "<pre><code>get_strategy_position(strategy_name, at)\n</code></pre> <p>\u7372\u53d6\u7b56\u7565\u7684\u958b\u5009\u90e8\u4f4d\u3002</p> PARAMETER DESCRIPTION <code>strategy_name</code> <p>\u7b56\u7565\u540d\u7a31\u3002</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>dict</code> <p>\u958b\u5009\u90e8\u4f4d\u8cc7\u8a0a\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.get_total_position", "title": "get_total_position", "text": "<pre><code>get_total_position()\n</code></pre> <p>\u56de\u50b3\u76ee\u524d\u6301\u5009\u7684 DataFrame\uff08\u8207 repr \u986f\u793a\u7684 df \u76f8\u540c\uff09\u3002</p> RETURNS DESCRIPTION <p>pd.DataFrame: \u6301\u5009\u8cc7\u8a0a\u7684 DataFrame\u3002</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.margin_cash_position_combine", "title": "margin_cash_position_combine  <code>staticmethod</code>", "text": "<pre><code>margin_cash_position_combine(acp, idp)\n</code></pre> <p>\u5408\u4f75\u73fe\u91d1\u8207\u4fdd\u8b49\u91d1\u90e8\u4f4d\u3002</p> PARAMETER DESCRIPTION <code>acp</code> <p>\u7576\u524d\u5e33\u6236\u7684\u80a1\u7968\u90e8\u4f4d\u3002</p> <p> TYPE: <code>Position</code> </p> <code>idp</code> <p>\u65b0\u7684\u5e33\u6236\u7684\u80a1\u7968\u90e8\u4f4d\u3002</p> <p> TYPE: <code>Position</code> </p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.sync", "title": "sync", "text": "<pre><code>sync(account, at='close', consider_margin_as_asset=True, market_name=None, **kwargs)\n</code></pre> <p>\u540c\u6b65\u6301\u5009\u8cc7\u8a0a\u3002</p> PARAMETER DESCRIPTION <code>account</code> <p>\u4ea4\u6613\u5e33\u6236\u3002</p> <p> TYPE: <code>Account</code> </p> <code>consider_margin_as_asset</code> <p>\u662f\u5426\u5c07\u4fdd\u8b49\u91d1\u4ea4\u6613\u8996\u70ba\u8cc7\u7522\u3002\u9810\u8a2d\u70ba True\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> <code>market_name</code> <p>\u6307\u5b9a\u5e02\u5834\u540d\u7a31\u3002\u9810\u8a2d\u70ba None\uff0c\u4e5f\u5c31\u662f\u7372\u53d6\u6240\u6709\u5e02\u5834\u3002</p> <p> TYPE: <code>str</code> DEFAULT: <code>None</code> </p> <code>market_order</code> <p>\u4ee5\u985e\u5e02\u50f9\u76e1\u91cf\u5373\u523b\u6210\u4ea4\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u6f32\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u8dcc\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>best_price_limit</code> <p>\u639b\u82ad\u6a02\u50f9\uff1a\u6240\u6709\u8cb7\u55ae\u639b\u8dcc\u505c\u50f9\uff0c\u6240\u6709\u8ce3\u55ae\u639b\u6f32\u505c\u50f9</p> <p> TYPE: <code>bool</code> </p> <code>view_only</code> <p>\u9810\u8a2d\u70ba False\uff0c\u6703\u5be6\u969b\u4e0b\u55ae\u3002\u82e5\u8a2d\u70ba True\uff0c\u4e0d\u6703\u4e0b\u55ae\uff0c\u53ea\u6703\u56de\u50b3\u6b32\u57f7\u884c\u7684\u59d4\u8a17\u55ae\u8cc7\u6599(dict)</p> <p> TYPE: <code>bool</code> </p> <code>extra_bid_pct</code> <p>\u4ee5\u8a72\u767e\u5206\u6bd4\u503c\u4e58\u4ee5\u50f9\u683c\u9032\u884c\u8ffd\u50f9\u4e0b\u55ae\uff0c\u5982\u8a2d\u5b9a\u70ba 0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 +(-)5% \u7684\u9650\u50f9\u9032\u8cb7\u5165(\u8ce3\u51fa)\uff0c\u4e5f\u5c31\u662f\u66f4\u6709\u6a5f\u6703\u53ef\u4ee5\u6210\u4ea4\uff0c\u4f46\u662f\u6210\u4ea4\u50f9\u683c\u53ef\u80fd\u4e0d\u7406\u60f3\uff1b \u5047\u5982\u8a2d\u5b9a\u70ba -0.05 \u6642\uff0c\u5c07\u4ee5\u7576\u524d\u50f9\u7684 -(+)5% \u9032\u884c\u8cb7\u5165\u8ce3\u51fa\uff0c\u4e5f\u5c31\u662f\u9650\u50f9\u55ae\u5c07\u4e0d\u6703\u7acb\u5373\u6210\u4ea4\uff0c\u7136\u800c\u5047\u5982\u6210\u4ea4\u5f8c\uff0c\u50f9\u683c\u6bd4\u8f03\u7406\u60f3\u3002\u53c3\u6578\u6709\u6548\u7bc4\u570d\u70ba -0.1 \u5230 0.1 \u5167\u3002</p> <p> TYPE: <code>float</code> </p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.to_cloud", "title": "to_cloud", "text": "<pre><code>to_cloud(name='default')\n</code></pre> <p>\u5c07\u6295\u8cc7\u7d44\u5408\u8cc7\u8a0a\u5b58\u81f3\u96f2\u7aef\u6a94\u6848\u3002</p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.to_local", "title": "to_local", "text": "<pre><code>to_local(name='default')\n</code></pre> <p>\u5c07\u6295\u8cc7\u7d44\u5408\u8cc7\u8a0a\u5b58\u81f3\u672c\u5730\u6a94\u6848\u3002</p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.to_path", "title": "to_path", "text": "<pre><code>to_path(path)\n</code></pre> <p>\u5c07\u6295\u8cc7\u7d44\u5408\u8cc7\u8a0a\u5b58\u81f3\u672c\u5730\u6a94\u6848\u3002</p> RETURNS DESCRIPTION <p>None</p>"}, {"location": "reference/portfolio/#finlab.portfolio.PortfolioSyncManager.update", "title": "update", "text": "<pre><code>update(portfolio, total_balance=0, rebalance_safety_weight=0.2, smooth_transition=None, force_override_difference=False, custom_position=None, excluded_stock_ids=None, excluded_symbols=None, **kwargs)\n</code></pre> <p>\u8a2d\u5b9a\u6295\u8cc7\u7d44\u5408\u7684\u51fd\u6578\u3002</p> PARAMETER DESCRIPTION <code>portfolio</code> <p>\u5305\u542b\u6295\u8cc7\u7d44\u5408\u8cc7\u8a0a\u7684\u5b57\u5178\u3002</p> <p> TYPE: <code>Portfolio</code> </p> <code>total_balance</code> <p>\u7e3d\u8cc7\u7522\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>0</code> </p> <code>rebalance_safety_weight</code> <p>\u73fe\u91d1\u7684\u6b0a\u91cd\uff0c\u78ba\u4fdd\u4ee5\u5e02\u50f9\u8cb7\u8ce3\u6642\uff0c\u65b0\u7684\u7b56\u7565\u7d44\u5408\u50f9\u503c\u4e0d\u8d85\u904e\u820a\u7684\u50f9\u503c\uff0c\u8a08\u7b97\u65b9\u5f0f\u70ba\uff1a\u8ce3\u51fa\u80a1\u7968\u5f8c\uff0c\u6709\u591a\u5c11\u6bd4\u4f8b\u8981\u8b8a\u6210\u73fe\u91d1(\u4f8b\u5982 20\uff05)\uff0c\u518d\u8cb7\u5165\u65b0\u7684\u80a1\u7968\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>0.2</code> </p> <code>smooth_transition</code> <p>\u662f\u5426\u53ea\u5728\u63db\u80a1\u65e5\u624d\u66f4\u65b0\uff0c\u9810\u8a2d\u70ba None\uff0c\u7cfb\u7d71\u6703\u81ea\u884c\u5224\u65b7\uff0c\u5047\u5982\u7b2c\u4e00\u6b21\u547c\u53eb\u51fd\u793a\uff0c\u6703\u662f False\uff0c\u4e4b\u5f8c\u6703\u662f True\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>None</code> </p> <code>force_override_difference</code> <p>\u662f\u5426\u5f37\u5236\u8986\u84cb\u4e0d\u540c\u7684\u90e8\u4f4d\uff0c\u9810\u8a2d\u70ba False\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> <code>custom_position</code> <p>\u81ea\u5b9a\u7fa9\u90e8\u4f4d\uff0c\u9810\u8a2d\u70ba None\u3002\u7576 custom_position \u4e0d\u70ba None \u6642\uff0c\u6703\u5c07 custom_position \u52a0\u5165\u5230\u90e8\u4f4d\u4e2d\u3002\u7a0b\u5f0f\u5728\u8a08\u7b97\u90e8\u4f4d\u6642\uff0c\u6703\u5c07 custom_position \u6392\u9664\u5728\u5916\uff0c\u4e0d\u5217\u5165\u3002</p> <p> TYPE: <code>Position or dict</code> DEFAULT: <code>None</code> </p> <code>excluded_stock_ids</code> <p>\u6392\u9664\u7684\u80a1\u7968\u4ee3\u78bc\u5217\u8868\u3002\u9810\u8a2d\u70ba None\u3002</p> <p> TYPE: <code>List[str]</code> DEFAULT: <code>None</code> </p> RETURNS DESCRIPTION <p>None</p> <p>Examples:</p> <pre><code>from finlab.backtest import sim\nfrom finlab.portfolio import Portfolio, OnlineReport\n\n# create report 1\nreport1 = sim(...) # \u8acb\u53c3\u8003\u56de\u6e2c\u8a9e\u6cd5\n\n# download online report\nreport2 = OnlineReport.from_cloud('strategyName') # \u4e0b\u8f09\u7b56\u7565\u5831\u544a\n\n# create portfolio\nportfolio = Portfolio({'\u7b56\u75651': (report1, 0.5), '\u7b56\u75652': (report2, 0.5)})\n\n# create PortfolioSyncManager\npm = PortfolioSyncManager.from_cloud()\npm.update(portfolio, total_balance=1000000, cash_weight=0.2) # \u6295\u8cc7 100 \u842c\u5143\n\n# create orders\naccount = ... # \u8acb\u53c3\u8003 Account \u7522\u751f\u65b9\u5f0f\npm.sync(account) # \u5e73\u76e4\u50f9\u683c\u4e0b\u55ae\npm.sync(account, market_order=True) # \u5e02\u50f9\u4e0b\u55ae\n</code></pre>"}, {"location": "reference/portfolio/#_5", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/portfolio/#q", "title": "Q: \u5982\u4f55\u8655\u7406\u7b56\u7565\u4e4b\u9593\u7684\u6301\u5009\u885d\u7a81\uff1f", "text": "<p>Portfolio \u6703\u81ea\u52d5\u8655\u7406\u6301\u5009\u885d\u7a81\uff1a</p> <pre><code># \u5047\u8a2d\u5169\u500b\u7b56\u7565\u540c\u6642\u6301\u6709 2330\n# \u7b56\u7565 A (\u6b0a\u91cd 40%): 2330 \u4f54 20%\n# \u7b56\u7565 B (\u6b0a\u91cd 60%): 2330 \u4f54 15%\n\nportfolio = Portfolio({\n    '\u7b56\u7565A': (report1, 0.4),\n    '\u7b56\u7565B': (report2, 0.6)\n})\n\n# \u7d44\u5408\u5f8c 2330 \u7684\u7e3d\u6b0a\u91cd = 0.4 * 0.20 + 0.6 * 0.15 = 0.17 (17%)\n</code></pre>"}, {"location": "reference/portfolio/#q_1", "title": "Q: \u5982\u4f55\u8a2d\u5b9a\u6700\u5927\u6301\u80a1\u6578\u9650\u5236\uff1f", "text": "<p>\u5728\u5404\u7b56\u7565\u56de\u6e2c\u6642\u4f7f\u7528 <code>is_largest()</code> \u9650\u5236\uff1a</p> <pre><code># \u7b56\u7565 1: \u6700\u591a 30 \u6a94\nposition1 = (close &gt; ma20).is_largest(30)\nreport1 = sim(position1, resample='M')\n\n# \u7b56\u7565 2: \u6700\u591a 20 \u6a94\nposition2 = (pb &lt; 1.5).is_largest(20)\nreport2 = sim(position2, resample='M')\n\n# \u7d44\u5408\u5f8c\u6700\u591a\u7d04 50 \u6a94\uff08\u53ef\u80fd\u6709\u91cd\u8907\u6301\u80a1\uff09\nportfolio = Portfolio({\n    '\u7b56\u75651': (report1, 0.5),\n    '\u7b56\u75652': (report2, 0.5)\n})\n</code></pre>"}, {"location": "reference/portfolio/#q_2", "title": "Q: \u5982\u4f55\u52d5\u614b\u8abf\u6574\u7b56\u7565\u6b0a\u91cd\uff1f", "text": "<pre><code># \u65b9\u6cd5 1: \u6839\u64da\u8fd1\u671f\u7e3e\u6548\u8abf\u6574\ndef dynamic_weights(reports, window=60):\n    \"\"\"\u6839\u64da\u8fd1 60 \u65e5\u8868\u73fe\u8abf\u6574\u6b0a\u91cd\"\"\"\n    recent_returns = []\n    for report in reports:\n        ret = report.get_returns().tail(window).mean()  # \u8fd1\u671f\u5e73\u5747\u5831\u916c\n        recent_returns.append(max(ret, 0))  # \u8ca0\u5831\u916c\u8a2d\u70ba 0\n\n    # \u6b78\u4e00\u5316\n    total = sum(recent_returns)\n    if total == 0:\n        return [1/len(reports)] * len(reports)  # \u7b49\u6b0a\n\n    return [r / total for r in recent_returns]\n\n# \u4f7f\u7528\u52d5\u614b\u6b0a\u91cd\nweights = dynamic_weights([report1, report2, report3], window=90)\nportfolio = Portfolio({\n    '\u7b56\u75651': (report1, weights[0]),\n    '\u7b56\u75652': (report2, weights[1]),\n    '\u7b56\u75653': (report3, weights[2])\n})\n</code></pre>"}, {"location": "reference/portfolio/#q_3", "title": "Q: \u7d44\u5408\u5f8c\u7e3e\u6548\u53cd\u800c\u8b8a\u5dee\uff1f", "text": "<p>\u53ef\u80fd\u539f\u56e0\u8207\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <ol> <li> <p>\u7b56\u7565\u76f8\u95dc\u6027\u904e\u9ad8:    <pre><code># \u6aa2\u67e5\u7b56\u7565\u76f8\u95dc\u6027\nreturns1 = report1.get_returns()\nreturns2 = report2.get_returns()\ncorrelation = returns1.corr(returns2)\nprint(f\"\u76f8\u95dc\u6027: {correlation:.2f}\")  # &gt; 0.8 \u8868\u793a\u9ad8\u5ea6\u76f8\u95dc\n\n# \u89e3\u6c7a\uff1a\u9078\u64c7\u76f8\u95dc\u6027\u4f4e\u7684\u7b56\u7565\uff08&lt; 0.5\uff09\n</code></pre></p> </li> <li> <p>\u6b0a\u91cd\u914d\u7f6e\u4e0d\u7576:    <pre><code># \u6aa2\u67e5\u5404\u7b56\u7565\u590f\u666e\u7387\nprint(f\"\u7b56\u7565 1 \u590f\u666e: {report1.stats['daily_sharpe']:.2f}\")\nprint(f\"\u7b56\u7565 2 \u590f\u666e: {report2.stats['daily_sharpe']:.2f}\")\n\n# \u7d66\u590f\u666e\u7387\u9ad8\u7684\u7b56\u7565\u66f4\u591a\u6b0a\u91cd\n</code></pre></p> </li> <li> <p>\u56de\u6e2c\u671f\u9593\u4e0d\u4e00\u81f4:    <pre><code># \u78ba\u4fdd\u6240\u6709\u7b56\u7565\u4f7f\u7528\u76f8\u540c\u7684\u56de\u6e2c\u671f\u9593\nimport finlab\nfinlab.truncate_start = '2018-01-01'\n\nreport1 = sim(position1, resample='M')\nreport2 = sim(position2, resample='M')\n# \u78ba\u4fdd\u5169\u500b report \u7684\u8d77\u59cb\u65e5\u671f\u4e00\u81f4\n</code></pre></p> </li> </ol>"}, {"location": "reference/portfolio/#_6", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406\u5b8c\u6574\u6d41\u7a0b - \u6df1\u5165\u6307\u5357</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5f9e\u7814\u7a76\u5230\u5be6\u76e4</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357 - \u7d44\u5408\u5c64\u7d1a\u98a8\u63a7</li> <li>\u5be6\u76e4\u4e0b\u55ae\u6559\u5b78\uff08\u591a\u7b56\u7565\uff09 - \u7d44\u5408\u5be6\u76e4\u57f7\u884c</li> <li>GitHub \u539f\u59cb\u78bc</li> </ul>"}, {"location": "reference/report/", "title": "finlab.report", "text": "<p>\u56de\u6e2c\u5831\u544a\u6a21\u7d44\uff0c<code>Report</code> \u7269\u4ef6\u7531 <code>sim()</code> \u51fd\u6578\u7522\u751f\uff0c\u5305\u542b\u5b8c\u6574\u7684\u56de\u6e2c\u7e3e\u6548\u8cc7\u8a0a\u3002</p>"}, {"location": "reference/report/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u67e5\u770b\u56de\u6e2c\u7e3e\u6548\uff08\u5e74\u5316\u5831\u916c\u3001\u590f\u666e\u7387\u3001\u6700\u5927\u56de\u64a4\uff09</li> <li>\u5206\u6790\u4ea4\u6613\u8a18\u9304\uff08\u9032\u51fa\u5834\u6642\u9593\u3001\u6301\u6709\u5929\u6578\u3001\u5831\u916c\u7387\uff09</li> <li>\u8996\u89ba\u5316\u6de8\u503c\u66f2\u7dda\u8207\u56de\u64a4</li> <li>\u5132\u5b58\u5831\u544a\u4f9b\u65e5\u5f8c\u67e5\u95b1</li> <li>\u4e0a\u50b3\u81f3 FinLab \u96f2\u7aef\u9032\u884c\u5be6\u76e4\u8ffd\u8e64</li> <li>\u57f7\u884c\u6df1\u5ea6\u5206\u6790\uff08\u6d41\u52d5\u6027\u3001\u9078\u80a1\u80fd\u529b\u3001\u6301\u80a1\u5206\u5e03\uff09</li> </ul>"}, {"location": "reference/report/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/report/#_3", "title": "\u57fa\u790e\u7528\u6cd5\uff1a\u7522\u751f\u4e26\u67e5\u770b\u5831\u544a", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u5efa\u7acb\u7b56\u7565\u4e26\u56de\u6e2c\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\n\n# \u7522\u751f\u56de\u6e2c\u5831\u544a\nreport = sim(position, resample='M')\n\n# \u986f\u793a\u5831\u544a\uff08\u5305\u542b\u8996\u89ba\u5316\u5716\u8868\uff09\nreport.display()\n</code></pre>"}, {"location": "reference/report/#_4", "title": "\u53d6\u5f97\u7e3e\u6548\u6307\u6a19", "text": "<pre><code># \u53d6\u5f97\u7e3e\u6548\u7d71\u8a08\uff08DataFrame\uff09\nstats = report.get_stats()\nprint(stats.head())\n\n# \u53d6\u5f97\u7e3e\u6548\u6307\u6a19\uff08\u5b57\u5178\uff09\nmetrics = report.get_metrics()\nprint(f\"\u5e74\u5316\u5831\u916c\u7387: {metrics['annual_return']:.2%}\")\nprint(f\"\u590f\u666e\u7387: {metrics['daily_sharpe']:.2f}\")\nprint(f\"\u6700\u5927\u56de\u64a4: {metrics['max_drawdown']:.2%}\")\n</code></pre>"}, {"location": "reference/report/#_5", "title": "\u67e5\u770b\u4ea4\u6613\u8a18\u9304", "text": "<pre><code># \u53d6\u5f97\u6240\u6709\u4ea4\u6613\u8a18\u9304\ntrades = report.get_trades()\nprint(f\"\u7e3d\u4ea4\u6613\u6b21\u6578: {len(trades)}\")\nprint(trades.head())\n\n# \u7be9\u9078\u7372\u5229\u4ea4\u6613\nprofitable_trades = trades[trades['returns'] &gt; 0]\nprint(f\"\u7372\u5229\u4ea4\u6613\u6bd4\u4f8b: {len(profitable_trades) / len(trades):.1%}\")\n</code></pre>"}, {"location": "reference/report/#_6", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u6b77\u53f2\u56de\u6e2c\u6559\u5b78\uff0c\u4e86\u89e3\uff1a - \u5b8c\u6574\u56de\u6e2c\u6d41\u7a0b - Report \u7269\u4ef6\u7684\u6240\u6709\u65b9\u6cd5 - \u7e3e\u6548\u6307\u6a19\u89e3\u8b80 - \u4ea4\u6613\u8a18\u9304\u5206\u6790</p>"}, {"location": "reference/report/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/report/#report", "title": "Report", "text": "<p>Report \u7269\u4ef6\u4e3b\u8981\u65b9\u6cd5\uff1a</p> \u65b9\u6cd5 \u8aaa\u660e \u5e38\u7528\u7a0b\u5ea6 <code>display()</code> \u986f\u793a\u5b8c\u6574\u5831\u544a\uff08\u542b\u8996\u89ba\u5316\u5716\u8868\uff09 \u2b50\u2b50\u2b50\u2b50\u2b50 <code>get_stats()</code> \u53d6\u5f97\u7e3e\u6548\u7d71\u8a08\uff08DataFrame\uff09 \u2b50\u2b50\u2b50\u2b50\u2b50 <code>get_metrics()</code> \u53d6\u5f97\u7e3e\u6548\u6307\u6a19\uff08\u5b57\u5178\uff09 \u2b50\u2b50\u2b50\u2b50\u2b50 <code>get_trades()</code> \u53d6\u5f97\u4ea4\u6613\u8a18\u9304\uff08DataFrame\uff09 \u2b50\u2b50\u2b50\u2b50\u2b50 <code>get_mae_mfe()</code> \u53d6\u5f97\u6700\u5927\u4e0d\u5229/\u6709\u5229\u504f\u79fb \u2b50\u2b50\u2b50\u2b50 <code>upload()</code> \u4e0a\u50b3\u81f3 FinLab \u96f2\u7aef \u2b50\u2b50\u2b50 <code>run_analysis()</code> \u57f7\u884c\u6df1\u5ea6\u5206\u6790\u6a21\u7d44 \u2b50\u2b50\u2b50 <code>to_pickle()</code> \u5132\u5b58\u5831\u544a\u70ba\u6a94\u6848 \u2b50\u2b50 <code>from_pickle()</code> \u5f9e\u6a94\u6848\u8f09\u5165\u5831\u544a \u2b50\u2b50"}, {"location": "reference/report/#finlab.analysis.Report", "title": "finlab.analysis.Report", "text": "<pre><code>Report(creturn, position, fee_ratio, tax_ratio, trade_at, next_trading_date, market)\n</code></pre> <p>               Bases: <code>Report</code></p> <p>\u7b56\u7565\u56de\u6e2c\u57fa\u790e\u5831\u544a Args:   creturn (pd.Series): \u7b56\u7565\u5831\u916c\u7387\u6642\u9593\u5e8f\u5217\u3002   position (pd.DataFrame): \u7b56\u7565\u5831\u916c\u7387\u6642\u9593\u5e8f\u5217\u3002   fee_ratio (float): \u4ea4\u6613\u624b\u7e8c\u8cbb\u7387\uff0c\u9810\u8a2d\u70ba\u53f0\u7063\u7121\u6253\u6298\u624b\u7e8c\u8cbb 0.001425\u3002\u53ef\u8996\u500b\u4eba\u4f7f\u7528\u7684\u5238\u5546\u512a\u60e0\u8abf\u6574\u8cbb\u7387\u3002   tax_ratio (float): \u4ea4\u6613\u7a05\u7387\uff0c\u9810\u8a2d\u70ba\u53f0\u7063\u666e\u901a\u80a1\u4e00\u822c\u4ea4\u6613\u4ea4\u6613\u7a05\u7387 0.003\u3002\u82e5\u4ea4\u6613\u7b56\u7565\u7684\u6a19\u7684\u7686\u70ba ETF\uff0c\u8a18\u5f97\u8a2d\u6210 0.001\u3002   trade_at (str): \u9078\u64c7\u56de\u6e2c\u4e4b\u9084\u539f\u80a1\u50f9\u4ee5\u6536\u76e4\u50f9\u6216\u958b\u76e4\u50f9\u8a08\u7b97\uff0c\u9810\u8a2d\u70ba close\u3002\u53ef\u9078 close \u6216 open\u3002   next_trading_date (str): \u9810\u671f\u4e0b\u671f\u63db\u80a1\u65e5\u3002   market (str or Market): \u53ef\u9078\u64c7<code>'TWSTOCK', 'CRYPTO'</code>\uff0c\u5206\u5225\u70ba\u53f0\u80a1\u6216\u52a0\u5bc6\u8ca8\u5e63\uff0c                                                              \u6216\u7e7c\u627f <code>finlab.market.Market</code> \u958b\u767c\u56de\u6e2c\u5e02\u5834\u985e\u5225\u3002 Attributes:   benchmark (pd.Series): \u5c0d\u6a19\u5831\u916c\u7387\u66f2\u7dda\u7684\u6642\u9593\u5e8f\u5217\uff0c\u7528\u65bc Report.display() \u986f\u793a\u7b56\u7565\u5831\u916c\u7387\u6bd4\u8f03\u6a19\u6e96\u3002   update_date (str): \u7528\u65bc Report.display() \u986f\u793a\u7b56\u7565\u5c0d\u6a19\u7684\u5831\u916c\u7387\u66f2\u7dda\u3002   asset_type (str): \u8cc7\u7522\u985e\u5225\uff0c tw_stock \u6216 crypto\u3002   last_trading_date (str): \u6700\u8fd1\u7522\u751f\u4ea4\u6613\u8a0a\u865f\u7684\u65e5\u671f\u3002</p>"}, {"location": "reference/report/#finlab.analysis.Report.display", "title": "display", "text": "<pre><code>display(return_fig=False)\n</code></pre> <p>\u986f\u793a\u56de\u6e2c\u5831\u916c\u7387\u5716\u7d44 Args:    return_fig (bool): \u662f\u5426\u56de\u50b3\u5716\u7d44 Returns:   (plotly.graph_objects.Figure): \u5716\u7d44</p> <p>Examples:</p> <p>\u8a2d\u5b9a\u5c0d\u6a19\u6307\u6578 <pre><code>from finlab import data\n...\nreport = sim(position, resample='Q',mae_mfe_window=30,mae_mfe_window_step=2)\nreport.benchmark = data.get('benchmark_return:\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578').squeeze()\nreport.display()\n</code></pre> </p>"}, {"location": "reference/report/#finlab.analysis.Report.display_mae_mfe_analysis", "title": "display_mae_mfe_analysis", "text": "<pre><code>display_mae_mfe_analysis(violinmode='group', mfe_scatter_x='mae', **kwargs)\n</code></pre> <p>\u986f\u793a\u6ce2\u52d5\u5206\u6790\u5716\u7d44</p> <p>\u5206\u6790\u4f7f\u7528\u8aaa\u660e\u3002 Args:   violinmode (str): violin \u578b\u614b\u7d71\u8a08\u5716\u6a23\u5f0f\uff0c\u6a21\u5f0f\u5206\u70ba group \u8207 overlay\u3002                     \u9810\u8a2d\u70ba group\uff0cgroup \u6a21\u5f0f\u70ba\u5c07\u4ea4\u6613\u52dd\u6557\u5206\u7fa4\u7d71\u8a08'\uff0coverlay \u63a1\u53d6\u5168\u6578\u7d71\u8a08\u3002   mfe_scatter_x (str): \u5b50\u5716 2-1\u30012-2 MFE \u6563\u9ede\u5716\u7684X\u8ef8\u6bd4\u8f03\u9805\u76ee\u8a2d\u5b9a\uff0c\u53ef\u9078<code>'mae' or 'return'</code>\u3002   **kwargs (dict): \u5176\u9918\u5716\u8868\u5916\u89c0(layout)\u53c3\u6578\u3002 Returns:   (plotly.graph_objects.Figure): \u6ce2\u52d5\u5206\u6790\u5716\u7d44</p> <p>Examples:</p> <p>group : </p> <p>overlay : </p>"}, {"location": "reference/report/#finlab.analysis.Report.from_pickle", "title": "from_pickle  <code>classmethod</code>", "text": "<pre><code>from_pickle(file_path)\n</code></pre> <p>\u8b80\u53d6\u56de\u6e2c\u5831\u544a</p> PARAMETER DESCRIPTION <code>file_path</code> <p>\u6a94\u6848\u8def\u5f91</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>Report</code> <p>\u56de\u6e2c\u5831\u544a\u7269\u4ef6</p>"}, {"location": "reference/report/#finlab.analysis.Report.get_mae_mfe", "title": "get_mae_mfe", "text": "<pre><code>get_mae_mfe()\n</code></pre> <p>\u53d6\u5f97 mae_mfe \u6642\u5e8f\u8cc7\u6599</p> RETURNS DESCRIPTION <code>DataFrame</code> <p>\u6ce2\u52d5\u6642\u5e8f\u8cc7\u6599</p>"}, {"location": "reference/report/#finlab.analysis.Report.get_metrics", "title": "get_metrics", "text": "<pre><code>get_metrics(stats_=None, riskfree_rate=0.02)\n</code></pre> <p>Get the metrics of the backtest result.</p> PARAMETER DESCRIPTION <code>stats_</code> <p>\u56de\u6e2c\u7d50\u679c\u7684\u7d71\u8a08\u6578\u64da\u3002\u5982\u679c\u70ba None\uff0c\u5247\u6703\u8a08\u7b97\u7d71\u8a08\u6578\u64da\u3002</p> <p> TYPE: <code>dict</code> DEFAULT: <code>None</code> </p> <code>riskfree_rate</code> <p>\u7121\u98a8\u96aa\u5229\u7387\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>0.02</code> </p> <p>Returns:</p> <pre><code>dict: \u56de\u6e2c\u7d50\u679c\u7684\u6307\u6a19:\n    - backtest (dict): \u56de\u6e2c\u4fe1\u606f\u3002\n        - startDate (int): \u56de\u6e2c\u958b\u59cb\u65e5\u671f\u3002\n        - endDate (int): \u56de\u6e2c\u7d50\u675f\u65e5\u671f\u3002\n        - version (str): \u56de\u6e2c\u7248\u672c\u3002\n        - feeRatio (float): \u624b\u7e8c\u8cbb\u6bd4\u7387\u3002\n        - taxRatio (float): \u7a05\u6536\u6bd4\u7387\u3002\n        - tradeAt (str): \u4ea4\u6613\u6642\u9593\u3002\n        - market (str): \u5e02\u5834\u3002\n        - freq (str): \u983b\u7387\u3002\n    - profitability (dict): \u76c8\u5229\u6307\u6a19\u3002\n        - annualReturn (float): \u5e74\u56de\u5831\u7387\u3002\n        - alpha (float): \u963f\u723e\u6cd5\u503c\u3002\n        - beta (float): \u8c9d\u5854\u503c\u3002\n        - avgNStock (float): \u5e73\u5747\u80a1\u7968\u6578\u91cf\u3002\n        - maxNStock (float): \u6700\u5927\u80a1\u7968\u6578\u91cf\u3002\n    - risk (dict): \u98a8\u96aa\u6307\u6a19\u3002\n        - maxDrawdown (float): \u6700\u5927\u56de\u64a4\u3002\n        - avgDrawdown (float): \u5e73\u5747\u56de\u64a4\u3002\n        - avgDrawdownDays (float): \u5e73\u5747\u56de\u64a4\u5929\u6578\u3002\n        - valueAtRisk (float): \u5728\u96aa\u50f9\u503c\u3002\n        - cvalueAtRisk (float): \u689d\u4ef6\u5728\u96aa\u50f9\u503c\u3002\n    - ratio (dict): \u6bd4\u7387\u6307\u6a19\u3002\n        - sharpeRatio (float): \u590f\u666e\u6bd4\u7387\u3002\n        - sortinoRatio (float): \u7d22\u63d0\u8afe\u6bd4\u7387\u3002\n        - calmarRatio (float): \u5361\u723e\u746a\u6bd4\u7387\u3002\n        - volatility (float): \u6ce2\u52d5\u7387\u3002\n        - profitFactor (float): \u5229\u6f64\u56e0\u5b50\u3002\n        - tailRatio (float): \u5c3e\u6bd4\u7387\u3002\n    - winrate (dict): \u52dd\u7387\u6307\u6a19\u3002\n        - winRate (float): \u52dd\u7387\u3002\n        - m12WinRate (float): 12\u500b\u6708\u52dd\u7387\u3002\n        - expectancy (float): \u671f\u671b\u503c\u3002\n        - mae (float): \u6700\u5927\u4e0d\u5229\u504f\u96e2\u3002\n        - mfe (float): \u6700\u5927\u6709\u5229\u504f\u96e2\u3002\n    - liquidity (dict): \u6d41\u52d5\u6027\u6307\u6a19\u3002\n        - capacity (float): \u5bb9\u91cf\u3002\n        - disposalStockRatio (float): \u8655\u7f6e\u80a1\u7968\u6bd4\u7387\u3002\n        - warningStockRatio (float): \u8b66\u544a\u80a1\u7968\u6bd4\u7387\u3002\n        - fullDeliveryStockRatio (float): \u5b8c\u5168\u4ea4\u5272\u80a1\u7968\u6bd4\u7387\u3002\n</code></pre>"}, {"location": "reference/report/#finlab.analysis.Report.get_stats", "title": "get_stats", "text": "<pre><code>get_stats(resample='1d', riskfree_rate=0.02)\n</code></pre> <p>\u53d6\u5f97\u7b56\u7565\u7d71\u8a08\u6578\u64da \u53d6\u5f97\u6578\u64da\u5982\uff1a\u5e74\u5316\u5831\u916c\u3001\u52dd\u7387\u3001\u590f\u666e\u7387\u3001\u7d22\u63d0\u8afe\u6bd4\u7387\u3001\u6700\u5927\u56de\u6a94\u3001\u8fd1\u671f\u5404\u5e74\u6708\u5831\u916c\u7387\u7d71\u8a08\u3001alpha_beta... Args:     resample (str): \u5831\u916c\u7387\u6aa2\u6e2c\u9031\u671f\uff0c\u5176\u4ed6\u5e38\u7528\u6578\u503c\u70ba W\u3001 M \u3001Q\uff08\u6bcf\u9031\u3001\u6bcf\u6708\u3001\u6bcf\u5b63\u63db\u80a1\uff09\u3002     riskfree_rate (float): \u7121\u98a8\u96aa\u5229\u7387\uff0c\u8207\u590f\u666e\u7387\u8a08\u7b97\u6709\u95dc\u3002 Returns:     (dict): \u7b56\u7565\u6307\u6a19\u6578\u64da</p>"}, {"location": "reference/report/#finlab.analysis.Report.get_trades", "title": "get_trades", "text": "<pre><code>get_trades()\n</code></pre> <p>\u53d6\u5f97\u56de\u6e2c\u9010\u7b46\u4ea4\u6613\u7d00\u9304</p> RETURNS DESCRIPTION <code>DataFrame</code> <p>\u4ea4\u6613\u7d00\u9304\uff0c\u6b04\u4f4d\u5305\u542b\uff1a</p> <ul> <li>entry_sig_date:\u9032\u5834\u8a0a\u865f\u7522\u751f\u65e5\u3002</li> <li>exit_sig_date:\u51fa\u5834\u8a0a\u865f\u7522\u751f\u65e5\u3002</li> <li>entry_date:\u9032\u5834\u65e5\u3002</li> <li>exit_date:\u51fa\u5834\u65e5\u3002</li> <li>position:\u6301\u6709\u4f54\u6bd4\u3002</li> <li>period:\u6301\u6709\u5929\u6578\u3002</li> <li>return:\u5831\u916c\u7387\u3002</li> <li>trade_price@entry_date:\u9032\u5834\u50f9\u3002</li> <li>trade_price@exit_date:\u51fa\u5834\u50f9\u3002</li> <li>mae:\u6301\u6709\u671f\u9593\u6700\u5927\u4e0d\u5229\u5831\u916c\u7387\u5e45\u5ea6\u3002</li> <li>gmfe:\u6301\u6709\u671f\u9593\u6700\u5927\u6709\u5229\u5831\u916c\u7387\u5e45\u5ea6\u3002</li> <li>bmfe:mae\u767c\u751f\u524d\u7684\u6700\u5927\u6709\u5229\u5831\u916c\u7387\u5e45\u5ea6\u3002</li> <li>mdd:\u6301\u6709\u671f\u9593\u6700\u5927\u56de\u64a4\u3002</li> <li>pdays:\u8655\u65bc\u7372\u5229\u6642\u7684\u5929\u6578\u3002</li> </ul>"}, {"location": "reference/report/#finlab.analysis.Report.is_rebalance_due", "title": "is_rebalance_due", "text": "<pre><code>is_rebalance_due()\n</code></pre> <p>\u5224\u65b7\u662f\u5426\u9700\u8981\u63db\u80a1</p> RETURNS DESCRIPTION <code>bool</code> <p>\u662f\u5426\u9700\u8981\u63db\u80a1</p>"}, {"location": "reference/report/#finlab.analysis.Report.is_stop_triggered", "title": "is_stop_triggered", "text": "<pre><code>is_stop_triggered()\n</code></pre> <p>\u5224\u65b7\u662f\u5426\u9700\u8981\u505c\u640d\u505c\u5229</p> RETURNS DESCRIPTION <code>bool</code> <p>\u662f\u5426\u89f8\u767c\u505c\u640d\u505c\u5229</p>"}, {"location": "reference/report/#finlab.analysis.Report.position_info", "title": "position_info", "text": "<pre><code>position_info()\n</code></pre> <p>\u53d6\u5f97\u8fd1\u671f\u6301\u6709\u90e8\u4f4d\u8207\u9810\u671f\u63db\u80a1\u8cc7\u8a0a Returns:   (dict): \u90e8\u4f4d\u8cc7\u8a0a</p>"}, {"location": "reference/report/#finlab.analysis.Report.run_analysis", "title": "run_analysis", "text": "<pre><code>run_analysis(analysis, display=True, **kwargs)\n</code></pre> <p>\u57f7\u884c\u7b56\u7565\u5206\u6790\u5916\u639b\u6a21\u7d44 Args:   analysis (str or object): <code>finlab.analysis</code>\u5167\u7684\u5206\u6790\u6a21\u7d44\u540d\u7a31\uff0cex:<code>'liquidityAnalysis'</code>\u3002   display (bool): \u662f\u5426\u986f\u793a\u6a21\u7d44\u5206\u6790\u5716\u8868\u3002   **kwargs (mapping, optional): \u5206\u6790\u6a21\u7d44\u53c3\u6578\u8abf\u6574\u3002 Returns:   (pd.DataFrame or plotly.graph_objects.Figure): \u5206\u6790\u7d50\u679c</p>"}, {"location": "reference/report/#finlab.analysis.Report.to_pickle", "title": "to_pickle", "text": "<pre><code>to_pickle(file_path)\n</code></pre> <p>\u5132\u5b58\u56de\u6e2c\u5831\u544a</p> PARAMETER DESCRIPTION <code>file_path</code> <p>\u5132\u5b58\u8def\u5f91</p> <p> TYPE: <code>str</code> </p>"}, {"location": "reference/report/#finlab.analysis.Report.to_terminal", "title": "to_terminal", "text": "<pre><code>to_terminal(height=12, width=80, show_benchmark=True, show_drawdown=True)\n</code></pre> <p>\u5728\u7d42\u7aef\u986f\u793a\u7d2f\u7a4d\u5831\u916c\u5716\u8868\u8207\u56de\u64a4</p> PARAMETER DESCRIPTION <code>height</code> <p>\u5716\u8868\u9ad8\u5ea6\uff08\u884c\u6578\uff09\uff0c\u9810\u8a2d 12</p> <p> DEFAULT: <code>12</code> </p> <code>width</code> <p>\u5716\u8868\u5bec\u5ea6\uff08\u8cc7\u6599\u9ede\u6578\uff09\uff0c\u9810\u8a2d 80</p> <p> DEFAULT: <code>80</code> </p> <code>show_benchmark</code> <p>\u662f\u5426\u986f\u793a\u5c0d\u7167\u57fa\u6e96\uff0c\u9810\u8a2d True</p> <p> DEFAULT: <code>True</code> </p> <code>show_drawdown</code> <p>\u662f\u5426\u986f\u793a\u56de\u64a4\u5716\uff0c\u9810\u8a2d True</p> <p> DEFAULT: <code>True</code> </p> <p>Examples:</p> <pre><code>report = sim(position)\nreport.to_terminal()\n\n# \u81ea\u8a02\u9ad8\u5ea6\u8207\u5bec\u5ea6\nreport.to_terminal(height=8, width=60)\n\n# \u4e0d\u986f\u793a benchmark \u548c drawdown\nreport.to_terminal(show_benchmark=False, show_drawdown=False)\n</code></pre>"}, {"location": "reference/report/#finlab.analysis.Report.to_text", "title": "to_text", "text": "<pre><code>to_text()\n</code></pre> <p>\u5c07\u56de\u6e2c\u5831\u544a\u4ee5\u6587\u5b57\u65b9\u5f0f\u5448\u73fe</p> RETURNS DESCRIPTION <code>str</code> <p>\u6587\u5b57\u683c\u5f0f\u7684\u56de\u6e2c\u5831\u544a</p>"}, {"location": "reference/report/#finlab.analysis.Report.upload", "title": "upload", "text": "<pre><code>upload(name=None)\n</code></pre> <p>\u4e0a\u50b3\u56de\u6e2c\u5831\u544a\u8cc7\u6599\u5230\u91cf\u5316\u5e73\u53f0\u7db2\u7ad9 Args:   name (str): \u7b56\u7565\u540d\u7a31\u3002</p>"}, {"location": "reference/report/#display", "title": "display()", "text": "<p>\u986f\u793a\u5b8c\u6574\u56de\u6e2c\u5831\u544a\uff0c\u5305\u542b\u8996\u89ba\u5316\u5716\u8868\u8207\u7e3e\u6548\u6307\u6a19\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u57fa\u790e\u7528\u6cd5\nreport.display()\n\n# \u56de\u50b3 plotly figure \u7269\u4ef6\u4f9b\u9032\u4e00\u6b65\u5ba2\u88fd\u5316\nfig = report.display(return_fig=True)\nfig.update_layout(title='\u6211\u7684\u7b56\u7565\u56de\u6e2c')\nfig.show()\n</code></pre> <p>\u986f\u793a\u5167\u5bb9\uff1a - \u6de8\u503c\u66f2\u7dda\uff08\u7b56\u7565 vs \u57fa\u6e96\uff09 - \u56de\u64a4\u66f2\u7dda - \u7e3e\u6548\u6307\u6a19\u8868\u683c\uff08\u5e74\u5316\u5831\u916c\u3001\u590f\u666e\u7387\u3001\u6700\u5927\u56de\u64a4\u7b49\uff09</p>"}, {"location": "reference/report/#get_stats", "title": "get_stats()", "text": "<p>\u53d6\u5f97\u6642\u9593\u5e8f\u5217\u7684\u7e3e\u6548\u7d71\u8a08\u8cc7\u6599\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u53d6\u5f97\u6bcf\u65e5\u7e3e\u6548\u7d71\u8a08\nstats = report.get_stats(resample='1d')\nprint(stats.head())\n\n# \u53d6\u5f97\u6bcf\u6708\u7e3e\u6548\u7d71\u8a08\nmonthly_stats = report.get_stats(resample='1M')\nprint(monthly_stats.tail(12))  # \u67e5\u770b\u6700\u8fd1 12 \u500b\u6708\n\n# \u53d6\u5f97\u6bcf\u5e74\u7e3e\u6548\u7d71\u8a08\nyearly_stats = report.get_stats(resample='1Y')\nprint(yearly_stats)\n\n# \u67e5\u770b\u7279\u5b9a\u6b04\u4f4d\nprint(f\"\u7d2f\u7a4d\u5831\u916c: {stats['acc_returns'].iloc[-1]:.2%}\")\nprint(f\"\u6700\u5927\u56de\u64a4: {stats['drawdown'].min():.2%}\")\n</code></pre> <p>\u56de\u50b3 DataFrame \u6b04\u4f4d\uff1a - <code>returns</code>: \u55ae\u671f\u5831\u916c\u7387 - <code>acc_returns</code>: \u7d2f\u7a4d\u5831\u916c\u7387 - <code>drawdown</code>: \u56de\u64a4\uff08\u5f9e\u9ad8\u9ede\u7684\u8dcc\u5e45\uff09 - <code>volatility</code>: \u6ce2\u52d5\u7387 - <code>sharpe</code>: \u590f\u666e\u7387 - <code>benchmark_returns</code>: \u57fa\u6e96\u5831\u916c\u7387\uff08\u5982\u6709\uff09</p>"}, {"location": "reference/report/#get_metrics", "title": "get_metrics()", "text": "<p>\u53d6\u5f97\u6574\u9ad4\u7e3e\u6548\u6307\u6a19\uff08\u55ae\u4e00\u6578\u503c\uff09\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u53d6\u5f97\u7e3e\u6548\u6307\u6a19\nmetrics = report.get_metrics()\n\n# \u5e38\u7528\u6307\u6a19\nprint(f\"\u5e74\u5316\u5831\u916c\u7387: {metrics['annual_return']:.2%}\")\nprint(f\"\u590f\u666e\u7387: {metrics['daily_sharpe']:.2f}\")\nprint(f\"\u6700\u5927\u56de\u64a4: {metrics['max_drawdown']:.2%}\")\nprint(f\"\u52dd\u7387: {metrics['win_rate']:.2%}\")\nprint(f\"\u7e3d\u4ea4\u6613\u6b21\u6578: {metrics['total_trades']}\")\n\n# \u67e5\u770b\u6240\u6709\u6307\u6a19\nfor key, value in metrics.items():\n    print(f\"{key}: {value}\")\n</code></pre> <p>\u4e3b\u8981\u6307\u6a19\u8aaa\u660e\uff1a</p> \u6307\u6a19 \u8aaa\u660e \u7406\u60f3\u503c <code>annual_return</code> \u5e74\u5316\u5831\u916c\u7387 &gt; 10% <code>daily_sharpe</code> \u590f\u666e\u7387\uff08\u65e5\u983b\u8a08\u7b97\uff09 &gt; 1.0 <code>max_drawdown</code> \u6700\u5927\u56de\u64a4 &lt; 20% <code>win_rate</code> \u52dd\u7387\uff08\u7372\u5229\u4ea4\u6613\u6bd4\u4f8b\uff09 &gt; 50% <code>total_trades</code> \u7e3d\u4ea4\u6613\u6b21\u6578 - <code>avg_holding_period</code> \u5e73\u5747\u6301\u6709\u5929\u6578 - <code>profit_factor</code> \u7372\u5229\u56e0\u5b50\uff08\u7e3d\u7372\u5229/\u7e3d\u8667\u640d\uff09 &gt; 1.5"}, {"location": "reference/report/#get_trades", "title": "get_trades()", "text": "<p>\u53d6\u5f97\u6240\u6709\u4ea4\u6613\u8a18\u9304\u7684\u8a73\u7d30\u8cc7\u8a0a\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u53d6\u5f97\u4ea4\u6613\u8a18\u9304\ntrades = report.get_trades()\n\n# \u67e5\u770b\u4ea4\u6613\u8a18\u9304\u7d50\u69cb\nprint(trades.head())\nprint(trades.columns)\n\n# \u5206\u6790\u4ea4\u6613\u8868\u73fe\nprint(f\"\u7e3d\u4ea4\u6613\u6b21\u6578: {len(trades)}\")\nprint(f\"\u5e73\u5747\u5831\u916c\u7387: {trades['returns'].mean():.2%}\")\nprint(f\"\u52dd\u7387: {(trades['returns'] &gt; 0).mean():.2%}\")\n\n# \u7be9\u9078\u5927\u8cfa\u6216\u5927\u8ce0\u7684\u4ea4\u6613\nbig_wins = trades[trades['returns'] &gt; 0.2]  # \u5831\u916c &gt; 20%\nbig_losses = trades[trades['returns'] &lt; -0.1]  # \u8667\u640d &gt; 10%\n\n# \u6309\u80a1\u7968\u7d71\u8a08\ntrades_by_stock = trades.groupby('stock_id')['returns'].agg(['count', 'mean'])\nprint(trades_by_stock.sort_values('mean', ascending=False).head())\n</code></pre> <p>DataFrame \u6b04\u4f4d\uff1a - <code>stock_id</code>: \u80a1\u7968\u4ee3\u865f - <code>entry_date</code>: \u9032\u5834\u65e5\u671f - <code>exit_date</code>: \u51fa\u5834\u65e5\u671f - <code>entry_price</code>: \u9032\u5834\u50f9\u683c - <code>exit_price</code>: \u51fa\u5834\u50f9\u683c - <code>returns</code>: \u5831\u916c\u7387 - <code>holding_period</code>: \u6301\u6709\u5929\u6578 - <code>position_size</code>: \u6301\u5009\u6b0a\u91cd</p>"}, {"location": "reference/report/#get_mae_mfe", "title": "get_mae_mfe()", "text": "<p>\u53d6\u5f97\u6700\u5927\u4e0d\u5229\u504f\u79fb\uff08MAE\uff09\u8207\u6700\u5927\u6709\u5229\u504f\u79fb\uff08MFE\uff09\u5206\u6790\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u53d6\u5f97 MAE/MFE \u8cc7\u6599\nmae_mfe = report.get_mae_mfe()\n\n# \u5206\u6790\u98a8\u96aa\u8207\u6a5f\u6703\nprint(f\"\u5e73\u5747 MAE: {mae_mfe['mae'].mean():.2%}\")  # \u5e73\u5747\u6700\u5927\u672a\u5be6\u73fe\u8667\u640d\nprint(f\"\u5e73\u5747 MFE: {mae_mfe['mfe'].mean():.2%}\")  # \u5e73\u5747\u6700\u5927\u672a\u5be6\u73fe\u7372\u5229\n\n# \u8996\u89ba\u5316 MAE/MFE \u5206\u5e03\nreport.display_mae_mfe_analysis()\n</code></pre> <p>\u61c9\u7528\u5834\u666f\uff1a - \u8a2d\u5b9a\u505c\u640d\u9ede\uff1a\u89c0\u5bdf MAE \u5206\u5e03\uff0c\u6c7a\u5b9a\u5408\u7406\u7684\u505c\u640d\u5e45\u5ea6 - \u8a2d\u5b9a\u505c\u5229\u9ede\uff1a\u89c0\u5bdf MFE \u5206\u5e03\uff0c\u6c7a\u5b9a\u5408\u7406\u7684\u505c\u5229\u5e45\u5ea6 - \u512a\u5316\u9032\u51fa\u5834\uff1a\u82e5 MFE \u5927\u4f46\u6700\u7d42\u5831\u916c\u5c0f\uff0c\u8868\u793a\u505c\u5229\u904e\u665a</p> <p>MAE/MFE \u89e3\u8b80</p> <ul> <li>MAE (Maximum Adverse Excursion): \u6301\u5009\u671f\u9593\u7684\u6700\u5927\u672a\u5be6\u73fe\u8667\u640d</li> <li>MFE (Maximum Favorable Excursion): \u6301\u5009\u671f\u9593\u7684\u6700\u5927\u672a\u5be6\u73fe\u7372\u5229</li> <li>\u7406\u60f3\u60c5\u6cc1\uff1aMFE \u5927\u3001MAE \u5c0f\uff0c\u8868\u793a\u9032\u5834\u6642\u6a5f\u4f73</li> </ul>"}, {"location": "reference/report/#upload", "title": "upload()", "text": "<p>\u4e0a\u50b3\u56de\u6e2c\u5831\u544a\u81f3 FinLab \u96f2\u7aef\uff0c\u4f9b\u5be6\u76e4\u8ffd\u8e64\u4f7f\u7528\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u4e0a\u50b3\u5831\u544a\nreport.upload(name='\u6211\u7684\u52d5\u80fd\u7b56\u7565')\n\n# \u4e4b\u5f8c\u53ef\u5728 FinLab \u7db2\u7ad9\u67e5\u770b\uff1a\n# https://ai.finlab.tw/strategies\n</code></pre> <p>\u4e0a\u50b3\u524d\u63d0</p> <ul> <li>\u9700\u767b\u5165 FinLab \u5e33\u865f\uff08<code>finlab.login()</code>\uff09</li> <li>\u9700\u70ba VIP \u6703\u54e1</li> <li>\u4e0a\u50b3\u5f8c\u53ef\u7528\u65bc\u5be6\u76e4\u4e0b\u55ae\u3001\u7e3e\u6548\u8ffd\u8e64</li> </ul>"}, {"location": "reference/report/#run_analysis", "title": "run_analysis()", "text": "<p>\u57f7\u884c\u6df1\u5ea6\u5206\u6790\u6a21\u7d44\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab.analysis import (\n    LiquidityAnalysis,\n    SelectionAbilityAnalysis,\n    PositionDistributionAnalysis\n)\n\n# \u6d41\u52d5\u6027\u5206\u6790\nreport.run_analysis(LiquidityAnalysis())\n\n# \u9078\u80a1\u80fd\u529b\u5206\u6790\nreport.run_analysis(SelectionAbilityAnalysis())\n\n# \u6301\u80a1\u5206\u5e03\u5206\u6790\nreport.run_analysis(PositionDistributionAnalysis())\n</code></pre> <p>\u8a73\u7d30\u8aaa\u660e\u8acb\u53c3\u8003 \u7b56\u7565\u5206\u6790\u6a21\u7d44\u3002</p>"}, {"location": "reference/report/#to_pickle-from_pickle", "title": "to_pickle() / from_pickle()", "text": "<p>\u5132\u5b58\u8207\u8f09\u5165\u5831\u544a\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code># \u5132\u5b58\u5831\u544a\nreport.to_pickle('my_strategy_report.pkl')\n\n# \u8f09\u5165\u5831\u544a\nfrom finlab.analysis import Report\nloaded_report = Report.from_pickle('my_strategy_report.pkl')\nloaded_report.display()\n</code></pre> <p>\u4f7f\u7528\u6642\u6a5f</p> <ul> <li>\u56de\u6e2c\u9700\u8981\u5f88\u9577\u6642\u9593\uff0c\u60f3\u4fdd\u5b58\u7d50\u679c</li> <li>\u9700\u8981\u5c0d\u6bd4\u4e0d\u540c\u6642\u671f\u7684\u56de\u6e2c\u5831\u544a</li> <li>\u8207\u4ed6\u4eba\u5206\u4eab\u56de\u6e2c\u7d50\u679c</li> </ul>"}, {"location": "reference/report/#_7", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/report/#q", "title": "Q: \u5982\u4f55\u5c0d\u6bd4\u591a\u500b\u7b56\u7565\u7684\u7e3e\u6548\uff1f", "text": "<pre><code># \u65b9\u6cd5 1\uff1a\u4f7f\u7528 get_metrics() \u5c0d\u6bd4\nreport1 = sim(position1, resample='M')\nreport2 = sim(position2, resample='M')\n\nmetrics1 = report1.get_metrics()\nmetrics2 = report2.get_metrics()\n\nimport pandas as pd\ncomparison = pd.DataFrame({\n    '\u7b56\u7565 A': metrics1,\n    '\u7b56\u7565 B': metrics2\n})\nprint(comparison[['annual_return', 'daily_sharpe', 'max_drawdown']])\n\n# \u65b9\u6cd5 2\uff1a\u4f7f\u7528 Portfolio \u7269\u4ef6\nfrom finlab.portfolio import Portfolio\nportfolio = Portfolio({\n    '\u7b56\u7565 A': (report1, 0.5),\n    '\u7b56\u7565 B': (report2, 0.5)\n})\nportfolio_report = portfolio.create_report()\nportfolio_report.display()\n</code></pre>"}, {"location": "reference/report/#q_1", "title": "Q: \u5982\u4f55\u532f\u51fa\u6de8\u503c\u66f2\u7dda\u6578\u64da\uff1f", "text": "<pre><code># \u53d6\u5f97\u6de8\u503c\u66f2\u7dda\nstats = report.get_stats()\nequity_curve = stats['acc_returns']\n\n# \u532f\u51fa\u70ba CSV\nequity_curve.to_csv('equity_curve.csv')\n\n# \u6216\u532f\u51fa\u5b8c\u6574\u7d71\u8a08\nstats.to_csv('full_stats.csv')\n</code></pre>"}, {"location": "reference/report/#q_2", "title": "Q: \u5982\u4f55\u7be9\u9078\u7279\u5b9a\u671f\u9593\u7684\u7e3e\u6548\uff1f", "text": "<pre><code># \u53d6\u5f97\u5b8c\u6574\u7d71\u8a08\nstats = report.get_stats()\n\n# \u7be9\u9078 2023 \u5e74\u7684\u7e3e\u6548\nstats_2023 = stats.loc['2023-01-01':'2023-12-31']\n\n# \u8a08\u7b97\u8a72\u671f\u9593\u7684\u5831\u916c\u7387\nperiod_return = (stats_2023['acc_returns'].iloc[-1] /\n                 stats_2023['acc_returns'].iloc[0]) - 1\nprint(f\"2023 \u5e74\u5831\u916c\u7387: {period_return:.2%}\")\n</code></pre>"}, {"location": "reference/report/#q_3", "title": "Q: \u70ba\u4ec0\u9ebc\u6211\u7684\u5831\u544a\u986f\u793a\u4e0d\u51fa\u4f86\uff1f", "text": "<pre><code># \u539f\u56e0 1\uff1a\u5fd8\u8a18\u547c\u53eb .display()\nreport  # \u274c \u4e0d\u6703\u986f\u793a\n\nreport.display()  # \u2705 \u6b63\u78ba\n\n# \u539f\u56e0 2\uff1aJupyter Notebook \u74b0\u5883\u554f\u984c\n# \u5728 notebook \u958b\u982d\u52a0\u5165\uff1a\n%matplotlib inline\n\n# \u539f\u56e0 3\uff1a\u8cc7\u6599\u70ba\u7a7a\uff08\u7121\u4efb\u4f55\u4ea4\u6613\uff09\ntrades = report.get_trades()\nif len(trades) == 0:\n    print(\"\u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304\uff0c\u8acb\u6aa2\u67e5\u9032\u5834\u689d\u4ef6\")\n</code></pre>"}, {"location": "reference/report/#q_4", "title": "Q: \u5982\u4f55\u8abf\u6574\u5831\u544a\u7684\u8996\u89ba\u5316\u6a23\u5f0f\uff1f", "text": "<pre><code># \u53d6\u5f97 plotly figure \u7269\u4ef6\nfig = report.display(return_fig=True)\n\n# \u4fee\u6539\u6a19\u984c\nfig.update_layout(title='\u6211\u7684\u7b56\u7565\u56de\u6e2c\u5831\u544a')\n\n# \u4fee\u6539\u984f\u8272\nfig.update_traces(line_color='blue', selector=dict(name='\u7b56\u7565'))\n\n# \u8abf\u6574\u5716\u8868\u5927\u5c0f\nfig.update_layout(width=1200, height=600)\n\n# \u986f\u793a\nfig.show()\n</code></pre>"}, {"location": "reference/report/#_8", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u6b77\u53f2\u56de\u6e2c\u6559\u5b78 - \u5b8c\u6574\u56de\u6e2c\u6d41\u7a0b</li> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44 - \u6df1\u5ea6\u5206\u6790\u5de5\u5177</li> <li>\u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406 - Portfolio \u7269\u4ef6</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u7aef\u5230\u7aef\u5de5\u4f5c\u6d41\u7a0b</li> </ul>"}, {"location": "reference/tools/", "title": "finlab.tools", "text": "<p>\u5de5\u5177\u6a21\u7d44\uff0c\u63d0\u4f9b\u4e8b\u4ef6\u7814\u7a76\u8207\u56e0\u5b50\u5206\u6790\u529f\u80fd\u3002</p>"}, {"location": "reference/tools/#_1", "title": "\u4f7f\u7528\u60c5\u5883", "text": "<ul> <li>\u5206\u6790\u7279\u5b9a\u4e8b\u4ef6\u5c0d\u80a1\u50f9\u7684\u5f71\u97ff\uff08\u4e8b\u4ef6\u7814\u7a76\uff09</li> <li>\u8a55\u4f30\u56e0\u5b50\u7684\u9078\u80a1\u80fd\u529b\uff08\u56e0\u5b50\u5206\u6790\uff09</li> <li>\u512a\u5316\u7b56\u7565\u7684\u56e0\u5b50\u7d44\u5408</li> <li>\u7406\u89e3\u7b56\u7565\u7e3e\u6548\u7684\u4f86\u6e90</li> </ul>"}, {"location": "reference/tools/#_2", "title": "\u5feb\u901f\u7bc4\u4f8b", "text": ""}, {"location": "reference/tools/#_3", "title": "\u4e8b\u4ef6\u7814\u7a76", "text": "<pre><code>from finlab.tools import event_study\n\n# \u5206\u6790\u71df\u6536\u516c\u544a\u5f8c\u7684\u80a1\u50f9\u8868\u73fe\n# \uff08\u5f85\u88dc\u5145\uff1a\u9700\u8981\u5be6\u969b\u7684\u4e8b\u4ef6\u8cc7\u6599\uff09\n</code></pre>"}, {"location": "reference/tools/#_4", "title": "\u56e0\u5b50\u5206\u6790", "text": "<pre><code>from finlab import data\nfrom finlab.tools import factor_analysis as fa\n\n# \u6e96\u5099\u56e0\u5b50\u8207\u6a19\u7c64\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# \u5efa\u7acb\u56e0\u5b50\ncond1 = marketcap.rank(pct=True, axis=1) &lt; 0.3  # \u5c0f\u5e02\u503c\ncond2 = (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &gt; 0.7  # \u71df\u6536\u6210\u9577\n\n# \u8a08\u7b97\u56e0\u5b50\u5831\u916c\nfactor_return = fa.calc_factor_return(cond1, label=future_return)\nprint(factor_return)\n</code></pre>"}, {"location": "reference/tools/#_5", "title": "\u8a73\u7d30\u6559\u5b78", "text": "<p>\u53c3\u8003 \u56e0\u5b50\u5206\u6790\u6559\u5b78\uff0c\u4e86\u89e3\uff1a - \u5b8c\u6574\u56e0\u5b50\u5206\u6790\u6d41\u7a0b - \u56e0\u5b50\u5831\u916c\u8a08\u7b97 - \u56e0\u5b50 IC \u5206\u6790 - Shapley values \u8ca2\u737b\u5ea6\u5206\u6790</p>"}, {"location": "reference/tools/#api-reference", "title": "API Reference", "text": ""}, {"location": "reference/tools/#event_study", "title": "event_study()", "text": "<p>\u4e8b\u4ef6\u7814\u7a76\uff1a\u5206\u6790\u7279\u5b9a\u4e8b\u4ef6\u5c0d\u80a1\u50f9\u7684\u5f71\u97ff\u3002</p> <p>\u4f7f\u7528\u8aaa\u660e</p> <p>\u4e8b\u4ef6\u7814\u7a76\u7528\u65bc\u5206\u6790\u7279\u5b9a\u4e8b\u4ef6\uff08\u5982\u8ca1\u5831\u516c\u544a\u3001\u6cd5\u8aaa\u6703\u3001\u80a1\u5229\u767c\u653e\uff09\u5c0d\u80a1\u50f9\u7684\u77ed\u671f\u8207\u9577\u671f\u5f71\u97ff\u3002</p>"}, {"location": "reference/tools/#finlab.tools.event_study", "title": "finlab.tools.event_study", "text": ""}, {"location": "reference/tools/#finlab.tools.event_study.create_factor_data", "title": "create_factor_data", "text": "<pre><code>create_factor_data(factor, adj_close, days=[5, 10, 20, 60], event=None)\n</code></pre> <p>create factor data, which contains future return</p> PARAMETER DESCRIPTION <code>factor</code> <p>factor data where index is datetime and columns is asset id</p> <p> TYPE: <code>DataFrame</code> </p> <code>adj_close</code> <p>adj close where index is datetime and columns is asset id</p> <p> TYPE: <code>DataFrame</code> </p> <code>days</code> <p>future return considered</p> <p> TYPE: <code>List[int]</code> DEFAULT: <code>[5, 10, 20, 60]</code> </p> Return <p>Analytic plots and tables</p> Warning <p>This function is not identical to <code>finlab.ml.alphalens.create_factor_data</code></p> <p>Examples:</p> \u73fe\u91d1\u589e\u6e1b\u8cc7\u5206\u6790<pre><code>from finlab.tools.event_study import create_factor_data\nfrom finlab.tools.event_study import event_study\n\nfactor = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\nadj_close = data.get('etl:adj_close')\nbenchmark = data.get('benchmark_return:\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578')\n\n# create event dataframe\ndividend_info = data.get('dividend_announcement')\nv = dividend_info[['stock_id', '\u9664\u6b0a\u4ea4\u6613\u65e5']].set_index(['stock_id', '\u9664\u6b0a\u4ea4\u6613\u65e5'])\nv['value'] = 1\nevent = v[~v.index.duplicated()].reset_index().drop_duplicates(\n    subset=['stock_id', '\u9664\u6b0a\u4ea4\u6613\u65e5']\n).pivot(index='\u9664\u6b0a\u4ea4\u6613\u65e5', columns='stock_id', values='value').notna()\n\n# calculate factor_data\nfactor_data = create_factor_data({'pb':factor}, adj_close, event=event)\n\nr = event_study(factor_data, benchmark, adj_close)\n\nplt.bar(r.columns, r.mean().values)\nplt.plot(r.columns, r.mean().cumsum().values)\n</code></pre>"}, {"location": "reference/tools/#finlab.tools.event_study.event_study", "title": "event_study", "text": "<pre><code>event_study(factor_data, benchmark_adj_close, stock_adj_close, sample_period=(-45, -20), estimation_period=(-5, 20), plot=True)\n</code></pre> <p>Run event study and returns the abnormal returns of each stock on each day.</p> PARAMETER DESCRIPTION <code>factor_data</code> <p>factor data where index is datetime and columns is asset id</p> <p> TYPE: <code>DataFrame</code> </p> <code>benchmark_adj_close</code> <p>benchmark for CAPM</p> <p> TYPE: <code>DataFrame</code> </p> <code>stock_adj_close</code> <p>stock price for CAPM</p> <p> TYPE: <code>DataFrame</code> </p> <code>sample_period</code> <p>period for fitting CAPM</p> <p> TYPE: <code>(int, int)</code> DEFAULT: <code>(-45, -20)</code> </p> <code>estimation_period</code> <p>period for calculating alpha (abnormal return)</p> <p> TYPE: <code>(int, int)</code> DEFAULT: <code>(-5, 20)</code> </p> <code>plot</code> <p>plot the result</p> <p> TYPE: <code>bool</code> DEFAULT: <code>True</code> </p> Return <p>Abnormal returns of each stock on each day.</p> <p>Examples:</p> \u73fe\u91d1\u589e\u6e1b\u8cc7\u5206\u6790<pre><code>from finlab.tools.event_study import create_factor_data\nfrom finlab.tools.event_study import event_study\n\nfactor = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\nadj_close = data.get('etl:adj_close')\nbenchmark = data.get('benchmark_return:\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578')\n\n# create event dataframe\ndividend_info = data.get('dividend_announcement')\nv = dividend_info[['stock_id', '\u9664\u6b0a\u4ea4\u6613\u65e5']].set_index(['stock_id', '\u9664\u6b0a\u4ea4\u6613\u65e5'])\nv['value'] = 1\nevent = v[~v.index.duplicated()].reset_index().drop_duplicates(\n    subset=['stock_id', '\u9664\u6b0a\u4ea4\u6613\u65e5']\n).pivot(index='\u9664\u6b0a\u4ea4\u6613\u65e5', columns='stock_id', values='value').notna()\n\n# calculate factor_data\nfactor_data = create_factor_data({'pb':factor}, adj_close, event=event)\n\nr = event_study(factor_data, benchmark, adj_close)\n\nplt.bar(r.columns, r.mean().values)\nplt.plot(r.columns, r.mean().cumsum().values)\n</code></pre>"}, {"location": "reference/tools/#finlab.tools.event_study.plot_event_study", "title": "plot_event_study", "text": "<pre><code>plot_event_study(returns)\n</code></pre> <p>Plot the event study for the given returns.</p> PARAMETER DESCRIPTION <code>returns</code> <p>A DataFrame containing the returns data.</p> <p> TYPE: <code>DataFrame</code> </p> Return <p>ax (matplotlib.axes.Axes): The axes object containing the plot.</p>"}, {"location": "reference/tools/#factor_analysis", "title": "factor_analysis", "text": "<p>\u56e0\u5b50\u5206\u6790\u6a21\u7d44\uff0c\u7528\u65bc\u8a55\u4f30\u56e0\u5b50\u7684\u9078\u80a1\u80fd\u529b\u8207\u8ca2\u737b\u5ea6\u3002</p> <p>\u4e3b\u8981\u529f\u80fd\uff1a</p> \u51fd\u6578 \u8aaa\u660e \u7528\u9014 <code>calc_factor_return()</code> \u8a08\u7b97\u56e0\u5b50\u5831\u916c \u8a55\u4f30\u56e0\u5b50\u7684\u6574\u9ad4\u8868\u73fe <code>calc_ic()</code> \u8a08\u7b97\u56e0\u5b50 IC\uff08\u8cc7\u8a0a\u4fc2\u6578\uff09 \u8a55\u4f30\u56e0\u5b50\u8207\u672a\u4f86\u5831\u916c\u7684\u76f8\u95dc\u6027 <code>calc_shapley_values()</code> \u8a08\u7b97 Shapley values \u8a55\u4f30\u56e0\u5b50\u5728\u591a\u56e0\u5b50\u6a21\u578b\u4e2d\u7684\u908a\u969b\u8ca2\u737b <code>calc_centrality()</code> \u8a08\u7b97\u56e0\u5b50\u96c6\u4e2d\u5ea6 \u8a55\u4f30\u56e0\u5b50\u5728\u4e0d\u540c\u80a1\u7968\u4e0a\u7684\u5206\u5e03"}, {"location": "reference/tools/#finlab.tools.factor_analysis", "title": "finlab.tools.factor_analysis", "text": ""}, {"location": "reference/tools/#finlab.tools.factor_analysis.calc_centrality", "title": "calc_centrality", "text": "<pre><code>calc_centrality(return_df, window_periods, n_components=1)\n</code></pre> <p>\u5c0d\u6307\u5b9a\u7684\u6642\u9593\u5e8f\u5217\u6578\u64da\u8a08\u7b97\u6efe\u52d5\u8cc7\u7522\u96c6\u4e2d\u5ea6\u3002</p> <p>\u6b64\u51fd\u5f0f\u70ba\u901a\u7528\u51fd\u5f0f\uff0c\u53ef\u61c9\u7528\u65bc\u4efb\u4f55\u4ee5\u6642\u9593\u70ba\u7d22\u5f15\u3001\u8cc7\u7522\u70ba\u6b04\u4f4d\u7684 DataFrame(\u4f8b\u5982\u56e0\u5b50\u5831\u916c)\u3002 \u5b83\u73fe\u5728\u662f\u983b\u7387\u7121\u95dc\u7684\uff0c\u6efe\u52d5\u7a97\u53e3\u7531\u6574\u6578 <code>window_periods</code> \u6307\u5b9a\u3002</p> PARAMETER DESCRIPTION <code>return_df</code> <p>\u4e00\u500b\u6642\u9593\u5e8f\u5217 DataFrame\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u6b04\u4f4d\u70ba\u8cc7\u7522(\u4f8b\u5982\u56e0\u5b50\u540d\u7a31)\u3002 \u96d6\u7136\u53c3\u6578\u540d\u7a31\u70ba <code>return_df</code>\uff0c\u4f46\u6b64\u51fd\u5f0f\u8a2d\u8a08\u4e0a\u53ef\u63a5\u53d7\u4efb\u4f55\u8cc7\u7522\u7684\u6642\u9593\u5e8f\u5217\u6578\u64da\uff0c\u4f8b\u5982\u56e0\u5b50\u6ce2\u52d5\u7387\uff0c\u4f46\u5c31\u662f\u4e0d\u80fd\u89e3\u91cb\u8cc7\u7522\u96c6\u4e2d\u5ea6\u4e86\u3002</p> <p> TYPE: <code>DataFrame</code> </p> <code>window_periods</code> <p>\u6efe\u52d5\u7a97\u53e3\u7684\u9577\u5ea6\uff0c\u4ee5\u6578\u64da\u9ede\u7684\u300c\u6578\u91cf\u300d\u8a08\u3002\u4f8b\u5982\uff0c\u5982\u679c <code>return_df</code> \u662f\u6708\u8cc7\u6599\uff0c <code>window_periods=3</code> \u5c31\u4ee3\u8868\u4f7f\u7528 3 \u500b\u6708\u7684\u6efe\u52d5\u7a97\u53e3\u3002</p> <p> TYPE: <code>int</code> </p> <code>n_components</code> <p>\u7528\u65bc\u8a08\u7b97\u7684 PCA \u4e3b\u6210\u5206\u6578\u91cf\u3002</p> <p> TYPE: <code>int</code> DEFAULT: <code>1</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>pd.DataFrame: \u5305\u542b\u6efe\u52d5\u96c6\u4e2d\u5ea6\u5206\u6578\u7684 DataFrame\u3002</p> Example date FactorA FactorB 2025-01-01 0.1 0.2 2025-01-02 0.1 0.2 2025-01-03 0.1 0.2 2025-01-04 0.1 0.2 2025-01-05 0.1 0.2"}, {"location": "reference/tools/#finlab.tools.factor_analysis.calc_factor_return", "title": "calc_factor_return", "text": "<pre><code>calc_factor_return(features, labels)\n</code></pre> <p>\u8a08\u7b97\u57fa\u65bc\u7279\u5fb5\u548c\u6a19\u7c64\u7684\u7b49\u6b0a\u91cd\u6295\u8cc7\u7d44\u5408\u9031\u671f\u8868\u73fe\u3002</p> <p>\u6b64\u51fd\u5f0f\u662f\u56e0\u5b50\u7e3e\u6548\u8a08\u7b97\u7684\u6838\u5fc3\u5f15\u64ce\uff0c\u63a5\u53d7\u9810\u5148\u6e96\u5099\u597d\u7684\u7279\u5fb5\u548c\u6a19\u7c64\uff0c \u7136\u5f8c\u8a08\u7b97\u6bcf\u500b\u56e0\u5b50\u7684\u6295\u8cc7\u7d44\u5408\u5831\u916c\u3002</p> <p>\u51fd\u5f0f\u6703\u81ea\u52d5\u8655\u7406\u4ee5\u4e0b\u6d41\u7a0b\uff1a 1. \u9a57\u8b49\u6240\u6709\u7279\u5fb5\u90fd\u662f\u5e03\u6797\u503c 2. \u5c0d\u6bcf\u500b\u56e0\u5b50\u8a08\u7b97\u7b49\u6b0a\u91cd\u6295\u8cc7\u7d44\u5408\u7684\u9031\u671f\u5831\u916c 3. \u81ea\u52d5\u88c1\u526a\u6389\u7b2c\u4e00\u500b\u975e\u7a7a\u884c\u4e4b\u524d\u7684\u6578\u64da</p> PARAMETER DESCRIPTION <code>features</code> <p>\u7279\u5fb5 DataFrame\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u6b04\u4f4d\u70ba\u56e0\u5b50\u540d\u7a31\uff0c\u503c\u61c9\u70ba\u5e03\u6797\u503c\u3002</p> <p> TYPE: <code>DataFrame</code> </p> <code>labels</code> <p>\u6a19\u7c64 Series\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u503c\u70ba\u8d85\u984d\u5831\u916c\u3002</p> <p> TYPE: <code>Series</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>pd.DataFrame: \u4e00\u500b\u7d22\u5f15\u70ba\u65e5\u671f\u3001\u6b04\u4f4d\u70ba\u5404\u56e0\u5b50\u540d\u7a31\u7684 DataFrame\uff0c\u5176\u503c\u70ba\u6bcf\u500b\u9031\u671f\u7684\u7b49\u6b0a\u91cd\u6295\u7d44\u8868\u73fe\u3002          \u8f38\u51fa\u6703\u81ea\u52d5\u5f9e\u7b2c\u4e00\u500b\u975e\u7a7a\u884c\u958b\u59cb\uff0c\u78ba\u4fdd\u6578\u64da\u5b8c\u6574\u6027\u3002</p> RAISES DESCRIPTION <code>ValueError</code> <p>\u5982\u679c\u7279\u5fb5\u4e0d\u662f\u5e03\u6797\u503c\u3002</p> Example <pre><code>from finlab import data\nfrom finlab.tools.factor_analysis import calc_factor_return, generate_features_and_labels\n\nprice = data.get('etl:adj_close')\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# \u5148\u751f\u6210\u7279\u5fb5\u548c\u6a19\u7c64\nfeatures, labels = generate_features_and_labels({\n     'marketcap': marketcap.rank(pct=True, axis=1) &lt; 0.3,\n     'revenue': (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &lt; 0.3,\n     'momentum': price / price.shift(20) - 1 &gt; 0\n}, resample=revenue.index)\n\n # \u8a08\u7b97\u56e0\u5b50\u5831\u916c\n factor_return = calc_factor_return(features, labels)\n\n # \u8f38\u51fa\u7bc4\u4f8b\n print(factor_return.head())\n</code></pre> datetime marketcap revenue momentum 2013-04-30 00:00:00 0.018 -0.005 0.009 2013-05-31 00:00:00 0.004 -0.003 -0.001 2013-06-30 00:00:00 -0.013 -0.006 0.023 2013-07-31 00:00:00 0.007 -0.007 0.001 2013-08-31 00:00:00 0.014 -0.003 -0.005"}, {"location": "reference/tools/#finlab.tools.factor_analysis.calc_ic", "title": "calc_ic", "text": "<pre><code>calc_ic(features, labels, rank=False)\n</code></pre> <p>\u8a08\u7b97\u7279\u5fb5\u8207\u6a19\u7c64\u4e4b\u9593\u7684\u76f8\u95dc\u4fc2\u6578\uff08IC\uff09\uff0c\u53ef\u9078\u64c7\u662f\u5426\u5c0d\u7279\u5fb5\u9032\u884c\u6392\u540d\u3002</p> PARAMETER DESCRIPTION <code>features</code> <p>\u7279\u5fb5\u8cc7\u6599\uff0c\u7d22\u5f15\u70baMultiIndex\uff08\u65e5\u671f, \u80a1\u7968\u4ee3\u78bc\uff09\uff0c\u6b04\u4f4d\u70ba\u56e0\u5b50\u540d\u7a31\u3002</p> <p> TYPE: <code>DataFrame</code> </p> <code>labels</code> <p>\u6a19\u7c64\u8cc7\u6599\uff0c\u7d22\u5f15\u70baMultiIndex\uff08\u65e5\u671f, \u80a1\u7968\u4ee3\u78bc\uff09\u3002</p> <p> TYPE: <code>Series</code> </p> <code>rank</code> <p>\u662f\u5426\u5c0d\u7279\u5fb5\u9032\u884c\u6392\u540d\u3002\u9810\u8a2d\u70baFalse\u3002</p> <p> TYPE: <code>bool</code> DEFAULT: <code>False</code> </p> RETURNS DESCRIPTION <p>pd.DataFrame: \u6bcf\u500b\u65e5\u671f\u3001\u6bcf\u500b\u56e0\u5b50\u7684IC\u503c\u3002</p>"}, {"location": "reference/tools/#finlab.tools.factor_analysis.calc_metric", "title": "calc_metric", "text": "<pre><code>calc_metric(factor, adj_close, days=[10, 20, 60, 120], func=corr)\n</code></pre> <p>\u8a08\u7b97\u56e0\u5b50</p> PARAMETER DESCRIPTION <code>factor</code> <p>\u56e0\u5b50</p> <p> TYPE: <code>DataFrame</code> </p> <code>adj_close</code> <p>\u80a1\u50f9</p> <p> TYPE: <code>DataFrame</code> </p> <code>days</code> <p>\u9810\u6e2c\u5929\u6578. Defaults to [10, 20, 60, 120].</p> <p> TYPE: <code>list</code> DEFAULT: <code>[10, 20, 60, 120]</code> </p> <code>func</code> <p>\u8a08\u7b97\u51fd\u6578. Defaults to corr.</p> <p> TYPE: <code>function</code> DEFAULT: <code>corr</code> </p> RETURNS DESCRIPTION <p>pd.DataFrame: \u56e0\u5b50\u8a08\u7b97\u7d50\u679c</p> Example <pre><code>factor = data.indicator('RSI')\nadj_close = data.get('etl:adj_close')\ncalc_metric(factor, adj_close)\n</code></pre> date factor_10 factor_20 factor_60 factor_120 2010-01-01 0.1 0.2 0.3 0.4 2010-01-02 0.1 0.2 0.3 0.4 2010-01-03 0.1 0.2 0.3 0.4 2010-01-04 0.1 0.2 0.3 0.4 2010-01-05 0.1 0.2 0.3 0.4"}, {"location": "reference/tools/#finlab.tools.factor_analysis.calc_regression_stats", "title": "calc_regression_stats", "text": "<pre><code>calc_regression_stats(df, p_value_threshold=0.05, r_squared_threshold=0.1)\n</code></pre> <p>\u5c0d DataFrame \u4e2d\u7684\u6bcf\u500b\u6642\u9593\u5e8f\u5217\u9032\u884c\u7dda\u6027\u56de\u6b78\uff0c\u4e26\u56de\u50b3\u539f\u59cb\u7d71\u8a08\u6578\u64da\u3002</p> <p>\u6b64\u51fd\u5f0f\u4f7f\u7528 numpy \u9032\u884c\u7dda\u6027\u56de\u6b78\u8a08\u7b97\uff0c\u4e26\u4f7f\u7528 scipy.stats.t \u8a08\u7b97\u6e96\u78ba\u7684\u96d9\u5c3e p-value\u3002</p> PARAMETER DESCRIPTION <code>df</code> <p>\u6642\u9593\u5e8f\u5217 DataFrame\uff0c\u7d22\u5f15\u70ba DatetimeIndex\uff0c\u6b04\u4f4d\u70ba\u4e0d\u540c\u7684\u6307\u6a19\u5e8f\u5217\u3002</p> <p> TYPE: <code>DataFrame</code> </p> <code>p_value_threshold</code> <p>p \u503c\u95be\u503c\uff0c\u7528\u65bc\u5224\u65b7\u8da8\u52e2\u7684\u7d71\u8a08\u986f\u8457\u6027\u3002\u9810\u8a2d\u70ba 0.05\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>0.05</code> </p> <code>r_squared_threshold</code> <p>R\u00b2 \u95be\u503c\uff0c\u7528\u65bc\u5224\u65b7\u8da8\u52e2\u7684\u89e3\u91cb\u529b\u3002\u9810\u8a2d\u70ba 0.1\u3002</p> <p> TYPE: <code>float</code> DEFAULT: <code>0.1</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>pd.DataFrame: \u7dda\u6027\u56de\u6b78\u7684\u7d71\u8a08\u7d50\u679c\uff0c\u5305\u542b\u4ee5\u4e0b\u6b04\u4f4d\uff1a - slope: \u7dda\u6027\u56de\u6b78\u659c\u7387 - intercept: \u7dda\u6027\u56de\u6b78\u622a\u8ddd - r_squared: \u6c7a\u5b9a\u4fc2\u6578 (R\u00b2) - p_value: \u659c\u7387\u7684 p \u503c\uff08\u96d9\u5c3e\u6aa2\u5b9a\uff09 - tail_estimate: \u6642\u9593\u5e8f\u5217\u5c3e\u90e8\u7684\u4f30\u8a08\u503c - trend: \u8da8\u52e2\u5206\u985e (\"up\", \"down\", \"flat\")</p> Example <pre><code># \u5047\u8a2d ic_df \u662f\u4e00\u500b\u5305\u542b IC \u6642\u9593\u5e8f\u5217\u7684 DataFrame\n# ic_df = calc_ic(features, labels)\n\n# 1. \u8a08\u7b97\u56de\u6b78\u7d71\u8a08\u6578\u64da\ntrend_stats = calc_regression_stats(ic_df)\nprint(trend_stats)\n\n# 2. \u57fa\u65bc\u56de\u50b3\u7d50\u679c\u9032\u884c\u5ba2\u88fd\u5316\u5206\u6790\n# \u7bc4\u4f8b\uff1a\u627e\u51fa\u7d71\u8a08\u986f\u8457 (p-value &lt; 0.05) \u4e14\u8da8\u52e2\u5411\u4e0a (slope &gt; 0) \u7684\u56e0\u5b50\nsignificant_up_trend = trend_stats[\n    (trend_stats['p_value'] &lt; 0.05) &amp; (trend_stats['slope'] &gt; 0)\n]\nprint(significant_up_trend)\n\n# 3. \u67e5\u770b\u8da8\u52e2\u5206\u985e\u7d50\u679c\nup_trends = trend_stats[trend_stats['trend'] == 'up']\ndown_trends = trend_stats[trend_stats['trend'] == 'down']\nflat_trends = trend_stats[trend_stats['trend'] == 'flat']\n</code></pre>"}, {"location": "reference/tools/#finlab.tools.factor_analysis.calc_shapley_values", "title": "calc_shapley_values", "text": "<pre><code>calc_shapley_values(features, labels)\n</code></pre> <p>\u8a08\u7b97\u56e0\u5b50\u7684 Shapley \u503c\uff0c\u7528\u65bc\u8a55\u4f30\u6bcf\u500b\u56e0\u5b50\u5c0d\u6295\u8cc7\u7d44\u5408\u8868\u73fe\u7684\u908a\u969b\u8ca2\u737b\u3002</p> <p>Shapley \u503c\u662f\u4e00\u7a2e\u5408\u4f5c\u535a\u5f08\u8ad6\u4e2d\u7684\u6982\u5ff5\uff0c\u7528\u65bc\u516c\u5e73\u5206\u914d\u806f\u76df\u7684\u7e3d\u6536\u76ca\u7d66\u5404\u500b\u53c3\u8207\u8005\u3002 \u5728\u56e0\u5b50\u5206\u6790\u4e2d\uff0c\u6211\u5011\u5c07\u6bcf\u500b\u56e0\u5b50\u8996\u70ba\u4e00\u500b\"\u53c3\u8207\u8005\"\uff0c\u6295\u8cc7\u7d44\u5408\u7684\u5831\u916c\u8996\u70ba\"\u806f\u76df\u7684\u7e3d\u6536\u76ca\"\u3002</p> <p>\u8a08\u7b97\u904e\u7a0b\uff1a 1. \u5c0d\u6240\u6709\u53ef\u80fd\u7684\u56e0\u5b50\u7d44\u5408\uff08\u5f9e\u55ae\u4e00\u56e0\u5b50\u5230\u5168\u90e8\u56e0\u5b50\uff09 2. \u8a08\u7b97\u6bcf\u500b\u7d44\u5408\u7684\u6295\u8cc7\u7d44\u5408\u5831\u916c 3. \u6839\u64da Shapley \u503c\u516c\u5f0f\u8a08\u7b97\u6bcf\u500b\u56e0\u5b50\u7684\u908a\u969b\u8ca2\u737b</p> PARAMETER DESCRIPTION <code>features</code> <p>\u7279\u5fb5 DataFrame\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u6b04\u4f4d\u70ba\u56e0\u5b50\u540d\u7a31\uff0c\u503c\u61c9\u70ba\u5e03\u6797\u503c\u3002 \u6bcf\u500b\u56e0\u5b50\u4ee3\u8868\u4e00\u500b\u6295\u8cc7\u7b56\u7565\uff08True \u8868\u793a\u9078\u4e2d\u8a72\u80a1\u7968\uff09\u3002</p> <p> TYPE: <code>DataFrame</code> </p> <code>labels</code> <p>\u6a19\u7c64 Series\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u503c\u70ba\u8d85\u984d\u5831\u916c\u3002 \u61c9\u70ba MultiIndex\uff0c\u5305\u542b 'datetime' \u548c 'stock_id' \u5c64\u7d1a\u3002</p> <p> TYPE: <code>Series</code> </p> RETURNS DESCRIPTION <code>DataFrame</code> <p>pd.DataFrame:  \u5305\u542b\u6bcf\u500b\u56e0\u5b50 Shapley \u503c\u7684 DataFrame\u3002 \u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u6b04\u4f4d\u70ba\u56e0\u5b50\u540d\u7a31\uff0c\u503c\u70ba\u8a72\u56e0\u5b50\u7684 Shapley \u503c\u3002</p> RAISES DESCRIPTION <code>ValueError</code> <ul> <li>\u5982\u679c features \u70ba\u7a7a\u6216\u6c92\u6709\u6b04\u4f4d</li> <li>\u5982\u679c labels \u7684\u7d22\u5f15\u4e0d\u662f MultiIndex</li> <li>\u5982\u679c features \u4e0d\u662f\u5e03\u6797\u503c</li> <li>\u5982\u679c features \u548c labels \u7684\u6642\u9593\u7d22\u5f15\u4e0d\u5339\u914d</li> </ul> Example <pre><code>from finlab import data\nfrom finlab.tools.factor_analysis import calc_shapley_values, generate_features_and_labels\n\nprice = data.get('etl:adj_close')\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# \u751f\u6210\u7279\u5fb5\u548c\u6a19\u7c64\nfeatures, labels = generate_features_and_labels({\n    'marketcap': marketcap.rank(pct=True, axis=1) &lt; 0.3,\n    'revenue': (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &lt; 0.3,\n    'momentum': price / price.shift(20) - 1 &gt; 0\n}, resample=revenue.index)\n\n# \u8a08\u7b97 Shapley \u503c\nshapley_df = calc_shapley_values(features, labels)\n\nprint(shapley_df.head())\n</code></pre> datetime marketcap revenue momentum 2013-04-30 00:00:00 0.012 -0.003 0.006 2013-05-31 00:00:00 0.002 -0.001 -0.001 2013-06-30 00:00:00 -0.008 -0.004 0.015 2013-07-31 00:00:00 0.004 -0.004 0.001 2013-08-31 00:00:00 0.009 -0.002 -0.003 Note <ul> <li>Shapley \u503c\u7684\u8a08\u7b97\u8907\u96dc\u5ea6\u70ba O(2^n)\uff0c\u5176\u4e2d n \u70ba\u56e0\u5b50\u6578\u91cf</li> <li>\u5c0d\u65bc\u5927\u91cf\u56e0\u5b50\uff0c\u8a08\u7b97\u6642\u9593\u53ef\u80fd\u8f03\u9577</li> <li>\u5efa\u8b70\u56e0\u5b50\u6578\u91cf\u4e0d\u8d85\u904e 10 \u500b\u4ee5\u78ba\u4fdd\u5408\u7406\u7684\u8a08\u7b97\u6642\u9593</li> </ul>"}, {"location": "reference/tools/#finlab.tools.factor_analysis.generate_features_and_labels", "title": "generate_features_and_labels", "text": "<pre><code>generate_features_and_labels(dfs, resample)\n</code></pre> <p>\u751f\u6210\u56e0\u5b50\u7279\u5fb5\u548c\u6a19\u7c64\uff0c\u9019\u662f\u56e0\u5b50\u5206\u6790\u7684\u6838\u5fc3\u6b65\u9a5f\u3002</p> <p>\u6b64\u51fd\u5f0f\u5c01\u88dd\u4e86\u56e0\u5b50\u5206\u6790\u4e2d\u7279\u5fb5\u548c\u6a19\u7c64\u751f\u6210\u7684\u6a19\u6e96\u6d41\u7a0b\uff1a 1. \u4f7f\u7528 <code>finlab.ml.feature.combine</code> \u5c07\u56e0\u5b50\u5b57\u5178\u8f49\u63db\u70ba\u7279\u5fb5 DataFrame 2. \u4f7f\u7528 <code>finlab.ml.label.excess_over_mean</code> \u751f\u6210\u8d85\u984d\u5831\u916c\u6a19\u7c64</p> PARAMETER DESCRIPTION <code>dfs</code> <p>\u56e0\u5b50\u5b57\u5178\uff0c\u5305\u542b\u56e0\u5b50\u540d\u7a31\u548c\u5c0d\u61c9\u7684\u56e0\u5b50\u6578\u64da\u6216\u8a08\u7b97\u51fd\u5f0f\u3002</p> <ul> <li>Key (str): \u56e0\u5b50\u540d\u7a31\uff0c\u5c07\u6210\u70ba\u8f38\u51fa DataFrame \u7684\u6b04\u4f4d\u540d</li> <li>Value (Union[pd.DataFrame, Callable]): \u56e0\u5b50\u6578\u64da\u6216\u8a08\u7b97\u51fd\u5f0f<ul> <li>pd.DataFrame: \u76f4\u63a5\u63d0\u4f9b\u7684\u56e0\u5b50\u6578\u64da</li> <li>Callable: \u8a08\u7b97\u56e0\u5b50\u7684\u51fd\u5f0f\uff0c\u5c07\u88ab\u8abf\u7528\u4ee5\u7372\u53d6\u56e0\u5b50\u6578\u64da</li> </ul> </li> </ul> <p>\u6b64\u70ba <code>finlab.ml.feature.combine</code> \u7684\u6a19\u6e96\u8f38\u5165\u683c\u5f0f\u3002</p> <p> TYPE: <code>Dict[str, Union[DataFrame, Callable]]</code> </p> <code>resample</code> <p>\u91cd\u63a1\u6a23\u983b\u7387\uff0c\u7528\u65bc\u7279\u5fb5\u548c\u6a19\u7c64\u7684\u751f\u6210\u3002</p> <p>\u4f8b\u5982: 'M' (\u6708\u5ea6), 'Q' (\u5b63\u5ea6), 'Y' (\u5e74\u5ea6)</p> <p> TYPE: <code>str</code> </p> RETURNS DESCRIPTION <code>tuple[DataFrame, Series]</code> <p>tuple[pd.DataFrame, pd.Series]:  - pd.DataFrame: \u7279\u5fb5 DataFrame\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u6b04\u4f4d\u70ba\u56e0\u5b50\u540d\u7a31 - pd.Series: \u6a19\u7c64 Series\uff0c\u7d22\u5f15\u70ba\u65e5\u671f\uff0c\u503c\u70ba\u8d85\u984d\u5831\u916c</p> RAISES DESCRIPTION <code>ValueError</code> <p>\u5982\u679c\u8f38\u5165\u7684\u56e0\u5b50\u5b57\u5178\u70ba\u7a7a\u6216\u7121\u6548\u3002</p> Example <pre><code>from finlab import data\nfrom finlab.tools.factor_analysis import generate_features_and_labels\n\nprice = data.get('etl:adj_close')\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\nfeatures, labels = generate_features_and_labels({\n    'marketcap': marketcap.rank(pct=True, axis=1) &lt; 0.3,\n    'revenue': (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &lt; 0.3,\n    'momentum': price / price.shift(20) - 1 &gt; 0\n}, resample=revenue.index)\n\nprint(f\"Features shape: {features.shape}\")\nprint(f\"Labels shape: {labels.shape}\")\nFeatures shape: (120, 3)\nLabels shape: (120,)\n</code></pre>"}, {"location": "reference/tools/#finlab.tools.factor_analysis.ic", "title": "ic", "text": "<pre><code>ic(factor, adj_close, days=[10, 20, 60, 120])\n</code></pre> <p>\u8a08\u7b97\u56e0\u5b50\u7684IC</p> PARAMETER DESCRIPTION <code>factor</code> <p>\u56e0\u5b50</p> <p> TYPE: <code>DataFrame</code> </p> <code>adj_close</code> <p>\u80a1\u50f9</p> <p> TYPE: <code>DataFrame</code> </p> <code>days</code> <p>\u9810\u6e2c\u5929\u6578. Defaults to [10, 20, 60, 120].</p> <p> TYPE: <code>list</code> DEFAULT: <code>[10, 20, 60, 120]</code> </p> RETURNS DESCRIPTION <p>pd.DataFrame: \u56e0\u5b50\u8a08\u7b97\u7d50\u679c</p> Example <pre><code>factor = data.indicator('RSI')\nadj_close = data.get('etl:adj_close')\ncalc_metric(factor, adj_close)\n</code></pre> date factor_10 factor_20 factor_60 factor_120 2010-01-01 0.1 0.2 0.3 0.4 2010-01-02 0.1 0.2 0.3 0.4 2010-01-03 0.1 0.2 0.3 0.4 2010-01-04 0.1 0.2 0.3 0.4 2010-01-05 0.1 0.2 0.3 0.4"}, {"location": "reference/tools/#finlab.tools.factor_analysis.is_boolean_series", "title": "is_boolean_series", "text": "<pre><code>is_boolean_series(series)\n</code></pre> <p>Check if a pandas Series contains boolean values, handling NaN values.</p> <p>In older pandas versions, boolean Series with NaN values get converted to float dtype. This function detects such cases by checking if the non-NaN values are boolean.</p> PARAMETER DESCRIPTION <code>series</code> <p>The Series to check</p> <p> TYPE: <code>Series</code> </p> RETURNS DESCRIPTION <code>bool</code> <p>True if the Series contains boolean values (including NaN), False otherwise</p> <p> TYPE: <code>bool</code> </p> Example <pre><code>import pandas as pd\nimport numpy as np\n\n# Pure boolean\ns1 = pd.Series([True, False, True])\nis_boolean_series(s1)  # True\n\n# Boolean with NaN (becomes float in old pandas)\ns2 = pd.Series([True, False, np.nan])\nis_boolean_series(s2)  # True\n\n# Non-boolean\ns3 = pd.Series([1, 2, 3])\nis_boolean_series(s3)  # False\n</code></pre>"}, {"location": "reference/tools/#calc_factor_return", "title": "calc_factor_return()", "text": "<p>\u8a08\u7b97\u56e0\u5b50\u5831\u916c\uff0c\u8a55\u4f30\u56e0\u5b50\u7684\u9078\u80a1\u80fd\u529b\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.tools import factor_analysis as fa\n\n# \u5efa\u7acb\u56e0\u5b50\uff1a\u5c0f\u5e02\u503c\nmarketcap = data.get('etl:market_value')\nfactor = marketcap.rank(pct=True, axis=1) &lt; 0.3\n\n# \u8a08\u7b97\u672a\u4f86 1 \u500b\u6708\u5831\u916c\uff08\u6a19\u7c64\uff09\nclose = data.get('price:\u6536\u76e4\u50f9')\nfuture_return = close.shift(-20) / close - 1\n\n# \u8a08\u7b97\u56e0\u5b50\u5831\u916c\nfactor_return = fa.calc_factor_return(factor, label=future_return)\n\n# \u67e5\u770b\u7d50\u679c\nprint(f\"\u5e73\u5747\u56e0\u5b50\u5831\u916c: {factor_return.mean():.2%}\")\nprint(f\"\u56e0\u5b50\u5831\u916c\u6a19\u6e96\u5dee: {factor_return.std():.2%}\")\nprint(f\"\u56e0\u5b50\u590f\u666e\u7387: {factor_return.mean() / factor_return.std():.2f}\")\n</code></pre> <p>\u89e3\u8b80\uff1a - \u6b63\u503c\uff1a\u56e0\u5b50\u6709\u9078\u80a1\u80fd\u529b\uff08\u9078\u4e2d\u7684\u80a1\u7968\u8868\u73fe\u8f03\u597d\uff09 - \u8ca0\u503c\uff1a\u56e0\u5b50\u53cd\u5411\u6709\u6548\uff08\u61c9\u53cd\u5411\u64cd\u4f5c\uff09 - \u63a5\u8fd1 0\uff1a\u56e0\u5b50\u7121\u9078\u80a1\u80fd\u529b</p> <p>\u6700\u4f73\u5be6\u8e10</p> <ul> <li>\u4f7f\u7528\u9577\u6642\u9593\u56de\u6e2c\u9a57\u8b49\u56e0\u5b50\u7a69\u5b9a\u6027</li> <li>\u5c0d\u6bd4\u4e0d\u540c\u5e02\u5834\u74b0\u5883\uff08\u725b\u5e02\u3001\u718a\u5e02\uff09\u7684\u56e0\u5b50\u8868\u73fe</li> <li>\u7d50\u5408 IC \u5206\u6790\u78ba\u8a8d\u56e0\u5b50\u6709\u6548\u6027</li> </ul>"}, {"location": "reference/tools/#calc_ic", "title": "calc_ic()", "text": "<p>\u8a08\u7b97\u56e0\u5b50 IC\uff08Information Coefficient\uff09\uff0c\u8861\u91cf\u56e0\u5b50\u8207\u672a\u4f86\u5831\u916c\u7684\u76f8\u95dc\u6027\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.tools import factor_analysis as fa\n\n# \u5efa\u7acb\u56e0\u5b50\uff1a\u71df\u6536\u6210\u9577\u7387\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nfactor = revenue.average(3) / revenue.average(12)  # \u8fd1 3 \u6708\u5e73\u5747 vs \u8fd1 12 \u6708\u5e73\u5747\n\n# \u8a08\u7b97\u672a\u4f86\u5831\u916c\nclose = data.get('price:\u6536\u76e4\u50f9')\nfuture_return = close.shift(-20) / close - 1\n\n# \u8a08\u7b97 IC\nic = fa.calc_ic(factor, label=future_return)\n\n# \u67e5\u770b\u7d50\u679c\nprint(f\"\u5e73\u5747 IC: {ic.mean():.4f}\")\nprint(f\"IC \u6a19\u6e96\u5dee: {ic.std():.4f}\")\nprint(f\"IC_IR (IC \u590f\u666e\u7387): {ic.mean() / ic.std():.2f}\")\n\n# \u8996\u89ba\u5316 IC \u6642\u9593\u5e8f\u5217\nic.plot(title='\u71df\u6536\u6210\u9577\u56e0\u5b50 IC')\n</code></pre> <p>IC \u8a55\u4f30\u6a19\u6e96\uff1a</p> IC \u503c \u8a55\u50f9 \u8aaa\u660e &gt; 0.05 \u512a\u79c0 \u56e0\u5b50\u6709\u5f37\u9078\u80a1\u80fd\u529b 0.03 ~ 0.05 \u826f\u597d \u56e0\u5b50\u6709\u9078\u80a1\u80fd\u529b 0.01 ~ 0.03 \u4e00\u822c \u56e0\u5b50\u5f31\u9078\u80a1\u80fd\u529b &lt; 0.01 \u7121\u6548 \u56e0\u5b50\u7121\u9078\u80a1\u80fd\u529b <p>IC \u5206\u6790\u6ce8\u610f\u4e8b\u9805</p> <ul> <li>IC &gt; 0: \u56e0\u5b50\u8207\u672a\u4f86\u5831\u916c\u6b63\u76f8\u95dc\uff08\u505a\u591a\u56e0\u5b50\u9ad8\u5206\u80a1\u7968\uff09</li> <li>IC &lt; 0: \u56e0\u5b50\u8207\u672a\u4f86\u5831\u916c\u8ca0\u76f8\u95dc\uff08\u505a\u591a\u56e0\u5b50\u4f4e\u5206\u80a1\u7968\uff09</li> <li>IC \u6ce2\u52d5\u5927: \u56e0\u5b50\u4e0d\u7a69\u5b9a\uff0c\u98a8\u96aa\u9ad8</li> <li>IC_IR &gt; 0.5: \u56e0\u5b50\u98a8\u96aa\u8abf\u6574\u5f8c\u8868\u73fe\u4f73</li> </ul>"}, {"location": "reference/tools/#calc_shapley_values", "title": "calc_shapley_values()", "text": "<p>\u8a08\u7b97 Shapley values\uff0c\u8a55\u4f30\u591a\u56e0\u5b50\u6a21\u578b\u4e2d\u5404\u56e0\u5b50\u7684\u908a\u969b\u8ca2\u737b\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.tools import factor_analysis as fa\n\n# \u5efa\u7acb\u591a\u500b\u56e0\u5b50\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nclose = data.get('price:\u6536\u76e4\u50f9')\n\nfactor1 = marketcap.rank(pct=True, axis=1) &lt; 0.3  # \u5c0f\u5e02\u503c\nfactor2 = (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &gt; 0.7  # \u71df\u6536\u6210\u9577\nfactor3 = (close / close.shift(20)).rank(pct=True, axis=1) &gt; 0.7  # \u52d5\u80fd\n\n# \u8a08\u7b97\u672a\u4f86\u5831\u916c\nfuture_return = close.shift(-20) / close - 1\n\n# \u8a08\u7b97 Shapley values\nfactors = [factor1, factor2, factor3]\nshapley = fa.calc_shapley_values(factors, label=future_return)\n\n# \u67e5\u770b\u7d50\u679c\nprint(\"\u5404\u56e0\u5b50\u7684 Shapley \u503c:\")\nfor i, value in enumerate(shapley):\n    print(f\"\u56e0\u5b50 {i+1}: {value:.4f}\")\n</code></pre> <p>\u89e3\u8b80\uff1a - \u9ad8 Shapley \u503c\uff1a\u56e0\u5b50\u8ca2\u737b\u5927\uff0c\u91cd\u8981\u6027\u9ad8 - \u4f4e Shapley \u503c\uff1a\u56e0\u5b50\u8ca2\u737b\u5c0f\uff0c\u53ef\u8003\u616e\u79fb\u9664 - \u8ca0 Shapley \u503c\uff1a\u56e0\u5b50\u6709\u5bb3\uff0c\u62c9\u4f4e\u6574\u9ad4\u8868\u73fe</p> <p>\u61c9\u7528\u5efa\u8b70</p> <ul> <li>\u79fb\u9664 Shapley \u503c\u70ba\u8ca0\u6216\u63a5\u8fd1 0 \u7684\u56e0\u5b50</li> <li>\u4fdd\u7559 Shapley \u503c\u9ad8\u7684\u56e0\u5b50</li> <li>\u91cd\u65b0\u8a55\u4f30\u79fb\u9664\u56e0\u5b50\u5f8c\u7684\u7b56\u7565\u8868\u73fe</li> </ul>"}, {"location": "reference/tools/#calc_centrality", "title": "calc_centrality()", "text": "<p>\u8a08\u7b97\u56e0\u5b50\u96c6\u4e2d\u5ea6\uff0c\u8a55\u4f30\u56e0\u5b50\u5728\u4e0d\u540c\u80a1\u7968\u4e0a\u7684\u5206\u5e03\u3002</p> <p>\u4f7f\u7528\u7bc4\u4f8b\uff1a</p> <pre><code>from finlab import data\nfrom finlab.tools import factor_analysis as fa\n\n# \u5efa\u7acb\u56e0\u5b50\nmarketcap = data.get('etl:market_value')\nfactor = marketcap.rank(pct=True, axis=1) &lt; 0.3\n\n# \u8a08\u7b97\u96c6\u4e2d\u5ea6\ncentrality = fa.calc_centrality(factor)\n\nprint(f\"\u56e0\u5b50\u96c6\u4e2d\u5ea6: {centrality}\")\n</code></pre> <p>\u89e3\u8b80\uff1a - \u9ad8\u96c6\u4e2d\u5ea6\uff1a\u56e0\u5b50\u96c6\u4e2d\u5728\u5c11\u6578\u80a1\u7968\uff0c\u5206\u6563\u4e0d\u8db3 - \u4f4e\u96c6\u4e2d\u5ea6\uff1a\u56e0\u5b50\u5206\u6563\u5728\u591a\u6578\u80a1\u7968\uff0c\u5206\u6563\u4f73</p>"}, {"location": "reference/tools/#_6", "title": "\u5b8c\u6574\u7bc4\u4f8b\uff1a\u591a\u56e0\u5b50\u7b56\u7565\u5206\u6790", "text": "<pre><code>from finlab import data\nfrom finlab.tools import factor_analysis as fa\nfrom finlab.backtest import sim\n\n# \u6b65\u9a5f 1\uff1a\u5efa\u7acb\u56e0\u5b50\nmarketcap = data.get('etl:market_value')\nrevenue = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nclose = data.get('price:\u6536\u76e4\u50f9')\n\nfactor1 = marketcap.rank(pct=True, axis=1) &lt; 0.3  # \u5c0f\u5e02\u503c\nfactor2 = (revenue.average(3) / revenue.average(12)).rank(pct=True, axis=1) &gt; 0.7  # \u71df\u6536\u6210\u9577\nfactor3 = (close / close.shift(20)).rank(pct=True, axis=1) &gt; 0.7  # \u52d5\u80fd\n\n# \u6b65\u9a5f 2\uff1a\u8a08\u7b97\u6a19\u7c64\uff08\u672a\u4f86\u5831\u916c\uff09\nfuture_return = close.shift(-20) / close - 1\n\n# \u6b65\u9a5f 3\uff1a\u5206\u6790\u5404\u56e0\u5b50\u8868\u73fe\nprint(\"=== \u56e0\u5b50\u5831\u916c\u5206\u6790 ===\")\nfor i, factor in enumerate([factor1, factor2, factor3], 1):\n    fr = fa.calc_factor_return(factor, label=future_return)\n    ic = fa.calc_ic(factor.rank(pct=True, axis=1), label=future_return)\n    print(f\"\\n\u56e0\u5b50 {i}:\")\n    print(f\"  \u5e73\u5747\u5831\u916c: {fr.mean():.2%}\")\n    print(f\"  \u5e73\u5747 IC: {ic.mean():.4f}\")\n\n# \u6b65\u9a5f 4\uff1a\u8a08\u7b97 Shapley values\uff08\u8ca2\u737b\u5ea6\uff09\nprint(\"\\n=== Shapley Values \u5206\u6790 ===\")\nshapley = fa.calc_shapley_values([factor1, factor2, factor3], label=future_return)\nfor i, value in enumerate(shapley, 1):\n    print(f\"\u56e0\u5b50 {i} \u8ca2\u737b\u5ea6: {value:.4f}\")\n\n# \u6b65\u9a5f 5\uff1a\u56de\u6e2c\u7b56\u7565\nposition = factor1 &amp; factor2 &amp; factor3\nreport = sim(position, resample='M')\nreport.display()\n\nprint(\"\\n=== \u7b56\u7565\u7e3e\u6548 ===\")\nmetrics = report.get_metrics()\nprint(f\"\u5e74\u5316\u5831\u916c: {metrics['annual_return']:.2%}\")\nprint(f\"\u590f\u666e\u7387: {metrics['daily_sharpe']:.2f}\")\nprint(f\"\u6700\u5927\u56de\u64a4: {metrics['max_drawdown']:.2%}\")\n</code></pre>"}, {"location": "reference/tools/#_7", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "reference/tools/#q", "title": "Q: \u5982\u4f55\u5224\u65b7\u4e00\u500b\u56e0\u5b50\u662f\u5426\u6709\u6548\uff1f", "text": "<p>\u4f7f\u7528\u4e09\u500b\u6307\u6a19\u7d9c\u5408\u5224\u65b7\uff1a</p> <pre><code># 1. \u56e0\u5b50\u5831\u916c\uff08\u61c9\u986f\u8457 &gt; 0\uff09\nfactor_return = fa.calc_factor_return(factor, label=future_return)\nprint(f\"\u5e73\u5747\u56e0\u5b50\u5831\u916c: {factor_return.mean():.2%}\")\n\n# 2. IC\uff08\u61c9 &gt; 0.02\uff09\nic = fa.calc_ic(factor.rank(pct=True, axis=1), label=future_return)\nprint(f\"\u5e73\u5747 IC: {ic.mean():.4f}\")\n\n# 3. IC_IR\uff08\u61c9 &gt; 0.5\uff09\nic_ir = ic.mean() / ic.std()\nprint(f\"IC_IR: {ic_ir:.2f}\")\n\n# \u7d50\u8ad6\uff1a\u4e09\u500b\u6307\u6a19\u90fd\u5408\u683c\u624d\u8a8d\u70ba\u56e0\u5b50\u6709\u6548\n</code></pre>"}, {"location": "reference/tools/#q-shapley-values", "title": "Q: Shapley values \u5982\u4f55\u61c9\u7528\u65bc\u7b56\u7565\u512a\u5316\uff1f", "text": "<pre><code># \u8a08\u7b97\u6240\u6709\u56e0\u5b50\u7684 Shapley values\nfactors = [factor1, factor2, factor3, factor4, factor5]\nshapley = fa.calc_shapley_values(factors, label=future_return)\n\n# \u79fb\u9664\u8ca2\u737b\u5ea6\u4f4e\u6216\u8ca0\u7684\u56e0\u5b50\nthreshold = 0.001\nvalid_factors = [f for f, s in zip(factors, shapley) if s &gt; threshold]\n\nprint(f\"\u539f\u59cb\u56e0\u5b50\u6578: {len(factors)}\")\nprint(f\"\u512a\u5316\u5f8c\u56e0\u5b50\u6578: {len(valid_factors)}\")\n\n# \u4f7f\u7528\u512a\u5316\u5f8c\u7684\u56e0\u5b50\u7d44\u5408\noptimized_position = valid_factors[0]\nfor factor in valid_factors[1:]:\n    optimized_position = optimized_position &amp; factor\n</code></pre>"}, {"location": "reference/tools/#q-ic", "title": "Q: IC \u548c\u56e0\u5b50\u5831\u916c\u7684\u5340\u5225\uff1f", "text": "<ul> <li>IC (Information Coefficient):</li> <li>\u8861\u91cf\u56e0\u5b50\u503c\u8207\u672a\u4f86\u5831\u916c\u7684\u76f8\u95dc\u6027</li> <li>\u7bc4\u570d [-1, 1]\uff0c\u8d8a\u63a5\u8fd1 1 \u8d8a\u597d</li> <li> <p>\u9069\u5408\u8a55\u4f30\u9023\u7e8c\u578b\u56e0\u5b50\uff08\u5982\u5e02\u503c\u3001ROE\uff09</p> </li> <li> <p>\u56e0\u5b50\u5831\u916c:</p> </li> <li>\u8861\u91cf\u56e0\u5b50\u9078\u51fa\u7684\u80a1\u7968\u7684\u5e73\u5747\u5831\u916c</li> <li>\u9069\u5408\u8a55\u4f30\u4e8c\u5143\u56e0\u5b50\uff08True/False\uff09</li> <li>\u76f4\u63a5\u53cd\u6620\u9078\u80a1\u6548\u679c</li> </ul> <pre><code># \u9023\u7e8c\u578b\u56e0\u5b50\u7528 IC\ncontinuous_factor = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nic = fa.calc_ic(continuous_factor, label=future_return)\n\n# \u4e8c\u5143\u56e0\u5b50\u7528\u56e0\u5b50\u5831\u916c\nbinary_factor = continuous_factor &lt; continuous_factor.quantile(0.3, axis=1)\nfactor_return = fa.calc_factor_return(binary_factor, label=future_return)\n</code></pre>"}, {"location": "reference/tools/#_8", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u56e0\u5b50\u5206\u6790\u5b8c\u6574\u6559\u5b78 - \u7aef\u5230\u7aef\u7bc4\u4f8b</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b - \u5305\u542b\u56e0\u5b50\u5206\u6790\u6b65\u9a5f</li> <li>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565 - \u4f7f\u7528 ML \u81ea\u52d5\u6316\u6398\u56e0\u5b50</li> </ul>"}, {"location": "tools/cheap-stock-ratio/", "title": "\u5927\u8dcc\u5e95\u90e8\u5224\u65b7", "text": "<p>\u4f7f\u7528\u300c\u80a1\u50f9\u6de8\u503c\u6bd4\u300d\u8ddf\u300c\u672c\u76ca\u6bd4\u300d\u4fbf\u5b9c\u80a1\u6578\u91cf\u4f86\u63a8\u4f30\uff0c \u4f86\u770b\u5927\u8dcc\u662f\u5426\u5c07\u8db3\u5920\u591a\u7684\u80a1\u7968\u6253\u5165\u300c\u4fbf\u5b9c\u80a1\u300d\u3002 \u7576\u300c\u4fbf\u5b9c\u80a1\u300d\u5920\u591a\u6642\uff0c\u5c31\u4ee3\u8868\u53ef\u80fd\u5df2\u7d93\u8dcc\u7121\u53ef\u8dcc\uff0c\u800c\u76ee\u524d\u53f0\u80a1\u591a\u6bba\u591a\u7684\u60c5\u6cc1\u4e0b\uff0c\u662f\u5426\u5df2\u7d93\u662f\u6700\u4f4e\u9ede\u4e86\u5462\uff1f</p>"}, {"location": "tools/cheap-stock-ratio/#_2", "title": "\u300c\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1\u300d\u548c\u300c\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1\u300d", "text": "<p>\u4fbf\u5b9c\u80a1\u6709\u5f88\u591a\u7a2e\uff0c\u6709\u4e9b\u53ef\u4ee5\u7528\u516c\u53f8\u7684\u6de8\u503c\u8ddf\u80a1\u50f9\u505a\u5224\u65b7 \u4e5f\u53ef\u4ee5\u662f\u516c\u53f8\u7684\u71df\u6536</p>"}, {"location": "tools/cheap-stock-ratio/#_3", "title": "\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1", "text": "<p>\u662f\u6307\u53f0\u7063\u4e0a\u5e02\u4e0a\u6ac3\uff0c\u80a1\u50f9\u6de8\u503c\u6bd4 &lt; 0.6 \u7684\u80a1\u7968\u3002</p>"}, {"location": "tools/cheap-stock-ratio/#_4", "title": "\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1", "text": "<p>\u662f\u6307\u53f0\u7063\u4e0a\u5e02\u4e0a\u6ac3\uff0c\u672c\u76ca\u6bd4 &lt; 8 \u7684\u80a1\u7968\u3002</p>"}, {"location": "tools/cheap-stock-ratio/#_5", "title": "\u7a0b\u5f0f\u78bc", "text": ""}, {"location": "tools/cheap-stock-ratio/#_6", "title": "\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1", "text": "<p>\u8a08\u7b97\u300c\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1\u300d\u4f54\u6240\u6709\u4e0a\u5e02\u4e0a\u6ac3\u7684\u80a1\u7968\u6bd4\u4f8b <pre><code>from finlab import data\n\n# \u8a08\u7b97\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\nsmall_pb_ratio = (pb &lt; 0.6).sum(axis=1) / pb.notna().sum(axis=1)\n</code></pre></p>"}, {"location": "tools/cheap-stock-ratio/#_7", "title": "\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1", "text": "<p>\u8a08\u7b97\u300c\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1\u300d\u4f54\u6240\u6709\u4e0a\u5e02\u4e0a\u6ac3\u7684\u80a1\u7968\u6bd4\u4f8b <pre><code># \u8a08\u7b97\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nsmall_pe_ratio = (pe &lt; 10).sum(axis=1) / pe.notna().sum(axis=1)\n</code></pre></p>"}, {"location": "tools/cheap-stock-ratio/#_8", "title": "\u7e6a\u88fd\u5716\u8868", "text": "<p><pre><code>from finlab import plot\n\nplot.plot_tw_stock_candles('0050', recent_days=100000, resample='M', technical_func={\n  'small_pb_ratio': lambda ohlcv: small_pb_ratio.reindex(ohlcv.index, method='ffill'),\n  'small_pe_ratio': lambda ohlcv: small_pe_ratio.reindex(ohlcv.index, method='ffill'),\n})\n</code></pre> </p>"}, {"location": "tools/cheap-stock-ratio/#_9", "title": "\u6307\u6a19\u610f\u7fa9", "text": "<p>\u7576\u53f0\u80a1\u4f4d\u65bc\u9ad8\u6a94\u6642\uff0c\u300c\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1\u300d\u8ddf\u300c\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1\u300d\u6578\u91cf\u504f\u4f4e\u3002 \u7576\u53f0\u80a1\u66b4\u8dcc\u81f3\u4f4e\u9ede\uff0c\u300c\u6de8\u503c\u6bd4\u4fbf\u5b9c\u80a1\u300d\u8ddf\u300c\u672c\u76ca\u6bd4\u4fbf\u5b9c\u80a1\u300d\u6578\u91cf\u6703\u96d9\u96d9 \u66b4\u6f32\u3002 \u5047\u5982\u4e0b\u8dcc\u6642\uff0c\u53ea\u89c0\u5bdf\u5230\u5176\u4e2d\u4e00\u500b\u6307\u6a19\u66b4\u6f32\uff0c\u4e0d\u8db3\u4ee5\u8b49\u660e\u53f0\u80a1\u5df2\u7d93\u8dcc\u81f3\u4f4e\u9ede\u3002</p>"}, {"location": "tools/important_info_search/", "title": "\u91cd\u8a0a\u516c\u544a\u641c\u5c0b - \u696d\u5916\u640d\u5931", "text": ""}, {"location": "tools/important_info_search/#_1", "title": "\u8ca1\u5831\u696d\u5916\u8f49\u6295\u8cc7\u8667\u640d\u98a8\u96aa", "text": "<p>\u53f0\u80a12022Q2\u5927\u8dcc\uff0c7-8\u6708\u6703\u958b\u59cb\u9678\u7e8c\u767c\u5e03Q2\u8ca1\u5831\uff0c\u8981\u6ce8\u610f\u6709\u4e9b\u559c\u6b61\u64cd\u4f5c\u77ed\u671f\u6295\u8cc7\u7684\u516c\u53f8\u82e5\u6709\u5728Q2\u91cd\u8a0a\u516c\u544a\u8655\u5206\u640d\u5931\uff0c\u8ca1\u5831\u5c07\u6703\u9762\u81e8\u696d\u5916\u8f49\u6295\u8cc7\u8667\u640d\u3002 \u53e6\u5916\u8f49\u6295\u8cc7\u6709\u50f9\u8b49\u5238\u4f54\u8cc7\u7522\u6bd4\u4f8b\u9ad8\u7684\u4e5f\u8981\u6ce8\u610f\u91d1\u878d\u8a55\u50f9\u640d\u5931\u7684\u98a8\u96aa\u3002\u7b49\u8ca1\u5831\u958b\u724c\u5df2\u7d93\u6162\u4e86\uff0c\u6709\u4e9b\u529f\u8ab2\u53ef\u4ee5\u63d0\u65e9\u505a\u3002</p> <p>FinLab\u8cc7\u6599\u5eab\u6709\u91cd\u8a0a\u7684\u6b77\u53f2\u8cc7\u6599\uff0c\u8abf\u8cc7\u6599\u770b\u770b\u54ea\u4e9b\u516c\u53f8Q2\u6709\u8655\u5206\u6709\u50f9\u8b49\u5238\u640d\u5931\u7684\u9a37\u64cd\u4f5c\u3002</p> <p>\u5b98\u65b9\u7684\u95dc\u9375\u5b57\u67e5\u8a62\u7cfb\u7d71\u4e0d\u597d\u7528\uff0c\u4e0a\u5e02\u6ac3\u88ab\u5206\u958b\uff0c\u9084\u662f\u81ea\u5df1\u7528\u7a0b\u5f0f\u641c\u5c0b\u6bd4\u8f03\u5feb\u3002</p>"}, {"location": "tools/important_info_search/#pandas-contains", "title": "pandas contains \u8a9e\u6cd5", "text": "<p>\u4f7f\u7528\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\uff0c\u7528pandas\u7684contains\u505a\u6a21\u7cca\u6bd4\u5c0d\uff0c\u627e\u51fa\u6a19\u984c\u8207\u5167\u5bb9\u542b\u6709\u95dc\u9375\u5b57\u7684\u91cd\u8a0a\u516c\u544a\u3002</p> <p><pre><code>from finlab import data\ninfo = data.get('important_info_announcement')\nreport = info[(info.index&gt;'2022-04') &amp; (info['title'].str.contains('\u8655\u5206')) &amp; (info['title'].str.contains('\u6709\u50f9\u8b49\u5238'))  &amp; (info['info'].str.contains('\u8655\u5206\u640d\u5931'))]\n</code></pre> \u7d50\u679c\u767c\u73fe1268\u6f22\u4f86\u7f8e\u98df\u7684\u554f\u984c\u6bd4\u5176\u4ed6\u5bb6\u5927\u689d\uff1a</p> <p>\u91cd\u8a0a\u516c\u544a</p> <p><pre><code>\u516c\u544a\u672c\u516c\u53f8\u4e00\u5e74\u5167\u7d2f\u7a4d\u8655\u5206\u540c\u4e00\u6709\u50f9\u8b49\u5238\u9054\u5be6\u6536\u8cc7\u672c\u984d20%\n1.\u8b49\u5238\u540d\u7a31:\n2603\u9577\u69ae\u6d77\u904b\u80a1\u4efd\u6709\u9650\u516c\u53f8\n2.\u4ea4\u6613\u65e5\u671f:111/6/29~111/7/1\n3.\u4ea4\u6613\u6578\u91cf\u3001\u6bcf\u55ae\u4f4d\u50f9\u683c\u53ca\u4ea4\u6613\u7e3d\u91d1\u984d:\n1,000,000\u80a1\uff1b\u65b0\u53f0\u5e6385.3\u5143~95\u5143\uff1b\u65b0\u53f0\u5e6392,814,600\u5143\n4.\u8655\u5206\u5229\u76ca\uff08\u6216\u640d\u5931\uff09\uff08\u53d6\u5f97\u6709\u50f9\u8b49\u5238\u8005\u4e0d\u9069\u7528\uff09:\n\u8655\u5206\u640d\u5931\u65b0\u53f0\u5e6334,601,955\u5143\n\u8fc4\u76ee\u524d\u70ba\u6b62\uff0c\u4f9d\u300c\u516c\u958b\u767c\u884c\u516c\u53f8\u53d6\u5f97\u6216\u8655\u5206\u8cc7\u7522\u8655\u7406\u6e96\u5247\u300d\u7b2c\u4e09\u689d\u6240\u5217\u4e4b\u6709\u50f9\u8b49\u5238\u6295\n\u8cc7\uff08\u542b\u672c\u6b21\u4ea4\u6613\uff09\u5360\u516c\u53f8\u6700\u8fd1\u671f\u8ca1\u52d9\u5831\u8868\u4e2d\u7e3d\u8cc7\u7522\u53ca\u6b78\u5c6c\u65bc\u6bcd\u516c\u53f8\u696d\u4e3b\u4e4b\u6b0a\u76ca\u4e4b\u6bd4\u4f8b\n\u66a8\u6700\u8fd1\u671f\u8ca1\u52d9\u5831\u8868\u4e2d\u71df\u904b\u8cc7\u91d1\u6578\u984d:\n\u5360\u7e3d\u8cc7\u7522\u6bd4\u4f8b\uff1a16.19%(\u542b\u5176\u4ed6\u6709\u50f9\u8b49\u5238\u6295\u8cc7)\n\u5360\u80a1\u6771\u6b0a\u76ca\u6bd4\u4f8b\uff1a37.09%(\u542b\u5176\u4ed6\u6709\u50f9\u8b49\u5238\u6295\u8cc7)\n\u71df\u904b\u8cc7\u91d1\uff1a770,504\u5343\u5143\n</code></pre> \u770b\u8d77\u4f86\u662f\u9910\u98f2\u696d\u4e0d\u666f\u6c23\uff0c\u60f3\u9760\u8f49\u6295\u8cc7\u7576\u6c34\u624b\u640f\u4e00\u628a\uff0c111/6/27~111/6/29\u5148\u516c\u544a\u5927\u8cb7\u9577\u69ae\uff0c\u7d50\u679c\u77ed\u77ed\u5e7e\u5929\u5c31\u505c\u640d\u51fa\u5834\uff0c\u640d\u5931\u4e863400\u842c\uff0c \u7528\u8cc7\u80a1\u65784272.37\u842c\u80a1\u4f86\u7b97\uff0c\u5f71\u97ffeps\u7d04 -0.8\uff0c\u672c\u696d\u5df2\u7d93\u5920\u6158\u4e86\uff0c\u73fe\u5728\u53c8\u591a\u4e00\u7b46\u696d\u5916\u8667\u640d\u3002 1268\u6f22\u4f86\u7f8e\u98df\u9019\u5247\u91cd\u8a0a\u4f86\u6709\u500b\u91cd\u9ede\u5728\u6709\u50f9\u8b49\u5238\u6295\u8cc7\u4f54\u80a1\u6771\u6b0a\u76ca\u592a\u9ad8\u4e86\uff0c\u9019\u6b21\u64cd\u4f5c\u9577\u69ae\u5c31\u9054\u5be6\u6536\u8cc7\u672c\u984d20%\uff0c\u98a8\u96aa\u5f88\u5927\u554a\uff01</p> <p>\u67e5\u4e00\u4e0b\u4ed6\u8f49\u6295\u8cc7\u660e\u7d30\uff0c\u4e0a\u5e02\u6ac3\u7684\u9084\u6709\u4e2d\u92fc\u3001\u5ee3\u9054\u3001\u74b0\u7403\u6676\u5713...\u6700\u8fd1\u90fd\u8dcc\u5230\u7206\u70b8\uff0c\u6301\u6709\u6210\u672c\u6709\u8208\u8da3\u7684\u4eba\u53ef\u4ee5\u53bb\u67e5\uff0c\u4e4b\u5f8c\u6709\u6c92\u6709\u8655\u5206\u640d\u5931\uff1f\u5c31\u7b97\u4e0d\u8ce3\uff0c Q2 \u8cc7\u7522\u8ca0\u50b5\u8868\u4e0b\u7684\"\u900f\u904e\u640d\u76ca\u6309\u516c\u5141\u50f9\u503c\u8861\u91cf\u4e4b\u91d1\u878d\u8cc7\u7522\u9019\u9805\u6b04\u4f4d\"\u7684\u6578\u5b57\u6e96\u5099\u96e3\u770b\u4e86\u3002 \u9664\u4e861268\u6f22\u4f86\u7f8e\u98df\uff0c\u6700\u8fd1\u4e5f\u6709\u4e00\u4e9b\u516c\u53f8\u505c\u640d\u53f0\u7a4d\u96fb\u3002</p> <p>\u9806\u9053\u67e5\u4e00\u4e0b\u4eca\u5e74\u54ea\u4e9b\u516c\u53f8\u6700\u8fd1\u4e5f\u5f88\u591a\u53f0\u80a1\u6709\u50f9\u8b49\u5238\u7684\u64cd\u4f5c\uff0c\u9664\u4e862323\u4e2d\u74b0\u6295\u9867 (\u5149\u789f\u672c\u696d\u4e0d\u592a\u884c\uff0c\u4e00\u5929\u5230\u665a\u767c\u80a1\u7968\u4ea4\u6613\u91cd\u8a0a) \uff0c 2704\u570b\u8cd3\u4e5f\u767c\u4f48\u591a\u6b21\uff0c\u548c1268\u6f22\u4f86\u7f8e\u98df\u4e00\u6a23\u90fd\u662f\u89c0\u5149\u696d\uff0c\u662f\u4e0d\u662f\u53c8\u4e00\u9846\u96f7\uff1f\u4e00\u67e5\u4e4b\u4e0b\u767c\u73fe\u662f\u8ce3\u6389\u6301\u80a1\u4e0d\u5c11\u7684\u4e2d\u4fe1\u91d1\uff0c\u5be6\u73fe\u7372\u5229\uff0c \u628a\u8cc7\u91d1\u8f49\u5230\u53f0\u7a4d\u96fb\u4e0a\uff0c\u76ee\u524d\u6210\u70ba574T\u5927\u5b78\u9577...\u77ed\u7dda\u4e5f\u8ce0\u8d85\u904e20%\u3002</p> <p>\u91cd\u8a0a\u516c\u544a</p> <p><pre><code>1.\u8b49\u5238\u540d\u7a31:\n\u53f0\u7a4d\u96fb \u666e\u901a\u80a1\n2.\u4ea4\u6613\u65e5\u671f:111/3/10~111/4/8\n3.\u4ea4\u6613\u6578\u91cf\u3001\u6bcf\u55ae\u4f4d\u50f9\u683c\u53ca\u4ea4\u6613\u7e3d\u91d1\u984d:\n\u4ea4\u6613\u6578\u91cf(\u80a1):540,000\u3001\u6bcf\u55ae\u4f4d\u50f9\u683c(\u5143):574.72\u3001\u4ea4\u6613\u7e3d\u91d1\u984d(\u5143):310,346,683\n</code></pre> \u9019\u4e9b\u672c\u696d\u6578\u64da\u504f\u5f31\u3001\u559c\u6b61\u5728\u8f49\u6295\u8cc7\u7422\u78e8\u7684\u516c\u53f8\u5728Q2\u8ca1\u5831\u5bb9\u6613\u5403\u5230\u82e6\u982d\uff0c\u6700\u597d\u5148\u907f\u958b\u96f7\u5305\uff0c\u6709\u4e9b\u71df\u6536\u6578\u5b57\u770b\u8d77\u4f86\u9084\u597d\uff0c\u4f46\u696d\u5916\u6295\u8cc7\u70b8\u5f48\u4e00\u7206\u5c31\u628a\u672c\u696d\u7372\u5229\u5403\u5149\u3002 -- \u53f0\u80a1\u5e02\u5834\u6709\u6642\u6c92\u6548\u7387\uff0c\u9019\u985e\u8655\u5206\u516c\u544a\u82e5\u662f\u4e2d\u5c0f\u578b\u51b7\u9580\u80a1\u6240\u767c\uff0c\u6295\u8cc7\u4eba\u5e38\u5728\u7576\u4e0b\u7121\u611f\uff0c\u5728\u8ca1\u5831\u767c\u4f48\u5f8c\u624d\u5f8c\u77e5\u5f8c\u89ba\uff0c\u6c92\u4ed4\u7d30\u767c\u73fe\u5148\u524d\u7684\u91cd\u8a0a\u65e9\u5c31\u958b\u724c\uff0c \u50cf\u662f\u53bb\u5e746523\u7684\u9054\u723e\u819a\uff0c2020\u5e74\u5e95\u5c31\u91cd\u8a0a\u516c\u544a\u8655\u5206\u4e2d\u570b\u5b50\u516c\u53f8\u80a1\u6b0a\u7684\u7372\u5229\uff0c\u53ef\u4ee5\u6709\u6642\u9593\u5728\u516c\u544a\u8ca1\u5831\u524d\u4f48\u5c40\uff0c\u4e4b\u5f8c\u8ca1\u5831\u548c\u80a1\u5229\u958b\u724c\uff0c\u72c2\u98c6\u4e00\u6ce2\u3002 \u9019\u53ef\u4e0d\u53ef\u4ee5\u8a2d\u8a08\u6210\u4e8b\u4ef6\u578b\u7b56\u7565\u7684SOP\u5462\uff1f\u6709\u8208\u8da3\u7684\u4eba\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b\u3002</p>"}, {"location": "workflows/complete_strategy_workflow/", "title": "\u5f9e\u7814\u7a76\u5230\u5be6\u76e4:\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b", "text": "<p>\u672c\u6587\u63d0\u4f9b\u4e00\u500b\u5b8c\u6574\u7684\u7aef\u5230\u7aef\u7bc4\u4f8b,\u5c55\u793a\u5982\u4f55\u5f9e\u7b56\u7565\u69cb\u60f3\u958b\u59cb,\u7d93\u904e\u56de\u6e2c\u3001\u512a\u5316\u3001\u9a57\u8b49,\u6700\u7d42\u90e8\u7f72\u81f3\u5be6\u76e4\u4ea4\u6613,\u6db5\u84cb\u6574\u500b\u91cf\u5316\u4ea4\u6613\u7b56\u7565\u7684\u751f\u547d\u9031\u671f\u3002</p> <p>\u5168\u6d41\u7a0b AI \u8f14\u52a9</p> <p>\u672c\u6d41\u7a0b\u7684\u6bcf\u500b\u968e\u6bb5\u90fd\u53ef\u642d\u914d AI \u7de8\u7a0b\u52a9\u624b\u5b8c\u6210\u3002\u5b89\u88dd FinLab Skill \u5f8c\uff0c\u5f9e\u7b56\u7565\u69cb\u60f3\u5230\u5be6\u76e4\u90e8\u7f72\uff0cAI \u53ef\u5354\u52a9\u64b0\u5beb\u7a0b\u5f0f\u78bc\u3001\u89e3\u8b80\u7e3e\u6548\u3001\u6392\u9664\u932f\u8aa4\u3002</p>"}, {"location": "workflows/complete_strategy_workflow/#_2", "title": "\u6d41\u7a0b\u6982\u89bd", "text": "<pre><code>graph TD\n    A[\u7b56\u7565\u69cb\u60f3] --&gt; B[\u8cc7\u6599\u63a2\u7d22]\n    B --&gt; C[\u7b56\u7565\u958b\u767c]\n    C --&gt; D[\u7b56\u7565\u512a\u5316]\n    D --&gt; E[\u6df1\u5ea6\u5206\u6790]\n    E --&gt; F[\u6a23\u672c\u5916\u6e2c\u8a66]\n    F --&gt; G{\u901a\u904e\u9a57\u8b49?}\n    G --&gt;|\u662f| H[\u90e8\u7f72\u524d\u6e96\u5099]\n    G --&gt;|\u5426| C\n    H --&gt; I[\u5be6\u76e4\u4ea4\u6613]\n    I --&gt; J[\u7e3e\u6548\u8ffd\u8e64]\n    J --&gt; K{\u9700\u8981\u8abf\u6574?}\n    K --&gt;|\u662f| C\n    K --&gt;|\u5426| I</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#1", "title": "\u968e\u6bb5 1: \u7b56\u7565\u69cb\u60f3\u8207\u521d\u6b65\u7814\u7a76", "text": ""}, {"location": "workflows/complete_strategy_workflow/#_3", "title": "\u7b56\u7565\u5047\u8a2d", "text": "<p>\u6211\u5011\u8981\u958b\u767c\u4e00\u500b\u300c\u71df\u6536\u6210\u9577 + \u6280\u8853\u7a81\u7834\u300d\u7684\u7d44\u5408\u7b56\u7565:</p> <ul> <li>\u57fa\u672c\u9762: \u71df\u6536\u8fd1\u671f\u52a0\u901f\u6210\u9577(\u6708\u5747\u7dda\u4e0a\u63da)</li> <li>\u6280\u8853\u9762: \u80a1\u50f9\u7a81\u7834\u5747\u7dda,\u78ba\u8a8d\u52d5\u80fd</li> <li>\u98a8\u63a7: \u8dcc\u7834\u5747\u7dda\u51fa\u5834,\u8a2d\u5b9a 10% \u505c\u640d</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#_4", "title": "\u8cc7\u6599\u63a2\u7d22", "text": "<p>\u9996\u5148\u6aa2\u67e5\u6240\u9700\u8cc7\u6599\u662f\u5426\u5b8c\u6574:</p> <pre><code>from finlab import data\nimport pandas as pd\n\n# \u8f09\u5165\u6240\u9700\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# \u6aa2\u67e5\u8cc7\u6599\u7bc4\u570d\nprint(f\"\u6536\u76e4\u50f9\u8cc7\u6599: {close.index[0]} ~ {close.index[-1]}\")\nprint(f\"\u71df\u6536\u8cc7\u6599: {rev.index[0]} ~ {rev.index[-1]}\")\n\n# \u6aa2\u67e5\u7f3a\u5931\u503c\u6bd4\u4f8b\nprint(f\"\u6536\u76e4\u50f9\u7f3a\u5931\u503c: {close.isna().sum().sum() / close.size * 100:.2f}%\")\nprint(f\"\u71df\u6536\u7f3a\u5931\u503c: {rev.isna().sum().sum() / rev.size * 100:.2f}%\")\n\n# \u8f38\u51fa:\n# \u6536\u76e4\u50f9\u8cc7\u6599: 2007-04-23 ~ 2024-12-31\n# \u71df\u6536\u8cc7\u6599: 2000-01-01 ~ 2024-12-01\n# \u6536\u76e4\u50f9\u7f3a\u5931\u503c: 2.15%\n# \u71df\u6536\u7f3a\u5931\u503c: 8.73%\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#2", "title": "\u968e\u6bb5 2: \u7b56\u7565\u958b\u767c\u8207\u56de\u6e2c", "text": ""}, {"location": "workflows/complete_strategy_workflow/#_5", "title": "\u64b0\u5beb\u7b56\u7565\u908f\u8f2f", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# 1. \u8cc7\u6599\u8f09\u5165\nclose = data.get('price:\u6536\u76e4\u50f9')\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# 2. \u8a08\u7b97\u6280\u8853\u6307\u6a19\nma20 = close.average(20)\nma60 = close.average(60)\n\n# 3. \u8a08\u7b97\u71df\u6536\u6307\u6a19\nrev_ma3 = rev.average(3)   # \u8fd1 3 \u500b\u6708\u5e73\u5747\u71df\u6536\nrev_ma12 = rev.average(12)  # \u8fd1 12 \u500b\u6708\u5e73\u5747\u71df\u6536\n\n# 4. \u5b9a\u7fa9\u9032\u5834\u689d\u4ef6\nentry_tech = (close &gt; ma20) &amp; (close &gt; ma60)  # \u6280\u8853\u9762:\u7a81\u7834\u5747\u7dda\nentry_fund = (rev_ma3 / rev_ma12) &gt; 1.1       # \u57fa\u672c\u9762:\u71df\u6536\u52a0\u901f\u6210\u9577\n\nentry_signal = entry_tech &amp; entry_fund\n\n# 5. \u5b9a\u7fa9\u51fa\u5834\u689d\u4ef6\nexit_signal = close &lt; ma20  # \u8dcc\u7834 20 \u65e5\u5747\u7dda\n\n# 6. \u7d44\u5408\u9032\u51fa\u5834\u8a0a\u865f(\u542b\u505c\u640d)\nposition = entry_signal.hold_until(\n    exit=exit_signal,\n    stop_loss=0.1  # \u505c\u640d 10%\n)\n\n# 7. \u56de\u6e2c\nreport = sim(\n    position,\n    resample='M',        # \u6bcf\u6708\u8abf\u6574\n    position_limit=0.1,  # \u55ae\u4e00\u6301\u80a1\u4e0a\u9650 10%\n    upload=False,\n    name=\"\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565 v1.0\"\n)\n\n# 8. \u986f\u793a\u7e3e\u6548\nreport.display()\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#_6", "title": "\u521d\u6b65\u7e3e\u6548\u8a55\u4f30", "text": "<pre><code>stats = report.get_stats()\n\nprint(f\"\u5e74\u5316\u5831\u916c\u7387: {stats['daily_mean']*100:.2f}%\")\nprint(f\"\u590f\u666e\u7387: {stats['daily_sharpe']:.2f}\")\nprint(f\"\u6700\u5927\u56de\u64a4: {stats['max_drawdown']*100:.2f}%\")\nprint(f\"\u52dd\u7387: {stats['win_ratio']*100:.2f}%\")\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n# \u5e74\u5316\u5831\u916c\u7387: 15.23%\n# \u590f\u666e\u7387: 0.87\n# \u6700\u5927\u56de\u64a4: -28.45%\n# \u52dd\u7387: 52.3%\n</code></pre> <p>\u521d\u6b65\u5224\u65b7</p> <ul> <li>\u5e74\u5316\u5831\u916c\u7387 15% \u4e0d\u932f,\u4f46\u590f\u666e\u7387 0.87 \u504f\u4f4e</li> <li>\u6700\u5927\u56de\u64a4 -28% \u53ef\u63a5\u53d7</li> <li>\u63a5\u4e0b\u4f86\u9700\u8981\u512a\u5316\u7b56\u7565,\u63d0\u5347\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#3", "title": "\u968e\u6bb5 3: \u7b56\u7565\u512a\u5316", "text": ""}, {"location": "workflows/complete_strategy_workflow/#31-sim_conditions", "title": "3.1 \u4f7f\u7528 sim_conditions() \u6e2c\u8a66\u689d\u4ef6\u7d44\u5408", "text": "<p>\u6211\u5011\u65b0\u589e\u66f4\u591a\u5019\u9078\u689d\u4ef6,\u627e\u51fa\u6700\u4f73\u7d44\u5408:</p> <pre><code>from finlab.optimize.combinations import sim_conditions\n\n# \u539f\u6709\u689d\u4ef6\nc1 = (close &gt; ma20) &amp; (close &gt; ma60)  # \u5747\u7dda\u591a\u982d\nc2 = rev_ma3 / rev_ma12 &gt; 1.1         # \u71df\u6536\u52a0\u901f\n\n# \u65b0\u589e\u689d\u4ef6\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nc3 = pe &lt; 15                          # \u4f4e\u672c\u76ca\u6bd4\nc4 = close == close.rolling(20).max()  # \u5275 20 \u65e5\u65b0\u9ad8\nc5 = rev / rev.shift(1) &gt; 0.9         # \u71df\u6536\u6708\u589e\u7387 &gt; -10%\n\n# \u7d44\u5408\u5b57\u5178\nconditions = {\n    'c1': c1,  # \u5747\u7dda\u591a\u982d\n    'c2': c2,  # \u71df\u6536\u52a0\u901f\n    'c3': c3,  # \u4f4e\u672c\u76ca\u6bd4\n    'c4': c4,  # \u5275\u65b0\u9ad8\n    'c5': c5   # \u71df\u6536\u6708\u589e\u7387\n}\n\n# \u6e2c\u8a66\u6240\u6709\u7d44\u5408(31 \u7a2e)\nreport_collection = sim_conditions(\n    conditions=conditions,\n    hold_until={'exit': exit_signal, 'stop_loss': 0.1},\n    resample='M',\n    position_limit=0.1,\n    upload=False\n)\n\n# \u8996\u89ba\u5316\u6bd4\u8f03\nreport_collection.plot_stats('heatmap')\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#32", "title": "3.2 \u5206\u6790\u512a\u5316\u7d50\u679c", "text": "<pre><code># \u53d6\u5f97\u7e3e\u6548\u6307\u6a19\u8868\nstats_df = report_collection.get_stats()\n\n# \u627e\u51fa top 3 \u7d44\u5408\ntop3 = stats_df.T.sort_values('daily_sharpe', ascending=False).head(3)\nprint(top3[['daily_mean', 'daily_sharpe', 'max_drawdown', 'win_ratio']])\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n#              daily_mean  daily_sharpe  max_drawdown  win_ratio\n# c1 &amp; c2 &amp; c3      0.182         1.35        -0.245      0.561\n# c1 &amp; c2 &amp; c5      0.165         1.28        -0.267      0.548\n# c1 &amp; c2          0.152         0.87        -0.285      0.523\n</code></pre> <p>\u512a\u5316\u6210\u679c</p> <p><code>c1 &amp; c2 &amp; c3</code>(\u5747\u7dda\u591a\u982d + \u71df\u6536\u52a0\u901f + \u4f4e\u672c\u76ca\u6bd4)\u7d44\u5408\u7684\u590f\u666e\u7387\u5f9e 0.87 \u63d0\u5347\u81f3 1.35,\u5927\u5e45\u6539\u5584!</p>"}, {"location": "workflows/complete_strategy_workflow/#33", "title": "3.3 \u63a1\u7528\u6700\u4f73\u7d44\u5408", "text": "<pre><code># \u4f7f\u7528\u6700\u4f73\u7d44\u5408\u91cd\u65b0\u5b9a\u7fa9\u7b56\u7565\nbest_entry = c1 &amp; c2 &amp; c3\n\nposition_optimized = best_entry.hold_until(\n    exit=exit_signal,\n    stop_loss=0.1\n)\n\nreport_opt = sim(\n    position_optimized,\n    resample='M',\n    position_limit=0.1,\n    upload=False,\n    name=\"\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565 v2.0 (\u512a\u5316\u5f8c)\"\n)\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#34", "title": "3.4 \u512a\u5316\u505c\u640d\u505c\u5229", "text": "<p>\u900f\u904e MAE/MFE \u5206\u6790\u627e\u51fa\u6700\u4f73\u505c\u640d\u505c\u5229\u9ede:</p> <pre><code># \u986f\u793a\u6ce2\u52d5\u5206\u6790\nreport_opt.display_mae_mfe_analysis()\n\n# \u53d6\u5f97\u4ea4\u6613\u8a18\u9304\ntrades = report_opt.get_trades()\n\n# \u5206\u6790 MAE/MFE \u5206\u4f4d\u6578\nmae_q75 = abs(trades['mae'].quantile(0.75))\ngmfe_q75 = trades['gmfe'].quantile(0.75)\n\nprint(f\"MAE Q75: {mae_q75*100:.2f}%\")  # \u4f8b\u5982 8.5%\nprint(f\"GMFE Q75: {gmfe_q75*100:.2f}%\")  # \u4f8b\u5982 18.3%\n\n# \u8abf\u6574\u505c\u640d\u505c\u5229\nposition_final = best_entry.hold_until(\n    exit=exit_signal,\n    stop_loss=mae_q75 * 1.2,      # \u505c\u640d\u8a2d\u70ba MAE Q75 * 1.2 = 10.2%\n    take_profit=gmfe_q75 * 0.8    # \u505c\u5229\u8a2d\u70ba GMFE Q75 * 0.8 = 14.6%\n)\n\nreport_final = sim(\n    position_final,\n    resample='M',\n    position_limit=0.1,\n    upload=False,\n    name=\"\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565 v3.0 (\u6700\u7d42\u7248)\"\n)\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#4", "title": "\u968e\u6bb5 4: \u6df1\u5ea6\u5206\u6790", "text": ""}, {"location": "workflows/complete_strategy_workflow/#41", "title": "4.1 \u6d41\u52d5\u6027\u98a8\u96aa\u6aa2\u6e2c", "text": "<p>\u6aa2\u67e5\u7b56\u7565\u662f\u5426\u9069\u5408\u5927\u8cc7\u91d1:</p> <pre><code># \u6d41\u52d5\u6027\u5206\u6790(\u5047\u8a2d\u8cc7\u91d1 1000 \u842c,\u55ae\u7b46\u9032\u51fa\u5834\u81f3\u5c11\u9700\u8981 10 \u842c\u80a1)\nreport_final.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n#        buy_high  sell_low  low_volume_stocks  \u8655\u7f6e\u80a1\n# entry     0.032     0.008              0.087   0.012\n# exit      0.015     0.045              0.092   0.008\n</code></pre> <p>\u6d41\u52d5\u6027\u6aa2\u8996</p> <ul> <li>\u4f4e\u6210\u4ea4\u91cf\u80a1\u7968\u6bd4\u4f8b 8.7%,\u5927\u8cc7\u91d1\u9700\u6ce8\u610f</li> <li>\u8655\u7f6e\u80a1\u6bd4\u4f8b 1.2%,\u53ef\u63a5\u53d7</li> <li>\u5efa\u8b70\u52a0\u5165\u6210\u4ea4\u91cf\u7be9\u9078\u689d\u4ef6</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#42", "title": "4.2 \u5e74\u5ea6\u7a69\u5b9a\u6027\u5206\u6790", "text": "<p>\u6aa2\u8996\u7b56\u7565\u5728\u4e0d\u540c\u5e74\u5ea6\u7684\u8868\u73fe:</p> <pre><code>report_final.run_analysis('PeriodStatsAnalysis')\n\n# \u8f38\u51fa\u6703\u986f\u793a\u6bcf\u5e74\u7684\u590f\u666e\u7387\u3001\u5831\u916c\u7387\u3001\u6ce2\u52d5\u7387\u7b49\n# \u53ef\u6aa2\u8996\u7b56\u7565\u662f\u5426\u5728\u67d0\u4e9b\u5e74\u5ea6\u7279\u5225\u5dee\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#43-alphabeta", "title": "4.3 Alpha/Beta \u5206\u6790", "text": "<p>\u8861\u91cf\u7b56\u7565\u7684\u8d85\u984d\u5831\u916c:</p> <pre><code>report_final.run_analysis('AlphaBetaAnalysis')\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n# Alpha: 0.082 (8.2% \u5e74\u5316\u8d85\u984d\u5831\u916c)\n# Beta: 0.65 (\u5e02\u5834\u4e0a\u6f32 1%,\u7b56\u7565\u9810\u671f\u4e0a\u6f32 0.65%)\n</code></pre> <p>Alpha/Beta \u8a55\u4f30</p> <ul> <li>Alpha 8.2% \u512a\u79c0,\u4ee3\u8868\u7b56\u7565\u6709\u771f\u5be6\u7684\u8d85\u984d\u5831\u916c</li> <li>Beta 0.65 \u4ee3\u8868\u7b56\u7565\u6ce2\u52d5\u5c0f\u65bc\u5927\u76e4,\u98a8\u96aa\u8f03\u4f4e</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#5", "title": "\u968e\u6bb5 5: \u6a23\u672c\u5916\u6e2c\u8a66", "text": "<p>\u5c07\u8cc7\u6599\u5207\u5206\u70ba\u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6,\u9a57\u8b49\u7b56\u7565\u662f\u5426\u904e\u5ea6\u914d\u9069:</p> <pre><code># \u5b9a\u7fa9\u5207\u5206\u65e5\u671f\ntrain_end = '2022-12-31'\ntest_start = '2023-01-01'\n\n# \u8a13\u7df4\u96c6\u56de\u6e2c(2018-2022)\nposition_train = position_final[position_final.index &lt;= train_end]\nreport_train = sim(\n    position_train,\n    resample='M',\n    position_limit=0.1,\n    upload=False,\n    name=\"\u8a13\u7df4\u96c6(2018-2022)\"\n)\n\n# \u6e2c\u8a66\u96c6\u56de\u6e2c(2023-2024)\nposition_test = position_final[position_final.index &gt;= test_start]\nreport_test = sim(\n    position_test,\n    resample='M',\n    position_limit=0.1,\n    upload=False,\n    name=\"\u6e2c\u8a66\u96c6(2023-2024)\"\n)\n\n# \u7e3e\u6548\u5c0d\u6bd4\nstats_train = report_train.get_stats()\nstats_test = report_test.get_stats()\n\ncomparison = pd.DataFrame({\n    '\u8a13\u7df4\u96c6': [\n        stats_train['daily_mean'],\n        stats_train['daily_sharpe'],\n        stats_train['max_drawdown'],\n        stats_train['win_ratio']\n    ],\n    '\u6e2c\u8a66\u96c6': [\n        stats_test['daily_mean'],\n        stats_test['daily_sharpe'],\n        stats_test['max_drawdown'],\n        stats_test['win_ratio']\n    ]\n}, index=['\u5e74\u5316\u5831\u916c\u7387', '\u590f\u666e\u7387', '\u6700\u5927\u56de\u64a4', '\u52dd\u7387'])\n\nprint(comparison)\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n#             \u8a13\u7df4\u96c6     \u6e2c\u8a66\u96c6\n# \u5e74\u5316\u5831\u916c\u7387   0.182    0.165\n# \u590f\u666e\u7387       1.35     1.21\n# \u6700\u5927\u56de\u64a4    -0.245   -0.267\n# \u52dd\u7387         0.561    0.542\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#_7", "title": "\u6a23\u672c\u5916\u5224\u65b7\u6a19\u6e96", "text": "\u6307\u6a19 \u8a13\u7df4\u96c6 vs \u6e2c\u8a66\u96c6 \u5224\u65b7 \u5e74\u5316\u5831\u916c\u7387 18.2% vs 16.5% \u2705 \u8870\u9000\u5408\u7406(&lt;20%) \u590f\u666e\u7387 1.35 vs 1.21 \u2705 \u7565\u964d\u4f46\u4ecd &gt; 1 \u6700\u5927\u56de\u64a4 -24.5% vs -26.7% \u2705 \u5dee\u7570\u4e0d\u5927 \u52dd\u7387 56.1% vs 54.2% \u2705 \u7a69\u5b9a <p>\u6a23\u672c\u5916\u6e2c\u8a66\u901a\u904e</p> <p>\u6e2c\u8a66\u96c6\u7e3e\u6548\u7565\u964d\u4f46\u4ecd\u4fdd\u6301\u512a\u79c0,\u7b56\u7565\u6c92\u6709\u904e\u5ea6\u914d\u9069,\u53ef\u9032\u5165\u90e8\u7f72\u968e\u6bb5!</p>"}, {"location": "workflows/complete_strategy_workflow/#6", "title": "\u968e\u6bb5 6: \u90e8\u7f72\u524d\u6e96\u5099", "text": ""}, {"location": "workflows/complete_strategy_workflow/#61", "title": "6.1 \u4e0a\u50b3\u7b56\u7565\u81f3\u96f2\u7aef", "text": "<pre><code># \u4e0a\u50b3\u6700\u7d42\u7248\u672c\u81f3 FinLab \u5e73\u53f0\nreport_final.upload(name=\"\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565 v3.0\")\n\n# \u53d6\u5f97\u6301\u80a1\u6e05\u55ae\nposition_info = report_final.position_info()\nprint(f\"\u4e0b\u671f\u63db\u80a1\u65e5: {position_info['next_trading_date']}\")\nprint(f\"\u7576\u524d\u6301\u80a1\u6578: {len(position_info['stocks'])}\")\nprint(\"\u6301\u80a1\u6e05\u55ae:\")\nprint(position_info['stocks'])\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n# \u4e0b\u671f\u63db\u80a1\u65e5: 2025-01-31\n# \u7576\u524d\u6301\u80a1\u6578: 8\n# \u6301\u80a1\u6e05\u55ae:\n#      stock_id  position\n# 0        2330      0.12\n# 1        2317      0.11\n# 2        2454      0.10\n# ...\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#62", "title": "6.2 \u6e96\u5099\u5be6\u76e4\u8cc7\u91d1\u914d\u7f6e", "text": "<pre><code># \u5047\u8a2d\u5be6\u76e4\u8cc7\u91d1 100 \u842c\ncapital = 1000000\n\n# \u8a08\u7b97\u6bcf\u6a94\u80a1\u7968\u61c9\u6295\u5165\u7684\u91d1\u984d\nstocks = position_info['stocks']\nstocks['amount'] = stocks['position'] * capital\n\nprint(stocks[['stock_id', 'position', 'amount']])\n\n# \u8f38\u51fa:\n#   stock_id  position  amount\n# 0     2330      0.12  120000\n# 1     2317      0.11  110000\n# ...\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#7", "title": "\u968e\u6bb5 7: \u5be6\u76e4\u4ea4\u6613", "text": ""}, {"location": "workflows/complete_strategy_workflow/#71", "title": "7.1 \u8a2d\u5b9a\u5238\u5546\u5e33\u6236(\u4ee5\u6c38\u8c50\u8b49\u5238\u70ba\u4f8b)", "text": "<pre><code>from finlab.online.sinopac_account import SinopacAccount\n\n# \u8a2d\u5b9a\u5238\u5546\u5e33\u6236\naccount = SinopacAccount(\n    simulation=False,  # False \u70ba\u5be6\u76e4,True \u70ba\u6a21\u64ec\u55ae\n)\n</code></pre> <p>\u5be6\u76e4\u4ea4\u6613\u6ce8\u610f\u4e8b\u9805</p> <ol> <li>\u9996\u6b21\u4f7f\u7528\u8acb\u5148\u8a2d\u5b9a <code>simulation=True</code> \u6e2c\u8a66</li> <li>\u78ba\u8a8d\u5238\u5546 API \u91d1\u9470\u6b63\u78ba</li> <li>\u78ba\u8a8d\u6709\u8db3\u5920\u7684\u8cc7\u91d1\u8207\u984d\u5ea6</li> <li>\u5efa\u8b70\u5148\u5c0f\u8cc7\u91d1\u6e2c\u8a66</li> </ol>"}, {"location": "workflows/complete_strategy_workflow/#72", "title": "7.2 \u8a08\u7b97\u76ee\u6a19\u90e8\u4f4d", "text": "<pre><code>from finlab.online.order_executor import Position\n\n# \u8a08\u7b97\u76ee\u6a19\u90e8\u4f4d\uff08\u6574\u80a1\uff09\ncapital = 1000000  # \u5be6\u76e4\u8cc7\u91d1 100 \u842c\nposition = Position.from_report(report_final, capital)\n\n# \u6216\u4f7f\u7528\u96f6\u80a1\u4ea4\u6613\nposition = Position.from_report(report_final, capital, odd_lot=True)\n\nprint(position)\n# \u8f38\u51fa: [{'stock_id': '2330', 'quantity': 5, 'order_condition': &lt;OrderCondition.CASH: 1&gt;}, ...]\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#73", "title": "7.3 \u57f7\u884c\u4e0b\u55ae", "text": "<pre><code>from finlab.online.order_executor import OrderExecutor\n\n# \u5efa\u7acb\u4e0b\u55ae\u57f7\u884c\u5668\norder_executor = OrderExecutor(position, account=account)\n\n# \u4e0b\u55ae\u6aa2\u67e5\uff08\u700f\u89bd\u6a21\u5f0f\uff0c\u4e0d\u6703\u771f\u7684\u4e0b\u55ae\uff09\norder_executor.create_orders(view_only=True)\n\n# \u57f7\u884c\u4e0b\u55ae\uff08\u6703\u771f\u7684\u4e0b\u55ae\uff0c\u521d\u6b21\u4f7f\u7528\u5efa\u8b70\u6536\u5e02\u6642\u6e2c\u8a66\uff09\norder_executor.create_orders()\n\n# \u66f4\u65b0\u9650\u50f9\uff08\u5c07\u6700\u5f8c\u4e00\u7b46\u6210\u4ea4\u50f9\u7576\u6210\u65b0\u7684\u9650\u50f9\uff09\norder_executor.update_order_price()\n\n# \u522a\u9664\u6240\u6709\u59d4\u8a17\u55ae\norder_executor.cancel_orders()\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#8", "title": "\u968e\u6bb5 8: \u7e3e\u6548\u8ffd\u8e64", "text": ""}, {"location": "workflows/complete_strategy_workflow/#81", "title": "8.1 \u53d6\u5f97\u5be6\u76e4\u4ea4\u6613\u8a18\u9304", "text": "<pre><code># \u53d6\u5f97\u5be6\u76e4\u90e8\u4f4d\naccount_positions = account.get_stocks()\nprint(account_positions)\n\n# \u53d6\u5f97\u5e33\u6236\u7e3d\u5e02\u503c\u8207\u73fe\u91d1\naccount_value = account.get_total_balance()\nprint(f\"\u5e33\u6236\u7e3d\u503c: {account_value:,.0f}\")\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#82", "title": "8.2 \u76e3\u63a7\u7b56\u7565\u8868\u73fe", "text": "<pre><code># \u5b9a\u671f\u6aa2\u67e5\u5e33\u6236\u72c0\u614b\uff08\u5efa\u8b70\u6bcf\u65e5\u6536\u76e4\u5f8c\u57f7\u884c\uff09\nimport pandas as pd\n\n# \u8a18\u9304\u6bcf\u65e5\u5e33\u6236\u6de8\u503c\ndaily_value = {\n    'date': pd.Timestamp.today(),\n    'account_value': account.get_total_balance(),\n    'positions': len(account.get_stocks())\n}\n\nprint(f\"\u65e5\u671f: {daily_value['date']}\")\nprint(f\"\u5e33\u6236\u6de8\u503c: {daily_value['account_value']:,.0f}\")\nprint(f\"\u6301\u80a1\u6a94\u6578: {daily_value['positions']}\")\n\n# \u8207\u56de\u6e2c\u6bd4\u8f03\nbacktest_return = report_final.get_stats()['daily_mean']\nprint(f\"\u56de\u6e2c\u5e74\u5316\u5831\u916c\u7387: {backtest_return * 100:.2f}%\")\nprint(f\"\u5be6\u76e4 vs \u56de\u6e2c\u5dee\u7570: {(realized_return - backtest_return) * 100:.2f}%\")\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#83", "title": "8.3 \u5b9a\u671f\u6aa2\u8996", "text": "<p>\u5efa\u8b70\u6bcf\u6708\u6aa2\u8996\u4ee5\u4e0b\u9805\u76ee:</p> <pre><code># 1. \u6301\u80a1\u662f\u5426\u6309\u8a08\u5283\u57f7\u884c\ncurrent_stocks = set(account_positions['stock_id'])\nplanned_stocks = set(position_info['stocks']['stock_id'])\n\nprint(f\"\u8a08\u5283\u6301\u80a1: {planned_stocks}\")\nprint(f\"\u5be6\u969b\u6301\u80a1: {current_stocks}\")\nprint(f\"\u8aa4\u5dee\u80a1\u7968: {planned_stocks.symmetric_difference(current_stocks)}\")\n\n# 2. \u5831\u916c\u7387\u662f\u5426\u7b26\u5408\u9810\u671f\nprint(f\"\u7576\u6708\u5831\u916c\u7387: {account.get_monthly_return()*100:.2f}%\")\n\n# 3. \u662f\u5426\u89f8\u767c\u505c\u640d\nfor stock_id, pos in account_positions.items():\n    entry_price = pos['avg_price']\n    current_price = pos['current_price']\n    unrealized_pnl = (current_price / entry_price - 1)\n\n    if unrealized_pnl &lt; -0.10:  # \u505c\u640d 10%\n        print(f\"\u8b66\u544a: {stock_id} \u5df2\u89f8\u767c\u505c\u640d,\u672a\u5be6\u73fe\u640d\u76ca: {unrealized_pnl*100:.2f}%\")\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#_8", "title": "\u5b8c\u6574\u7a0b\u5f0f\u78bc\u5f59\u6574", "text": "<p>\u4ee5\u4e0b\u662f\u5b8c\u6574\u7684\u53ef\u57f7\u884c\u7a0b\u5f0f\u78bc:</p> <pre><code># =============================================================================\n# \u5f9e\u7814\u7a76\u5230\u5be6\u76e4:\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565\u5b8c\u6574\u7bc4\u4f8b\n# =============================================================================\n\nfrom finlab import data\nfrom finlab.backtest import sim\nfrom finlab.optimize.combinations import sim_conditions\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 1 &amp; 2: \u8cc7\u6599\u8f09\u5165\u8207\u7b56\u7565\u958b\u767c\n# -----------------------------------------------------------------------------\n\n# \u8f09\u5165\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\n\n# \u8a08\u7b97\u6307\u6a19\nma20 = close.average(20)\nma60 = close.average(60)\nrev_ma3 = rev.average(3)\nrev_ma12 = rev.average(12)\n\n# \u5b9a\u7fa9\u689d\u4ef6\nc1 = (close &gt; ma20) &amp; (close &gt; ma60)  # \u5747\u7dda\u591a\u982d\nc2 = rev_ma3 / rev_ma12 &gt; 1.1         # \u71df\u6536\u52a0\u901f\nc3 = pe &lt; 15                          # \u4f4e\u672c\u76ca\u6bd4\n\n# \u51fa\u5834\u8a0a\u865f\nexit_signal = close &lt; ma20\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 3: \u7b56\u7565\u512a\u5316\n# -----------------------------------------------------------------------------\n\n# \u6e2c\u8a66\u689d\u4ef6\u7d44\u5408\nconditions = {'c1': c1, 'c2': c2, 'c3': c3}\nreport_collection = sim_conditions(\n    conditions=conditions,\n    hold_until={'exit': exit_signal, 'stop_loss': 0.1},\n    resample='M',\n    position_limit=0.1,\n    upload=False\n)\n\n# \u627e\u51fa\u6700\u4f73\u7d44\u5408\nstats_df = report_collection.get_stats()\ntop1 = stats_df.T.sort_values('daily_sharpe', ascending=False).index[0]\nprint(f\"\u6700\u4f73\u7d44\u5408: {top1}\")\n\n# \u4f7f\u7528\u6700\u4f73\u7d44\u5408\nbest_entry = c1 &amp; c2 &amp; c3\n\n# \u512a\u5316\u505c\u640d\u505c\u5229\nposition_temp = best_entry.hold_until(exit=exit_signal, stop_loss=0.1)\nreport_temp = sim(position_temp, resample='M', position_limit=0.1, upload=False)\ntrades = report_temp.get_trades()\n\nmae_q75 = abs(trades['mae'].quantile(0.75))\ngmfe_q75 = trades['gmfe'].quantile(0.75)\n\n# \u6700\u7d42\u7b56\u7565\nposition_final = best_entry.hold_until(\n    exit=exit_signal,\n    stop_loss=mae_q75 * 1.2,\n    take_profit=gmfe_q75 * 0.8\n)\n\nreport_final = sim(\n    position_final,\n    resample='M',\n    position_limit=0.1,\n    upload=False,\n    name=\"\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565 v3.0\"\n)\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 4: \u6df1\u5ea6\u5206\u6790\n# -----------------------------------------------------------------------------\n\n# \u6d41\u52d5\u6027\u5206\u6790\nreport_final.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# \u6ce2\u52d5\u5206\u6790\nreport_final.display_mae_mfe_analysis()\n\n# \u6642\u671f\u7a69\u5b9a\u6027\nreport_final.run_analysis('PeriodStatsAnalysis')\n\n# Alpha/Beta\nreport_final.run_analysis('AlphaBetaAnalysis')\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 5: \u6a23\u672c\u5916\u6e2c\u8a66\n# -----------------------------------------------------------------------------\n\ntrain_end = '2022-12-31'\ntest_start = '2023-01-01'\n\nposition_train = position_final[position_final.index &lt;= train_end]\nposition_test = position_final[position_final.index &gt;= test_start]\n\nreport_train = sim(position_train, resample='M', position_limit=0.1, upload=False)\nreport_test = sim(position_test, resample='M', position_limit=0.1, upload=False)\n\nprint(\"\u8a13\u7df4\u96c6\u7e3e\u6548:\", report_train.get_stats()['daily_sharpe'])\nprint(\"\u6e2c\u8a66\u96c6\u7e3e\u6548:\", report_test.get_stats()['daily_sharpe'])\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 6: \u90e8\u7f72\u524d\u6e96\u5099\n# -----------------------------------------------------------------------------\n\n# \u4e0a\u50b3\u81f3\u96f2\u7aef\nreport_final.upload(name=\"\u71df\u6536\u6210\u9577\u7a81\u7834\u7b56\u7565 v3.0\")\n\n# \u53d6\u5f97\u6301\u80a1\u6e05\u55ae\nposition_info = report_final.position_info()\nprint(\"\u4e0b\u671f\u6301\u80a1:\")\nprint(position_info['stocks'])\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 7: \u5be6\u76e4\u4ea4\u6613(\u9700\u5148\u8a2d\u5b9a\u5238\u5546\u5e33\u6236)\n# -----------------------------------------------------------------------------\n\n# from finlab.online.sinopac_account import SinopacAccount\n# from finlab.online.order_executor import OrderExecutor\n#\n# account = SinopacAccount(simulation=True)  # \u5148\u7528\u6a21\u64ec\u55ae\u6e2c\u8a66\n# executor = OrderExecutor(\n#     report=report_final,\n#     account=account,\n#     fund=1000000\n# )\n# executor.execute()\n\n# -----------------------------------------------------------------------------\n# \u968e\u6bb5 8: \u7e3e\u6548\u8ffd\u8e64\n# -----------------------------------------------------------------------------\n\n# \u5b9a\u671f\u57f7\u884c\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u6aa2\u8996\u5be6\u76e4\u72c0\u6cc1:\n# account_value = account.get_total_value()\n# print(f\"\u5e33\u6236\u7e3d\u503c: {account_value}\")\n</code></pre>"}, {"location": "workflows/complete_strategy_workflow/#_9", "title": "\u95dc\u9375\u8981\u9ede\u7e3d\u7d50", "text": ""}, {"location": "workflows/complete_strategy_workflow/#_10", "title": "\u958b\u767c\u968e\u6bb5\u6aa2\u67e5\u6e05\u55ae", "text": "<ul> <li>[ ] \u7b56\u7565\u69cb\u60f3\u660e\u78ba: \u6709\u6e05\u6670\u7684\u908f\u8f2f\u5047\u8a2d(\u6280\u8853\u9762/\u57fa\u672c\u9762/\u7c4c\u78bc\u9762)</li> <li>[ ] \u8cc7\u6599\u5b8c\u6574\u6027\u6aa2\u67e5: \u78ba\u8a8d\u6240\u9700\u8cc7\u6599\u7bc4\u570d\u8db3\u5920,\u7f3a\u5931\u503c\u6bd4\u4f8b\u5408\u7406</li> <li>[ ] \u521d\u6b65\u56de\u6e2c\u7e3e\u6548\u53ef\u63a5\u53d7: \u5e74\u5316\u5831\u916c &gt; 10%,\u590f\u666e\u7387 &gt; 0.5</li> <li>[ ] \u689d\u4ef6\u7d44\u5408\u512a\u5316: \u4f7f\u7528 <code>sim_conditions()</code> \u627e\u51fa\u6700\u4f73\u7d44\u5408</li> <li>[ ] \u505c\u640d\u505c\u5229\u512a\u5316: \u4f7f\u7528 MAE/MFE \u5206\u6790\u8a2d\u5b9a\u5408\u7406\u7684\u505c\u640d\u505c\u5229\u9ede</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#_11", "title": "\u9a57\u8b49\u968e\u6bb5\u6aa2\u67e5\u6e05\u55ae", "text": "<ul> <li>[ ] \u6d41\u52d5\u6027\u98a8\u96aa: \u4f4e\u6210\u4ea4\u91cf\u6bd4\u4f8b &lt; 20%,\u8655\u7f6e\u80a1\u6bd4\u4f8b &lt; 5%</li> <li>[ ] \u5e74\u5ea6\u7a69\u5b9a\u6027: \u6c92\u6709\u9023\u7e8c\u591a\u5e74\u8868\u73fe\u6975\u5dee</li> <li>[ ] Alpha &gt; 0: \u7b56\u7565\u6709\u8d85\u984d\u5831\u916c</li> <li>[ ] \u6a23\u672c\u5916\u6e2c\u8a66\u901a\u904e: \u6e2c\u8a66\u96c6\u7e3e\u6548\u8870\u9000 &lt; 30%,\u590f\u666e\u7387\u4ecd &gt; 1</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#_12", "title": "\u90e8\u7f72\u968e\u6bb5\u6aa2\u67e5\u6e05\u55ae", "text": "<ul> <li>[ ] \u7b56\u7565\u5df2\u4e0a\u50b3\u96f2\u7aef: \u53ef\u96a8\u6642\u6aa2\u8996\u6301\u80a1\u6e05\u55ae</li> <li>[ ] \u5238\u5546\u5e33\u6236\u8a2d\u5b9a\u5b8c\u6210: API \u91d1\u9470\u6b63\u78ba,\u6b0a\u9650\u958b\u901a</li> <li>[ ] \u5148\u7528\u6a21\u64ec\u55ae\u6e2c\u8a66: \u78ba\u8a8d\u4e0b\u55ae\u908f\u8f2f\u6b63\u78ba</li> <li>[ ] \u5c0f\u8cc7\u91d1\u6e2c\u8a66: \u5148\u7528\u5c0f\u984d\u8cc7\u91d1\u6e2c\u8a66 1-2 \u500b\u6708</li> <li>[ ] \u5b9a\u671f\u6aa2\u8996\u6a5f\u5236: \u8a2d\u5b9a\u6bcf\u6708\u6aa2\u8996\u5be6\u76e4\u7e3e\u6548</li> </ul>"}, {"location": "workflows/complete_strategy_workflow/#_13", "title": "\u5f8c\u7e8c\u5b78\u7fd2\u5efa\u8b70", "text": "<p>\u5b8c\u6210\u672c\u6d41\u7a0b\u5f8c,\u53ef\u9032\u4e00\u6b65\u5b78\u7fd2:</p> <ol> <li>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565: \u6a5f\u5668\u5b78\u7fd2\u5b8c\u6574\u6d41\u7a0b(\u9032\u968e\u7bc7)</li> <li>\u591a\u7b56\u7565\u7d44\u5408: \u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406(\u9032\u968e\u7bc7)</li> <li>\u81ea\u8a02\u5206\u6790\u6a21\u7d44: \u7b56\u7565\u5206\u6790\u6a21\u7d44\u6307\u5357</li> <li>\u81ea\u8a02\u5e02\u5834\u56de\u6e2c: \u81ea\u8a02\u5e02\u5834\u7269\u4ef6\u6307\u5357</li> </ol>"}, {"location": "workflows/complete_strategy_workflow/#_14", "title": "\u5e38\u898b\u932f\u8aa4\u8655\u7406\u6aa2\u67e5\u6e05\u55ae", "text": "<p>\u5728\u57f7\u884c\u5b8c\u6574\u6d41\u7a0b\u6642\uff0c\u52d9\u5fc5\u5728\u6bcf\u500b\u968e\u6bb5\u9032\u884c\u932f\u8aa4\u6aa2\u67e5\u3002\u4ee5\u4e0b\u662f\u95dc\u9375\u6aa2\u67e5\u9ede\u8207\u89e3\u6c7a\u65b9\u6848\uff1a</p>"}, {"location": "workflows/complete_strategy_workflow/#1-2", "title": "\u968e\u6bb5 1-2\uff1a\u8cc7\u6599\u8f09\u5165\u8207\u56de\u6e2c", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c <code>KeyError: 'price:\u6536\u76e4\u50f9'</code> - API token \u672a\u8a2d\u5b9a\u6216\u8cc7\u6599\u8868\u540d\u7a31\u932f\u8aa4 - \u274c \u8cc7\u6599\u70ba\u7a7a\u6216\u7f3a\u5931\u503c\u904e\u591a - \u274c \u56de\u6e2c\u7121\u4ea4\u6613\u8a18\u9304\uff08\u9032\u5834\u689d\u4ef6\u904e\u56b4\uff09</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code>try:\n    # 1. \u6aa2\u67e5\u8cc7\u6599\u8f09\u5165\n    close = data.get('price:\u6536\u76e4\u50f9')\n\n    if close.empty:\n        raise ValueError(\"\u274c \u8cc7\u6599\u70ba\u7a7a\uff0c\u8acb\u6aa2\u67e5 API token\")\n\n    missing_ratio = close.isna().sum().sum() / close.size\n    if missing_ratio &gt; 0.1:\n        print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u7f3a\u5931\u503c\u6bd4\u4f8b {missing_ratio:.1%} &gt; 10%\")\n\n    # 2. \u6aa2\u67e5\u9032\u5834\u8a0a\u865f\n    entry_count = entry_signal.sum(axis=1).mean()\n    if entry_count &lt; 1:\n        print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u9032\u5834\u689d\u4ef6\u904e\u56b4\uff0c\u5e73\u5747\u6bcf\u65e5 &lt; 1 \u6a94\u80a1\u7968\")\n        print(\"\u5efa\u8b70\uff1a\u653e\u5bec\u689d\u4ef6\u6216\u4f7f\u7528 .is_largest(N) \u78ba\u4fdd\u56fa\u5b9a\u6a94\u6578\")\n\n    # 3. \u6aa2\u67e5\u56de\u6e2c\u7d50\u679c\n    report = sim(position, resample='M', position_limit=0.1)\n    trades = report.get_trades()\n\n    if len(trades) == 0:\n        raise ValueError(\"\u274c \u7b56\u7565\u7121\u4efb\u4f55\u4ea4\u6613\u8a18\u9304\uff0c\u8acb\u6aa2\u67e5\u9032\u5834\u689d\u4ef6\")\n\n    print(f\"\u2705 \u56de\u6e2c\u6210\u529f\uff1a{len(trades)} \u7b46\u4ea4\u6613\")\n\nexcept KeyError as e:\n    print(f\"\u274c \u627e\u4e0d\u5230\u8cc7\u6599\u8868\uff1a{e}\")\n    print(\"\u8acb\u81f3 https://ai.finlab.tw/database \u78ba\u8a8d\u8cc7\u6599\u8868\u540d\u7a31\")\n    print(\"\u6216\u6aa2\u67e5 API token \u662f\u5426\u6b63\u78ba\u8a2d\u5b9a\")\n\nexcept ValueError as e:\n    print(f\"\u274c \u8cc7\u6599\u9a57\u8b49\u5931\u6557\uff1a{e}\")\n</code></pre> <p>\u8a73\u7d30\u932f\u8aa4\u8655\u7406\uff1a\u53c3\u8003 \u8cc7\u6599\u4e0b\u8f09\u932f\u8aa4\u8655\u7406</p>"}, {"location": "workflows/complete_strategy_workflow/#3_1", "title": "\u968e\u6bb5 3\uff1a\u7b56\u7565\u512a\u5316", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c <code>sim_conditions()</code> \u7d44\u5408\u6578\u91cf\u904e\u591a\u5c0e\u81f4\u57f7\u884c\u6642\u9593\u904e\u9577 - \u274c \u689d\u4ef6\u5b9a\u7fa9\u932f\u8aa4\uff08\u65e5\u671f\u7bc4\u570d\u4e0d\u4e00\u81f4\uff09</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code># \u9650\u5236\u7d44\u5408\u6578\u91cf\uff08&lt; 50 \u500b\u7d44\u5408\uff09\nconditions = {\n    'c1': c1,\n    'c2': c2,\n    'c3': c3,\n    # \u6700\u591a 5 \u500b\u689d\u4ef6\uff082^5 = 32 \u7a2e\u7d44\u5408\uff09\n}\n\n# \u4f30\u7b97\u57f7\u884c\u6642\u9593\nnum_combinations = 2**len(conditions) - 1\nprint(f\"\u5c07\u6e2c\u8a66 {num_combinations} \u7a2e\u7d44\u5408\uff0c\u9810\u4f30\u6642\u9593\uff1a\u7d04 {num_combinations * 30 / 60:.1f} \u5206\u9418\")\n\nif num_combinations &gt; 100:\n    print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u7d44\u5408\u6578\u91cf\u904e\u591a\uff0c\u5efa\u8b70\u5148\u6e2c\u8a66\u90e8\u5206\u689d\u4ef6\")\n</code></pre> <p>\u8a73\u7d30\u932f\u8aa4\u8655\u7406\uff1a\u53c3\u8003 \u7b56\u7565\u512a\u5316\u932f\u8aa4\u8655\u7406</p>"}, {"location": "workflows/complete_strategy_workflow/#5_1", "title": "\u968e\u6bb5 5\uff1a\u6a23\u672c\u5916\u6e2c\u8a66", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c \u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6\u65e5\u671f\u7bc4\u570d\u91cd\u758a - \u274c \u6e2c\u8a66\u96c6\u7e3e\u6548\u8207\u8a13\u7df4\u96c6\u5dee\u7570\u904e\u5927\uff08\u904e\u5ea6\u914d\u9069\uff09</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code># \u6aa2\u67e5\u65e5\u671f\u7bc4\u570d\ntrain_end = '2022-12-31'\ntest_start = '2023-01-01'\n\nposition_train = position_final[position_final.index &lt;= train_end]\nposition_test = position_final[position_final.index &gt;= test_start]\n\n# \u78ba\u8a8d\u7121\u91cd\u758a\nif position_train.index[-1] &gt;= position_test.index[0]:\n    raise ValueError(\"\u274c \u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6\u65e5\u671f\u91cd\u758a\uff01\")\n\n# \u6aa2\u67e5\u7e3e\u6548\u5dee\u7570\nsharpe_train = report_train.get_stats()['daily_sharpe']\nsharpe_test = report_test.get_stats()['daily_sharpe']\ndegradation = (sharpe_train - sharpe_test) / sharpe_train\n\nif degradation &gt; 0.5:\n    print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u590f\u666e\u7387\u8870\u9000 {degradation:.1%} &gt; 50%\uff0c\u53ef\u80fd\u904e\u5ea6\u914d\u9069\")\n    print(\"\u5efa\u8b70\uff1a\")\n    print(\"1. \u7c21\u5316\u7b56\u7565\u689d\u4ef6\")\n    print(\"2. \u589e\u52a0\u8a13\u7df4\u96c6\u8cc7\u6599\u7bc4\u570d\")\n    print(\"3. \u4f7f\u7528\u4ea4\u53c9\u9a57\u8b49\")\n</code></pre> <p>\u8a73\u7d30\u932f\u8aa4\u8655\u7406\uff1a\u53c3\u8003 \u56de\u6e2c\u932f\u8aa4\u8655\u7406</p>"}, {"location": "workflows/complete_strategy_workflow/#7_1", "title": "\u968e\u6bb5 7\uff1a\u5be6\u76e4\u4ea4\u6613", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c \u5238\u5546\u5e33\u6236\u9023\u7dda\u5931\u6557\uff08API key \u932f\u8aa4\u3001\u6191\u8b49\u904e\u671f\uff09 - \u274c \u8cc7\u91d1\u4e0d\u8db3\u6216\u6301\u5009\u904e\u591a - \u274c \u8a02\u55ae\u88ab\u62d2\u7d55\uff08\u8655\u7f6e\u80a1\u672a\u5708\u5b58\u3001\u6f32\u8dcc\u505c\u9396\u6b7b\uff09</p> <p>\u5b89\u5168\u6aa2\u67e5\u6e05\u55ae\uff1a</p> <pre><code># \u5be6\u76e4\u4e0b\u55ae\u524d\u5fc5\u9808\u6aa2\u67e5\ndef pre_trading_checks(position, account):\n    \"\"\"\u5be6\u76e4\u4e0b\u55ae\u524d\u5b89\u5168\u6aa2\u67e5\"\"\"\n\n    print(\"=== \u5be6\u76e4\u4e0b\u55ae\u5b89\u5168\u6aa2\u67e5 ===\\n\")\n\n    # 1. \u6aa2\u67e5\u6301\u5009\u6578\u91cf\n    if len(position) &gt; 30:\n        raise ValueError(f\"\u274c \u6301\u5009\u904e\u591a\uff08{len(position)} \u6a94\uff09\uff0c\u5efa\u8b70 &lt; 30 \u6a94\")\n\n    # 2. \u6aa2\u67e5\u53ef\u7528\u8cc7\u91d1\n    available = account.get_balance()\n    required = position.total_value  # \u5047\u8a2d\u6b64\u65b9\u6cd5\u5b58\u5728\n\n    if required &gt; available * 0.9:\n        raise ValueError(f\"\u274c \u8cc7\u91d1\u4e0d\u8db3\uff01\u9700\u8981 {required:,.0f}\uff0c\u53ef\u7528 {available:,.0f}\")\n\n    # 3. \u6aa2\u67e5\u5e33\u6236\u9023\u7dda\n    try:\n        account.get_position()\n    except Exception as e:\n        raise ConnectionError(f\"\u274c \u5238\u5546\u5e33\u6236\u9023\u7dda\u5931\u6557\uff1a{e}\")\n\n    print(\"\u2705 \u6240\u6709\u6aa2\u67e5\u901a\u904e\\n\")\n\n# \u57f7\u884c\u6aa2\u67e5\ntry:\n    pre_trading_checks(position_info, account)\n\n    # \u5148\u9810\u89bd\uff08\u4e0d\u6703\u771f\u7684\u4e0b\u55ae\uff09\n    executor.create_orders(view_only=True)\n\n    # \u78ba\u8a8d\u5f8c\u57f7\u884c\uff08\u53d6\u6d88\u8a3b\u89e3\uff09\n    # executor.create_orders()\n\nexcept (ValueError, ConnectionError) as e:\n    print(f\"\\n{e}\")\n    print(\"\u8acb\u4fee\u6b63\u554f\u984c\u5f8c\u518d\u57f7\u884c\u4e0b\u55ae\")\n</code></pre> <p>\u8a73\u7d30\u932f\u8aa4\u8655\u7406\uff1a\u53c3\u8003 \u5be6\u76e4\u4e0b\u55ae\u932f\u8aa4\u8655\u7406</p> <p>\u5be6\u76e4\u4ea4\u6613\u6700\u5f8c\u63d0\u9192</p> <p>\u4e0b\u55ae\u524d\u52d9\u5fc5\u78ba\u8a8d\uff1a</p> <ul> <li>\u2705 \u7b56\u7565\u5df2\u901a\u904e\u6a23\u672c\u5916\u6e2c\u8a66</li> <li>\u2705 \u5148\u7528\u6a21\u64ec\u5e33\u6236\u6e2c\u8a66\u81f3\u5c11 1 \u9031</li> <li>\u2705 \u521d\u671f\u8cc7\u91d1\u4e0d\u8d85\u904e\u7e3d\u8cc7\u91d1\u7684 10-20%</li> <li>\u2705 \u8a2d\u5b9a\u505c\u640d\u6a5f\u5236\uff0c\u907f\u514d\u55ae\u6b21\u5de8\u5927\u8667\u640d</li> <li>\u2705 \u6bcf\u65e5\u76e3\u63a7\u6301\u5009\u8207\u8a02\u55ae\u72c0\u614b</li> </ul> <p>\u932f\u8aa4\u53ef\u80fd\u5c0e\u81f4\u8ca1\u52d9\u640d\u5931\uff01\u8acb\u52d9\u5fc5\u8b39\u614e\uff01</p>"}, {"location": "workflows/complete_strategy_workflow/#_15", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u7b56\u7565\u53c3\u6578\u512a\u5316\u5b8c\u6574\u6307\u5357</li> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44\u5b8c\u6574\u6307\u5357</li> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u5be6\u76e4\u4ea4\u6613\u8a73\u7d30\u8aaa\u660e</li> <li>\u8cc7\u6599\u4e0b\u8f09\u6559\u5b78</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357</li> <li>\u5e38\u898b\u554f\u984c FAQ</li> <li>FinLab \u91cf\u5316\u5e73\u53f0</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/", "title": "\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u5b8c\u6574\u6d41\u7a0b", "text": "<p>\u672c\u6587\u63d0\u4f9b\u6a5f\u5668\u5b78\u7fd2\u91cf\u5316\u7b56\u7565\u7684\u5b8c\u6574\u958b\u767c\u6d41\u7a0b,\u5f9e\u7279\u5fb5\u5de5\u7a0b\u3001\u6a19\u7c64\u751f\u6210\u3001\u6a21\u578b\u8a13\u7df4,\u5230\u56de\u6e2c\u9a57\u8b49\u8207\u5be6\u76e4\u90e8\u7f72\u3002</p> <p>ML \u7b56\u7565\u958b\u767c\u63a8\u85a6\u642d\u914d AI \u52a9\u624b</p> <p>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u6d89\u53ca\u7279\u5fb5\u5de5\u7a0b\u3001\u6a19\u7c64\u8a2d\u8a08\u3001\u6a21\u578b\u8a13\u7df4\u7b49\u591a\u500b\u74b0\u7bc0\u3002\u5b89\u88dd FinLab Skill \u5f8c\uff0cAI \u7de8\u7a0b\u52a9\u624b\u53ef\u5728\u6bcf\u500b\u968e\u6bb5\u63d0\u4f9b\u7a0b\u5f0f\u78bc\u7bc4\u4f8b\u8207\u9664\u932f\u5354\u52a9\u3002</p>"}, {"location": "workflows/ml_strategy_workflow/#_2", "title": "\u6d41\u7a0b\u6982\u89bd", "text": "<pre><code>graph TD\n    A[\u539f\u59cb\u8cc7\u6599] --&gt; B[\u7279\u5fb5\u5de5\u7a0b&lt;br/&gt;finlab.ml.feature]\n    B --&gt; C[\u6a19\u7c64\u751f\u6210&lt;br/&gt;finlab.ml.label]\n    C --&gt; D[\u8cc7\u6599\u96c6\u5207\u5206]\n    D --&gt; E[\u6a21\u578b\u8a13\u7df4&lt;br/&gt;finlab.ml.qlib]\n    E --&gt; F[\u9810\u6e2c\u6301\u5009\u6b0a\u91cd]\n    F --&gt; G[\u56de\u6e2c\u9a57\u8b49]\n    G --&gt; H{\u7e3e\u6548\u6eff\u610f?}\n    H --&gt;|\u5426| I[\u8abf\u6574\u7279\u5fb5/\u6a21\u578b]\n    I --&gt; B\n    H --&gt;|\u662f| J[\u6a23\u672c\u5916\u6e2c\u8a66]\n    J --&gt; K{\u901a\u904e\u9a57\u8b49?}\n    K --&gt;|\u5426| I\n    K --&gt;|\u662f| L[\u5be6\u76e4\u90e8\u7f72]</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#1", "title": "\u968e\u6bb5 1: \u7279\u5fb5\u5de5\u7a0b", "text": "<p>\u6a5f\u5668\u5b78\u7fd2\u7684\u6210\u529f\u8207\u5426,80% \u53d6\u6c7a\u65bc\u7279\u5fb5\u5de5\u7a0b\u3002FinLab \u63d0\u4f9b\u5f37\u5927\u7684\u7279\u5fb5\u5de5\u7a0b\u5de5\u5177\u3002</p>"}, {"location": "workflows/ml_strategy_workflow/#11", "title": "1.1 \u8f09\u5165\u8207\u5408\u4f75\u57fa\u672c\u9762\u7279\u5fb5", "text": "<pre><code>from finlab import data\nfrom finlab.ml import feature as mlf\n\n# \u8f09\u5165\u57fa\u672c\u9762\u8cc7\u6599\npb_ratio = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\npe_ratio = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nroe = data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\nroa = data.get('fundamental_features:\u8cc7\u7522\u5831\u916c\u7387')\n\n# \u5408\u4f75\u70ba\u7279\u5fb5\u96c6\nfundamental_features = mlf.combine({\n    'pb': pb_ratio,\n    'pe': pe_ratio,\n    'roe': roe,\n    'roa': roa\n}, resample='W')  # \u91cd\u63a1\u6a23\u70ba\u9031\u5ea6\u8cc7\u6599\n\nprint(fundamental_features.head())\n# \u8f38\u51fa:\n#                                        pb     pe    roe    roa\n# (2010-01-04 00:00:00, '1101')        1.47  18.85   7.80   3.21\n# (2010-01-04 00:00:00, '1102')        1.44  14.58   9.87   4.15\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#12", "title": "1.2 \u65b0\u589e\u6280\u8853\u6307\u6a19\u7279\u5fb5", "text": "<pre><code># \u65b9\u6cd5 1: \u4f7f\u7528\u96a8\u6a5f\u6280\u8853\u6307\u6a19(\u63a2\u7d22\u6700\u4f73\u6307\u6a19)\nta_features = mlf.combine({\n    'talib': mlf.ta(mlf.ta_names(n=5))  # \u6bcf\u500b\u6307\u6a19\u96a8\u6a5f\u7522\u751f 5 \u7a2e\u53c3\u6578\u914d\u7f6e\n}, resample='W')\n\n# \u65b9\u6cd5 2: \u6307\u5b9a\u7279\u5b9a\u6280\u8853\u6307\u6a19\nfrom finlab import data\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nvolume = data.get('price:\u6210\u4ea4\u80a1\u6578')\n\nspecific_ta = mlf.combine({\n    'rsi': close.ta.RSI(timeperiod=14),\n    'macd': close.ta.MACD(),\n    'bbands': close.ta.BBANDS(timeperiod=20),\n    'obv': volume.ta.OBV(close)\n}, resample='W')\n\nprint(f\"\u6280\u8853\u6307\u6a19\u7279\u5fb5\u6578: {ta_features.shape[1]}\")  # \u4f8b\u5982: 450 \u500b\u7279\u5fb5\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#13", "title": "1.3 \u65b0\u589e\u81ea\u8a02\u7279\u5fb5", "text": "<pre><code># \u71df\u6536\u76f8\u95dc\u7279\u5fb5\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nrev_yoy = data.get('monthly_revenue:\u53bb\u5e74\u540c\u6708\u589e\u6e1b(%)')\n\ncustom_features = mlf.combine({\n    'rev_ma3': rev.average(3),          # 3 \u500b\u6708\u71df\u6536\u79fb\u52d5\u5e73\u5747\n    'rev_ma12': rev.average(12),        # 12 \u500b\u6708\u71df\u6536\u79fb\u52d5\u5e73\u5747\n    'rev_momentum': rev.average(3) / rev.average(12),  # \u71df\u6536\u52d5\u80fd\n    'rev_yoy': rev_yoy,                 # \u71df\u6536\u5e74\u589e\u7387\n}, resample='W')\n\nprint(custom_features.head())\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#14", "title": "1.4 \u5408\u4f75\u6240\u6709\u7279\u5fb5", "text": "<pre><code># \u5408\u4f75\u6240\u6709\u7279\u5fb5\u96c6\nall_features = mlf.combine({\n    'fundamental': fundamental_features,\n    'technical': ta_features,\n    'custom': custom_features\n}, resample='W')\n\nprint(f\"\u7e3d\u7279\u5fb5\u6578: {all_features.shape[1]}\")  # \u4f8b\u5982: 470 \u500b\u7279\u5fb5\nprint(f\"\u8cc7\u6599\u7b46\u6578: {all_features.shape[0]}\")  # \u4f8b\u5982: 150,000 \u7b46\n\n# \u6aa2\u67e5\u7f3a\u5931\u503c\nmissing_ratio = all_features.isna().sum() / len(all_features)\nprint(f\"\u7f3a\u5931\u503c\u6bd4\u4f8b:\\n{missing_ratio[missing_ratio &gt; 0.5]}\")  # \u986f\u793a\u7f3a\u5931\u8d85\u904e 50% \u7684\u7279\u5fb5\n\n# \u79fb\u9664\u7f3a\u5931\u503c\u904e\u591a\u7684\u7279\u5fb5\nall_features = all_features.loc[:, missing_ratio &lt; 0.5]\nprint(f\"\u904e\u6ffe\u5f8c\u7279\u5fb5\u6578: {all_features.shape[1]}\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#2", "title": "\u968e\u6bb5 2: \u6a19\u7c64\u751f\u6210", "text": "<p>\u6a19\u7c64\u5b9a\u7fa9\u4e86\u6211\u5011\u7684\u9810\u6e2c\u76ee\u6a19\u3002<code>finlab.ml.label</code> \u63d0\u4f9b\u591a\u7a2e\u6a19\u7c64\u751f\u6210\u51fd\u6578\uff0c\u6240\u6709\u51fd\u6578\u90fd\u63a5\u53d7 <code>features.index</code>\uff08MultiIndex\uff09\u4f5c\u70ba\u7b2c\u4e00\u500b\u53c3\u6578\u3002</p>"}, {"location": "workflows/ml_strategy_workflow/#21", "title": "2.1 \u9810\u6e2c\u672a\u4f86\u5831\u916c\u7387", "text": "<pre><code>from finlab.ml import label as mll\n\n# \u9810\u6e2c\u672a\u4f86 1 \u9031\u5831\u916c\u7387\uff08\u6700\u5e38\u7528\uff09\nlabel = mll.return_percentage(all_features.index, resample='W', period=1)\n\nprint(label.head())\n# \u8f38\u51fa:\n# datetime             instrument\n# 2010-01-04 00:00:00  1101          0.032\n#                      1102         -0.015\n#                      1103          0.021\n# dtype: float64\n\n# \u6aa2\u67e5\u6a19\u7c64\u5206\u5e03\nprint(label.describe())\n# \u8f38\u51fa:\n# count    150000.00\n# mean          0.005\n# std           0.087\n# min          -0.450\n# 25%          -0.042\n# 50%           0.002\n# 75%           0.051\n# max           0.520\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#22", "title": "2.2 \u8d85\u984d\u5831\u916c\u6a19\u7c64", "text": "<pre><code># \u76f8\u5c0d\u540c\u671f\u5168\u5e02\u5834\u6536\u76ca\u4e2d\u4f4d\u6578\u7684\u8d85\u984d\u6536\u76ca\nlabel_excess_median = mll.excess_over_median(all_features.index, resample='W', period=1)\n\n# \u76f8\u5c0d\u540c\u671f\u5168\u5e02\u5834\u6536\u76ca\u5747\u503c\u7684\u8d85\u984d\u6536\u76ca\nlabel_excess_mean = mll.excess_over_mean(all_features.index, resample='W', period=1)\n\nprint(label_excess_median.describe())\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#23", "title": "2.3 \u5176\u4ed6\u6a19\u7c64\u985e\u578b", "text": "<pre><code># \u65e5\u5167\u4ea4\u6613\u5831\u916c\uff08\u958b\u76e4\u5230\u6536\u76e4\u7684\u8b8a\u5316\uff09\nlabel_daytrading = mll.daytrading_percentage(all_features.index)\n\n# \u98a8\u96aa\u6307\u6a19\uff1a\u6700\u5927\u4e0d\u5229\u504f\u79fb\uff08\u6301\u6709\u671f\u5167\u6700\u5927\u8dcc\u5e45\uff09\nlabel_mae = mll.maximum_adverse_excursion(all_features.index, period=5)\n\n# \u98a8\u96aa\u6307\u6a19\uff1a\u6700\u5927\u6709\u5229\u504f\u79fb\uff08\u6301\u6709\u671f\u5167\u6700\u5927\u6f32\u5e45\uff09\nlabel_mfe = mll.maximum_favorable_excursion(all_features.index, period=5)\n\n# \u591a\u671f\u9810\u6e2c\uff08\u9810\u6e2c\u4e0d\u540c\u6642\u9593\u8de8\u5ea6\uff09\nlabel_1w = mll.return_percentage(all_features.index, resample='W', period=1)\nlabel_2w = mll.return_percentage(all_features.index, resample='W', period=2)\nlabel_4w = mll.return_percentage(all_features.index, resample='W', period=4)\n</code></pre> <p>\u6a19\u7c64\u9078\u64c7\u5efa\u8b70</p> <ul> <li><code>return_percentage</code>: \u6700\u5e38\u7528\uff0c\u76f4\u63a5\u9810\u6e2c\u5831\u916c\u7387</li> <li><code>excess_over_median</code>: \u9810\u6e2c\u76f8\u5c0d\u8868\u73fe\uff0c\u6e1b\u5c11\u5927\u76e4\u6f32\u8dcc\u5f71\u97ff</li> <li><code>daytrading_percentage</code>: \u9069\u5408\u7576\u6c96\u7b56\u7565</li> <li><code>maximum_adverse_excursion</code>: \u9069\u5408\u98a8\u96aa\u7ba1\u7406\u6a21\u578b</li> <li><code>period</code> \u8207\u7b56\u7565\u8abf\u5009\u983b\u7387\u4e00\u81f4\uff1a\u5982 <code>resample='W', period=1</code> \u4ee3\u8868\u9810\u6e2c\u4e00\u9031\u5f8c\u7684\u5831\u916c</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/#3", "title": "\u968e\u6bb5 3: \u8cc7\u6599\u96c6\u6e96\u5099\u8207\u5207\u5206", "text": ""}, {"location": "workflows/ml_strategy_workflow/#31", "title": "3.1 \u5c0d\u9f4a\u7279\u5fb5\u8207\u6a19\u7c64", "text": "<p>\u7279\u5fb5\uff08<code>all_features</code>\uff09\u8207\u6a19\u7c64\uff08<code>label</code>\uff09\u5171\u7528\u76f8\u540c\u7684 MultiIndex\uff08datetime, instrument\uff09\uff0c\u53ef\u76f4\u63a5\u9032\u884c\u5207\u5206\u3002</p> <pre><code># \u9078\u7528\u6a19\u7c64\nlabel = mll.return_percentage(all_features.index, resample='W', period=1)\n\n# \u6aa2\u67e5\u5c0d\u9f4a\u72c0\u6cc1\nprint(f\"\u7279\u5fb5\u7b46\u6578: {len(all_features)}\")\nprint(f\"\u6a19\u7c64\u7b46\u6578: {len(label)}\")\nprint(f\"\u6a19\u7c64 NaN \u6bd4\u4f8b: {label.isna().mean():.2%}\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#32", "title": "3.2 \u5207\u5206\u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6", "text": "<pre><code># \u4f7f\u7528\u6642\u9593\u5207\u5206\uff08\u56b4\u683c\u907f\u514d\u8cc7\u6599\u6d29\u9732\uff09\nis_train = all_features.index.get_level_values('datetime') &lt; '2023-01-01'\n\nX_train = all_features[is_train]\ny_train = label[is_train]\nX_test = all_features[~is_train]\n\nprint(f\"\u8a13\u7df4\u96c6: {len(X_train)} \u7b46 ({X_train.index.get_level_values(0).min()} ~ {X_train.index.get_level_values(0).max()})\")\nprint(f\"\u6e2c\u8a66\u96c6: {len(X_test)} \u7b46 ({X_test.index.get_level_values(0).min()} ~ {X_test.index.get_level_values(0).max()})\")\nprint(f\"\u8a13\u7df4\u7279\u5fb5\u7dad\u5ea6: {X_train.shape}\")\n</code></pre> <p>\u6642\u9593\u5207\u5206\u5f88\u91cd\u8981</p> <p>\u5fc5\u9808\u7528\u6642\u9593\u5207\u5206\uff0c\u4e0d\u53ef\u7528\u96a8\u6a5f\u5207\u5206\u3002\u96a8\u6a5f\u5207\u5206\u6703\u5c0e\u81f4\u8cc7\u6599\u6d29\u9732\u2014\u2014\u6a21\u578b\u770b\u5230\u672a\u4f86\u7684\u8cc7\u6599\u4f86\u9810\u6e2c\u904e\u53bb\uff0c\u5c0e\u81f4\u56de\u6e2c\u8868\u73fe\u865b\u9ad8\u3002</p>"}, {"location": "workflows/ml_strategy_workflow/#4", "title": "\u968e\u6bb5 4: \u6a21\u578b\u8a13\u7df4", "text": ""}, {"location": "workflows/ml_strategy_workflow/#41-lightgbm", "title": "4.1 \u4f7f\u7528 LightGBM \u6a21\u578b", "text": "<pre><code>import finlab.ml.qlib as q\n\n# \u5efa\u7acb\u4e26\u8a13\u7df4 LightGBM \u6a21\u578b\nmodel = q.LGBModel()\nmodel.fit(X_train, y_train)\n\nprint(\"\u8a13\u7df4\u5b8c\u6210!\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#42", "title": "4.2 \u4f7f\u7528\u5176\u4ed6\u6a21\u578b", "text": "<pre><code># XGBoost\nmodel_xgb = q.XGBModel()\nmodel_xgb.fit(X_train, y_train)\n\n# CatBoost\nmodel_cat = q.CatBoostModel()\nmodel_cat.fit(X_train, y_train)\n\n# \u7dda\u6027\u6a21\u578b\uff08\u5feb\u901f\u9a57\u8b49\u3001\u4e0d\u6613\u904e\u64ec\u5408\uff09\nmodel_linear = q.LinearModel()\nmodel_linear.fit(X_train, y_train)\n\n# \u6df1\u5ea6\u5b78\u7fd2\nmodel_dnn = q.DNNModel()\nmodel_dnn.fit(X_train, y_train)\n\n# \u5217\u51fa\u6240\u6709\u53ef\u7528\u6a21\u578b\nmodels = q.get_models()\nprint(list(models.keys()))\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#43", "title": "4.3 \u591a\u6a21\u578b\u6bd4\u8f03", "text": "<pre><code>import finlab.ml.qlib as q\nfrom finlab.backtest import sim\n\n# \u5feb\u901f\u6bd4\u8f03\u591a\u500b\u6a21\u578b\nresults = {}\nfor name, ModelClass in [('LightGBM', q.LGBModel), ('XGBoost', q.XGBModel), ('Linear', q.LinearModel)]:\n    model = ModelClass()\n    model.fit(X_train, y_train)\n    y_pred = model.predict(X_test)\n    position = y_pred.is_largest(30)\n    report = sim(position, resample='W', name=f\"ML {name}\", upload=False)\n    results[name] = report\n\n# \u6bd4\u8f03\u7e3e\u6548\nfor name, report in results.items():\n    stats = report.get_stats()\n    print(f\"{name}: \u5e74\u5316\u5831\u916c {stats['daily_mean']:.2%}, \u590f\u666e\u7387 {stats['daily_sharpe']:.2f}\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#5", "title": "\u968e\u6bb5 5: \u9810\u6e2c\u8207\u6301\u5009\u6b0a\u91cd\u751f\u6210", "text": "<p><code>model.predict()</code> \u56de\u50b3 <code>FinlabDataFrame</code>\uff08index \u70ba\u65e5\u671f\u3001columns \u70ba\u80a1\u7968\u4ee3\u865f\uff09\uff0c\u53ef\u76f4\u63a5\u4f7f\u7528 FinlabDataFrame \u7684\u65b9\u6cd5\u8f49\u63db\u70ba\u6301\u5009\u3002</p>"}, {"location": "workflows/ml_strategy_workflow/#51", "title": "5.1 \u7522\u751f\u9810\u6e2c", "text": "<pre><code># \u5c0d\u6e2c\u8a66\u96c6\u9032\u884c\u9810\u6e2c\ny_pred = model.predict(X_test)\n\nprint(y_pred.head())\n# \u8f38\u51fa\uff08FinlabDataFrame\uff0cindex=\u65e5\u671f\uff0ccolumns=\u80a1\u7968\u4ee3\u865f\uff09:\n#              1101    1102    1103    1216    2330\n# 2023-01-06  0.032   0.015  -0.008   0.045   0.023\n# 2023-01-13  0.018   0.027   0.003   0.012   0.041\n\n# \u6aa2\u67e5\u9810\u6e2c\u5206\u5e03\nprint(y_pred.stack().describe())\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#52", "title": "5.2 \u8f49\u63db\u70ba\u6301\u5009", "text": "<pre><code>from finlab.backtest import sim\n\n# \u65b9\u6cd5 1: Top N \u9078\u80a1\uff08\u8cb7\u5165\u9810\u6e2c\u503c\u6700\u9ad8\u7684 N \u6a94\uff09\nposition_topn = y_pred.is_largest(30)\n\n# \u65b9\u6cd5 2: \u524d 20% \u9078\u80a1\nposition_quantile = y_pred &gt; y_pred.quantile(0.8)\n\n# \u65b9\u6cd5 3: \u6839\u64da\u9810\u6e2c\u503c\u5206\u914d\u6b0a\u91cd\nposition_weighted = y_pred / y_pred.sum()\n\nprint(f\"Top 30 \u7b56\u7565\u5e73\u5747\u6301\u80a1\u6578: {position_topn.sum(axis=1).mean():.1f}\")\nprint(f\"\u524d 20% \u7b56\u7565\u5e73\u5747\u6301\u80a1\u6578: {position_quantile.sum(axis=1).mean():.1f}\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#6", "title": "\u968e\u6bb5 6: \u56de\u6e2c\u9a57\u8b49", "text": ""}, {"location": "workflows/ml_strategy_workflow/#61", "title": "6.1 \u57f7\u884c\u56de\u6e2c", "text": "<pre><code>from finlab.backtest import sim\n\n# \u56de\u6e2c Top 30 \u7b56\u7565\nreport_topn = sim(\n    position_topn,\n    resample='W',\n    name=\"ML Top 30 \u7b56\u7565\",\n    upload=False\n)\n\n# \u56de\u6e2c\u52a0\u6b0a\u7b56\u7565\nreport_weighted = sim(\n    position_weighted,\n    resample='W',\n    name=\"ML \u52a0\u6b0a\u7b56\u7565\",\n    upload=False\n)\n\n# \u986f\u793a\u7e3e\u6548\nreport_topn.display()\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#62", "title": "6.2 \u7e3e\u6548\u6bd4\u8f03", "text": "<pre><code>import pandas as pd\n\nstats_topn = report_topn.get_stats()\nstats_weighted = report_weighted.get_stats()\n\ncomparison = pd.DataFrame({\n    'Top 30 \u7b56\u7565': [\n        stats_topn['daily_mean'],\n        stats_topn['daily_sharpe'],\n        stats_topn['max_drawdown'],\n        stats_topn['win_ratio']\n    ],\n    '\u52a0\u6b0a\u7b56\u7565': [\n        stats_weighted['daily_mean'],\n        stats_weighted['daily_sharpe'],\n        stats_weighted['max_drawdown'],\n        stats_weighted['win_ratio']\n    ]\n}, index=['\u5e74\u5316\u5831\u916c\u7387', '\u590f\u666e\u7387', '\u6700\u5927\u56de\u64a4', '\u52dd\u7387'])\n\nprint(comparison)\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#63", "title": "6.3 \u6df1\u5ea6\u5206\u6790", "text": "<pre><code># \u6d41\u52d5\u6027\u5206\u6790\nreport_topn.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# MAE/MFE \u5206\u6790\nreport_topn.display_mae_mfe_analysis()\n\n# \u6642\u671f\u7a69\u5b9a\u6027\nreport_topn.run_analysis('PeriodStatsAnalysis')\n\n# Alpha/Beta\nreport_topn.run_analysis('AlphaBetaAnalysis')\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#7", "title": "\u968e\u6bb5 7: \u7279\u5fb5\u5de5\u7a0b\u8fed\u4ee3\u512a\u5316", "text": ""}, {"location": "workflows/ml_strategy_workflow/#71", "title": "7.1 \u6e1b\u5c11\u7279\u5fb5\u6578\u91cf", "text": "<pre><code># \u7b56\u7565 1: \u4f7f\u7528\u8f03\u5c11\u7684\u6280\u8853\u6307\u6a19\nfeatures_small = mlf.combine({\n    'pb': pb_ratio,\n    'pe': pe_ratio,\n    'roe': roe,\n    'talib': mlf.ta(mlf.ta_names(n=1)[:20])  # \u53ea\u53d6\u524d 20 \u500b\u6307\u6a19\n}, resample='W')\n\nlabel_small = mll.return_percentage(features_small.index, resample='W', period=1)\n\nis_train_small = features_small.index.get_level_values('datetime') &lt; '2023-01-01'\nmodel_v2 = q.LGBModel()\nmodel_v2.fit(features_small[is_train_small], label_small[is_train_small])\n\ny_pred_v2 = model_v2.predict(features_small[~is_train_small])\nposition_v2 = y_pred_v2.is_largest(30)\nreport_v2 = sim(position_v2, resample='W', name=\"ML V2 \u7cbe\u7c21\u7279\u5fb5\", upload=False)\nreport_v2.display()\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#72", "title": "7.2 \u8abf\u6574\u6a19\u7c64\u9810\u6e2c\u671f", "text": "<pre><code># \u6e2c\u8a66\u4e0d\u540c\u9810\u6e2c\u671f\nfor period in [1, 2, 4]:\n    label_n = mll.return_percentage(all_features.index, resample='W', period=period)\n\n    model_n = q.LGBModel()\n    model_n.fit(X_train, label_n[is_train])\n\n    y_pred_n = model_n.predict(X_test)\n    position_n = y_pred_n.is_largest(30)\n    report_n = sim(position_n, resample='W', name=f\"ML \u9810\u6e2c{period}\u9031\", upload=False)\n\n    stats = report_n.get_stats()\n    print(f\"\u9810\u6e2c {period} \u9031: \u5e74\u5316\u5831\u916c {stats['daily_mean']:.2%}, \u590f\u666e\u7387 {stats['daily_sharpe']:.2f}\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#73", "title": "7.3 \u5617\u8a66\u4e0d\u540c\u6a19\u7c64\u985e\u578b", "text": "<pre><code># \u6bd4\u8f03\u5831\u916c\u7387 vs \u8d85\u984d\u5831\u916c\u6a19\u7c64\nlabel_return = mll.return_percentage(all_features.index, resample='W', period=1)\nlabel_excess = mll.excess_over_median(all_features.index, resample='W', period=1)\n\nfor label_name, label_data in [('\u5831\u916c\u7387', label_return), ('\u8d85\u984d\u5831\u916c', label_excess)]:\n    model_cmp = q.LGBModel()\n    model_cmp.fit(X_train, label_data[is_train])\n\n    y_pred_cmp = model_cmp.predict(X_test)\n    position_cmp = y_pred_cmp.is_largest(30)\n    report_cmp = sim(position_cmp, resample='W', name=f\"ML {label_name}\", upload=False)\n\n    stats = report_cmp.get_stats()\n    print(f\"{label_name}: \u5e74\u5316\u5831\u916c {stats['daily_mean']:.2%}, \u590f\u666e\u7387 {stats['daily_sharpe']:.2f}\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#8", "title": "\u968e\u6bb5 8: \u5be6\u76e4\u90e8\u7f72", "text": ""}, {"location": "workflows/ml_strategy_workflow/#81", "title": "8.1 \u5efa\u7acb\u5be6\u6642\u9810\u6e2c\u6d41\u7a0b", "text": "<pre><code>from finlab import data\nfrom finlab.ml import feature as mlf, label as mll\nimport finlab.ml.qlib as q\nimport pickle\n\n# 1. \u8a13\u7df4\u5b8c\u6574\u6a21\u578b\uff08\u4f7f\u7528\u6240\u6709\u6b77\u53f2\u8cc7\u6599\uff09\nfeatures = mlf.combine({\n    'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n    'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4'),\n    'roe': data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387'),\n    'talib': mlf.ta(mlf.ta_names(n=1)[:20])\n}, resample='W')\n\nlabel = mll.return_percentage(features.index, resample='W', period=1)\n\nmodel = q.LGBModel()\nmodel.fit(features, label)\n\n# 2. \u5132\u5b58\u6a21\u578b\nwith open('ml_model.pkl', 'wb') as f:\n    pickle.dump(model, f)\n\n# 3. \u8f09\u5165\u6a21\u578b\u4e26\u9810\u6e2c\u6700\u65b0\u6301\u5009\nwith open('ml_model.pkl', 'rb') as f:\n    loaded_model = pickle.load(f)\n\ny_pred = loaded_model.predict(features)\n\n# 4. \u53d6\u5f97\u6700\u65b0\u6301\u5009\nposition = y_pred.is_largest(30)\nlatest_position = position.iloc[-1]\nlatest_position = latest_position[latest_position &gt; 0].sort_values(ascending=False)\n\nprint(\"\u6700\u65b0\u6301\u80a1\u5efa\u8b70:\")\nprint(latest_position)\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#82", "title": "8.2 \u81ea\u52d5\u4ea4\u6613\u8a2d\u5b9a", "text": "<pre><code>from finlab.backtest import sim\nfrom finlab.online.sinopac_account import SinopacAccount\nfrom finlab.online.order_executor import OrderExecutor\n\n# \u5efa\u7acb\u5b9a\u671f\u57f7\u884c\u8173\u672c\uff08\u6bcf\u9031\u4e00\u57f7\u884c\uff09\ndef weekly_rebalance():\n    # \u91cd\u65b0\u8a08\u7b97\u7279\u5fb5\n    features = mlf.combine({\n        'pb': data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4'),\n        'pe': data.get('price_earning_ratio:\u672c\u76ca\u6bd4'),\n        'roe': data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387'),\n        'talib': mlf.ta(mlf.ta_names(n=1)[:20])\n    }, resample='W')\n\n    # \u8f09\u5165\u6a21\u578b\u4e26\u9810\u6e2c\n    with open('ml_model.pkl', 'rb') as f:\n        model = pickle.load(f)\n\n    y_pred = model.predict(features)\n    position = y_pred.is_largest(30)\n\n    # \u7528 sim \u7522\u751f report\n    report = sim(position, resample='W', upload=False)\n\n    # \u57f7\u884c\u4e0b\u55ae\n    account = SinopacAccount(simulation=False)\n    executor = OrderExecutor(report=report, account=account, fund=1000000)\n    executor.execute()\n\n# \u4f7f\u7528 cron \u6216\u6392\u7a0b\u5de5\u5177\u5b9a\u671f\u57f7\u884c weekly_rebalance()\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#_3", "title": "\u5b8c\u6574\u7a0b\u5f0f\u78bc\u5f59\u6574", "text": "<pre><code># =============================================================================\n# \u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u5b8c\u6574\u7bc4\u4f8b\n# =============================================================================\n\nfrom finlab import data\nfrom finlab.ml import feature as mlf\nfrom finlab.ml import label as mll\nimport finlab.ml.qlib as q\nfrom finlab.backtest import sim\n\n# 1. \u7279\u5fb5\u5de5\u7a0b\nclose = data.get('price:\u6536\u76e4\u50f9')\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\npe = data.get('price_earning_ratio:\u672c\u76ca\u6bd4')\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\nfeatures = mlf.combine({\n    'pb': pb,\n    'pe': pe,\n    'rev_ma3': rev.average(3),\n    'rev_ma12': rev.average(12),\n    'talib': mlf.ta(mlf.ta_names(n=1)[:20])\n}, resample='W')\n\n# 2. \u6a19\u7c64\u751f\u6210\nlabel = mll.return_percentage(features.index, resample='W', period=1)\n\n# 3. \u8cc7\u6599\u5207\u5206\nis_train = features.index.get_level_values('datetime') &lt; '2023-01-01'\nX_train = features[is_train]\ny_train = label[is_train]\nX_test = features[~is_train]\n\n# 4. \u6a21\u578b\u8a13\u7df4\nmodel = q.LGBModel()\nmodel.fit(X_train, y_train)\n\n# 5. \u9810\u6e2c\u8207\u6301\u5009\ny_pred = model.predict(X_test)\nposition = y_pred.is_largest(30)\n\n# 6. \u56de\u6e2c\nreport = sim(position, resample='W', name=\"ML Strategy\", upload=False)\nreport.display()\n\n# 7. \u5206\u6790\nreport.run_analysis('LiquidityAnalysis')\nreport.display_mae_mfe_analysis()\n\nprint(\"\u5b8c\u6210!\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#_4", "title": "\u95dc\u9375\u8981\u9ede\u7e3d\u7d50", "text": ""}, {"location": "workflows/ml_strategy_workflow/#_5", "title": "\u7279\u5fb5\u5de5\u7a0b\u968e\u6bb5", "text": "<ul> <li>\u2705 \u591a\u6a23\u5316\u7279\u5fb5\u4f86\u6e90\uff08\u57fa\u672c\u9762\u3001\u6280\u8853\u9762\u3001\u81ea\u8a02\uff09</li> <li>\u2705 \u4f7f\u7528 <code>mlf.combine()</code> \u7d71\u4e00\u5408\u4f75\uff0c\u78ba\u4fdd MultiIndex \u5c0d\u9f4a</li> <li>\u2705 \u6aa2\u67e5\u4e26\u8655\u7406\u7f3a\u5931\u503c</li> <li>\u2705 \u7279\u5fb5\u6578\u91cf\u63a7\u5236\uff08\u904e\u591a\u6703\u5c0e\u81f4\u904e\u5ea6\u914d\u9069\uff09</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/#_6", "title": "\u6a19\u7c64\u751f\u6210\u968e\u6bb5", "text": "<ul> <li>\u2705 \u4f7f\u7528 <code>mll.return_percentage()</code> \u7b49\u51fd\u6578\uff0c\u50b3\u5165 <code>features.index</code></li> <li>\u2705 <code>resample</code> \u53c3\u6578\u8207\u7279\u5fb5\u4e00\u81f4</li> <li>\u2705 \u9810\u6e2c\u671f\uff08<code>period</code>\uff09\u8981\u5408\u7406\uff08\u592a\u77ed\u566a\u97f3\u5927\uff0c\u592a\u9577\u96e3\u9810\u6e2c\uff09</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/#_7", "title": "\u6a21\u578b\u8a13\u7df4\u968e\u6bb5", "text": "<ul> <li>\u2705 \u4f7f\u7528 <code>q.LGBModel()</code> \u7b49\u5305\u88dd\u985e\uff0c<code>fit()</code> + <code>predict()</code></li> <li>\u2705 \u6642\u9593\u5207\u5206\u8a13\u7df4/\u6e2c\u8a66\u96c6\uff08\u4e0d\u662f\u96a8\u6a5f\u5207\u5206\uff09</li> <li>\u2705 \u5148\u7528\u7c21\u55ae\u6a21\u578b\uff08<code>LinearModel</code>\uff09\u5efa\u7acb\u57fa\u6e96</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/#_8", "title": "\u56de\u6e2c\u9a57\u8b49\u968e\u6bb5", "text": "<ul> <li>\u2705 <code>predict()</code> \u56de\u50b3 FinlabDataFrame\uff0c\u7528 <code>is_largest()</code> \u8f49\u70ba\u6301\u5009</li> <li>\u2705 \u6a23\u672c\u5916\u6e2c\u8a66\u5fc5\u505a</li> <li>\u2705 \u57f7\u884c\u6df1\u5ea6\u5206\u6790\uff08\u6d41\u52d5\u6027\u3001MAE/MFE\uff09</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/#_9", "title": "\u5be6\u76e4\u90e8\u7f72\u968e\u6bb5", "text": "<ul> <li>\u2705 \u5b9a\u671f\u91cd\u65b0\u8a13\u7df4\u6a21\u578b\uff08\u4f8b\u5982\u6bcf\u5b63\uff09</li> <li>\u2705 \u76e3\u63a7\u5be6\u76e4\u8207\u56de\u6e2c\u7684\u504f\u5dee</li> <li>\u2705 \u8a2d\u5b9a\u7e3e\u6548\u9810\u8b66\u6a5f\u5236</li> </ul>"}, {"location": "workflows/ml_strategy_workflow/#_10", "title": "\u5e38\u898b\u932f\u8aa4\u8655\u7406\u6aa2\u67e5\u6e05\u55ae", "text": "<p>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u958b\u767c\u904e\u7a0b\u4e2d\uff0c\u4ee5\u4e0b\u662f\u95dc\u9375\u932f\u8aa4\u6aa2\u67e5\u9ede\uff1a</p>"}, {"location": "workflows/ml_strategy_workflow/#1_1", "title": "\u968e\u6bb5 1\uff1a\u7279\u5fb5\u5de5\u7a0b", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c \u7279\u5fb5\u8207\u6a19\u7c64\u7684 <code>resample</code> \u4e0d\u4e00\u81f4 - \u274c \u7f3a\u5931\u503c\u904e\u591a\u5c0e\u81f4\u8a13\u7df4\u8cc7\u6599\u4e0d\u8db3 - \u274c \u672a\u4f86\u51fd\u6578\uff08\u4f7f\u7528\u672a\u4f86\u8cc7\u6599\u9810\u6e2c\u904e\u53bb\uff09</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code>try:\n    # 1. \u5efa\u7acb\u7279\u5fb5\n    features = mlf.combine({\n        'pb': pb,\n        'pe': pe,\n        'rev_ma3': rev.average(3)\n    }, resample='W')\n\n    if features.empty:\n        raise ValueError(\"\u274c \u7279\u5fb5 DataFrame \u70ba\u7a7a\")\n\n    # 2. \u6aa2\u67e5\u7f3a\u5931\u503c\u6bd4\u4f8b\n    missing_ratio = features.isna().sum() / len(features)\n    high_missing_cols = missing_ratio[missing_ratio &gt; 0.3].index.tolist()\n\n    if high_missing_cols:\n        print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u4ee5\u4e0b\u7279\u5fb5\u7f3a\u5931\u503c &gt; 30%\uff1a{high_missing_cols}\")\n        print(\"\u5efa\u8b70\uff1a\u79fb\u9664\u9019\u4e9b\u7279\u5fb5\u6216\u4f7f\u7528 forward fill\")\n\n    # 3. \u6aa2\u67e5\u65e5\u671f\u7bc4\u570d\n    print(f\"\u7279\u5fb5\u65e5\u671f\u7bc4\u570d\uff1a{features.index.get_level_values(0).min()} ~ {features.index.get_level_values(0).max()}\")\n\n    # 4. \u6aa2\u67e5\u7279\u5fb5\u6578\u91cf\n    num_features = features.shape[1]\n    if num_features &gt; 500:\n        print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u7279\u5fb5\u6578\u91cf\u904e\u591a\uff08{num_features} \u500b\uff09\uff0c\u53ef\u80fd\u5c0e\u81f4\u904e\u5ea6\u914d\u9069\")\n        print(\"\u5efa\u8b70\uff1a&lt; 200 \u500b\u7279\u5fb5\u70ba\u4f73\")\n\n    print(f\"\u2705 \u7279\u5fb5\u5de5\u7a0b\u5b8c\u6210\uff1a{num_features} \u500b\u7279\u5fb5\uff0c{len(features)} \u7b46\u8cc7\u6599\")\n\nexcept KeyError as e:\n    print(f\"\u274c \u8cc7\u6599\u8868\u540d\u7a31\u932f\u8aa4\uff1a{e}\")\n    print(\"\u8acb\u81f3 https://ai.finlab.tw/database \u78ba\u8a8d\u6b63\u78ba\u540d\u7a31\")\n\nexcept ValueError as e:\n    print(f\"\u274c \u7279\u5fb5\u9a57\u8b49\u5931\u6557\uff1a{e}\")\n</code></pre> <p>\u8a73\u7d30\u932f\u8aa4\u8655\u7406\uff1a\u53c3\u8003 \u8cc7\u6599\u4e0b\u8f09\u932f\u8aa4\u8655\u7406</p>"}, {"location": "workflows/ml_strategy_workflow/#2_1", "title": "\u968e\u6bb5 2\uff1a\u6a19\u7c64\u751f\u6210", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c \u6a19\u7c64\u8207\u7279\u5fb5\u7684 <code>resample</code> \u4e0d\u4e00\u81f4 - \u274c \u50b3\u5165\u932f\u8aa4\u7684 <code>index</code>\uff08\u61c9\u50b3 <code>features.index</code>\uff09 - \u274c \u9810\u6e2c\u671f\u8a2d\u5b9a\u4e0d\u5408\u7406</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code># \u751f\u6210\u6a19\u7c64\nlabel = mll.return_percentage(features.index, resample='W', period=1)\n\n# \u6aa2\u67e5\u6a19\u7c64\u5206\u5e03\nprint(\"\u6a19\u7c64\u7d71\u8a08:\")\nprint(label.describe())\n\n# \u6aa2\u67e5\u6a19\u7c64\u7f3a\u5931\u503c\nnan_ratio = label.isna().mean()\nif nan_ratio &gt; 0.1:\n    print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u6a19\u7c64\u7f3a\u5931\u503c {nan_ratio:.1%} &gt; 10%\")\n    print(\"\u53ef\u80fd\u539f\u56e0\uff1a\u9810\u6e2c\u671f\u904e\u9577\uff0c\u8fd1\u671f\u8cc7\u6599\u7121\u6a19\u7c64\")\n\nprint(f\"\u2705 \u6a19\u7c64\u751f\u6210\u5b8c\u6210\uff1a{len(label)} \u7b46\u8cc7\u6599\")\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#3_1", "title": "\u968e\u6bb5 3\uff1a\u6a21\u578b\u8a13\u7df4", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c \u8a13\u7df4\u8cc7\u6599\u4e0d\u8db3\uff08&lt; 1000 \u7b46\uff09 - \u274c \u4f7f\u7528\u96a8\u6a5f\u5207\u5206\u800c\u975e\u6642\u9593\u5207\u5206 - \u274c \u904e\u5ea6\u914d\u9069\uff08\u6e2c\u8a66\u96c6\u8868\u73fe\u9060\u5dee\u65bc\u8a13\u7df4\u96c6\uff09</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code># \u5207\u5206\u8a13\u7df4/\u6e2c\u8a66\u96c6\nis_train = features.index.get_level_values('datetime') &lt; '2023-01-01'\nX_train = features[is_train]\ny_train = label[is_train]\nX_test = features[~is_train]\n\n# 1. \u6aa2\u67e5\u8cc7\u6599\u91cf\nprint(f\"\u8a13\u7df4\u96c6\uff1a{len(X_train)} \u7b46\")\nprint(f\"\u6e2c\u8a66\u96c6\uff1a{len(X_test)} \u7b46\")\n\nif len(X_train) &lt; 1000:\n    print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u8a13\u7df4\u8cc7\u6599\u4e0d\u8db3\uff08&lt; 1000 \u7b46\uff09\")\n    print(\"\u5efa\u8b70\uff1a\u589e\u52a0\u6b77\u53f2\u8cc7\u6599\u7bc4\u570d\u6216\u964d\u4f4e resample \u983b\u7387\")\n\nif len(X_test) &lt; 100:\n    print(\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u6e2c\u8a66\u8cc7\u6599\u904e\u5c11\uff08&lt; 100 \u7b46\uff09\")\n\n# 2. \u6aa2\u67e5\u65e5\u671f\u9806\u5e8f\ntrain_last = X_train.index.get_level_values(0).max()\ntest_first = X_test.index.get_level_values(0).min()\n\nif train_last &gt;= test_first:\n    raise ValueError(\n        f\"\u274c \u8a13\u7df4\u96c6\u8207\u6e2c\u8a66\u96c6\u65e5\u671f\u91cd\u758a\uff01\\n\"\n        f\"   \u8a13\u7df4\u96c6\u6700\u5f8c\u65e5\u671f\uff1a{train_last}\\n\"\n        f\"   \u6e2c\u8a66\u96c6\u7b2c\u4e00\u65e5\u671f\uff1a{test_first}\\n\"\n        f\"   \u9019\u6703\u5c0e\u81f4\u8cc7\u6599\u6d29\u9732\uff08data leakage\uff09\"\n    )\n\nprint(f\"\u2705 \u8cc7\u6599\u5207\u5206\u6b63\u78ba\")\n\n# 3. \u6a21\u578b\u8a13\u7df4\ntry:\n    model = q.LGBModel()\n    model.fit(X_train, y_train)\n    print(f\"\u2705 \u6a21\u578b\u8a13\u7df4\u5b8c\u6210\")\n\nexcept Exception as e:\n    print(f\"\u274c \u6a21\u578b\u8a13\u7df4\u5931\u6557\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5\uff1a\")\n    print(\"1. \u7279\u5fb5\u662f\u5426\u5305\u542b NaN \u6216 Inf\")\n    print(\"2. \u6a19\u7c64\u662f\u5426\u70ba\u6578\u503c\u578b\u614b\")\n    print(\"3. \u76f8\u95dc\u5957\u4ef6\u662f\u5426\u6b63\u78ba\u5b89\u88dd\uff08pip install lightgbm / xgboost\uff09\")\n    raise\n</code></pre>"}, {"location": "workflows/ml_strategy_workflow/#4_1", "title": "\u968e\u6bb5 4\uff1a\u9810\u6e2c\u8207\u56de\u6e2c", "text": "<p>\u5e38\u898b\u932f\u8aa4\uff1a - \u274c \u9810\u6e2c\u7d50\u679c\u5168\u70ba NaN - \u274c \u6301\u5009 DataFrame \u683c\u5f0f\u932f\u8aa4 - \u274c \u56de\u6e2c\u7121\u4ea4\u6613\u8a18\u9304</p> <p>\u6aa2\u67e5\u65b9\u6cd5\uff1a</p> <pre><code># 1. \u9810\u6e2c\ny_pred = model.predict(X_test)\n\nif y_pred.isna().all().all():\n    raise ValueError(\"\u274c \u9810\u6e2c\u7d50\u679c\u5168\u70ba NaN\")\n\n# \u6aa2\u67e5\u9810\u6e2c\u5206\u5e03\nprint(f\"\u9810\u6e2c\u503c\u7bc4\u570d\uff1a{y_pred.min().min():.4f} ~ {y_pred.max().max():.4f}\")\nprint(f\"\u9810\u6e2c\u5e73\u5747\u503c\uff1a{y_pred.stack().mean():.4f}\")\n\n# 2. \u7522\u751f\u6301\u5009\nposition = y_pred.is_largest(30)\n\nif position.empty:\n    raise ValueError(\"\u274c \u6301\u5009 DataFrame \u70ba\u7a7a\")\n\nholding_count = position.sum(axis=1).mean()\nif holding_count &lt; 10:\n    print(f\"\u26a0\ufe0f  \u8b66\u544a\uff1a\u5e73\u5747\u6301\u5009\u6578 {holding_count:.1f} &lt; 10\uff0c\u53ef\u80fd\u904e\u5c11\")\n\nprint(f\"\u2705 \u6301\u5009\u751f\u6210\u6210\u529f\uff1a\u5e73\u5747\u6301\u6709 {holding_count:.1f} \u6a94\")\n\n# 3. \u56de\u6e2c\ntry:\n    report = sim(position, resample='W', name=\"ML Strategy\", upload=False)\n    print(f\"\u2705 \u56de\u6e2c\u6210\u529f\")\n\n    stats = report.get_stats()\n    print(f\"   \u5e74\u5316\u5831\u916c\uff1a{stats['daily_mean']:.2%}\")\n    print(f\"   \u590f\u666e\u7387\uff1a{stats['daily_sharpe']:.2f}\")\n\nexcept Exception as e:\n    print(f\"\u274c \u56de\u6e2c\u5931\u6557\uff1a{e}\")\n    print(\"\u8acb\u6aa2\u67e5\uff1a\")\n    print(\"1. position \u7684 index \u662f\u5426\u70ba DatetimeIndex\")\n    print(\"2. position \u7684 columns \u662f\u5426\u70ba\u80a1\u7968\u4ee3\u865f\")\n    raise\n</code></pre> <p>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u7279\u6709\u98a8\u96aa</p> <p>\u76f8\u6bd4\u50b3\u7d71\u7b56\u7565\uff0cML \u7b56\u7565\u9700\u984d\u5916\u6ce8\u610f\uff1a</p> <ul> <li>\u274c \u8cc7\u6599\u6d29\u9732\uff08data leakage\uff09- \u4f7f\u7528\u672a\u4f86\u8cc7\u6599\u9810\u6e2c\u904e\u53bb</li> <li>\u274c \u904e\u5ea6\u914d\u9069\uff08overfitting\uff09- \u6e2c\u8a66\u96c6\u8868\u73fe\u9060\u5dee\u65bc\u8a13\u7df4\u96c6</li> <li>\u274c \u6a21\u578b\u8870\u9000\uff08model decay\uff09- \u5be6\u76e4\u8868\u73fe\u96a8\u6642\u9593\u8870\u9000</li> </ul> <p>\u5efa\u8b70\uff1a - \u2705 \u56b4\u683c\u4f7f\u7528\u6642\u9593\u5e8f\u5217\u5207\u5206\uff08\u4e0d\u662f\u96a8\u6a5f\u5207\u5206\uff09 - \u2705 \u5b9a\u671f\u91cd\u65b0\u8a13\u7df4\u6a21\u578b\uff08\u6bcf\u5b63\u6216\u6bcf\u6708\uff09 - \u2705 \u76e3\u63a7\u5be6\u76e4\u8207\u56de\u6e2c\u504f\u5dee\uff0c\u8a2d\u5b9a\u9810\u8b66\u6a5f\u5236</p>"}, {"location": "workflows/ml_strategy_workflow/#_11", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u6a5f\u5668\u5b78\u7fd2\u7c21\u6613\u6559\u5b78</li> <li>finlab.ml API Reference</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44</li> <li>\u5be6\u76e4\u4ea4\u6613\u6559\u5b78</li> <li>\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357</li> <li>\u5e38\u898b\u554f\u984c FAQ</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/", "title": "\u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406\u5b8c\u6574\u6d41\u7a0b", "text": "<p>\u672c\u6587\u4ecb\u7d39\u5982\u4f55\u5efa\u7acb\u3001\u7ba1\u7406\u8207\u90e8\u7f72\u591a\u7b56\u7565\u6295\u8cc7\u7d44\u5408,\u5f9e\u7b56\u7565\u6c60\u5efa\u7acb\u5230\u5be6\u76e4\u57f7\u884c\u7684\u5b8c\u6574\u6d41\u7a0b\u3002</p>"}, {"location": "workflows/multi_strategy_portfolio/#_2", "title": "\u70ba\u4ec0\u9ebc\u9700\u8981\u591a\u7b56\u7565\u7d44\u5408?", "text": "<p>\u55ae\u4e00\u7b56\u7565\u7684\u98a8\u96aa:</p> <ul> <li>\u5e02\u5834\u74b0\u5883\u8b8a\u5316: \u7b56\u7565\u5728\u7279\u5b9a\u5e02\u5834\u74b0\u5883\u8868\u73fe\u597d,\u4f46\u74b0\u5883\u6539\u8b8a\u6642\u53ef\u80fd\u5931\u6548</li> <li>\u56de\u64a4\u98a8\u96aa: \u55ae\u4e00\u7b56\u7565\u7684\u6700\u5927\u56de\u64a4\u53ef\u80fd\u5f88\u5927</li> <li>\u6536\u76ca\u4e0d\u7a69\u5b9a: \u7b56\u7565\u53ef\u80fd\u9577\u6642\u9593\u8868\u73fe\u4e0d\u4f73</li> </ul> <p>\u591a\u7b56\u7565\u7d44\u5408\u7684\u512a\u52e2:</p> <ul> <li>\u5206\u6563\u98a8\u96aa: \u4e0d\u540c\u7b56\u7565\u5728\u4e0d\u540c\u5e02\u5834\u74b0\u5883\u4e0b\u4e92\u88dc</li> <li>\u964d\u4f4e\u56de\u64a4: \u7d44\u5408\u7684\u6700\u5927\u56de\u64a4\u901a\u5e38\u5c0f\u65bc\u55ae\u4e00\u7b56\u7565</li> <li>\u7a69\u5b9a\u6536\u76ca: \u5e73\u6ed1\u55ae\u4e00\u7b56\u7565\u7684\u6ce2\u52d5</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_3", "title": "\u6d41\u7a0b\u6982\u89bd", "text": "<pre><code>graph TB\n    A[\u5efa\u7acb\u7b56\u7565\u6c60] --&gt; B{\u6709\u591a\u500b\u7b56\u7565?}\n    B --&gt;|\u662f| C[\u4f7f\u7528 Portfolio \u7d44\u5408]\n    B --&gt;|\u5426| A\n    C --&gt; D[\u56de\u6e2c\u7d44\u5408\u7e3e\u6548]\n    D --&gt; E{\u7e3e\u6548\u6eff\u610f?}\n    E --&gt;|\u5426| F[\u8abf\u6574\u6b0a\u91cd\u6216\u7b56\u7565]\n    F --&gt; C\n    E --&gt;|\u662f| G[\u4f7f\u7528 PortfolioSyncManager]\n    G --&gt; H[\u8a08\u7b97\u6301\u80a1\u5f35\u6578]\n    H --&gt; I[\u5be6\u76e4\u57f7\u884c]\n    I --&gt; J[\u5b9a\u671f\u8abf\u6574]\n    J --&gt; K{\u9700\u8981\u512a\u5316?}\n    K --&gt;|\u662f| F\n    K --&gt;|\u5426| I</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#1", "title": "\u968e\u6bb5 1: \u7b56\u7565\u6c60\u5efa\u7acb", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#11", "title": "1.1 \u958b\u767c\u591a\u500b\u4e0d\u540c\u985e\u578b\u7684\u7b56\u7565", "text": "<p>\u5efa\u8b70\u7d44\u5408\u5305\u542b\u4e0d\u540c\u98a8\u683c\u7684\u7b56\u7565:</p> <pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u7b56\u7565 1: \u6280\u8853\u9762\u52d5\u80fd\u7b56\u7565(\u77ed\u671f)\nclose = data.get('price:\u6536\u76e4\u50f9')\nvolume = data.get('price:\u6210\u4ea4\u80a1\u6578')\n\nentry1 = (close == close.rolling(20).max()) &amp; (volume &gt; volume.average(20) * 1.5)\nexit1 = close &lt; close.average(10)\n\nposition1 = entry1.hold_until(exit=exit1, stop_loss=0.08)\nreport1 = sim(position1, resample='W', name=\"\u52d5\u80fd\u7b56\u7565\", upload=False)\n\n# \u7b56\u7565 2: \u57fa\u672c\u9762\u50f9\u503c\u7b56\u7565(\u4e2d\u671f)\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\nroe = data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\n\nentry2 = (pb &lt; pb.quantile(0.3, axis=1)) &amp; (roe &gt; 0.1)\nexit2 = pb &gt; pb.quantile(0.7, axis=1)\n\nposition2 = entry2.hold_until(exit=exit2)\nreport2 = sim(position2, resample='M', name=\"\u50f9\u503c\u7b56\u7565\", upload=False)\n\n# \u7b56\u7565 3: \u71df\u6536\u6210\u9577\u7b56\u7565(\u4e2d\u9577\u671f)\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\nrev_ma3 = rev.average(3)\nrev_ma12 = rev.average(12)\n\nentry3 = (rev_ma3 / rev_ma12 &gt; 1.15) &amp; (close &gt; close.average(60))\nexit3 = rev_ma3 / rev_ma12 &lt; 1.0\n\nposition3 = entry3.hold_until(exit=exit3, stop_loss=0.1)\nreport3 = sim(position3, resample='M', name=\"\u71df\u6536\u6210\u9577\u7b56\u7565\", upload=False)\n\nprint(\"\u7b56\u7565\u6c60\u5efa\u7acb\u5b8c\u6210!\")\nprint(f\"\u7b56\u7565 1 \u5e74\u5316\u5831\u916c: {report1.get_stats()['daily_mean']*100:.2f}%\")\nprint(f\"\u7b56\u7565 2 \u5e74\u5316\u5831\u916c: {report2.get_stats()['daily_mean']*100:.2f}%\")\nprint(f\"\u7b56\u7565 3 \u5e74\u5316\u5831\u916c: {report3.get_stats()['daily_mean']*100:.2f}%\")\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#12", "title": "1.2 \u5f9e\u96f2\u7aef\u8f09\u5165\u5df2\u958b\u767c\u7684\u7b56\u7565", "text": "<pre><code>from finlab.portfolio import create_report_from_cloud\n\n# \u5f9e FinLab \u5e73\u53f0\u8f09\u5165\u5df2\u4e0a\u50b3\u7684\u7b56\u7565\nreport1 = create_report_from_cloud('\u6211\u7684\u52d5\u80fd\u7b56\u7565')\nreport2 = create_report_from_cloud('\u6211\u7684\u50f9\u503c\u7b56\u7565')\nreport3 = create_report_from_cloud('\u6211\u7684\u71df\u6536\u6210\u9577\u7b56\u7565')\n\nprint(\"\u5f9e\u96f2\u7aef\u8f09\u5165 3 \u500b\u7b56\u7565\u5b8c\u6210!\")\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#2-portfolio", "title": "\u968e\u6bb5 2: \u4f7f\u7528 Portfolio \u6a21\u7d44\u7d44\u5408\u7b56\u7565", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#21", "title": "2.1 \u57fa\u790e\u7d44\u5408:\u7b49\u6b0a\u91cd", "text": "<pre><code>from finlab.portfolio import Portfolio\n\n# \u5efa\u7acb\u7b49\u6b0a\u91cd\u7d44\u5408(\u5404\u4f54 1/3)\nport_equal = Portfolio({\n    '\u52d5\u80fd\u7b56\u7565': (report1, 1/3),\n    '\u50f9\u503c\u7b56\u7565': (report2, 1/3),\n    '\u71df\u6536\u6210\u9577\u7b56\u7565': (report3, 1/3)\n})\n\n# \u986f\u793a\u7d44\u5408\u7e3e\u6548\nport_equal.display()\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#22", "title": "2.2 \u9032\u968e\u7d44\u5408:\u6839\u64da\u590f\u666e\u7387\u5206\u914d\u6b0a\u91cd", "text": "<pre><code># \u53d6\u5f97\u5404\u7b56\u7565\u590f\u666e\u7387\nsharpe1 = report1.get_stats()['daily_sharpe']\nsharpe2 = report2.get_stats()['daily_sharpe']\nsharpe3 = report3.get_stats()['daily_sharpe']\n\n# \u8a08\u7b97\u6b0a\u91cd(\u590f\u666e\u7387\u8d8a\u9ad8\u6b0a\u91cd\u8d8a\u5927)\ntotal_sharpe = sharpe1 + sharpe2 + sharpe3\nw1 = sharpe1 / total_sharpe\nw2 = sharpe2 / total_sharpe\nw3 = sharpe3 / total_sharpe\n\nprint(f\"\u52d5\u80fd\u7b56\u7565\u6b0a\u91cd: {w1*100:.1f}%\")\nprint(f\"\u50f9\u503c\u7b56\u7565\u6b0a\u91cd: {w2*100:.1f}%\")\nprint(f\"\u71df\u6536\u6210\u9577\u7b56\u7565\u6b0a\u91cd: {w3*100:.1f}%\")\n\n# \u5efa\u7acb\u590f\u666e\u7387\u52a0\u6b0a\u7d44\u5408\nport_sharpe = Portfolio({\n    '\u52d5\u80fd\u7b56\u7565': (report1, w1),\n    '\u50f9\u503c\u7b56\u7565': (report2, w2),\n    '\u71df\u6536\u6210\u9577\u7b56\u7565': (report3, w3)\n})\n\nport_sharpe.display()\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#23", "title": "2.3 \u7d44\u5408\u7e3e\u6548\u8a55\u4f30", "text": "<pre><code># \u53d6\u5f97\u7d44\u5408\u7e3e\u6548\nstats_equal = port_equal.report.get_stats()\nstats_sharpe = port_sharpe.report.get_stats()\n\n# \u8207\u55ae\u4e00\u7b56\u7565\u6bd4\u8f03\nimport pandas as pd\n\ncomparison = pd.DataFrame({\n    '\u52d5\u80fd\u7b56\u7565': [\n        report1.get_stats()['daily_mean'],\n        report1.get_stats()['daily_sharpe'],\n        report1.get_stats()['max_drawdown']\n    ],\n    '\u50f9\u503c\u7b56\u7565': [\n        report2.get_stats()['daily_mean'],\n        report2.get_stats()['daily_sharpe'],\n        report2.get_stats()['max_drawdown']\n    ],\n    '\u71df\u6536\u6210\u9577\u7b56\u7565': [\n        report3.get_stats()['daily_mean'],\n        report3.get_stats()['daily_sharpe'],\n        report3.get_stats()['max_drawdown']\n    ],\n    '\u7b49\u6b0a\u7d44\u5408': [\n        stats_equal['daily_mean'],\n        stats_equal['daily_sharpe'],\n        stats_equal['max_drawdown']\n    ],\n    '\u590f\u666e\u52a0\u6b0a\u7d44\u5408': [\n        stats_sharpe['daily_mean'],\n        stats_sharpe['daily_sharpe'],\n        stats_sharpe['max_drawdown']\n    ]\n}, index=['\u5e74\u5316\u5831\u916c\u7387', '\u590f\u666e\u7387', '\u6700\u5927\u56de\u64a4'])\n\nprint(comparison)\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n#            \u52d5\u80fd\u7b56\u7565   \u50f9\u503c\u7b56\u7565  \u71df\u6536\u6210\u9577\u7b56\u7565  \u7b49\u6b0a\u7d44\u5408  \u590f\u666e\u52a0\u6b0a\u7d44\u5408\n# \u5e74\u5316\u5831\u916c\u7387   0.185    0.142      0.168    0.165      0.172\n# \u590f\u666e\u7387       1.23     0.98       1.15     1.35       1.42\n# \u6700\u5927\u56de\u64a4    -0.312   -0.285     -0.298   -0.245     -0.238\n</code></pre> <p>\u7d44\u5408\u512a\u52e2</p> <p>\u89c0\u5bdf\u5230\u7d44\u5408\u7684\u590f\u666e\u7387(1.35, 1.42)\u9ad8\u65bc\u6240\u6709\u55ae\u4e00\u7b56\u7565,\u4e14\u6700\u5927\u56de\u64a4(-0.245, -0.238)\u4e5f\u8f03\u5c0f,\u8b49\u5be6\u4e86\u5206\u6563\u6548\u679c!</p>"}, {"location": "workflows/multi_strategy_portfolio/#3", "title": "\u968e\u6bb5 3: \u56de\u6e2c\u591a\u7b56\u7565\u7d44\u5408", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#31", "title": "3.1 \u6df1\u5ea6\u5206\u6790\u7d44\u5408", "text": "<pre><code># \u53d6\u5f97\u7d44\u5408\u7684\u56de\u6e2c\u5831\u544a\ncombined_report = port_sharpe.report\n\n# \u6d41\u52d5\u6027\u5206\u6790\ncombined_report.run_analysis('LiquidityAnalysis', required_volume=100000)\n\n# MAE/MFE \u5206\u6790\ncombined_report.display_mae_mfe_analysis()\n\n# \u6642\u671f\u7a69\u5b9a\u6027\ncombined_report.run_analysis('PeriodStatsAnalysis')\n\n# Alpha/Beta\ncombined_report.run_analysis('AlphaBetaAnalysis')\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#32", "title": "3.2 \u6aa2\u67e5\u7d44\u5408\u6301\u80a1\u5206\u6563\u5ea6", "text": "<pre><code># \u53d6\u5f97\u7d44\u5408\u7684\u6301\u5009\nposition_combined = combined_report.position\n\n# \u8a08\u7b97\u5e73\u5747\u6301\u80a1\u6578\navg_holdings = (position_combined &gt; 0).sum(axis=1).mean()\nprint(f\"\u5e73\u5747\u6301\u80a1\u6578: {avg_holdings:.1f}\")\n\n# \u8a08\u7b97\u6700\u5927\u55ae\u4e00\u6301\u80a1\u6b0a\u91cd\nmax_weight = position_combined.max(axis=1).mean()\nprint(f\"\u5e73\u5747\u6700\u5927\u55ae\u4e00\u6301\u80a1\u6b0a\u91cd: {max_weight*100:.1f}%\")\n\n# \u6aa2\u67e5\u4e09\u500b\u7b56\u7565\u7684\u91cd\u758a\u5ea6\npos1 = report1.position.iloc[-1]\npos2 = report2.position.iloc[-1]\npos3 = report3.position.iloc[-1]\n\noverlap_12 = len(set(pos1[pos1&gt;0].index) &amp; set(pos2[pos2&gt;0].index))\noverlap_13 = len(set(pos1[pos1&gt;0].index) &amp; set(pos3[pos3&gt;0].index))\noverlap_23 = len(set(pos2[pos2&gt;0].index) &amp; set(pos3[pos3&gt;0].index))\n\nprint(f\"\u52d5\u80fd &amp; \u50f9\u503c \u91cd\u758a\u80a1\u6578: {overlap_12}\")\nprint(f\"\u52d5\u80fd &amp; \u71df\u6536\u6210\u9577 \u91cd\u758a\u80a1\u6578: {overlap_13}\")\nprint(f\"\u50f9\u503c &amp; \u71df\u6536\u6210\u9577 \u91cd\u758a\u80a1\u6578: {overlap_23}\")\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#4", "title": "\u968e\u6bb5 4: \u52d5\u614b\u8abf\u6574\u6b0a\u91cd", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#41", "title": "4.1 \u6efe\u52d5\u8996\u7a97\u91cd\u65b0\u8a08\u7b97\u6b0a\u91cd", "text": "<pre><code>def optimize_weights(reports, lookback_days=252):\n    \"\"\"\n    \u6839\u64da\u904e\u53bb\u4e00\u5e74\u7684\u8868\u73fe,\u52d5\u614b\u8abf\u6574\u6b0a\u91cd\n\n    Args:\n        reports: list of Report \u7269\u4ef6\n        lookback_days: \u56de\u671b\u5929\u6578(\u9810\u8a2d 252 \u4ea4\u6613\u65e5 \u2248 1 \u5e74)\n\n    Returns:\n        dict: \u6700\u512a\u6b0a\u91cd\n    \"\"\"\n    import numpy as np\n    from scipy.optimize import minimize\n\n    # \u53d6\u5f97\u904e\u53bb\u4e00\u5e74\u7684\u65e5\u5831\u916c\u7387\n    returns = []\n    for report in reports:\n        daily_return = report.daily_creturn.pct_change().iloc[-lookback_days:]\n        returns.append(daily_return)\n\n    returns_df = pd.concat(returns, axis=1).dropna()\n\n    # \u8a08\u7b97\u5354\u65b9\u5dee\u77e9\u9663\n    cov_matrix = returns_df.cov()\n\n    # \u6700\u5c0f\u5316\u8b8a\u7570\u6578(\u98a8\u96aa\u5e73\u50f9)\n    def portfolio_variance(weights):\n        return np.dot(weights, np.dot(cov_matrix, weights))\n\n    # \u7d04\u675f:\u6b0a\u91cd\u7e3d\u548c = 1,\u6bcf\u500b\u6b0a\u91cd &gt;= 0\n    constraints = {'type': 'eq', 'fun': lambda w: np.sum(w) - 1}\n    bounds = tuple((0, 1) for _ in range(len(reports)))\n\n    # \u521d\u59cb\u6b0a\u91cd\n    init_weights = np.array([1/len(reports)] * len(reports))\n\n    # \u512a\u5316\n    result = minimize(\n        portfolio_variance,\n        init_weights,\n        method='SLSQP',\n        bounds=bounds,\n        constraints=constraints\n    )\n\n    return result.x\n\n# \u8a08\u7b97\u6700\u512a\u6b0a\u91cd\noptimal_weights = optimize_weights([report1, report2, report3])\n\nprint(\"\u6700\u512a\u6b0a\u91cd:\")\nfor i, w in enumerate(optimal_weights, 1):\n    print(f\"  \u7b56\u7565 {i}: {w*100:.1f}%\")\n\n# \u5efa\u7acb\u6700\u512a\u6b0a\u91cd\u7d44\u5408\nport_optimal = Portfolio({\n    '\u52d5\u80fd\u7b56\u7565': (report1, optimal_weights[0]),\n    '\u50f9\u503c\u7b56\u7565': (report2, optimal_weights[1]),\n    '\u71df\u6536\u6210\u9577\u7b56\u7565': (report3, optimal_weights[2])\n})\n\nport_optimal.display()\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#42", "title": "4.2 \u6839\u64da\u5e02\u5834\u74b0\u5883\u52d5\u614b\u5207\u63db", "text": "<pre><code>def adaptive_weights(reports, market_condition='bull'):\n    \"\"\"\n    \u6839\u64da\u5e02\u5834\u74b0\u5883\u8abf\u6574\u6b0a\u91cd\n\n    Args:\n        reports: list of (name, Report) tuples\n        market_condition: 'bull', 'bear', \u6216 'sideways'\n\n    Returns:\n        dict: \u8abf\u6574\u5f8c\u6b0a\u91cd\n    \"\"\"\n    if market_condition == 'bull':\n        # \u591a\u982d:\u589e\u52a0\u52d5\u80fd\u7b56\u7565\u6b0a\u91cd\n        return [0.5, 0.25, 0.25]\n    elif market_condition == 'bear':\n        # \u7a7a\u982d:\u589e\u52a0\u50f9\u503c\u7b56\u7565\u6b0a\u91cd\n        return [0.2, 0.5, 0.3]\n    else:  # sideways\n        # \u76e4\u6574:\u5747\u8861\u914d\u7f6e\n        return [0.33, 0.33, 0.34]\n\n# \u5224\u65b7\u5e02\u5834\u74b0\u5883(\u7c21\u5316\u7bc4\u4f8b)\nfrom finlab import data\n\ntaiex = data.get('benchmark_return:\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578').squeeze()\ntaiex_ma50 = taiex.rolling(50).mean()\ntaiex_ma200 = taiex.rolling(200).mean()\n\nif taiex.iloc[-1] &gt; taiex_ma50.iloc[-1] &gt; taiex_ma200.iloc[-1]:\n    market = 'bull'\n    print(\"\u5e02\u5834\u74b0\u5883:\u591a\u982d\")\nelif taiex.iloc[-1] &lt; taiex_ma50.iloc[-1] &lt; taiex_ma200.iloc[-1]:\n    market = 'bear'\n    print(\"\u5e02\u5834\u74b0\u5883:\u7a7a\u982d\")\nelse:\n    market = 'sideways'\n    print(\"\u5e02\u5834\u74b0\u5883:\u76e4\u6574\")\n\n# \u6839\u64da\u5e02\u5834\u74b0\u5883\u8abf\u6574\u6b0a\u91cd\nadaptive_w = adaptive_weights([report1, report2, report3], market)\n\nport_adaptive = Portfolio({\n    '\u52d5\u80fd\u7b56\u7565': (report1, adaptive_w[0]),\n    '\u50f9\u503c\u7b56\u7565': (report2, adaptive_w[1]),\n    '\u71df\u6536\u6210\u9577\u7b56\u7565': (report3, adaptive_w[2])\n})\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#5", "title": "\u968e\u6bb5 5: \u5be6\u76e4\u57f7\u884c", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#51-portfoliosyncmanager", "title": "5.1 \u4f7f\u7528 PortfolioSyncManager", "text": "<pre><code>from finlab.portfolio import PortfolioSyncManager\n\n# \u7b2c\u4e00\u6b21\u5efa\u7acb\npm = PortfolioSyncManager()\n\n# \u6216\u5f9e\u96f2\u7aef/\u672c\u5730\u8f09\u5165\u5df2\u6709\u7684\u90e8\u4f4d\n# pm = PortfolioSyncManager.from_cloud()\n# pm = PortfolioSyncManager.from_local()\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#52", "title": "5.2 \u66f4\u65b0\u6301\u80a1\u90e8\u4f4d", "text": "<pre><code># \u8a2d\u5b9a\u7e3d\u8cc7\u91d1\ntotal_balance = 5000000  # 500 \u842c\n\n# \u66f4\u65b0\u6301\u80a1(\u53ea\u5728\u63db\u80a1\u65e5\u624d\u6703\u63db\u80a1)\npm.update(port_sharpe, total_balance=total_balance)\n\n# \u986f\u793a\u7576\u524d\u6301\u80a1\nprint(pm)\n\n# \u8f38\u51fa\u7bc4\u4f8b:\n# Estimate value: 5,123,450\n#\n#          quantity  price   weight  close_price  volume  strategy         type\n# stock_id\n# 2330         50.0  520.0   0.052       520.0     1250   \u7b56\u75651,\u7b56\u75653    STOCK\n# 2317        100.0   85.0   0.017        85.0      850   \u7b56\u75652          STOCK\n# 2454         80.0  120.0   0.019       120.0      960   \u7b56\u75651          STOCK\n# ...\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#53", "title": "5.3 \u555f\u7528\u96f6\u80a1\u6216\u878d\u8cc7\u4ea4\u6613", "text": "<pre><code># \u96f6\u80a1\u4ea4\u6613(\u53ef\u8cb7\u8ce3\u96f6\u80a1)\npm.update(port_sharpe, total_balance=total_balance, odd_lot=True)\n\n# \u878d\u8cc7\u4ea4\u6613(\u53ef\u4f7f\u7528\u878d\u8cc7\u878d\u5238)\npm.update(port_sharpe, total_balance=total_balance, margin_trading=True)\n\n# \u7d44\u5408\u4f7f\u7528\npm.update(\n    port_sharpe,\n    total_balance=total_balance,\n    odd_lot=True,\n    margin_trading=True\n)\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#54", "title": "5.4 \u5be6\u76e4\u4e0b\u55ae", "text": "<pre><code>from finlab.online.sinopac_account import SinopacAccount\nfrom finlab.online.order_executor import OrderExecutor\n\n# \u8a2d\u5b9a\u5238\u5546\u5e33\u6236\naccount = SinopacAccount(simulation=False)\n\n# \u5efa\u7acb\u4e0b\u55ae\u57f7\u884c\u5668\nexecutor = OrderExecutor(\n    positions=pm.generate_positions_amount(),  # \u5f9e PortfolioSyncManager \u53d6\u5f97\u90e8\u4f4d\n    account=account,\n    market_order=False,      # \u4f7f\u7528\u9650\u50f9\u55ae\n    price_discount=0.01,     # \u9650\u50f9\u55ae\u6298\u50f9 1%\n)\n\n# \u57f7\u884c\u4e0b\u55ae\nexecutor.create_orders()\n\n# \u8f38\u51fa:\n# 2024-12-20 09:05:23 [INFO] \u958b\u59cb\u57f7\u884c\u63db\u80a1\n# 2024-12-20 09:05:25 [INFO] \u8ce3\u51fa 2303 100 \u80a1 @ 10.5\n# 2024-12-20 09:05:27 [INFO] \u8cb7\u5165 2330 50 \u80a1 @ 519.5\n# ...\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#55", "title": "5.5 \u5b9a\u671f\u57f7\u884c\u8173\u672c", "text": "<pre><code># \u5efa\u7acb\u6bcf\u65e5\u57f7\u884c\u8173\u672c\ndef daily_portfolio_sync():\n    \"\"\"\n    \u6bcf\u65e5\u57f7\u884c:\n    1. \u6aa2\u67e5\u662f\u5426\u70ba\u63db\u80a1\u65e5\n    2. \u6aa2\u67e5\u505c\u640d\u505c\u5229\n    3. \u66f4\u65b0\u6301\u80a1\n    \"\"\"\n    from finlab.portfolio import PortfolioSyncManager, create_report_from_cloud\n\n    # \u8f09\u5165\u7b56\u7565\n    report1 = create_report_from_cloud('\u52d5\u80fd\u7b56\u7565')\n    report2 = create_report_from_cloud('\u50f9\u503c\u7b56\u7565')\n    report3 = create_report_from_cloud('\u71df\u6536\u6210\u9577\u7b56\u7565')\n\n    # \u5efa\u7acb\u7d44\u5408\n    port = Portfolio({\n        '\u52d5\u80fd\u7b56\u7565': (report1, 0.4),\n        '\u50f9\u503c\u7b56\u7565': (report2, 0.3),\n        '\u71df\u6536\u6210\u9577\u7b56\u7565': (report3, 0.3)\n    })\n\n    # \u8f09\u5165\u73fe\u6709\u90e8\u4f4d\n    pm = PortfolioSyncManager.from_cloud()\n\n    # \u66f4\u65b0(\u53ea\u5728\u63db\u80a1\u65e5\u6703\u5be6\u969b\u63db\u80a1)\n    pm.update(port, total_balance=5000000)\n\n    # \u540c\u6b65\u81f3\u96f2\u7aef\n    pm.sync_to_cloud()\n\n    # \u5982\u9700\u4e0b\u55ae,\u555f\u7528\u4ee5\u4e0b\u7a0b\u5f0f\u78bc:\n    # account = SinopacAccount(simulation=False)\n    # executor = OrderExecutor(\n    #     positions=pm.generate_positions_amount(),\n    #     account=account\n    # )\n    # executor.create_orders()\n\n    print(\"\u6bcf\u65e5\u540c\u6b65\u5b8c\u6210!\")\n\n# \u4f7f\u7528 cron \u6216\u6392\u7a0b\u5de5\u5177\u5b9a\u671f\u57f7\u884c\n# \u4f8b\u5982:\u6bcf\u5929\u65e9\u4e0a 8:30 \u57f7\u884c\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#6", "title": "\u968e\u6bb5 6: \u7e3e\u6548\u8ffd\u8e64\u8207\u8abf\u6574", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#61", "title": "6.1 \u76e3\u63a7\u5be6\u76e4\u8207\u56de\u6e2c\u7684\u5dee\u7570", "text": "<pre><code># \u53d6\u5f97\u5be6\u76e4\u90e8\u4f4d\ncurrent_positions = pm.get_positions()\n\n# \u53d6\u5f97\u61c9\u6709\u90e8\u4f4d(\u56de\u6e2c\u5efa\u8b70)\ntarget_positions = pm.generate_positions_amount()\n\n# \u6bd4\u8f03\u5dee\u7570\ndiff = {}\nfor stock_id in set(current_positions.keys()) | set(target_positions.keys()):\n    current = current_positions.get(stock_id, 0)\n    target = target_positions.get(stock_id, 0)\n    if abs(current - target) &gt; 0.01:  # \u5dee\u7570 &gt; 1%\n        diff[stock_id] = {\n            'current': current,\n            'target': target,\n            'diff': current - target\n        }\n\nif diff:\n    print(\"\u90e8\u4f4d\u5dee\u7570:\")\n    for stock_id, info in diff.items():\n        print(f\"  {stock_id}: \u5be6\u76e4 {info['current']:.2%}, \u76ee\u6a19 {info['target']:.2%}, \u5dee\u7570 {info['diff']:.2%}\")\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#62", "title": "6.2 \u5b9a\u671f\u91cd\u65b0\u8a55\u4f30\u7b56\u7565\u6b0a\u91cd", "text": "<pre><code># \u6bcf\u5b63\u91cd\u65b0\u8a55\u4f30\ndef quarterly_rebalance():\n    \"\"\"\n    \u6bcf\u5b63\u57f7\u884c:\n    1. \u91cd\u65b0\u8a55\u4f30\u5404\u7b56\u7565\u8868\u73fe\n    2. \u8abf\u6574\u6b0a\u91cd\n    3. \u79fb\u9664\u8868\u73fe\u5dee\u7684\u7b56\u7565\n    4. \u65b0\u589e\u8868\u73fe\u597d\u7684\u7b56\u7565\n    \"\"\"\n    # \u53d6\u5f97\u6700\u65b0 3 \u500b\u6708\u7e3e\u6548\n    sharpe1 = report1.get_stats()['daily_sharpe']\n    sharpe2 = report2.get_stats()['daily_sharpe']\n    sharpe3 = report3.get_stats()['daily_sharpe']\n\n    print(f\"\u52d5\u80fd\u7b56\u7565 3M \u590f\u666e\u7387: {sharpe1:.2f}\")\n    print(f\"\u50f9\u503c\u7b56\u7565 3M \u590f\u666e\u7387: {sharpe2:.2f}\")\n    print(f\"\u71df\u6536\u6210\u9577\u7b56\u7565 3M \u590f\u666e\u7387: {sharpe3:.2f}\")\n\n    # \u79fb\u9664\u590f\u666e\u7387 &lt; 0.5 \u7684\u7b56\u7565\n    active_strategies = {}\n    if sharpe1 &gt;= 0.5:\n        active_strategies['\u52d5\u80fd\u7b56\u7565'] = (report1, sharpe1)\n    if sharpe2 &gt;= 0.5:\n        active_strategies['\u50f9\u503c\u7b56\u7565'] = (report2, sharpe2)\n    if sharpe3 &gt;= 0.5:\n        active_strategies['\u71df\u6536\u6210\u9577\u7b56\u7565'] = (report3, sharpe3)\n\n    # \u91cd\u65b0\u5206\u914d\u6b0a\u91cd\n    total_sharpe = sum(s for _, s in active_strategies.values())\n    new_port = Portfolio({\n        name: (report, sharpe/total_sharpe)\n        for name, (report, sharpe) in active_strategies.items()\n    })\n\n    print(f\"\\n\u4fdd\u7559 {len(active_strategies)} \u500b\u7b56\u7565,\u91cd\u65b0\u8abf\u6574\u6b0a\u91cd\")\n    return new_port\n\n# \u6bcf\u5b63\u57f7\u884c\nnew_port = quarterly_rebalance()\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#_4", "title": "\u5b8c\u6574\u7a0b\u5f0f\u78bc\u5f59\u6574", "text": "<pre><code># =============================================================================\n# \u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406\u5b8c\u6574\u7bc4\u4f8b\n# =============================================================================\n\nfrom finlab import data\nfrom finlab.backtest import sim\nfrom finlab.portfolio import Portfolio, PortfolioSyncManager\n\n# 1. \u5efa\u7acb\u7b56\u7565\u6c60\nclose = data.get('price:\u6536\u76e4\u50f9')\nvolume = data.get('price:\u6210\u4ea4\u80a1\u6578')\npb = data.get('price_earning_ratio:\u80a1\u50f9\u6de8\u503c\u6bd4')\nroe = data.get('fundamental_features:\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387')\nrev = data.get('monthly_revenue:\u7576\u6708\u71df\u6536')\n\n# \u7b56\u7565 1: \u52d5\u80fd\nposition1 = ((close == close.rolling(20).max()) &amp;\n             (volume &gt; volume.average(20) * 1.5)).hold_until(\n    exit=close &lt; close.average(10),\n    stop_loss=0.08\n)\nreport1 = sim(position1, resample='W', name=\"\u52d5\u80fd\u7b56\u7565\", upload=False)\n\n# \u7b56\u7565 2: \u50f9\u503c\nposition2 = ((pb &lt; pb.quantile(0.3, axis=1)) &amp;\n             (roe &gt; 0.1)).hold_until(\n    exit=pb &gt; pb.quantile(0.7, axis=1)\n)\nreport2 = sim(position2, resample='M', name=\"\u50f9\u503c\u7b56\u7565\", upload=False)\n\n# \u7b56\u7565 3: \u71df\u6536\u6210\u9577\nrev_momentum = rev.average(3) / rev.average(12)\nposition3 = ((rev_momentum &gt; 1.15) &amp;\n             (close &gt; close.average(60))).hold_until(\n    exit=rev_momentum &lt; 1.0,\n    stop_loss=0.1\n)\nreport3 = sim(position3, resample='M', name=\"\u71df\u6536\u6210\u9577\u7b56\u7565\", upload=False)\n\n# 2. \u5efa\u7acb\u7d44\u5408\nport = Portfolio({\n    '\u52d5\u80fd\u7b56\u7565': (report1, 0.4),\n    '\u50f9\u503c\u7b56\u7565': (report2, 0.3),\n    '\u71df\u6536\u6210\u9577\u7b56\u7565': (report3, 0.3)\n})\n\n# 3. \u8a55\u4f30\u7d44\u5408\u7e3e\u6548\nport.display()\nprint(port.report.get_stats())\n\n# 4. \u5be6\u76e4\u57f7\u884c\npm = PortfolioSyncManager()\npm.update(port, total_balance=5000000)\nprint(pm)\n\n# 5. \u540c\u6b65\u81f3\u96f2\u7aef\npm.sync_to_cloud()\n\nprint(\"\u591a\u7b56\u7565\u7d44\u5408\u5efa\u7acb\u5b8c\u6210!\")\n</code></pre>"}, {"location": "workflows/multi_strategy_portfolio/#_5", "title": "\u95dc\u9375\u8981\u9ede\u7e3d\u7d50", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#_6", "title": "\u7b56\u7565\u6c60\u5efa\u7acb\u968e\u6bb5", "text": "<ul> <li>\u2705 \u9078\u64c7\u98a8\u683c\u4e0d\u540c\u7684\u7b56\u7565(\u6280\u8853\u9762\u3001\u57fa\u672c\u9762\u3001\u7c4c\u78bc\u9762)</li> <li>\u2705 \u7b56\u7565\u9593\u76f8\u95dc\u6027\u4f4e,\u5206\u6563\u6548\u679c\u597d</li> <li>\u2705 \u6bcf\u500b\u7b56\u7565\u90fd\u8981\u7d93\u904e\u5b8c\u6574\u56de\u6e2c\u9a57\u8b49</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_7", "title": "\u7d44\u5408\u6b0a\u91cd\u968e\u6bb5", "text": "<ul> <li>\u2705 \u7b49\u6b0a\u91cd\u662f\u6700\u7c21\u55ae\u7684\u8d77\u9ede</li> <li>\u2705 \u6839\u64da\u590f\u666e\u7387\u52a0\u6b0a\u53ef\u63d0\u5347\u6574\u9ad4\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c</li> <li>\u2705 \u5b9a\u671f(\u6bcf\u5b63)\u91cd\u65b0\u8a55\u4f30\u6b0a\u91cd</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_8", "title": "\u56de\u6e2c\u9a57\u8b49\u968e\u6bb5", "text": "<ul> <li>\u2705 \u7d44\u5408\u7684\u590f\u666e\u7387\u61c9\u9ad8\u65bc\u55ae\u4e00\u7b56\u7565</li> <li>\u2705 \u7d44\u5408\u7684\u6700\u5927\u56de\u64a4\u61c9\u5c0f\u65bc\u55ae\u4e00\u7b56\u7565</li> <li>\u2705 \u6aa2\u67e5\u6301\u80a1\u5206\u6563\u5ea6\u8207\u7b56\u7565\u91cd\u758a\u5ea6</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_9", "title": "\u5be6\u76e4\u57f7\u884c\u968e\u6bb5", "text": "<ul> <li>\u2705 \u4f7f\u7528 PortfolioSyncManager \u81ea\u52d5\u7ba1\u7406\u90e8\u4f4d</li> <li>\u2705 \u5b9a\u671f(\u6bcf\u65e5)\u540c\u6b65,\u78ba\u4fdd\u90e8\u4f4d\u4e00\u81f4</li> <li>\u2705 \u76e3\u63a7\u5be6\u76e4\u8207\u56de\u6e2c\u7684\u504f\u5dee</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_10", "title": "\u6301\u7e8c\u512a\u5316\u968e\u6bb5", "text": "<ul> <li>\u2705 \u6bcf\u5b63\u91cd\u65b0\u8a55\u4f30\u7b56\u7565\u8868\u73fe</li> <li>\u2705 \u79fb\u9664\u590f\u666e\u7387 &lt; 0.5 \u7684\u7b56\u7565</li> <li>\u2705 \u6839\u64da\u5e02\u5834\u74b0\u5883\u52d5\u614b\u8abf\u6574\u6b0a\u91cd</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_11", "title": "\u5e38\u898b\u554f\u984c", "text": ""}, {"location": "workflows/multi_strategy_portfolio/#q1", "title": "Q1: \u7d44\u5408\u591a\u5c11\u500b\u7b56\u7565\u6700\u597d?", "text": "<p>\u5efa\u8b70 3-5 \u500b\u3002\u592a\u5c11\u7121\u6cd5\u6709\u6548\u5206\u6563,\u592a\u591a\u6703\u7a00\u91cb\u6536\u76ca\u4e14\u7ba1\u7406\u8907\u96dc\u3002</p>"}, {"location": "workflows/multi_strategy_portfolio/#q2", "title": "Q2: \u5982\u4f55\u5224\u65b7\u7b56\u7565\u662f\u5426\u61c9\u8a72\u79fb\u9664?", "text": "<p>\u89c0\u5bdf 3-6 \u500b\u6708\u7684\u6efe\u52d5\u590f\u666e\u7387,\u82e5\u6301\u7e8c &lt; 0.5 \u8003\u616e\u79fb\u9664\u3002</p>"}, {"location": "workflows/multi_strategy_portfolio/#q3", "title": "Q3: \u53ef\u4ee5\u52d5\u614b\u589e\u6e1b\u7b56\u7565\u55ce?", "text": "<p>\u53ef\u4ee5!\u4f7f\u7528 <code>quarterly_rebalance()</code> \u5b9a\u671f\u8a55\u4f30,\u65b0\u589e\u8868\u73fe\u597d\u7684\u7b56\u7565,\u79fb\u9664\u8868\u73fe\u5dee\u7684\u3002</p>"}, {"location": "workflows/multi_strategy_portfolio/#q4-portfoliosyncmanager", "title": "Q4: PortfolioSyncManager \u5982\u4f55\u8655\u7406\u885d\u7a81?", "text": "<p>\u7576\u591a\u500b\u7b56\u7565\u540c\u6642\u6301\u6709\u540c\u4e00\u6a94\u80a1\u7968\u6642,\u6703\u81ea\u52d5\u52a0\u7e3d\u6b0a\u91cd\u3002\u4f8b\u5982\u7b56\u7565 A \u6301\u6709 2330 5%,\u7b56\u7565 B \u6301\u6709 2330 3%,\u6700\u7d42\u7d44\u5408\u6301\u6709 8%\u3002</p>"}, {"location": "workflows/multi_strategy_portfolio/#q5", "title": "Q5: \u5982\u4f55\u907f\u514d\u904e\u5ea6\u4ea4\u6613?", "text": "<ul> <li>\u4f7f\u7528\u8f03\u9577\u7684 resample \u9031\u671f(M \u6216 Q)</li> <li>\u8a2d\u5b9a\u6700\u5c0f\u63db\u80a1\u5e45\u5ea6(\u4f8b\u5982\u6b0a\u91cd\u8b8a\u5316 &lt; 2% \u4e0d\u8abf\u6574)</li> <li>\u512a\u5148\u9078\u64c7\u63db\u80a1\u983b\u7387\u8f03\u4f4e\u7684\u7b56\u7565</li> </ul>"}, {"location": "workflows/multi_strategy_portfolio/#_12", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u4e0b\u55ae(\u591a\u7b56\u7565)\u6559\u5b78</li> <li>finlab.portfolio API Reference</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>\u6a5f\u5668\u5b78\u7fd2\u7b56\u7565\u6d41\u7a0b</li> <li>\u5be6\u76e4\u4ea4\u6613\u6559\u5b78</li> </ul>"}, {"location": "workflows/risk_management/", "title": "\u98a8\u96aa\u7ba1\u7406\u5b8c\u6574\u6307\u5357", "text": "<p>\u672c\u6587\u4ecb\u7d39\u91cf\u5316\u4ea4\u6613\u4e2d\u7684\u98a8\u96aa\u7ba1\u7406\u7b56\u7565,\u5305\u62ec\u90e8\u4f4d\u63a7\u5236\u3001\u505c\u640d\u505c\u5229\u3001\u8cc7\u91d1\u7ba1\u7406\u8207\u56de\u64a4\u63a7\u5236\u3002</p>"}, {"location": "workflows/risk_management/#_2", "title": "\u98a8\u96aa\u7ba1\u7406\u7684\u91cd\u8981\u6027", "text": "<p>\u5728\u91cf\u5316\u4ea4\u6613\u4e2d,\u4e0d\u8667\u9322\u6bd4\u8cfa\u9322\u66f4\u91cd\u8981\u3002\u826f\u597d\u7684\u98a8\u96aa\u7ba1\u7406\u53ef\u4ee5: - \u907f\u514d\u55ae\u6b21\u5de8\u5927\u8667\u640d - \u964d\u4f4e\u6574\u9ad4\u6295\u8cc7\u7d44\u5408\u6ce2\u52d5 - \u63d0\u5347\u9577\u671f\u7a69\u5b9a\u5831\u916c</p>"}, {"location": "workflows/risk_management/#1-position-sizing", "title": "1. \u90e8\u4f4d\u63a7\u5236 (Position Sizing)", "text": ""}, {"location": "workflows/risk_management/#11", "title": "1.1 \u8a2d\u5b9a\u55ae\u4e00\u6301\u80a1\u4e0a\u9650", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\nclose = data.get('price:\u6536\u76e4\u50f9')\nposition = close &gt; close.average(20)\n\n# \u55ae\u4e00\u6301\u80a1\u4e0a\u9650 10%\nreport = sim(\n    position,\n    resample='M',\n    position_limit=0.1  # \u55ae\u4e00\u6301\u80a1\u6700\u591a\u4f54\u7e3d\u8cc7\u91d1 10%\n)\n</code></pre>"}, {"location": "workflows/risk_management/#12", "title": "1.2 \u8a2d\u5b9a\u6700\u5927\u6301\u80a1\u6578", "text": "<pre><code># \u65b9\u6cd5 1: \u4f7f\u7528 is_largest \u9650\u5236\u6301\u80a1\u6578\ntop_n_position = (close &gt; close.average(20)).is_largest(30)\n\n# \u65b9\u6cd5 2: \u5728\u56de\u6e2c\u6642\u9650\u5236\nreport = sim(\n    position,\n    resample='M',\n    position_limit=0.1,\n    # \u6700\u591a\u6301\u6709 30 \u6a94 (\u6bcf\u6a94 10%,\u6700\u591a 30 \u6a94 = 300% \u69d3\u687f)\n)\n</code></pre>"}, {"location": "workflows/risk_management/#13", "title": "1.3 \u6839\u64da\u6ce2\u52d5\u5ea6\u8abf\u6574\u90e8\u4f4d", "text": "<pre><code># \u8a08\u7b97\u6ce2\u52d5\u5ea6\nreturns = close.pct_change()\nvolatility = returns.rolling(60).std()\n\n# \u6ce2\u52d5\u5ea6\u8d8a\u9ad8,\u6301\u5009\u8d8a\u5c0f\ninverse_vol_weight = 1 / volatility\nnormalized_weight = inverse_vol_weight / inverse_vol_weight.sum(axis=1)\n\n# \u8207\u9078\u80a1\u8a0a\u865f\u7d50\u5408\nposition_with_vol = (close &gt; close.average(20)) * normalized_weight\n</code></pre>"}, {"location": "workflows/risk_management/#2", "title": "2. \u505c\u640d\u505c\u5229\u8a2d\u5b9a", "text": ""}, {"location": "workflows/risk_management/#21", "title": "2.1 \u56fa\u5b9a\u767e\u5206\u6bd4\u505c\u640d\u505c\u5229", "text": "<pre><code># \u505c\u640d 10%,\u505c\u5229 20%\nposition = entry_signal.hold_until(\n    exit=exit_signal,\n    stop_loss=0.10,\n    take_profit=0.20\n)\n\nreport = sim(position, resample='M')\n</code></pre>"}, {"location": "workflows/risk_management/#22-maemfe", "title": "2.2 \u6839\u64da MAE/MFE \u512a\u5316\u505c\u640d\u505c\u5229", "text": "<pre><code># \u5148\u57f7\u884c\u521d\u6b65\u56de\u6e2c\nreport_initial = sim(position_without_stops, resample='M', upload=False)\n\n# \u67e5\u770b MAE/MFE\ntrades = report_initial.get_trades()\nmae_q75 = abs(trades['mae'].quantile(0.75))  # \u4f8b\u5982 8.5%\ngmfe_q75 = trades['gmfe'].quantile(0.75)     # \u4f8b\u5982 18.3%\n\nprint(f\"\u5efa\u8b70\u505c\u640d: {mae_q75*1.2*100:.1f}%\")  # MAE Q75 * 1.2 = 10.2%\nprint(f\"\u5efa\u8b70\u505c\u5229: {gmfe_q75*0.8*100:.1f}%\") # GMFE Q75 * 0.8 = 14.6%\n\n# \u4f7f\u7528\u512a\u5316\u5f8c\u7684\u505c\u640d\u505c\u5229\nposition_optimized = entry_signal.hold_until(\n    exit=exit_signal,\n    stop_loss=mae_q75 * 1.2,\n    take_profit=gmfe_q75 * 0.8\n)\n</code></pre>"}, {"location": "workflows/risk_management/#23-trailing-stop", "title": "2.3 \u79fb\u52d5\u505c\u5229 (Trailing Stop)", "text": "<p>\u79fb\u52d5\u505c\u5229\u9700\u900f\u904e <code>sim()</code> \u7684 <code>trail_stop</code> \u53c3\u6578\u8a2d\u5b9a\uff1a</p> <pre><code># \u56de\u6a94 8% \u5373\u51fa\u5834\nposition = entry_signal.hold_until(\n    exit=exit_signal,\n    stop_loss=0.10\n)\n\nreport = sim(position, resample='M', trail_stop=0.08)  # \u5f9e\u6700\u9ad8\u9ede\u56de\u6a94 8%\n</code></pre>"}, {"location": "workflows/risk_management/#24", "title": "2.4 \u6642\u9593\u505c\u640d", "text": "<pre><code>import pandas as pd\n\n# \u6301\u6709\u8d85\u904e 30 \u5929\u81ea\u52d5\u51fa\u5834\ndef add_time_stop(position, max_hold_days=30):\n    \"\"\"\u65b0\u589e\u6642\u9593\u505c\u640d\"\"\"\n    hold_days = (position &gt; 0).astype(int).groupby(level=1).cumsum()\n    time_exit = hold_days &gt; max_hold_days\n    return position &amp; (~time_exit)\n\nposition_with_time_stop = add_time_stop(position, max_hold_days=30)\n</code></pre>"}, {"location": "workflows/risk_management/#3", "title": "3. \u8cc7\u91d1\u7ba1\u7406", "text": ""}, {"location": "workflows/risk_management/#31-kelly-criterion", "title": "3.1 \u51f1\u5229\u516c\u5f0f (Kelly Criterion)", "text": "<pre><code>def kelly_criterion(win_rate, avg_win, avg_loss):\n    \"\"\"\n    \u8a08\u7b97\u51f1\u5229\u6bd4\u4f8b\n\n    Args:\n        win_rate: \u52dd\u7387 (0-1)\n        avg_win: \u5e73\u5747\u7372\u5229\u7387\n        avg_loss: \u5e73\u5747\u8667\u640d\u7387 (\u6b63\u503c)\n\n    Returns:\n        float: \u5efa\u8b70\u6295\u5165\u6bd4\u4f8b\n    \"\"\"\n    if avg_loss == 0:\n        return 0\n\n    kelly = (win_rate * avg_win - (1 - win_rate) * avg_loss) / avg_win\n    return max(0, min(kelly, 1))  # \u9650\u5236\u5728 0-1 \u4e4b\u9593\n\n# \u4f7f\u7528\u7bc4\u4f8b\nstats = report.get_stats()\nkelly_ratio = kelly_criterion(\n    win_rate=stats['win_ratio'],\n    avg_win=trades[trades['return'] &gt; 0]['return'].mean(),\n    avg_loss=abs(trades[trades['return'] &lt; 0]['return'].mean())\n)\n\nprint(f\"\u51f1\u5229\u5efa\u8b70\u6295\u5165\u6bd4\u4f8b: {kelly_ratio*100:.1f}%\")\n# \u5be6\u52d9\u4e0a\u4f7f\u7528 0.5 * Kelly (\u534a\u51f1\u5229) \u8f03\u4fdd\u5b88\nprint(f\"\u534a\u51f1\u5229\u5efa\u8b70: {kelly_ratio*0.5*100:.1f}%\")\n</code></pre>"}, {"location": "workflows/risk_management/#32-fixed-fractional", "title": "3.2 \u56fa\u5b9a\u5206\u6578\u6cd5 (Fixed Fractional)", "text": "<pre><code># \u6bcf\u6b21\u53ea\u6295\u5165\u7e3d\u8cc7\u91d1\u7684\u56fa\u5b9a\u6bd4\u4f8b\nRISK_PER_TRADE = 0.02  # \u55ae\u6b21\u98a8\u96aa 2%\n\n# \u6839\u64da\u505c\u640d\u5e45\u5ea6\u8a08\u7b97\u90e8\u4f4d\u5927\u5c0f\nstop_loss = 0.10  # \u505c\u640d 10%\nposition_size = RISK_PER_TRADE / stop_loss  # = 0.2 = 20%\n\nprint(f\"\u5efa\u8b70\u90e8\u4f4d\u5927\u5c0f: {position_size*100:.0f}%\")\n</code></pre>"}, {"location": "workflows/risk_management/#4", "title": "4. \u56de\u64a4\u63a7\u5236", "text": ""}, {"location": "workflows/risk_management/#41", "title": "4.1 \u76e3\u63a7\u56de\u64a4\u4e26\u66ab\u505c\u4ea4\u6613", "text": "<pre><code>def check_drawdown_limit(report, max_drawdown=0.20):\n    \"\"\"\u6aa2\u67e5\u662f\u5426\u8d85\u904e\u6700\u5927\u56de\u64a4\u9650\u5236\"\"\"\n    stats = report.get_stats()\n    current_dd = stats['max_drawdown']\n\n    if abs(current_dd) &gt; max_drawdown:\n        print(f\"\u8b66\u544a:\u56de\u64a4 {current_dd*100:.1f}% \u8d85\u904e\u9650\u5236 {max_drawdown*100:.0f}%\")\n        print(\"\u5efa\u8b70\u66ab\u505c\u4ea4\u6613,\u6aa2\u8996\u7b56\u7565!\")\n        return False\n    return True\n\n# \u4f7f\u7528\nif not check_drawdown_limit(report, max_drawdown=0.25):\n    # \u66ab\u505c\u4ea4\u6613\u908f\u8f2f\n    pass\n</code></pre>"}, {"location": "workflows/risk_management/#42", "title": "4.2 \u52d5\u614b\u8abf\u6574\u90e8\u4f4d(\u6839\u64da\u56de\u64a4)", "text": "<pre><code>def adjust_position_by_drawdown(position, creturn, base_size=1.0):\n    \"\"\"\u6839\u64da\u7576\u524d\u56de\u64a4\u52d5\u614b\u8abf\u6574\u90e8\u4f4d\n\n    \u56de\u64a4\u8d8a\u5927,\u90e8\u4f4d\u8d8a\u5c0f\n    \"\"\"\n    # \u8a08\u7b97\u7576\u524d\u56de\u64a4\n    peak = creturn.expanding().max()\n    drawdown = (creturn - peak) / peak\n\n    # \u8abf\u6574\u4fc2\u6578 (\u56de\u64a4 -20% \u6642,\u90e8\u4f4d\u6e1b\u534a)\n    adj_factor = 1 + drawdown / 0.20\n    adj_factor = adj_factor.clip(0.5, 1.0)  # \u9650\u5236\u5728 0.5-1.0\n\n    # \u8abf\u6574\u90e8\u4f4d\n    adjusted_position = position * adj_factor.reindex(position.index, method='ffill')\n    return adjusted_position\n\n# \u4f7f\u7528\nposition_adjusted = adjust_position_by_drawdown(\n    position,\n    report.creturn,\n    base_size=1.0\n)\n</code></pre>"}, {"location": "workflows/risk_management/#5", "title": "5. \u98a8\u96aa\u6307\u6a19\u76e3\u63a7", "text": ""}, {"location": "workflows/risk_management/#51", "title": "5.1 \u8a2d\u5b9a\u98a8\u96aa\u9810\u8b66", "text": "<pre><code>def risk_alert(report):\n    \"\"\"\u98a8\u96aa\u9810\u8b66\u6aa2\u67e5\"\"\"\n    stats = report.get_stats()\n    alerts = []\n\n    # \u6aa2\u67e5 1: \u590f\u666e\u7387\u904e\u4f4e\n    if stats['daily_sharpe'] &lt; 0.5:\n        alerts.append(f\"\u26a0\ufe0f \u590f\u666e\u7387\u904e\u4f4e: {stats['daily_sharpe']:.2f}\")\n\n    # \u6aa2\u67e5 2: \u6700\u5927\u56de\u64a4\u904e\u5927\n    if abs(stats['max_drawdown']) &gt; 0.30:\n        alerts.append(f\"\u26a0\ufe0f \u6700\u5927\u56de\u64a4\u904e\u5927: {stats['max_drawdown']*100:.1f}%\")\n\n    # \u6aa2\u67e5 3: \u52dd\u7387\u904e\u4f4e\n    if stats['win_ratio'] &lt; 0.40:\n        alerts.append(f\"\u26a0\ufe0f \u52dd\u7387\u904e\u4f4e: {stats['win_ratio']*100:.1f}%\")\n\n    # \u6aa2\u67e5 4: \u5e73\u5747\u7372\u5229/\u8667\u640d\u6bd4\u904e\u4f4e\n    trades = report.get_trades()\n    avg_win = trades[trades['return'] &gt; 0]['return'].mean()\n    avg_loss = abs(trades[trades['return'] &lt; 0]['return'].mean())\n    win_loss_ratio = avg_win / avg_loss if avg_loss &gt; 0 else 0\n\n    if win_loss_ratio &lt; 1.5:\n        alerts.append(f\"\u26a0\ufe0f \u7372\u5229/\u8667\u640d\u6bd4\u904e\u4f4e: {win_loss_ratio:.2f}\")\n\n    # \u8f38\u51fa\u8b66\u5831\n    if alerts:\n        print(\"=\" * 50)\n        print(\"\u98a8\u96aa\u8b66\u5831:\")\n        for alert in alerts:\n            print(alert)\n        print(\"=\" * 50)\n    else:\n        print(\"\u2705 \u98a8\u96aa\u6aa2\u67e5\u901a\u904e\")\n\n    return len(alerts) == 0\n\n# \u4f7f\u7528\nrisk_alert(report)\n</code></pre>"}, {"location": "workflows/risk_management/#52", "title": "5.2 \u5b9a\u671f\u98a8\u96aa\u5831\u544a", "text": "<pre><code>def generate_risk_report(report):\n    \"\"\"\u7522\u751f\u98a8\u96aa\u5831\u544a\"\"\"\n    stats = report.get_stats()\n    trades = report.get_trades()\n\n    risk_metrics = {\n        '\u5e74\u5316\u5831\u916c\u7387': f\"{stats['daily_mean']*100:.2f}%\",\n        '\u5e74\u5316\u6ce2\u52d5\u7387': f\"{stats['daily_std']*100:.2f}%\",\n        '\u590f\u666e\u7387': f\"{stats['daily_sharpe']:.2f}\",\n        '\u6700\u5927\u56de\u64a4': f\"{stats['max_drawdown']*100:.2f}%\",\n        '\u52dd\u7387': f\"{stats['win_ratio']*100:.1f}%\",\n        '\u5e73\u5747\u6301\u6709\u5929\u6578': f\"{trades['period'].mean():.1f} \u5929\",\n        '\u7e3d\u4ea4\u6613\u6b21\u6578': len(trades),\n    }\n\n    print(\"\\n\" + \"=\" * 50)\n    print(\"\u98a8\u96aa\u5831\u544a\")\n    print(\"=\" * 50)\n    for key, value in risk_metrics.items():\n        print(f\"{key:12s}: {value}\")\n    print(\"=\" * 50 + \"\\n\")\n\n# \u4f7f\u7528\ngenerate_risk_report(report)\n</code></pre>"}, {"location": "workflows/risk_management/#6", "title": "6. \u5be6\u6230\u98a8\u96aa\u7ba1\u7406\u6aa2\u67e5\u6e05\u55ae", "text": ""}, {"location": "workflows/risk_management/#_3", "title": "\u56de\u6e2c\u968e\u6bb5", "text": "<ul> <li>[ ] \u55ae\u4e00\u6301\u80a1\u6b0a\u91cd \u2264 10%</li> <li>[ ] \u8a2d\u5b9a\u5408\u7406\u7684\u505c\u640d(8-12%)\u8207\u505c\u5229(15-25%)</li> <li>[ ] \u6700\u5927\u56de\u64a4 &lt; 30%</li> <li>[ ] \u590f\u666e\u7387 &gt; 1.0</li> <li>[ ] \u52dd\u7387 &gt; 45% \u6216 \u5e73\u5747\u7372\u5229/\u8667\u640d\u6bd4 &gt; 1.5</li> </ul>"}, {"location": "workflows/risk_management/#_4", "title": "\u5be6\u76e4\u968e\u6bb5", "text": "<ul> <li>[ ] \u4f7f\u7528\u6a21\u64ec\u55ae\u6e2c\u8a66\u81f3\u5c11 1 \u500b\u6708</li> <li>[ ] \u521d\u671f\u8cc7\u91d1 \u2264 \u7e3d\u8cc7\u91d1\u7684 20%</li> <li>[ ] \u6bcf\u65e5\u76e3\u63a7\u56de\u64a4\u8207\u6301\u5009</li> <li>[ ] \u6bcf\u9031\u6aa2\u8996\u5be6\u76e4 vs \u56de\u6e2c\u7684\u504f\u5dee</li> <li>[ ] \u6bcf\u6708\u7522\u751f\u98a8\u96aa\u5831\u544a</li> </ul>"}, {"location": "workflows/risk_management/#_5", "title": "\u7dca\u6025\u72c0\u6cc1", "text": "<ul> <li>[ ] \u56de\u64a4 &gt; 20%:\u66ab\u505c\u65b0\u589e\u90e8\u4f4d</li> <li>[ ] \u56de\u64a4 &gt; 30%:\u5e73\u5009 50%</li> <li>[ ] \u56de\u64a4 &gt; 40%:\u5168\u90e8\u5e73\u5009,\u6aa2\u8a0e\u7b56\u7565</li> <li>[ ] \u9023\u7e8c\u8667\u640d &gt; 5 \u7b46:\u66ab\u505c\u4ea4\u6613,\u6aa2\u8996\u7b56\u7565</li> </ul>"}, {"location": "workflows/risk_management/#_6", "title": "\u5b8c\u6574\u7a0b\u5f0f\u78bc\u7bc4\u4f8b", "text": "<pre><code>from finlab import data\nfrom finlab.backtest import sim\n\n# \u8f09\u5165\u8cc7\u6599\nclose = data.get('price:\u6536\u76e4\u50f9')\n\n# \u7b56\u7565\u908f\u8f2f\nentry = close &gt; close.average(20)\nexit_signal = close &lt; close.average(10)\n\n# \u52a0\u5165\u98a8\u96aa\u63a7\u5236\nposition = entry.hold_until(\n    exit=exit_signal,\n    stop_loss=0.10,          # \u505c\u640d 10%\n    take_profit=0.20         # \u505c\u5229 20%\n)\n\n# \u56de\u6e2c(\u55ae\u4e00\u6301\u80a1\u4e0a\u9650 10%\uff0c\u79fb\u52d5\u505c\u5229 8%)\nreport = sim(\n    position,\n    resample='M',\n    position_limit=0.1,\n    trail_stop=0.08,\n    upload=False\n)\n\n# \u98a8\u96aa\u6aa2\u67e5\nif risk_alert(report):\n    print(\"\u7b56\u7565\u901a\u904e\u98a8\u96aa\u6aa2\u67e5,\u53ef\u8003\u616e\u5be6\u76e4\")\nelse:\n    print(\"\u7b56\u7565\u672a\u901a\u904e\u98a8\u96aa\u6aa2\u67e5,\u9700\u8981\u512a\u5316\")\n\n# \u7522\u751f\u98a8\u96aa\u5831\u544a\ngenerate_risk_report(report)\n</code></pre>"}, {"location": "workflows/risk_management/#_7", "title": "\u53c3\u8003\u8cc7\u6e90", "text": "<ul> <li>\u6b77\u53f2\u56de\u6e2c\u8a73\u7d30\u8aaa\u660e</li> <li>\u7b56\u7565\u5206\u6790\u6a21\u7d44</li> <li>\u5b8c\u6574\u7b56\u7565\u958b\u767c\u6d41\u7a0b</li> <li>\u591a\u7b56\u7565\u7d44\u5408\u7ba1\u7406</li> </ul>"}]}