
<!doctype html>
<html lang="zh-TW" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="FinLab - 台股量化交易工具，用最少程式碼完成策略研究、回測分析與實盤下單。支援技術指標、財報分析、機器學習與多策略組合管理。">
      
      
      
        <link rel="canonical" href="https://doc.finlab.tw/details/document/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>FinLab 函式庫 - FinLab 量化交易工具文檔</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/material.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="FinLab 函式庫 - FinLab 量化交易工具文檔" />
<meta property="og:description" content="FinLab - 台股量化交易工具，用最少程式碼完成策略研究、回測分析與實盤下單。支援技術指標、財報分析、機器學習與多策略組合管理。" />
<meta property="og:image" content="https://doc.finlab.tw/assets/images/social/details/document.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://doc.finlab.tw/details/document/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="FinLab 函式庫 - FinLab 量化交易工具文檔" />
<meta property="twitter:description" content="FinLab - 台股量化交易工具，用最少程式碼完成策略研究、回測分析與實盤下單。支援技術指標、財報分析、機器學習與多策略組合管理。" />
<meta property="twitter:image" content="https://doc.finlab.tw/assets/images/social/details/document.png" />
</head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#finlab" class="md-skip">
          跳轉到
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="https://ai.finlab.tw" title="FinLab 量化交易工具文檔" class="md-header__button md-logo" aria-label="FinLab 量化交易工具文檔" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FinLab 量化交易工具文檔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FinLab 函式庫
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜尋" placeholder="搜尋" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="搜尋">
        
        <button type="reset" class="md-search__icon md-icon" title="清除" aria-label="清除" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/finlab-python" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="標籤" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  三分鐘上手

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../get_data/" class="md-tabs__link">
          
  
  
  簡易教學

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/finlab/" class="md-tabs__link">
          
  
  
  詳細功能

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../workflows/complete_strategy_workflow/" class="md-tabs__link">
          
  
  
  完整工作流程

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/module_relationships/" class="md-tabs__link">
          
  
  
  架構與設計

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tools/guide_for_beginners/" class="md-tabs__link">
          
  
  
  實用範例

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../change-log/" class="md-tabs__link">
        
  
  
    
  
  更新日誌

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
  
    
  
  常見問題 FAQ

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
  
    
  
  術語表

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://discord.gg/tAr4ysPqvR" class="md-tabs__link">
        
  
  
    
  
  社群助教

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://ai.finlab.tw/pricing" class="md-tabs__link">
        
  
  
    
  
  價格

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="導覽列" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ai.finlab.tw" title="FinLab 量化交易工具文檔" class="md-nav__button md-logo" aria-label="FinLab 量化交易工具文檔" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    FinLab 量化交易工具文檔
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/finlab-python" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    三分鐘上手
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    簡易教學
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    簡易教學
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../get_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    數據
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tech_ind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    指標
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backtest_decorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    選股條件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backtest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    歷史回測
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../factor_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    因子分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../order_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    下單(單策略)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../order_api2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    下單(多策略)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../machine_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    機器學習
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finlab_plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    資料視覺化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimize_strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    策略參數優化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    策略分析模組
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../market_customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    自訂市場物件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    詳細功能
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    詳細功能
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/finlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dataframe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.dataframe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/backtest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.backtest
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/machine_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.portfolio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/online/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.online
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.plot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/optimize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.optimize
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/market/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finlab.market
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    完整工作流程
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    完整工作流程
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/complete_strategy_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    從研究到實盤
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/ml_strategy_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    機器學習策略流程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/multi_strategy_portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    多策略組合管理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/risk_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    風險管理指南
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    架構與設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    架構與設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/module_relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    模組架構圖
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/data_flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    資料流程詳解
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/extending_finlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    擴充開發指南
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    實用範例
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    實用範例
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    台股
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    台股
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/guide_for_beginners/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    策略開發10分鐘上手
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/Pandas_%E7%AD%96%E7%95%A5%E9%96%8B%E7%99%BC%E5%9F%BA%E7%A4%8E%E8%AA%9E%E6%B3%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pandas 策略開發基礎語法
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E8%82%A1%E5%83%B9%E5%89%B5%E6%96%B0%E9%AB%98%E5%8B%95%E8%83%BD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    股價創新高動能
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E6%8A%80%E8%A1%93%E6%8C%87%E6%A8%99%E9%81%B8%E8%82%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術指標選股
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E4%B9%96%E9%9B%A2%E7%8E%87%E5%92%8C%E8%B2%A1%E5%A0%B1%E6%BF%BE%E7%B6%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    乖離率和財報濾網
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E6%9C%AC%E7%9B%8A%E6%88%90%E9%95%B7%E6%AF%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    本益成長比(月營收截止日換股)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E5%B0%8F%E8%B3%87%E6%97%8F%E5%84%AA%E7%AD%89%E7%94%9F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    小資族優等生
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E5%A4%9A%E7%A9%BA%E5%B0%8D%E6%B2%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    多空對沖
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E7%87%9F%E5%BB%BA%E7%94%A2%E6%A5%AD%E5%B0%88%E7%94%A8%E6%8C%87%E6%A8%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    營建產業專用指標
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E9%81%8E%E6%BF%BE%E5%85%A8%E9%A1%8D%E4%BA%A4%E5%89%B2%E8%82%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    過濾全額交割股
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E9%81%8E%E6%BF%BEKY%E8%82%A1%E8%B2%A1%E5%A0%B1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    過濾KY股財報
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/%E5%A4%A7%E7%9B%A4%E6%8C%87%E6%A8%99%E6%BF%BE%E7%B6%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    大盤指標濾網
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/2330_bband_rebound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    台積電逆勢抄底
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/cheap-stock-ratio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    大跌底部判斷
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/important_info_search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    重訊公告搜尋 - 業外損失
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/ml_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    機器學習範例策略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../change-log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    更新日誌
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    常見問題 FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    術語表
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://discord.gg/tAr4ysPqvR" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    社群助教
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://ai.finlab.tw/pricing" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    價格
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        快速上手
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="快速上手">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        會員註冊
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        快速安裝
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        獲取歷史資料
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        策略開發與回測
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        模組功能指南
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="模組功能指南">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#finlab_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finlab權限登入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        獲取歷史資料
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="獲取歷史資料">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 時間序列資料
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 非時間序列資料(table)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        技術指標計算
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="技術指標計算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        使用設定
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明：
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例一
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例二
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例三 (續) 選股
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-pandas_ta" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例四 - Pandas_ta 技術指標
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        限定上市櫃、類股
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="限定上市櫃、類股">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        獲取已上傳策略的數據
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="獲取已上傳策略的數據">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        返回值
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        回測模組
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="回測模組">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
        返回值
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      
        多空並存回測
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    <span class="md-ellipsis">
      
        Report物件
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Report物件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
        屬性:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
        方法:
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="方法:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
        返回值
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      
        返回值
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
        回測語法糖
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="回測語法糖">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      
        日月季不等式、四則運算
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      
        均線
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="均線">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例：股價在均線之上
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    <span class="md-ellipsis">
      
        每列數值最大的 n 檔股票
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="每列數值最大的 n 檔股票">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#roa-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        選股範例：每季 ROA 前 10 名的股票
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        每列數值最小的 n 檔股票
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="每列數值最小的 n 檔股票">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例：股價淨值比最小的 10 檔股票
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      
        訊號進出場
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="訊號進出場">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      
        策略範例
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
        數值上升中
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="數值上升中">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：收盤價是否高於10日前股價
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
        數值下降中
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="數值下降中">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：收盤價是否低於10日前股價
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        持續 N 天滿足條件
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="持續 N 天滿足條件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：收盤價是否連兩日上漲
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      
        股票當天數值分位數
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="股票當天數值分位數">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#90" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：取每日股價前90％分位數
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      
        財務月季報索引格式轉換
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="財務月季報索引格式轉換">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      
        產業分群
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="產業分群">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：半導體平均股價淨值比時間序列
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      
        進場點
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="進場點">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：策略為每日收盤價前10高，取進場點。
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      
        出場點
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="出場點">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例：策略為每日收盤價前10高，取出場點。
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      
        回測條件範例
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="回測條件範例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      
        創新高策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsi" class="md-nav__link">
    <span class="md-ellipsis">
      
        高 RSI 技術指標策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      
        乖離率和財報濾網策略
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      
        下單串接
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="下單串接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      
        執行交易策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      
        計算股票張數
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      
        部位增減調整
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      
        多策略權重加總
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      
        實際下單
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="實際下單">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 安裝券商 API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 連接證券帳戶
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 連接證券帳戶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 玉山富果 帳戶串接
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 永豐帳戶串接
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3 批次下單
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      
        策略管理介面
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="策略管理介面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      
        刪除策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      
        設定自動更新策略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      
        分享策略
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      
        視覺化子模組（暫不支援網頁）
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="視覺化子模組（暫不支援網頁）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k" class="md-nav__link">
    <span class="md-ellipsis">
      
        K線圖組
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="K線圖組">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      
        圖例
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例一：單一股票繪圖
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例二：日、月線繪圖
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例三：客制化技術指標繪圖
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例四：客制化技術指標繪圖
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      
        樹狀板塊地圖
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="樹狀板塊地圖">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pepb" class="md-nav__link">
    <span class="md-ellipsis">
      
        PE、PB 河流圖
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PE、PB 河流圖">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    <span class="md-ellipsis">
      
        財務指標分級雷達圖
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="財務指標分級雷達圖">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#polar-bar" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例一 Polar Bar
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#polar-line" class="md-nav__link">
    <span class="md-ellipsis">
      
        範例二 Polar Line
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    <span class="md-ellipsis">
      
        多策略資產配置旭日圖
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多策略資產配置旭日圖">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    <span class="md-ellipsis">
      
        參數說明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    <span class="md-ellipsis">
      
        程式範例
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pandas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pandas 常用語法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pandas 常用語法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    <span class="md-ellipsis">
      
        讀取函式庫
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    <span class="md-ellipsis">
      
        準備歷史資料
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="準備歷史資料">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    <span class="md-ellipsis">
      
        資料檢索
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="資料檢索">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    <span class="md-ellipsis">
      
        選取「列」
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    <span class="md-ellipsis">
      
        選取頭跟尾
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        選取 index 跟 columns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    <span class="md-ellipsis">
      
        顯示控制
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    <span class="md-ellipsis">
      
        資料運算
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    <span class="md-ellipsis">
      
        移動窗格作業
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="finlab">FinLab 函式庫</h1>
<h2 id="_1">快速上手</h2>
<p>FinLab 致力於推廣我們在量化投資上的知識與 Python 實作經驗，並且分享如何運用 Python 創造屬於自己的投資生態系，靠自己的能力為自己創造投資收入，不用在外花錢聽信無根據的明牌，讓大家用很低的成本複製我們在財經一路上的所學與經驗。除了過去在 Hahow 開設課程，現在為了打造更豐富的 Python 量化投資生態系，建置了 SaaS 與延伸教學內容平台，不斷研發，提供給大家更多武器應對複雜的金融市場。</p>
<h3 id="_2">會員註冊</h3>
<p>進入首頁後，點選右上角登入按鈕，即可使用 Google 帳號登錄 FinLab 會員。若無 Google 帳號，請先 <a href="https://accounts.google.com/signup/v2/webcreateaccount?continue=https%3A%2F%2Faccounts.google.com%2FManageAccount%3Fnc%3D1&amp;hl=zh-TW&amp;flowName=GlifWebSignIn&amp;flowEntry=SignUp">註冊 Google 帳號</a> 方可接續進行。</p>
<h3 id="_3">快速安裝</h3>
<p>提供3種選項，每個人都可以選擇適合自己的環境：
1. Python:
    使用 <code>pip install finlab</code> 並且在一般 Python 環境下執行回測。</p>
<div class="highlight"><pre><span></span><code>注意:若在finlab hahow課程資料夾內操作，可能與本地finlab模組有命名衝突問題，請重開新的python開發環境或在colab操作。
</code></pre></div>
<ol>
<li>
<p>FinLab IDE:
    免安裝，直接在網頁上執行 Python 程式語法，並搭配 FinLab 函式庫使用。</p>
<p>注意:免費權限有每日運行時間限制600秒，建議先在一般 Python 環境下執行回測(無限制時間)，確認策略運作正常後，再將程式碼貼到FinLab IDE執行部屬。</p>
</li>
<li>
<p>FinLab GUI:
    免安裝，直接在網頁上執行，用圖形化介面編輯策略。</p>
</li>
</ol>
<details>
<summary>Python</summary>

一般 Python 環境安裝:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">pip</span> <span class="n">install</span> <span class="n">finlab</span>
</code></pre></div>

註：假如是在 Colab或Jupyter 環境下，可以使用 `!pip install finlab` 來安裝。
</details>

<details>
<summary>Finlab IDE</summary>

#### Step1
左側導覽列點選選股策略Icon。

#### Step2
點選“建立新策略”。

<img src='https://i.imgur.com/6F7nznX.png'>

#### Step3
輸入策略名稱，點選“確定”。

<img src='https://i.imgur.com/QBXDObb.png'>

#### Step4:
點選“程式碼編輯器”，進入IDE開發畫面。

<img src='https://i.imgur.com/ic4K9ib.png'>
</details>

<details>
<summary >Finlab GUI</summary>
<h4>Step1:</h4>
左側導覽列點選選股策略Icon。
<h4>Step2:</h4>
點選“建立新策略”。


<img src='https://i.imgur.com/6F7nznX.png'>
<h4>Step3:</h4>
輸入策略名稱，點選“確定”。


<img src='https://i.imgur.com/QBXDObb.png'>
<h4>Step4:</h4>
點選“圖形化編輯器”，進入GUI開發畫面。


<img src='https://i.imgur.com/Twtja4k.png'>
</details>

<h3 id="_4">獲取歷史資料</h3>
<p>一行程式快速抓取豐富的股市資料庫！</p>
<details>
<summary>Python</summary>
<h4>Step1:</h4>

利用 finlab.data 來得到「所有」歷史資料。

至[資料庫目錄](https://ai.finlab.tw/database)複製想獲取的資料的使用方法。
舉例：

<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">close</span>
</code></pre></div>
<h4>Step2:</h4>
初次下載資料會跳出驗證碼請求，若有成功註冊會員，畫面會顯示驗證碼，再將驗證碼複製填入“輸入驗證碼”欄位即可獲取資料。


<img src='https://i.imgur.com/CoYBh89.png'>
</details>

<details>
<summary>Finlab IDE</summary>
<h4>方法1:</h4>

至[資料庫目錄](https://ai.finlab.tw/database)複製想獲取的資料的使用方法貼到IDE編寫。
舉例：

<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">close</span>
</code></pre></div>
<h4>方法2:</h4>

至IDE右側財務指標或技術指標點選，即可生成data.get(所選指標)的程式碼於IDE。
舉例：

<img src='https://i.imgur.com/pnm5pqP.png'>
</details>

<details>
<summary>Finlab GUI</summary>
<h4>Step1:</h4>

至IDE右側財務指標或技術指標點選，即可生成所選的指標拼圖於GUI。
舉例：

<img src='https://i.imgur.com/yFOpl3W.png' width="1000">
</details>

<h3 id="_5">策略開發與回測</h3>
<p>簡單開發策略，執行強大的回測系統！</p>
<details>
<summary>Python</summary>
<h4>Step1:</h4>

利用python pandas及finlab語法撰寫條件程式碼。
[Colab範例檔連結。](https://colab.research.google.com/drive/1RVd2d6eW_A3yZGqLSl9PJ2LHGAoNIOOj?usp=sharing)
程式範例如下:

<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># 下載資料</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">pe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:本益比&#39;</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1"># 收盤價位於20日均線支撐上</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">cond1</span><span class="o">=</span><span class="n">close</span> <span class="o">&gt;</span> <span class="n">close</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="c1"># 使用indicator計算rsi指標</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="n">rsi</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="s1">&#39;RSI&#39;</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="c1"># rsi高檔鈍化</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="n">cond2</span><span class="o">=</span><span class="p">(</span><span class="n">rsi</span><span class="o">&gt;</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">==</span><span class="mi">3</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="c1"># 排除股價過高與過低的股票</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="n">cond3</span><span class="o">=</span><span class="p">(</span><span class="n">close</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">close</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="c1"># 選出買進訊號中益本比前10大標地</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="n">ind</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pe</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cond1</span><span class="o">&amp;</span><span class="n">cond2</span><span class="o">&amp;</span><span class="n">cond3</span><span class="p">)</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="n">position</span><span class="o">=</span><span class="n">ind</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo_strategy&quot;</span><span class="p">)</span>
</code></pre></div>
<h4>Step2:</h4>
取得回測結果


<img src='https://i.imgur.com/KFRmEpy.png' width="1000">
</details>

<details>
<summary>Finlab IDE</summary>
<h4>Step1:</h4>

利用python pandas及finlab語法撰寫條件程式碼，範例如下:

<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># 下載資料</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">pe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:本益比&#39;</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># 收盤價位於20日均線支撐上</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">cond1</span><span class="o">=</span><span class="n">close</span> <span class="o">&gt;</span> <span class="n">close</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># 使用indicator計算rsi指標</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="n">rsi</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="s1">&#39;RSI&#39;</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="c1"># rsi高檔鈍化</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="n">cond2</span><span class="o">=</span><span class="p">(</span><span class="n">rsi</span><span class="o">&gt;</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">==</span><span class="mi">3</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="c1"># 排除股價過高與過低的股票</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="n">cond3</span><span class="o">=</span><span class="p">(</span><span class="n">close</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">close</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="c1"># 選出買進訊號中益本比前10大標地</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="n">ind</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pe</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cond1</span><span class="o">&amp;</span><span class="n">cond2</span><span class="o">&amp;</span><span class="n">cond3</span><span class="p">)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="n">position</span><span class="o">=</span><span class="n">ind</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo_strategy&quot;</span><span class="p">)</span>
</code></pre></div>
<h4>Step2:</h4>
執行程式(範例圖紅圈處)。


<img src='https://i.imgur.com/Go7NtX9.png' width="1000">


<h4>Step3:</h4>
取得回測結果。


<img src='https://i.imgur.com/KFRmEpy.png' width="1000">
</details>

<details>
<summary>Finlab GUI</summary>
<h4>Step1:</h4>

GUI操作原則:

1. 拼圖顏色由外而內配置順序為：紅、黃、藍、紫，不同顏色代表不同主功能。
1. 依資料邏輯填入數值，若邏輯正確，拼圖即可拼接，否則無法填入。
1. 拼接完成後，按下方執行鈕(範例圖紅圈處)，回測即開始執行。

選股範例條件如下:

1. 收盤價位於20日均線支撐上。
1. rsi高檔鈍化，連3日大於80。
1. 股價介於5-500。
1. 最後選出買進訊號中益本比前10大標地。

GUI操作範例如下:

<img src='https://i.imgur.com/zbDnHgZ.png' width="1000">

<h4>Step2:</h4>
取得回測結果。


<img src='https://i.imgur.com/KFRmEpy.png' width="1000">
</details>

<h2 id="_6">模組功能指南</h2>
<p>以下為使用 <code>finlab</code> package 更細部的介紹，針對每一個函式撰寫範例。</p>
<h3 id="finlab_1">Finlab權限登入</h3>
<p><code>finlab.login(api_token:str)</code></p>
<p>可以至 </p>
<p><a href="https://ai.finlab.tw/api_token/">api_token查詢頁面</a> 獲取api_token，執行<code>finlab.login(api_token)</code>登入來設置相關環境變數。</p>
<p>若不自行輸入，在使用Finlab模組執行會員功能時，系統會自動會跳出 </p>
<p><a href="https://ai.finlab.tw/api_token/">GUI頁面</a> 請求輸入api_token，驗證完方可使用對應權限的功能。</p>
<p><img src='https://i.imgur.com/CoYBh89.png'></p>
<h3 id="_7">獲取歷史資料</h3>
<p><code>finlab.data.get(dataset)</code></p>
<p>利用 finlab.data 來得到「所有」歷史資料，可以至<a href="https://ai.finlab.tw/database">資料庫目錄</a>複製資料的使用方法。一行程式快速抓取豐富的股市資料庫！
目前針對 FREE 跟 VIP 用戶，所得到的資料時間段不同：
* FREE 用戶：去除最近兩個月之歷史資料
* VIP 用戶：完整歷史和當天資料</p>
<p>資料格式為分為兩種：「時間序列資料」和「非時間序列資料」</p>
<h4 id="1">1. 時間序列資料</h4>
<p>資料獲取方法，就是使用  <code>data.get</code> 函式，傳入：<code>主資料:子資料</code> 的格式，例如<code>price:收盤價</code>。
獲得的資料，其縱軸為日期，橫軸為股票代號，製作選股策略非常方便。</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
</code></pre></div>
<img src="https://i.ibb.co/rdPXqjd/Screen-Shot-2021-07-13-at-10-44-37-PM.png"/></p>
<h4 id="2-table">2.  非時間序列資料(table)</h4>
<p>資料獲取方法，就是使用  <code>data.get</code> 函式，傳入：<code>主資料</code> 的格式，例如 <code>company_main_business</code>。可以發現拿到的資料，不是按照時間序列排列。</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;company_main_business&#39;</span><span class="p">)</span>
</code></pre></div>
<img src="https://i.ibb.co/c6qNBBJ/Screen-Shot-2021-07-13-at-10-49-41-PM.png" /></p>
<h3 id="_8">技術指標計算</h3>
<p><code>finlab.data.indicator(indname:str, adjust_price:bool=False, resample:str='D', **kwargs):</code></p>
<p>支援 Talib 和 pandas_ta 上百種技術指標！只需要一行，幫你算出2000檔股票、10年的所有資訊！</p>
<h4 id="_9">使用設定</h4>
<p>在使用這個函式前，必需要先安裝 talib 套件，可以參考 <a href="https://github.com/mrjbq7/ta-lib#installation">官方安裝教學</a> 來安裝，支援 Windows、MacOS、Linux。</p>
<h4 id="_10">參數說明：</h4>
<ul>
<li><code>indname</code>: talib指標名稱，例如 <code>SMA</code>, <code>STOCH</code>, <code>RSI</code> 等，可以參考 <a href="https://mrjbq7.github.io/ta-lib/funcs.html">talib 教學</a>。</li>
<li><code>adjust_price</code>: 是否使用還原股價計算。</li>
<li><code>resample</code>: 技術指標價格週期，ex: <code>D</code> 代表日線, <code>W</code> 代表週線, <code>M</code> 代表月線。</li>
<li><code>**kwargs</code>: 所選talib指標的其他參數設定，以 <code>RSI</code> 為例，參考 <a href="https://mrjbq7.github.io/ta-lib/func_groups/momentum_indicators.html">talib 文件中 RSI 範例</a>，調整項為計算週期 <code>timeperiod</code>。</li>
</ul>
<p>建議使用者可以先參考以下範例，並且搭配 <a href="http://mrjbq7.github.io/ta-lib/doc_index.html">talib官方文件</a>，就可以掌握製作技術指標的方法了。</p>
<h4 id="_11">範例一</h4>
<p>計算所有股票的 RSI 數值
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">data</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="s1">&#39;RSI&#39;</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</code></pre></div>
<img src="https://i.ibb.co/ZdNdCWg/Screen-Shot-2021-07-13-at-11-19-57-PM.png" /></p>
<p>上圖中，可以看到資料包含 <code>NaN</code> ，代表資料筆數不足，無法計算出數值，每一檔股票除了剛開始的 14 天外，幾乎都會有數值。</p>
<h4 id="_12">範例二</h4>
<p>計算所有股票的 KD 值，由於 KD 數值是由 K 和 D 所組成，每一檔股票每天會有兩個數值，所以 <code>data.indicator</code> 會自動回傳兩個 <code>pd.DataFrame</code>，可以用 <code>k, d = data.indicator('STOCH')</code> 將 K 與 D 數值紀錄，之後用於比大小，例如 <code>k &gt; d</code>。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="s1">&#39;STOCH&#39;</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">k</span>
</code></pre></div>
<p><img src="https://i.ibb.co/HdrKSxp/Screen-Shot-2021-07-13-at-11-22-56-PM.png" /></p>
<h4 id="_13">範例三 (續) 選股</h4>
<p>延續上述的範例二，假如我們希望將最近一天 K &gt; D 值的股票清單列出來，可以用以下語法
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="mi">0015</span>    <span class="kc">False</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="mi">0050</span>     <span class="kc">True</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="mi">0051</span>    <span class="kc">False</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="mi">0052</span>     <span class="kc">True</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="mi">0053</span>     <span class="kc">True</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="o">...</span>  
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="mi">9951</span>     <span class="kc">True</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="mi">9955</span>    <span class="kc">False</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="mi">9958</span>    <span class="kc">False</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="mi">9960</span>     <span class="kc">True</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="mi">9962</span>     <span class="kc">True</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="n">Name</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">13</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">2269</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></p>
<h4 id="-pandas_ta">範例四 - Pandas_ta 技術指標</h4>
<p>finlab 0.3.2 dev1 版本開始支援 Pandas_ta 計算技術指標。
套件安裝方法及指標選項請見
<a href="https://twopirllc.github.io/pandas-ta/#installation">Pandas_ta官方文件</a></p>
<p>我們將 Pandas_ta 與 Finlab 整合，使用方式非常的簡單，就跟以前一模一樣，用一行簡短的程式，就可以計算兩千檔股票的數值：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="s1">&#39;supertrend&#39;</span><span class="p">)</span>
</code></pre></div>
<p>此時，程式會優先搜尋 TaLib 中是否有對應的函式，假如沒有的話，就會搜尋 Pandas_ta。可以讓你一次把所有股票的技術指標一次計算出來。缺點是 Pandas_ta 計算的速度比較慢，所以運算時要稍微等待一下。</p>
<h3 id="_14">限定上市櫃、類股</h3>
<p><code>finlab.data.set_universe(market='ALL', category='ALL', exclude_category=None)</code></p>
<p>使用者可以使用此函式設定市場與類股的回測標的範圍。
設定完畢後，再使用 <code>data.get</code> 或是 <code>data.indicator</code> 時，就只會獲得所選範圍之標的，所得到的股票會被過濾。注意此設定影響為全域，若之後的data不想被影響，可使用以下程式。
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">with</span> <span class="n">data</span><span class="o">.</span><span class="n">universe</span><span class="p">(</span><span class="n">market</span><span class="o">=</span><span class="s1">&#39;TSE_OTC&#39;</span><span class="p">):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="n">price</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="_15">參數說明</h4>
<ul>
<li><code>market (str)</code>: 市場名稱。
    範例： 
    <code>'ALL', 'TSE', 'OTC', 'TSE_OTC', 'ETF'</code></li>
<li><code>category (str or list)</code>: 類股名稱，可以使用模糊比對，例如 <code>'電子'</code>，會選到<code>'電子工業'</code>, <code>'電子通路業'</code>... 等;例如 <code>['水泥','鋼鐵']</code>，會選到<code>'水泥工業'</code>, <code>'鋼鐵工業'</code>。</li>
<li><code>exclude_category (str or list | None)</code>: 排除的類股名稱（支援模糊比對）。預設為 <code>None</code>，例如：<code>exclude_category='ETF'</code> 將排除所有 ETF 類別。
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="s1">&#39;光電業&#39;</span><span class="p">,</span> <span class="s1">&#39;其他&#39;</span><span class="p">,</span> <span class="s1">&#39;其他電子業&#39;</span><span class="p">,</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="s1">&#39;化學工業&#39;</span><span class="p">,</span> <span class="s1">&#39;半導體&#39;</span><span class="p">,</span> <span class="s1">&#39;塑膠工業&#39;</span><span class="p">,</span> <span class="s1">&#39;存託憑證&#39;</span><span class="p">,</span> <span class="s1">&#39;建材營造&#39;</span><span class="p">,</span> <span class="s1">&#39;文化創意業&#39;</span><span class="p">,</span> <span class="s1">&#39;橡膠工業&#39;</span><span class="p">,</span> <span class="s1">&#39;水泥工業&#39;</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="s1">&#39;汽車工業&#39;</span><span class="p">,</span> <span class="s1">&#39;油電燃氣業&#39;</span><span class="p">,</span> <span class="s1">&#39;玻璃陶瓷&#39;</span><span class="p">,</span> <span class="s1">&#39;生技醫療&#39;</span><span class="p">,</span> <span class="s1">&#39;生技醫療業&#39;</span><span class="p">,</span> <span class="s1">&#39;紡織纖維&#39;</span><span class="p">,</span> <span class="s1">&#39;航運業&#39;</span><span class="p">,</span> <span class="s1">&#39;觀光事業&#39;</span><span class="p">,</span> <span class="s1">&#39;貿易百貨&#39;</span><span class="p">,</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="s1">&#39;資訊服務業&#39;</span><span class="p">,</span> <span class="s1">&#39;農業科技&#39;</span><span class="p">,</span> <span class="s1">&#39;通信網路業&#39;</span><span class="p">,</span> <span class="s1">&#39;造紙工業&#39;</span><span class="p">,</span> <span class="s1">&#39;金融&#39;</span><span class="p">,</span> <span class="s1">&#39;鋼鐵工業&#39;</span><span class="p">,</span> <span class="s1">&#39;電器電纜&#39;</span><span class="p">,</span> <span class="s1">&#39;電子商務&#39;</span><span class="p">,</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="s1">&#39;電子通路業&#39;</span><span class="p">,</span> <span class="s1">&#39;電子零組件&#39;</span><span class="p">,</span> <span class="s1">&#39;電機機械&#39;</span><span class="p">,</span> <span class="s1">&#39;電腦及週邊&#39;</span><span class="p">,</span> <span class="s1">&#39;食品工業&#39;</span>
</code></pre></div></li>
</ul>
<h4 id="_16">程式範例</h4>
<p>限定只抓取上市櫃普通股(排除ETF、ETN、特別股、存託憑證)
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1"># 僅水泥工業，且排除 ETF</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">data</span><span class="o">.</span><span class="n">set_universe</span><span class="p">(</span><span class="n">market</span><span class="o">=</span><span class="s1">&#39;TSE_OTC&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;水泥&#39;</span><span class="p">,</span> <span class="n">exclude_category</span><span class="o">=</span><span class="s1">&#39;ETF&#39;</span><span class="p">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
</code></pre></div>
<img src="https://i.ibb.co/ynWR1gt/Screen-Shot-2021-07-13-at-11-17-06-PM.png" /></p>
<h3 id="_17">獲取已上傳策略的數據</h3>
<p><code>finlab.data.get_strategies()</code>
，可取得自己策略儀表板上的數據，像是每個策略的報酬率曲線、策略報酬率統計、近期部位、近期換股日等等，這些數據可以用來進行多策略彙整的應用喔！</p>
<h4 id="_18">參數說明</h4>
<ul>
<li><code>api_token (str)</code>:
    預設為None，若未輸入過finlab模組的api_token，會自動跳出登入頁面。已登入的使用者不用再次輸入api_token參數。 </li>
</ul>
<h4 id="_19">返回值</h4>
<ul>
<li><code>{strategy1:{'positions':{},'returns':[],...},strategy2:{'positions':{},'returns':[],...},...}</code></li>
</ul>
<h3 id="_20">回測模組</h3>
<p><code>finlab.backtest.sim(position, resample=None, ...)</code></p>
<p>一行執行強大的回測系統，產生 <code>position</code> 的每日訊號，帶入 <code>finlab.backtest.sim</code> 進行回測，快速得到風險報酬分析、選股清單！</p>
<h4 id="_21">程式範例</h4>
<p>你相信年報酬 +27% 的策略，程式碼三行就搞定嗎？讓 FinLab 打開你的眼界，接下來我們可以建構一個策略，策略每個月會檢查股票清單，持有價格小於 6 元的股票，剔除價格大於 6 元的股票，每個月底執行，周而復始。來回測看看這樣的績效到底如何：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtest</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># 只買入價格小於 6 元的股票</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">position</span> <span class="o">=</span> <span class="n">close</span> <span class="o">&lt;</span> <span class="mi">6</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="c1"># 回測，每月底(M)重新調整股票權重</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">backtest</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;價格小於6的股票&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="_22">參數說明</h4>
<ul>
<li><code>position (pd.Dataframe)</code>:
    買賣訊號紀錄。 True 為持有， False 為空手。
    若選擇做空position，只要將 sim(position) 改成負的 <code>sim(-position.astype(float))</code>即可做空。
    系統預設使用資料為台股與加密貨幣，若要使用美股或其他市場，將資料格式設定同為台股範例即可，index為datetime格式，column為文字格式的標的代號，注意每日自動更新服務不適用台股與加密貨幣的資料。
    <strong>必填</strong>。</li>
<li><code>resample (str)</code>:
    交易週期。將 <code>position</code> 的訊號以週期性的方式論動股票，預設為每天換股。其他常用數值為 <code>W</code>、 <code>M</code> 、 <code>Q</code> （每週、每月、每季換股一次），也可以使用 <code>W-Fri</code> 在週五的時候產生新的股票清單，並且於下週交易日下單。更多freq的選擇請見<a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">pandas文件</a>。</li>
<li><code>trade_at_price (str)</code>:
    選擇回測之還原股價以收盤價或開盤價計算，預設為'close'。可選'close'或'open'。</li>
<li><code>fee_ratio (float)</code>:
    交易手續費率，預設為台灣無打折手續費 <code>0.001425</code>。可視個人使用的券商優惠調整費率。</li>
<li><code>tax_ratio (float)</code>:
    交易稅率，預設為台灣普通股一般交易交易稅率 <code>0.003</code>。若交易策略的標的皆為ETF，記得設成 <code>0.001</code>。</li>
<li>
<p><code>name (str)</code>:
    策略名稱，預設為 <code>未指名</code>。策略名稱。相同名稱之策略上傳會覆寫。</p>
<p>命名規則:全英文或開頭中文，不接受開頭英文接中文。
* <code>stop_loss (float)</code>:
停損基準，預設為None，不執行停損。範例：0.1，代表成本價虧損 10% 時出場。
* <code>take_profit (float)</code>:
停利基準，預設為None，不執行停利。範例：0.1，代表成本價獲利 10% 時出場。
* <code>position_limit(float)</code>:
單檔標的持股比例上限，控制倉位風險。預設為None。範例：0.2，代表單檔標的最多持有 20 % 部位。
* <code>touched_exit(bool)</code>:
觸及到賣出訊號即以訊號日當下出場。預設為False，訊號產生後隔日出場。
* <code>mae_mfe_window(int)</code>:
計算mae_mfe於進場後於不同持有天數下的數據變化，主要應用為edge_ratio (優勢比率)計算。預設為0，則<code>Report.display_mae_mfe_analysis(...)</code>中的edge_ratio不會顯現。
* <code>mae_mfe_window_step(int)</code>:
與mae_mfe_window參數做搭配，為時間間隔設定，預設為1。若mae_mfe_window設20，mae_mfe_window_step設定為2，相當於python的range(0,20,2)，以2日為間距計算mae_mfe。
* <code>upload(bool)</code>:
上傳策略至finlab網站，預設為True，上傳策略。範例：
False，不上傳，可用
<code>finlab.backtest.sim(position, upload=False, ...).display()</code>
快速檢視策略績效。</p>
</li>
</ul>
<h4 id="_23">返回值</h4>
<ul>
<li><code>finlab.report.Report()</code></li>
</ul>
<p><img src="https://i.ibb.co/fMrgwGM/Screen-Shot-2021-07-13-at-11-36-02-PM.png" /></p>
<p>此時，使用者可以點選下方的「選股清單」來查看今天的持股狀況，甚至是手動跟單，來將虛擬的獲利變成現實。</p>
<p><img src="https://i.ibb.co/JnqJDvs/Screen-Shot-2021-07-13-at-11-41-56-PM.png" /></p>
<h4 id="_24">多空並存回測</h4>
<p>若策略想同時做多和做空，可參考以下範例，範例是做多 2330 一半的部位，做空 1101 一半的部位。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtest</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">position</span> <span class="o">=</span> <span class="n">close</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">position</span><span class="p">[</span><span class="s1">&#39;2330&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">position</span><span class="p">[</span><span class="s1">&#39;1101&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">r</span> <span class="o">=</span> <span class="n">backtest</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="n">r</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</code></pre></div>
<h3 id="report">Report物件</h3>
<p><code>class finlab.report.Report()</code></p>
<p>產生策略分析報告。</p>
<h4 id="_25">屬性:</h4>
<p><code>Report.position</code>: 得到每日歷史部位明細 (pd.Dataframe)。</p>
<p><code>Report.creturn</code>: 得到策略報酬率變化 (pd.Series)。</p>
<p><code>Report.benchmark</code>: 設定對標標準 (pd.Series)。預設為None，台股對標台股加權報酬指數，加密貨幣對標BTC/USD走勢。若要改為對標0050或其他標的，範例如下。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span><span class="p">,</span><span class="n">backtest</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">pb</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:股價淨值比&#39;</span><span class="p">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">pb</span> <span class="o">*</span> <span class="n">close</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">close</span> <span class="o">&gt;</span> <span class="n">close</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">close</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">rr</span><span class="o">=</span><span class="n">backtest</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="o">=-</span><span class="n">position</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span><span class="n">resample</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">upload</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="n">rr</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="n">close</span><span class="p">[</span><span class="s1">&#39;0050&#39;</span><span class="p">]</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="n">rr</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</code></pre></div>
<h4 id="_26">方法:</h4>
<p><code>Report.display()</code>:
顯示策略績效圖。
<img alt="" src="https://i.imgur.com/jyhGZTB.png" /></p>
<p><code>Report.get_stats()</code>:
取得策略統計數據，如夏普率、索提諾比率、最大回檔、近期報酬率統計。</p>
<p><code>Report.get_trades()</code>: 取得策略每筆交易紀錄資料。</p>
<ul>
<li>
<h5 id="_27">返回值</h5>
<ul>
<li><code>trade_record</code>: pd.Dataframe
    ##### trade_record 重點欄位說明<ul>
<li>exit_sig_date:進場訊號產生日。</li>
<li>entry_sig_date:出場訊號產生日。</li>
<li>entry_date:進場日。</li>
<li>exit_date:出場日。</li>
<li>return:報酬率。</li>
<li>mdd:持有期間最大回撤。</li>
<li>mae:持有期間最大不利報酬率幅度。</li>
<li>gmfe:持有期間最大有利報酬率幅度。</li>
<li>bmfe:mae發生前的最大有利報酬率幅度。</li>
<li>position: 持有佔比。</li>
<li>period:持有天數。</li>
<li>pdays:處於獲利時的天數。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>Report.display_mae_mfe_analysis(...)</code>: 顯示波動分析圖組。
<a href="https://www.finlab.tw/display_mae_mfe_analysis/">分析使用說明</a>。</p>
<ul>
<li>
<h5 id="_28">參數說明</h5>
<ul>
<li><code>atr_freq(int)</code>: edge_ratio使用的 ATR 時段週期參數。預設為10。</li>
<li><code>violinmode(str)</code>: violin型態統計圖樣式，模式分為'group'與'overlay'。預設為'group'，'group'模式為將交易勝敗手分群統計呈現'，'overlay'採取全數統計。</li>
</ul>
<h5 id="_29">返回值</h5>
<ul>
<li><code>figure(obj)</code></li>
</ul>
</li>
</ul>
<h4 id="_30">程式範例</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">pb</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:股價淨值比&#39;</span><span class="p">)</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">pb</span> <span class="o">*</span> <span class="n">close</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">close</span> <span class="o">&gt;</span> <span class="n">close</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">close</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">report</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">mae_mfe_window</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">mae_mfe_window_step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="n">report</span><span class="o">.</span><span class="n">position</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="n">report</span><span class="o">.</span><span class="n">creturn</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="n">report</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;benchmark_return:發行量加權股價報酬指數&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="n">report</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="n">report</span><span class="o">.</span><span class="n">get_trades</span><span class="p">()</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="c1">#report.display_mae_mfe_analysis()</span>
</code></pre></div>
<h2 id="_31">回測語法糖</h2>
<p><code>class finlab.dataframe.FinlabDataFrame()</code></p>
<p>除了使用熟悉的 Pandas 語法外，我們也提供很多語法糖，讓大家開發程式時，可以用簡易的語法完成複雜的功能，讓開發策略更簡潔！我們將所有的語法糖包裹在 <code>FinlabDataFrame</code> 中，用起來跟 <code>pd.DataFrame</code> 一樣，但是多了很多功能！只要使用 <code>finlab.data.get()</code> 所獲得的資料，皆為 <code>FinlabDataFrame</code> 格式，接下來我們就來看看， <code>FinlabDataFrame</code> 有哪些好用的語法糖吧！</p>
<h3 id="_32">日月季不等式、四則運算</h3>
<p>當資料日期沒有對齊（例如: 財報 vs 收盤價 vs 月報）時，在使用以下運算符號：<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>==</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&amp;</code>, <code>|</code>, <code>~</code>，不需要先將資料對齊，因為 <code>FinlabDataFrame</code> 會自動幫你處理，以下是示意圖。</p>
<p><img src="https://i.ibb.co/pQr5yx5/Screen-Shot-2021-10-26-at-5-32-44-AM.png" alt="Screen-Shot-2021-10-26-at-5-32-44-AM"></p>
<p>以下是範例：<code>cond1</code> 與 <code>cond2</code> 分別為「每天」，和「每季」的資料，假如要取交集的時間，可以用以下語法：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="err"></span><span class="c1"># 取得 FinlabDataFrame</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">roa</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fundamental_features:ROA稅後息前&#39;</span><span class="p">)</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1"># 運算兩個選股條件交集</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="n">cond1</span> <span class="o">=</span> <span class="n">close</span> <span class="o">&gt;</span> <span class="mi">37</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="n">cond2</span> <span class="o">=</span> <span class="n">roa</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="n">cond_1_2</span> <span class="o">=</span> <span class="n">cond1</span> <span class="o">&amp;</span> <span class="n">cond2</span>
</code></pre></div>
<p>擷取 1101 台泥 的訊號如下圖，可以看到 <code>cond1</code> 跟 <code>cond2</code> 訊號的頻率雖然不相同，但是由於 <code>cond1</code> 跟 <code>cond2</code> 是 <code>FinlabDataFrame</code>，所以可以直接取交集，而不用處理資料頻率對齊的問題。</p>
<p><img src="https://i.ibb.co/m9chXSQ/imageconds.png" alt="imageconds"></p>
<hr>

<h3 id="_33">均線</h3>
<p><code>FinlabDataFrame.average(n)</code></p>
<hr>

<p>取 n 筆移動平均，若股票在時間窗格內，有 N/2 筆 NaN，則會產生 NaN。</p>
<h4 id="_34">範例：股價在均線之上</h4>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">sma</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">cond</span> <span class="o">=</span> <span class="n">close</span> <span class="o">&gt;</span> <span class="n">sma</span>
</code></pre></div>
只需要簡單的語法，就可以將其中一部分的訊號繪製出來檢查：
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">close</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2021&#39;</span><span class="p">,</span> <span class="s1">&#39;2330&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">sma</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2021&#39;</span><span class="p">,</span> <span class="s1">&#39;2330&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">cond</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2021&#39;</span><span class="p">,</span> <span class="s1">&#39;2330&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;sma&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">])</span>
</code></pre></div>
<img src="https://i.ibb.co/Mg1P85y/sma.png" alt="sma"></p>
<hr>

<h3 id="n">每列數值最大的 n 檔股票</h3>
<p><code>FinlabDataFrame.is_largest(n)</code></p>
<hr>
<p>取每列前 n 筆大的數值，若符合 <code>True</code> ，反之為 <code>False</code> 。用來篩選每天數值最大的股票</p>
<p><img src="https://i.ibb.co/8rh3tbt/is-largest.png" alt="is-largest"></p>
<h4 id="roa-10">選股範例：每季 ROA 前 10 名的股票</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">roa</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fundamental_features:ROA稅後息前&#39;</span><span class="p">)</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">good_stocks</span> <span class="o">=</span> <span class="n">roa</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<hr>

<h3 id="n_1">每列數值最小的 n 檔股票</h3>
<p><code>FinlabDataFrame.is_smallest(n)</code></p>
<hr>
<p>取每列前 n 筆小的數值，若符合 <code>True</code> ，反之為 <code>False</code> 。用來篩選每天數值最小的股票</p>
<h4 id="10">範例：股價淨值比最小的 10 檔股票</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">pb</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:股價淨值比&#39;</span><span class="p">)</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">cheap_stocks</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">is_smallest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<h3 id="_35">訊號進出場</h3>
<p><code>entries.hold_until(exits, ...)</code></p>
<p>這大概是所有策略撰寫中，最重要的語法糖，上述語法中 <code>entries</code> 為進場訊號，而 <code>exits</code> 是出場訊號。所以 <code>entries.hold_until(exits)</code> ，就是進場訊號為 <code>True</code> 時，買入並持有該檔股票，直到出場訊號為 <code>True</code> 則賣出。</p>
<p><img src="https://i.ibb.co/PCt4hPd/Screen-Shot-2021-10-26-at-6-35-05-AM.png" alt="Screen-Shot-2021-10-26-at-6-35-05-AM"></p>
<p>此函式有很多細部設定，可以讓你最多選擇 N 檔股票做輪動。另外，當超過 N 檔進場訊號發生，也可以按照客制化的排序，選擇優先選入的股票。最後，可以持外設定停損停利，來增加出場的時機點。以下是 <code>hold_until</code> 的參數說明：</p>
<ul>
<li><code>exit (pd.Dataframe)</code>: 出場訊號。</li>
<li><code>nstocks_limit (int)</code>: 輪動檔數上限，預設為None。</li>
<li><code>stop_loss (float)</code>: 停損基準，預設為None，不執行停損。範例：0.1，代表成本價下跌 10% 時產生出場訊號。</li>
<li><code>take_profit (float)</code>: 停利基準，預設為None，不執行停利。範例：0.1，代表成本價上漲 10% 時產生出場訊號。</li>
<li><code>trade_at (str)</code>: 停損停利參考價，預設為'close'。可選 <code>close</code> 或 <code>open</code>。</li>
<li><code>rank (pd.Dataframe)</code>: 當天進場訊號數量超過 nstocks_limit 時，以 rank 數值越大的股票優先進場。</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>若要使用 hold_until 與停損停利，將停損停利設置在 hold_until 內即可，不可將停損停利設置在<code>finlab.backtest.sim</code>，以避免衝突。</p>
<h4 id="_36">策略範例</h4>
<p>價格 &gt; 20 日均線入場, 價格 &lt; 60 日均線出場，最多持有10檔，超過 10 個進場訊號，則以股價淨值比小的股票優先選入。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">pb</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:股價淨值比&#39;</span><span class="p">)</span>  
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">sma20</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">sma60</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="n">entries</span> <span class="o">=</span> <span class="n">close</span> <span class="o">&gt;</span> <span class="n">sma20</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="n">exits</span> <span class="o">=</span> <span class="n">close</span> <span class="o">&lt;</span> <span class="n">sma60</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="err">＃</span><span class="n">pb前10小的標的做輪動</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="n">position</span> <span class="o">=</span> <span class="n">entries</span><span class="o">.</span><span class="n">hold_until</span><span class="p">(</span><span class="n">exits</span><span class="p">,</span> <span class="n">nstocks_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rank</span><span class="o">=-</span><span class="n">pb</span><span class="p">)</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</code></pre></div>
<hr>

<h3 id="_37">數值上升中</h3>
<p><code>rise(n=1)</code></p>
<hr>

<p>取是否比前第n筆高，若符合條件的值則為True，反之為False。
<img src="https://i.ibb.co/Y72bN5v/Screen-Shot-2021-10-26-at-6-43-41-AM.png" alt="Screen-Shot-2021-10-26-at-6-43-41-AM"></p>
<h4 id="10_1">程式範例：收盤價是否高於10日前股價</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rise</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<hr>

<h3 id="_38">數值下降中</h3>
<p><code>fall(n=1)</code></p>
<hr>

<p>取是否比前第n筆低，若符合條件的值則為True，反之為False。</p>
<h4 id="10_2">程式範例：收盤價是否低於10日前股價</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fall</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<hr>

<h3 id="n_2">持續 N 天滿足條件</h3>
<p><code>FinlabDataFrame.sustain(nwindow, nsatisfy=None)</code></p>
<hr>
<p>取移動 nwindow 筆加總大於等於nsatisfy，若符合條件的值則為True，反之為False。</p>
<h4 id="_39">程式範例：收盤價是否連兩日上漲</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rise</span><span class="p">()</span><span class="o">.</span><span class="n">sustain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<hr>

<h3 id="_40">股票當天數值分位數</h3>
<p><code>FinlabDataFrame.quantile_row(n=1)</code></p>
<hr>

<p>取得每列n定分位數的值。</p>
<h4 id="90">程式範例：取每日股價前90％分位數</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="c1"># </span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantile_row</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span>
</code></pre></div>
<hr>

<h3 id="_41">財務月季報索引格式轉換</h3>
<p><code>FinlabDataFrame.index_str_to_date()</code></p>
<hr>

<p>將以下資料的索引:月營收 (ex:2022M01) ，財務季報 (ex:2022Q1) 從文字格式轉為公告截止日的datetime格式，通常使用情境為對不同週期的dataframe做reindex，常用於以公告截止日為訊號產生日的時候。</p>
<h4 id="_42">程式範例：</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;monthly_revenue:當月營收&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">index_str_to_date</span><span class="p">()</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;financial_statement:現金及約當現金&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">index_str_to_date</span><span class="p">()</span>
</code></pre></div>
<hr>

<h3 id="_43">產業分群</h3>
<p><code>FinlabDataFrame.groupby_category()</code></p>
<hr>

<p>資料按產業分群，類似 <code>pd.DataFrame.groupby()</code>。</p>
<h4 id="_44">程式範例：半導體平均股價淨值比時間序列</h4>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">pe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price_earning_ratio:股價淨值比&#39;</span><span class="p">)</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">pe</span><span class="o">.</span><span class="n">groupby_category</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="s1">&#39;半導體&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<img src="https://i.ibb.co/Tq2fKBp/pbmean.png" alt="pbmean"></p>
<p>全球 2020 量化寬鬆加上晶片短缺，使得半導體股價淨值比衝高。</p>
<hr>

<h3 id="_45">進場點</h3>
<p><code>FinlabDataFrame.is_entry()</code></p>
<hr>
<p>取進場訊號點，若符合條件的值則為True，反之為False。</p>
<h4 id="10_3">程式範例：策略為每日收盤價前10高，取進場點。</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">is_entry</span><span class="p">()</span>
</code></pre></div>
<hr>

<h3 id="_46">出場點</h3>
<p><code>FinlabDataFrame.is_exit()</code></p>
<hr>
<p>取出場訊號點，若符合條件的值則為 True，反之為 False。</p>
<h4 id="10_4">程式範例：策略為每日收盤價前10高，取出場點。</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">is_entry</span><span class="p">()</span>
</code></pre></div>
<h2 id="_47">回測條件範例</h2>
<h3 id="_48">創新高策略</h3>
<p>股票最忌諱就是「買高賣低」，汲汲營營，但是你有沒有想過，大家都怕買高，反而要買更高？
創新高的股票，由於受到市場的關注，上漲動能非常強，所以選擇這些股票，就能帶來不錯的報酬率。
下方的條件，使用了 <code>pd.DataFrame</code> 裡的功能 <code>rolling(250).max()</code>，代表 250 天的最高價，
假如今天的收盤，等於 250 天的最高價，就代表創新高了！</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1"># 創 250 天新高的股票</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span> <span class="o">==</span> <span class="n">close</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="c1"># 回測，每月(M)調整一次，選出當天創新高股票</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;創年新高策略&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img src="https://i.ibb.co/7kNyvhP/Screen-Shot-2021-07-13-at-11-54-29-PM.png" /></p>
<h3 id="rsi">高 RSI 技術指標策略</h3>
<p>上述策略會選出很多檔標的，要是我們只想要選出 20 檔要怎麼寫呢？這個策略我們可以將 RSI 最大的 20 檔股票納入組合，並且持有一週，來試試看效果如何。我們可以用 <code>data.indicator</code> 來計算所有股票的 RSI，也可以用 <code>rsi.is_largest</code> 來計算此股票的 RSI 是否是最大的 20 檔。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="c1"># 選出 RSI 最大的 20 檔股票</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="n">rsi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="s1">&#39;RSI&#39;</span><span class="p">)</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="n">position</span> <span class="o">=</span> <span class="n">rsi</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="c1"># 回測，每月(M)調整一次</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="n">report</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;高RSI策略&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img src="https://i.ibb.co/3pQXGS2/Screen-Shot-2021-07-14-at-12-07-49-AM.png" /></p>
<h3 id="_49">乖離率和財報濾網策略</h3>
<p>可以一次使用兩種不同的指標來選股嗎？答案是肯定的，而且這兩個指標，還可以是每季的財報跟每天的價格，混和條件選股，由於下方的 <code>roe</code> 和 <code>close</code> 並不是 <code>pd.DataFrame</code> 而是 <code>finlab.dataframe.FinlabDataFrame</code> ，當在做條件運算，例如交集、聯集（and or）時，不同頻率的 index 會被取連集並且整合，所以使用者不需要思考，究竟資料是「季」還是「月」還是「日」，可以直接當作 index 和 columns 是對齊的，直接運算（程式會自動想辦法）。</p>
<p>下面的策略，利用 <code>close / close.shift(60)</code> 計算乖離率，並取 30 檔股票出來，再用 ROE 當濾網，選擇 ROE 為正的股票。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.backtest</span><span class="w"> </span><span class="kn">import</span> <span class="n">sim</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1"># 下載 ROE 跟收盤價</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">roe</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fundamental_features:ROE稅後&quot;</span><span class="p">)</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="n">close</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="n">position</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>      <span class="p">(</span><span class="n">close</span> <span class="o">/</span> <span class="n">close</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span><span class="o">.</span><span class="n">is_largest</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># 選出乖離率前 30 名的股票</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>    <span class="o">&amp;</span> <span class="p">(</span><span class="n">roe</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># 選出 ROE 大於 0 的股票</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="p">)</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="c1"># 回測，每月(M)調整一次</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="n">report</span> <span class="o">=</span> <span class="n">sim</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;乖離率和ROE濾網策略&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img src="https://i.ibb.co/Q9nFgMx/Screen-Shot-2021-07-14-at-12-30-48-AM.png" /></p>
<h2 id="_50">下單串接</h2>
<hr>

<h3 id="_51">執行交易策略</h3>
<p>目前交易系統僅支援 <code>finlab&gt;=0.3.0.dev1</code> 版本。在下單前，請先確認安裝了新版的 Package 喔！
首先，在下一個交易日開盤前，執行策略：
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtest</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="c1"># write your own strategy</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="n">report</span> <span class="o">=</span> <span class="n">backtest</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="_52">計算股票張數</h3>
<p>接下來，顯示最近的部位</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">current_trades</span><span class="p">)</span>
</code></pre></div>
<div style="overflow-x: scroll;width: 600px">
<table border="1" class="dataframe">  <thead>    <tr style="text-align: right;">      <th></th>      <th>entry_date</th>      <th>exit_date</th>      <th>entry_sig_date</th>      <th>exit_sig_date</th>      <th>position</th>      <th>period</th>      <th>entry_index</th>      <th>exit_index</th>      <th>return</th>      <th>entry_price</th>      <th>exit_price</th>      <th>mae</th>      <th>gmfe</th>      <th>bmfe</th>      <th>mdd</th>      <th>pdays</th>      <th>weight</th>      <th>next_weights</th>    </tr>    <tr>      <th>stock_id</th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>      <th></th>    </tr>  </thead>  <tbody>    <tr>      <th>1416 廣豐</th>      <td>2021-10-01</td>      <td>NaT</td>      <td>2021-09-30</td>      <td>2022-06-30</td>      <td>0.510197</td>      <td>159.0</td>      <td>3566.0</td>      <td>-1.0</td>      <td>-3.539823e-02</td>      <td>10.60</td>      <td>NaN</td>      <td>-0.053097</td>      <td>0.070796</td>      <td>0.070796</td>      <td>-0.115702</td>      <td>37.0</td>      <td>0.060665</td>      <td>0.00</td>    </tr>    <tr>      <th>1453 大將</th>      <td>2021-10-01</td>      <td>NaT</td>      <td>2021-09-30</td>      <td>2022-06-30</td>      <td>0.510197</td>      <td>159.0</td>      <td>3566.0</td>      <td>-1.0</td>      <td>2.348165e+00</td>      <td>8.43</td>      <td>NaN</td>      <td>-0.086763</td>      <td>2.403782</td>      <td>0.245829</td>      <td>-0.624585</td>      <td>60.0</td>      <td>0.171264</td>      <td>0.00</td>    </tr>    <tr>      <th>1524 耿鼎</th>      <td>2022-04-01</td>      <td>NaT</td>      <td>2022-03-31</td>      <td>2022-06-30</td>      <td>0.611632</td>      <td>39.0</td>      <td>3686.0</td>      <td>-1.0</td>      <td>-3.330669e-16</td>      <td>10.60</td>      <td>NaN</td>      <td>-0.476658</td>      <td>0.015152</td>      <td>0.000000</td>      <td>-0.476658</td>      <td>2.0</td>      <td>0.122168</td>      <td>0.00</td>    </tr>    <tr>      <th>2543 皇昌</th>      <td>2021-10-01</td>      <td>NaT</td>      <td>2021-09-30</td>      <td>NaT</td>      <td>0.510197</td>      <td>159.0</td>      <td>3566.0</td>      <td>-1.0</td>      <td>1.073232e-01</td>      <td>7.46</td>      <td>NaN</td>      <td>-0.063131</td>      <td>0.363636</td>      <td>0.008838</td>      <td>-0.268519</td>      <td>44.0</td>      <td>0.070298</td>      <td>0.05</td>    </tr>    <tr>      <th>2701 萬企</th>      <td>2022-04-01</td>      <td>NaT</td>      <td>2022-03-31</td>      <td>2022-06-30</td>      <td>0.611632</td>      <td>39.0</td>      <td>3686.0</td>      <td>-1.0</td>      <td>-3.330669e-16</td>      <td>12.05</td>      <td>NaN</td>      <td>-0.025105</td>      <td>0.029289</td>      <td>0.029289</td>      <td>-0.052846</td>      <td>18.0</td>      <td>0.063107</td>      <td>0.00</td>    </tr>  </tbody></table>
</div>

<p>假如確認沒問題，可以計算每檔股票投資的張數：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.online.order_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">Position</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="c1"># total fund</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="n">fund</span> <span class="o">=</span> <span class="mi">1000000</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="n">position</span> <span class="o">=</span> <span class="n">Position</span><span class="o">.</span><span class="n">from_report</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">fund</span><span class="p">)</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</code></pre></div>
<p>[{'stock_id': '2330', 'quantity': 1, 'order_condition': <OrderCondition.CASH: 1>}]</p>
<p>上述 <code>Position</code> 代表您的帳戶中，只希望有一張 <code>2330</code> 台積電股票，並且是現貨。</p>
<h3 id="_53">部位增減調整</h3>
<p>我們可以用以下方法調整部位大小</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># 減一張 2330 股票</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">new_position</span> <span class="o">=</span> <span class="n">position</span> <span class="o">-</span> <span class="n">Position</span><span class="p">({</span><span class="s1">&#39;2330&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># 增加一張 1101 股票</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="n">new_position</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">Position</span><span class="p">({</span><span class="s1">&#39;1101&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div>
<h3 id="_54">多策略權重加總</h3>
<p>假如我們有多個 position，可以用以下方式加總：
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtest</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.online.order_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">Position</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">report1</span> <span class="o">=</span> <span class="n">backtest</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="n">report2</span> <span class="o">=</span> <span class="n">backtest</span><span class="o">.</span><span class="n">sim</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="n">position1</span> <span class="o">=</span> <span class="n">Position</span><span class="o">.</span><span class="n">from_report</span><span class="p">(</span><span class="n">report1</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span> <span class="c1"># 策略操作金額一百萬</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="n">position2</span> <span class="o">=</span> <span class="n">Position</span><span class="o">.</span><span class="n">from_report</span><span class="p">(</span><span class="n">report2</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span> <span class="c1"># 策略操作金額一百萬</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="n">total_position</span> <span class="o">=</span> <span class="n">position1</span> <span class="o">+</span> <span class="n">position2</span>
</code></pre></div></p>
<h3 id="_55">實際下單</h3>
<h4 id="1-api">1 安裝券商 API</h4>
<p>目前支援 <code>玉山 Fugle</code> 和 <code>永豐</code> 證券的下單系統，則一使用即可。
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a># 玉山 Fugle
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>pip install fugle-trade
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a># 永豐
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>pip install shioaji
</code></pre></div></p>
<h4 id="2">2 連接證券帳戶</h4>
<p>目前支援 <code>Fugle</code> 和 <code>永豐</code> 證券的下單系統，可以先將帳號密碼設定成環境變數，只要針對您需要的券商來設定即可，不需要兩個券商同時串接。</p>
<h5 id="21">2.1 玉山富果 帳戶串接</h5>
<p>請先按照<a href="https://developer.fugle.tw/docs/trading/prerequisites">config 教學</a>獲取 config 設定檔。
並到登入<a href="https://developer.fugle.tw/docs/key/">富果API</a>，獲得市場行情 Token。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.online.fugle_account</span><span class="w"> </span><span class="kn">import</span> <span class="n">FugleAccount</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;FUGLE_CONFIG_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;玉山富果交易設定檔(config.ini.example)路徑&#39;</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;FUGLE_MARKET_API_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;玉山富果的行情API Token&#39;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="n">acc</span> <span class="o">=</span> <span class="n">FugleAccount</span><span class="p">()</span>
</code></pre></div>
<h5 id="22">2.2 永豐帳戶串接</h5>
<p>請先獲取憑證</p>
<p><a href="https://www.sinotrade.com.tw/CSCenter/CSCenter_13_1?tab=2">Windows 憑證下載方式</a></p>
<p><a href="https://www.sinotrade.com.tw/ec/20160324/Default.aspx">MacOS 憑證下載</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.online.sinopac_account</span><span class="w"> </span><span class="kn">import</span> <span class="n">SinopacAccount</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SHIOAJI_ACCOUNT&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;永豐證券帳號&#39;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SHIOAJI_PASSWORD&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;永豐證券密碼&#39;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SHIOAJI_CERT_PATH&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;永豐證券憑證路徑&#39;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="n">acc</span> <span class="o">=</span> <span class="n">SinopacAccount</span><span class="p">()</span>
</code></pre></div>
<h4 id="3">3 批次下單</h4>
<p>最後利用 <code>OrderExecuter</code> 將當證券帳戶的部位，按照 <code>position</code> 的部位進行調整。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.online.order_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderExecutor</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="c1"># Order Executer</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">order_executer</span> <span class="o">=</span> <span class="n">OrderExecutor</span><span class="p">(</span><span class="n">position</span> <span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">acc</span><span class="p">)</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="c1"># 下單檢查（瀏覽模式，不會真的下單）</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="n">order_executer</span><span class="o">.</span><span class="n">create_orders</span><span class="p">(</span><span class="n">view_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="c1"># 執行下單（會真的下單，初次使用建議收市時測試）</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="c1"># 預設使用最近一筆成交價當成限價</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="n">order_executer</span><span class="o">.</span><span class="n">create_orders</span><span class="p">()</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="c1"># 更新限價（將最後一筆成交價當成新的限價）</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="n">order_executer</span><span class="o">.</span><span class="n">update_order_price</span><span class="p">()</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="c1"># 刪除所有委託單</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="n">order_executer</span><span class="o">.</span><span class="n">cancel_orders</span><span class="p">()</span>
</code></pre></div>
<p></br>
</br></p>
<h2 id="_56">策略管理介面</h2>
<hr>

<h3 id="_57">刪除策略</h3>
<p>點選策略右側齒輪符號(下圖紅圈處)刪除策略。</p>
<p><img src='https://i.imgur.com/RKy9he8.png' width="1000"></p>
<h3 id="_58">設定自動更新策略</h3>
<p>點選右上“設定自動更新策略”按鈕，設定需要每日自動更新清單與回測的策略，選取策略名稱與更新時間，目前每個帳號限定3項策略可自動更新。</p>
<p>Note:限定使用Finlab IDE介面上傳程式後，方可設定“自動更新策略”。使用colab或其他編輯器者，可在撰寫完策略後，將程式貼於Finlab IDE介面執行。</p>
<p><img src='https://i.imgur.com/Sl68DLj.png' width="1000"></p>
<h3 id="_59">分享策略</h3>
<p>Step1: 點選策略名稱進入策略，之後點選在策略名稱旁的齒輪符號。</p>
<p><img src='https://i.imgur.com/GbOw8Rk.png'></p>
<p>Step2: 進入“策略網址的分享權限設定，未設定公開前，只有帳戶本人才能看到自己的策略。若想分享策略清單與相關程式，權限可以選擇“隱藏”之外的選項。</p>
<p><img src='https://i.imgur.com/YYs5uHZ.png'></p>
<p>Step3: 確認設定後，即可分享策略的網址給其他人參考。</p>
<p><img src='https://i.imgur.com/ZMabaA6.png'></p>
<h2 id="_60">視覺化子模組（暫不支援網頁）</h2>
<h3 id="k">K線圖組</h3>
<p><code>finlab.plot.plot_tw_stock_candles(stock_id, recent_days=400, ...)</code></p>
<p>繪製K線圖，可以各種技術指標跟 K 線圖一起繪製。</p>
<h4 id="_61">參數說明</h4>
<ul>
<li><code>stock_id (str)</code>: 必填，標地代碼 ex:2330。</li>
<li><code>recent_days (int)</code>: 取近n日內的資料，預設為400。</li>
<li><code>adjust_price (bool)</code>: 是否使用還原股價，預設為False。</li>
<li><code>resample (str)</code>: 技術指標價格週期，預設為'D'，範例：<code>D</code> 代表日線, <code>W</code>代表週線, <code>M</code> 代表月線。</li>
<li><code>overlay_func (dict)</code>: 主圖輔助線，預設為None，顯示布林通道。範例可以參考下方教學
    自定義格式寫法如下:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>    <span class="s1">&#39;ema_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>    <span class="s1">&#39;ema_10&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>    <span class="s1">&#39;ema_20&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    <span class="s1">&#39;ema_60&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="p">}</span>
</code></pre></div></li>
<li><code>technical_func(dict or dict in list)</code>: 技術指標子圖，預設為None，顯示KD指標。
    自定義格式寫法如下:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">talib</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstract</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="p">{</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>    <span class="s1">&#39;rsi_10&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">abstract</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    <span class="s1">&#39;rsi_20&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span><span class="n">abstract</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span><span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="p">}</span>
</code></pre></div>
    technical_func 為dict in list格式，可任意設定技術指標組數，像是範例會產生兩組技術指標圖：
    <div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">talib</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstract</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="n">technical_func</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>    <span class="p">{</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>    <span class="s1">&#39;rsi_10&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>    <span class="s1">&#39;rsi_20&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>    <span class="p">},</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>    <span class="p">{</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>     <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">STOCH</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>     <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">STOCH</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>    <span class="p">}</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="p">]</span>
</code></pre></div></li>
</ul>
<h4 id="_62">圖例</h4>
<p><img alt="" src="https://www.finlab.tw/wp-content/uploads/2022/02/newplot-1.png" /></p>
<h4 id="_63">範例一：單一股票繪圖</h4>
<p>最簡單的範例如下，可以直接呼叫並且繪製 <code>2330</code> 台積電的股價
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_candles</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="n">plot_tw_stock_candles</span><span class="p">(</span><span class="s2">&quot;2330&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="_64">範例二：日、月線繪圖</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_candles</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">plot_tw_stock_candles</span><span class="p">(</span><span class="s2">&quot;2330&quot;</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="_65">範例三：客制化技術指標繪圖</h4>
<p>我們可以額外使用 <code>talib</code> 來繪製想要看的技術指標，例如 5日、10日、20日的移動幾何平均，由於這些技術指標，是跟股價繪製在一起，所以可以用 <code>overlay_function</code> 這個參數。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_candles</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">talib</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstract</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="n">overlay_func</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>    <span class="s1">&#39;ema_05&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>    <span class="s1">&#39;ema_10&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>    <span class="s1">&#39;ema_20&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="p">}</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="n">plot_tw_stock_candles</span><span class="p">(</span><span class="s2">&quot;2330&quot;</span><span class="p">,</span> <span class="n">overlay_func</span><span class="o">=</span><span class="n">overlay_func</span><span class="p">)</span>
</code></pre></div>
<h4 id="_66">範例四：客制化技術指標繪圖</h4>
<p>與上述的範例不同，技術指標如 KD、RSI，不能跟股價繪製在同一張圖表，需要額外在不同的圖表上繪製，就可以使用 <code>technical_func</code> 來繪製，<code>technical_func</code> 為dict in list格式，可任意設定技術指標組數，像是範例會產生兩組技術指標圖：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_candles</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">talib</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstract</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="n">technical_func</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>    <span class="p">{</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>      <span class="s1">&#39;rsi_10&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>      <span class="s1">&#39;rsi_20&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="n">timeperiod</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>    <span class="p">},</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>    <span class="p">{</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>      <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">STOCH</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>      <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">abstract</span><span class="o">.</span><span class="n">STOCH</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>    <span class="p">}</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="p">]</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="n">plot_tw_stock_candles</span><span class="p">(</span><span class="s2">&quot;2330&quot;</span><span class="p">,</span> <span class="n">technical_func</span><span class="o">=</span><span class="n">technical_func</span><span class="p">)</span>
</code></pre></div>
<h3 id="_67">樹狀板塊地圖</h3>
<p><code>finlab.plot.plot_tw_stock_treemap(start, end, ...)</code></p>
<p>板塊地圖，可以用來瞭解股票的成交量分佈，以及現金流的轉換。</p>
<h4 id="_68">參數說明</h4>
<ul>
<li><code>start (str)</code>: 必填，資料起始日，ex:2021-01-02。</li>
<li><code>end (str)</code>: 必填， 資料結束日，ex:2021-01-05。</li>
<li><code>adjust_price (bool)</code>: 是否使用還原股價，預設為False。</li>
<li><code>area_ind (str)</code>: 決定板塊面積大小的參數，預設為'market_value'，可選範圍為<code>["market_value", "turnover", "turnover_ratio"]</code>(分別為：市值、交易力量、交易佔比)。</li>
<li><code>item (str)</code>: 決定板塊面積大小的參數，預設為'return_ratio'，預設可選範圍為<code>["return_ratio", "turnover_ratio"]</code>或是帶入finlab database的使用方法，ex:<code>'price_earning_ratio:本益比'</code>。</li>
<li>
<p><code>color_scales (str)</code>: 色溫條樣式，預設為'Temps'。
    <a href="https://plotly.com/python/builtin-colorscales/">樣式選擇詳細資訊</a>。</p>
</li>
<li>
<p><code>clip (tuple)</code>: 數值限定範圍，預設為None。避免數值範圍過大讓色溫顯示過淡，ex:(0,100)。</p>
</li>
</ul>
<h4 id="_69">程式範例</h4>
<p>以下範例為使用此函式，繪製出 <code>2021-7-1</code> ~ <code>2021-7-2</code> 的成交量的比例。其面積是成交量的大小，而顏色則是上漲或下跌的幅度。
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_treemap</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="n">plot_tw_stock_treemap</span><span class="p">(</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>    <span class="n">start</span><span class="o">=</span><span class="s1">&#39;2021-7-1&#39;</span><span class="p">,</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>    <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2021-7-2&#39;</span><span class="p">,</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>    <span class="n">area_ind</span><span class="o">=</span><span class="s1">&#39;turnover_ratio&#39;</span><span class="p">,</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>    <span class="n">item</span><span class="o">=</span><span class="s1">&#39;turnover_ratio&#39;</span><span class="p">)</span>
</code></pre></div>
<img src='https://i.imgur.com/QfnuPUo.png'></p>
<h3 id="pepb">PE、PB 河流圖</h3>
<p><code>finlab.plot.plot_tw_stock_river(start=None, end=None, stock_id='2330', mode='pe', split_range=8)</code></p>
<p>河流圖，可以用來瞭解股票指標的歷史位階。</p>
<h4 id="_70">參數說明</h4>
<ul>
<li><code>start (str)</code>: 資料起始日，預設為None，帶入全部資料。ex:'2021-01-02'。</li>
<li><code>end (str)</code>: 資料結束日，預設為None，帶入全部資料。ex:'2021-01-05'。</li>
<li><code>stock_id (str)</code>: 股號，預設為'2330'，ex:'2330'。</li>
<li><code>mode (str)</code>: 資料模式，預設為'pe'，可選範圍為<code>["pe", "pb"]</code>，分別為本益比、股價淨值比。</li>
<li><code>split_range (int)</code>: 河流階層數，預設為8層。</li>
</ul>
<h4 id="_71">程式範例</h4>
<p>以下範例為使用此函式繪製出台積電的歷史本益比河流圖。
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_river</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">plot_tw_stock_river</span><span class="p">(</span><span class="n">stock_id</span><span class="o">=</span><span class="s1">&#39;2330&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;pb&#39;</span><span class="p">,</span><span class="n">split_range</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<img alt="河流圖" src="https://i.imgur.com/ON8yVcm.png" /></p>
<h3 id="_72">財務指標分級雷達圖</h3>
<p><code>finlab.plot.plot_tw_stock_radar(df=None, feats=None, ...)</code></p>
<h4 id="_73">參數說明</h4>
<ul>
<li>
<p><code>df(dataframe)</code>: 客製化指標dataframe，數值使用pandas的rank與cut做群組分級。如果不填，則使用下一個feats參數帶入現有資料庫指標
    格式範例:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>            營業毛利率   營業利益率   稅後淨利率
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>stock_id
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>1101              6         9         9
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>1102              6         9         9
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>1103              1         1         1
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>1104              4         7         8
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>1108              3         6         5
</code></pre></div></p>
</li>
<li>
<p><code>feats (list)</code>: 指標清單，填入<a href="https://ai.finlab.tw/database">資料庫</a>使用方法至list。預設為20項常用財務指標。
    格式範例:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="p">[</span><span class="s1">&#39;fundamental_features:營業毛利率&#39;</span><span class="p">,</span><span class="s1">&#39;fundamental_features:營業利益率&#39;</span><span class="p">]</span>
</code></pre></div></p>
</li>
<li><code>select_targets(list)</code>: 必填，台股標的清單。
    格式範例:<code>['1101','1102']</code></li>
<li><code>mode(str)</code>: 雷達圖模式選擇，預設為'line_polar'，可用模式為<code>'line_polar','bar_polar','scatter_polar'</code>，
    <a href="https://plotly.com/python-api-reference/generated/plotly.express.html">詳細資訊</a>。</li>
<li><code>line_polar_fill(str)</code>: line_polar模式下的圖型填滿選擇，預設為'None'，可用模式為:<code>None,'toself','tonext'</code>，
    <a href="https://plotly.github.io/plotly.py-docs/generated/plotly.graph_objects.Scatterpolar.html">詳細資訊</a>。</li>
<li><code>cut_bins(int)</code>: 設定指標分級級距，預設為10。</li>
<li><code>title(str)</code>: 設定圖表標題，預設為None。</li>
</ul>
<h4 id="polar-bar">範例一 Polar Bar</h4>
<p>適合呈現整體投資組合指標累積評分結果。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_radar</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="n">plot_tw_stock_radar</span><span class="p">(</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>    <span class="n">select_targets</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1101&quot;</span><span class="p">,</span> <span class="s2">&quot;2330&quot;</span><span class="p">,</span> <span class="s2">&quot;8942&quot;</span><span class="p">,</span> <span class="s2">&quot;6263&quot;</span><span class="p">],</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bar_polar&quot;</span> <span class="p">,</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>    <span class="n">line_polar_fill</span><span class="o">=</span><span class="n">line_polar_fill</span><span class="p">)</span>
</code></pre></div>
<p><img src='https://i.imgur.com/z9nc8fN.png'></p>
<h4 id="polar-line">範例二 Polar Line</h4>
<p>line_polar 適合比較單一標地指標評分。
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_tw_stock_radar</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="n">plot_tw_stock_radar</span><span class="p">(</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>    <span class="n">select_targets</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1101&quot;</span><span class="p">,</span> <span class="s2">&quot;2330&quot;</span><span class="p">,</span> <span class="s2">&quot;8942&quot;</span><span class="p">,</span> <span class="s2">&quot;6263&quot;</span><span class="p">],</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bar_polar&quot;</span> <span class="p">,</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>    <span class="n">line_polar_fill</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></p>
<p><img src='https://i.imgur.com/7CWhZ52.png'></p>
<h3 id="_74">多策略資產配置旭日圖</h3>
<p><code>finlab.plot.StrategySunburst().plot(select_strategy=None, path=None, color_continuous_scale='RdBu_r')</code></p>
<p>多策略旭日圖 (sunburst)，可以用來瞭解已部署的策略，檢視當前的持股部位與配置資訊。</p>
<h4 id="_75">參數說明</h4>
<ul>
<li><code>select_strategy (dict)</code>: 設定選取的策略與策略對應的持股現值權重，預設是策略全選，權重為策略數的平均值。也可以自訂匡選的策略，像是只想看兩個實戰的策略，並分別設定6成與4成持股現值比重，可以設定成 {'低波動本益成長比':0.6,'研發魔人':0.4} 。若有現金的空部位想加入資產配置，可以設定成 {'低波動本益成長比':0.5,'研發魔人':0.2, '現金':0.2} ，策略名稱為現金，即可創造現金部位。</li>
<li><code>path (list)</code>: sunburst 分層路徑，預設由裡到外的分層是 ['s_name', 'market', 'category', 'stock_id'] ，可以觀察策略持有哪些類股為主。你可以自動設定分層，會有不同的效果，像是也可以設成 ['category','stock_id','s_name']  變成可以看標的被哪些策略同時選到。</li>
<li><code>color_continuous_scale (str)</code>: color_continuous_scale (str)：預設為'RdBu_r'，可以自選<a href="https://plotly.com/python/builtin-colorscales/">其他樣式</a>。</li>
</ul>
<h4 id="_76">程式範例</h4>
<p><a href="https://www.finlab.tw/plotly-sunburst%e8%bc%95%e9%ac%86%e7%9b%a3%e6%8e%a7%e5%a4%9a%e7%ad%96%e7%95%a5%e9%83%a8%e4%bd%8ddashboard%e8%a3%bd%e4%bd%9c%e6%95%99%e5%ad%b85/">詳細使用說明(內含 colab 範例檔)</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrategySunburst</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="c1"># 實例化物件</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="n">strategies</span> <span class="o">=</span> <span class="n">StrategySunburst</span><span class="p">()</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="n">s_data</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="n">s_data</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;已上傳的策略名稱:</span><span class="si">{</span><span class="n">s_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="c1"># 範例1</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="n">strategies</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="c1"># 範例2</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="n">strategies</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">select_strategy</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;高殖利率烏龜&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;營收強勢動能瘋狗&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span><span class="s1">&#39;現金流價值成長&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">})</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="c1"># 範例3</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="n">strategies</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">select_strategy</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;高殖利率烏龜&#39;</span><span class="p">:</span><span class="mf">0.4</span><span class="p">,</span><span class="s1">&#39;營收強勢動能瘋狗&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;現金流價值成長&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span><span class="s1">&#39;現金&#39;</span><span class="p">:</span><span class="mf">0.15</span><span class="p">},</span><span class="n">path</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;market&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;stock_id&#39;</span><span class="p">,</span><span class="s1">&#39;s_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="https://www.finlab.tw/wp-content/uploads/2022/06/newplot-16.png" /></p>
<h2 id="pandas">Pandas 常用語法</h2>
<p>FinLab 策略程式的開發建立在 Pandas 的基礎，藉由 Pandas 強大的資料處理功能，我們可以省下許多學習成本，更方便地操控資料。以下整理出經常使用在策略撰寫函數，並以 Finlab 財經資料為範例，示範策略轉寫。若你已經有 Python 基礎，此份資料方便你在處理資料遇到困難時得以檢索、複習、套用，無論在使用 Finlab 模組功能或開發其他延伸應用，都能得心應手。若你想操考更多語法功能細節，請參考文章底處的參考資源連結。</p>
<p><a href="https://colab.research.google.com/drive/1JIur-j42X8Nz-9UB_Tui2ljepnnyZzoh?usp=sharing">colab 範例連結</a></p>
<h3 id="_77">讀取函式庫</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">finlab</span><span class="w"> </span><span class="kn">import</span> <span class="n">data</span>
</code></pre></div>
<h3 id="_78">準備歷史資料</h3>
<p><code>pd.Dataframe</code> 建立二維資料表，有索引與欄位。可想成是多欄資料，由多個Series組成。</p>
<p>資料格式範例，我們這個章節，將分析三檔股票
* 鴻海 <code>2317</code>
* 台積電 <code>2330</code>
* 大立光 <code>3008</code>
利用語法將 <code>2018</code> 年的股票資料取出，接下來的資料分析，就會著重在這三檔股票。</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;price:收盤價&#39;</span><span class="p">)</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2018&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;2317&#39;</span><span class="p">,</span> <span class="s1">&#39;2330&#39;</span><span class="p">,</span> <span class="s1">&#39;3008&#39;</span><span class="p">]]</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="n">df</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>            <span class="mi">2317</span>   <span class="mi">2330</span>    <span class="mi">3008</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="n">date</span>                           
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">95.0</span>  <span class="mf">232.5</span>  <span class="mf">4255.0</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">94.0</span>  <span class="mf">237.0</span>  <span class="mf">4145.0</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>  <span class="mf">92.6</span>  <span class="mf">239.5</span>  <span class="mf">4135.0</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>  <span class="mf">93.0</span>  <span class="mf">240.0</span>  <span class="mf">4100.0</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">91.8</span>  <span class="mf">242.0</span>  <span class="mf">3930.0</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="o">...</span>          <span class="o">...</span>    <span class="o">...</span>     <span class="o">...</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">24</span>  <span class="mf">71.4</span>  <span class="mf">220.0</span>  <span class="mf">3270.0</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">25</span>  <span class="mf">70.7</span>  <span class="mf">217.5</span>  <span class="mf">3165.0</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">26</span>  <span class="mf">70.2</span>  <span class="mf">216.5</span>  <span class="mf">3125.0</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span>  <span class="mf">70.8</span>  <span class="mf">223.0</span>  <span class="mf">3135.0</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="mi">2018</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span>  <span class="mf">70.8</span>  <span class="mf">225.5</span>  <span class="mf">3215.0</span>
</code></pre></div></p>
<h4 id="_79">資料檢索</h4>
<p>可以將上述的 <code>df</code> 中，用時間和股票來選取其中的一小部分，以下是各種的用法:</p>
<ul>
<li>
<h5 id="_80">選取「列」</h5>
<p>我們可以選取歷史資料中的一條時間序列，例如我們希望將 <code>2330</code> 台積電從上述 <code>df</code> 中取出來：
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;2330&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>date
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>2018-01-02    232.5
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>2018-01-03    237.0
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>2018-01-04    239.5
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>2018-01-05    240.0
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>2018-01-08    242.0
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>            ...  
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>2018-12-24    220.0
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>2018-12-25    217.5
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>2018-12-26    216.5
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>2018-12-27    223.0
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>2018-12-28    225.5
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>Name: 2330, Length: 247, dtype: float64
</code></pre></div></p>
</li>
<li>
<h5 id="_81">選取頭跟尾</h5>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html"><strong>head &amp; tail</strong></a> 會選取前 n 筆，和後 n 筆資料，預設 <code>n = 5</code></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>            2317   2330    3008
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>date                           
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>2018-01-02  95.0  232.5  4255.0
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>2018-01-03  94.0  237.0  4145.0
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>2018-01-04  92.6  239.5  4135.0
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>2018-01-05  93.0  240.0  4100.0
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>2018-01-08  91.8  242.0  3930.0
</code></pre></div></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>            2317   2330    3008
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>date                           
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>2018-12-26  70.2  216.5  3125.0
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>2018-12-27  70.8  223.0  3135.0
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>2018-12-28  70.8  225.5  3215.0
</code></pre></div></p>
</li>
<li>
<h5 id="index-columns">選取 index 跟 columns</h5>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>DatetimeIndex([&#39;2018-01-02&#39;, &#39;2018-01-03&#39;, &#39;2018-01-04&#39;, &#39;2018-01-05&#39;,
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>            &#39;2018-01-08&#39;, &#39;2018-01-09&#39;, &#39;2018-01-10&#39;, &#39;2018-01-11&#39;,
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>            &#39;2018-01-12&#39;, &#39;2018-01-15&#39;,
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>            ...
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>            &#39;2018-12-18&#39;, &#39;2018-12-19&#39;, &#39;2018-12-20&#39;, &#39;2018-12-21&#39;,
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>            &#39;2018-12-22&#39;, &#39;2018-12-24&#39;, &#39;2018-12-25&#39;, &#39;2018-12-26&#39;,
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>            &#39;2018-12-27&#39;, &#39;2018-12-28&#39;],
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>            dtype=&#39;datetime64[ns]&#39;, name=&#39;date&#39;, length=247, freq=None)
</code></pre></div></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>Index([&#39;2317&#39;, &#39;2330&#39;, &#39;3008&#39;], dtype=&#39;object&#39;)
</code></pre></div></p>
</li>
<li>
<p>values:取值。
    <code>python=
    demo_values=df.values
    <div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>
</code></pre></div>
    array([[  9.54,  57.85,  32.83, ...,    nan,  46.  ,  49.6 ],
        [  9.54,  58.1 ,  32.99, ...,    nan,  45.9 ,  50.4 ],
        [  9.52,  57.6 ,  32.8 , ...,    nan,  49.1 ,  49.1 ],
        ...,
        [   nan, 137.6 ,  57.8 , ..., 131.5 ,  27.2 ,  14.6 ],
        [   nan, 138.95,  58.2 , ..., 134.  ,  27.35,  16.05],
        [   nan, 138.3 ,  57.9 , ..., 129.5 ,  27.25,  17.65]])</code></p>
</li>
<li>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#boolean-indexing"><strong>boolean indexing</strong></a>:</p>
<p>索引布林邏輯篩選。</p>
<p>ex:取得索引大於2020年份的資料。
<code>python=
demo_boolean_indexing=df[df.index&gt;'2020']
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>
</code></pre></div>
    0015    0050    0051    0052    0053
date                    
2020-01-02  NaN 97.65   35.45   73.30   42.70
2020-01-03  NaN 97.65   35.30   72.85   42.58
2020-01-06  NaN 96.40   35.10   72.05   42.04
2020-01-07  NaN 96.10   34.72   71.80   41.70
2020-01-08  NaN 95.65   34.69   71.25   41.61
... ... ... ... ... ...
2021-06-25  NaN 136.95  57.85   124.30  66.30
2021-06-28  NaN 137.20  57.90   124.20  66.15
2021-06-29  NaN 137.60  57.80   124.65  66.45
2021-06-30  NaN 138.95  58.20   125.00  66.80
2021-07-01  NaN 138.30  57.90   124.35  66.20</code>
5. <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html"><strong>loc</strong></a>:使用標籤篩選欄列。</p>
<p>ex:選擇2020-01-03~2020-01-08中所有標地的股價。
```python=
demo_loc1=df.loc['2020-01-03':'2020-01-08']
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>
</code></pre></div>
    0015    0050    0051    0052    0053
date                  <br />
2020-01-03  NaN 97.65   35.30   72.85   42.58
2020-01-06  NaN 96.40   35.10   72.05   42.04
2020-01-07  NaN 96.10   34.72   71.80   41.70
2020-01-08  NaN 95.65   34.69   71.25   41.61
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>ex:選擇0050&amp;1101&amp;2330的股價，以下兩種方法等價。
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>```python=
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>demo_loc2=df.loc[:,[&#39;0050&#39;,&#39;1101&#39;,&#39;2330&#39;]]
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>demo_column_select=df[[&#39;0050&#39;,&#39;1101&#39;,&#39;2330&#39;]]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>    0050    1101    2330
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>date            
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>2007-04-23  57.85   29.60   68.6
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>2007-04-24  58.10   30.25   69.8
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>2007-04-25  57.60   29.65   69.3
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>2007-04-26  57.70   29.65   69.9
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>2007-04-27  57.50   30.35   69.0
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>... ... ... ...
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>2021-06-25  136.95  51.00   591.0
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>2021-06-28  137.20  51.10   590.0
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>2021-06-29  137.60  51.20   595.0
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>2021-06-30  138.95  51.00   595.0
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>2021-07-01  138.30  50.60   593.0
</code></pre></div></p>
<p>ex:選擇2020-01-03~2020-01-08中0050&amp;1101&amp;2330的股價。
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>demo_loc3=df.loc[&#39;2020-01-03&#39;:&#39;2020-01-08&#39;,[&#39;0050&#39;,&#39;1101&#39;,&#39;2330&#39;]]
</code></pre></div></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>0050    1101    2330
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>date            
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>2020-01-03  97.65   43.95   339.5
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>2020-01-06  96.40   43.45   332.0
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>2020-01-07  96.10   43.60   329.5
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>2020-01-08  95.65   43.40   329.5
</code></pre></div>
6. <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html"><strong>iloc</strong></a>:使用標籤位置篩選欄列。</p>
<p>ex:選擇第6列到第10列的資料。</p>
<p><code>python=
demo_iloc1=df.iloc[5:10]
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>
</code></pre></div>
0015    0050    0051    0052    0053
date                    
2007-04-30  9.37    56.90   32.07   38.10   NaN
2007-05-02  9.50    57.55   32.02   38.49   NaN
2007-05-03  9.41    58.20   31.75   38.80   NaN
2007-05-04  9.59    59.20   32.41   39.23   NaN
2007-05-07  9.60    59.55   32.60   39.44   NaN
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>ex:選擇df表中第6檔到第10檔標地資料。
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>```python=
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>demo_iloc2=df.iloc[:,5:10]
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>    0054    0055    0056    0057    0058
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>date                    
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>2007-04-23  NaN NaN NaN NaN NaN
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>2007-04-24  NaN NaN NaN NaN NaN
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>2007-04-25  NaN NaN NaN NaN NaN
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>2007-04-26  NaN NaN NaN NaN NaN
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>2007-04-27  NaN NaN NaN NaN NaN
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>... ... ... ... ... ...
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>2021-06-25  31.84   21.25   34.74   94.05   NaN
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>2021-06-28  31.84   21.29   35.10   94.05   NaN
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>2021-06-29  31.80   21.20   34.80   94.70   NaN
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>2021-06-30  31.90   21.26   35.00   95.45   NaN
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a>2021-07-01  31.56   21.24   35.00   94.95   NaN
</code></pre></div>
ex:選擇第6列到第10列的資料&amp;選擇df表中第6檔到第10檔標地資料。</code>python=
demo_iloc3=df.iloc[5:10,5:10]
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>
</code></pre></div>
    0054    0055    0056    0057    0058
date                  <br />
2007-04-30  NaN NaN NaN NaN NaN
2007-05-02  NaN NaN NaN NaN NaN
2007-05-03  NaN NaN NaN NaN NaN
2007-05-04  NaN NaN NaN NaN NaN
2007-05-07  NaN NaN NaN NaN NaN
<code>7. [**nlargest &amp; nsmallest**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.nlargest.html):
1. nlargest:取前n大，ex:取近一日股價前n高的標地。</code>python=
demo_nlargest=df.iloc[-1].nlargest(10)
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>
</code></pre></div>
6415    3710.0
3008    3105.0
5274    2115.0
8454    1900.0
4966    1380.0
5269    1375.0
6409    1340.0
3529    1310.0
1590    1100.0
6669     976.0
Name: 2021-07-01 00:00:00, dtype: float64
```</p>
</li>
<li>
<p>nsmallest:取前n大，ex:取近一日股價前n低的標地。
    <code>python=
    demo_nsmallest=df.iloc[-1].nsmallest(10)
    <div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>
</code></pre></div>
    8101      2.61
    5701      2.85
    02001R    2.88
    3095      2.96
    2443      2.99
    6289      2.99
    9188      3.09
    9110      3.12
    2364      3.22
    6225      3.40
    Name: 2021-07-01 00:00:00, dtype: float64</code></p>
</li>
</ul>
<hr>

<h3 id="_82">顯示控制</h3>
<p>pandas預防資源消耗，預設顯示列數為10(頭尾各五列)，中間資料以‘...’帶過，若想要調整顯示數量來檢視資料，可作以下控制。</p>
<p><strong>Hint:</strong> 要注意的是此影響為全域，接下來的顯示數都會被影響。</p>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/options.html"><strong>set_option</strong></a>:</p>
<ol>
<li>
<p>列數全展開:
    <code>python=
    pd.set_option("display.max_rows", None)</code></p>
</li>
<li>
<p>欄數全展開:
    <code>python=
    pd.set_option("display.max_columns", None)</code></p>
</li>
<li>
<p>最多顯示20列:
    <code>python=
    pd.set_option("display.max_rows", 20)</code></p>
</li>
<li>
<p>最多顯示20欄:
    <code>python=
    pd.set_option("display.max_columns", 20)</code></p>
</li>
<li>
<p>還原顯示數預設初始值:
    <code>python=
    pd.reset_option("^display")</code></p>
</li>
</ol>
<h3 id="_83"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/basics.html#descriptive-statistics">資料運算</a></h3>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sum.html"><strong>sum</strong></a>:</p>
<p>加總，axis=0為整欄加總，axis=1為整列加總。</p>
<p>ex:計算每日股價大於100的標地數量
<code>python=
產生股價大於100元的布林dataframe，若大於100則顯示True(計算時視為1)，若不大於100則顯示False(計算時視為0)
price_up_10=df&gt;100
demo_sum=price_up_10.sum(axis=1)
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>
</code></pre></div>
date
2007-04-23     70
2007-04-24     72
2007-04-25     70
2007-04-26     71
2007-04-27     71
             ... 
2021-06-25    282
2021-06-28    285
2021-06-29    283
2021-06-30    283
2021-07-01    280
Length: 3503, dtype: int64
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>[**mean &amp; median &amp; std**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mean.html):
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>mean:平均數，常用於計算均線。
</code></pre></div>
demo_mean=df.mean()
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>
</code></pre></div>
0015     7.697360
0050    67.783269
0051    29.989126
0052    45.283546
0053    29.846568
          ...    
9951    84.396078
9955    30.770911
9958    29.483578
9960    24.562452
9962    12.956349
Length: 2269, dtype: float64
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>median:中位數。
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>```python=
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>demo_median=df.median()
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>0015     7.49
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>0050    62.90
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>0051    29.44
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>0052    38.77
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>0053    27.10
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a>        ...  
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a>9951    79.00
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>9955    20.90
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a>9958    11.50
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a>9960    22.30
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a>9962    11.50
<a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a>Length: 2269, dtype: float64
</code></pre></div>
std:標準差，常用於計算乖離率。</code>python=
demo_std=df.std()
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>
</code></pre></div>
0015     1.482317
0050    19.781026
0051     6.076147
0052    20.926838
0053     9.881821
          ...  <br />
9951    54.171955
9955    21.267716
9958    33.751259
9960     8.755944
9962     6.390186
Length: 2269, dtype: float64
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>[**max &amp; min**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.max.html):
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>max:最大值。
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>```python=
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>demo_max=df.max()
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>0015     12.40
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>0050    143.00
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>0051     58.20
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>0052    136.45
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>0053     68.80
<a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>         ...  
<a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>9951    220.00
<a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a>9955    140.50
<a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a>9958    141.50
<a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a>9960     61.10
<a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a>9962     50.40
<a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a>Length: 2269, dtype: float64
</code></pre></div>
min:最小值。
```python=
demo_min=df.min()
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>
</code></pre></div>
0015     4.15
0050    29.50
0051    13.40
0052    17.02
0053    11.85
        ...<br />
9951     0.00
9955    10.90
9958     5.10
9960     0.00
9962     4.95
Length: 2269, dtype: float64
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>[**cumsum &amp; cumprod**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html):
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>cumsum:累加。
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>ex:累積漲多少元。
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>```python=
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>demo_diff=df.diff()
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>demo_cumsum=demo_diff.cumsum()
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>    0015    0050    0051    0052    0053
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>date                    
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>2007-04-23  NaN NaN NaN NaN NaN
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>2007-04-24  0.00    0.25    0.16    0.25    NaN
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>2007-04-25  -0.02   -0.25   -0.03   0.19    NaN
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>2007-04-26  0.05    -0.15   -0.03   0.20    NaN
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>2007-04-27  0.01    -0.35   -0.11   0.00    NaN
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>... ... ... ... ... ...
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>2021-06-25  NaN 79.10   25.57   86.56   37.18
<a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>2021-06-28  NaN 79.35   25.62   86.46   37.03
<a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a>2021-06-29  NaN 79.75   25.52   86.91   37.33
<a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>2021-06-30  NaN 81.10   25.92   87.26   37.68
<a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a>2021-07-01  NaN 80.45   25.62   86.61   37.08
</code></pre></div>
cumprod:累乘。</p>
<p>ex:常用於計算累積報酬率。
<code>python=
demo_pct_change=df.pct_change()+1
demo_cumprod=demo_pct_change.cumprod()
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>
</code></pre></div>
    0015    0050    0051    0052    0053
date                    
2007-04-23  NaN NaN NaN NaN NaN
2007-04-24  1.000000    1.004322    1.004874    1.006510    NaN
2007-04-25  0.997904    0.995678    0.999086    1.004948    NaN
2007-04-26  1.005241    0.997407    0.999086    1.005208    NaN
2007-04-27  1.001048    0.993950    0.996649    1.000000    NaN
... ... ... ... ... ...
2021-06-25  0.966457    2.367329    1.762108    3.236979    2.207057
2021-06-28  0.966457    2.371651    1.763631    3.234375    2.202064
2021-06-29  0.966457    2.378565    1.760585    3.246094    2.212051
2021-06-30  0.966457    2.401901    1.772769    3.255208    2.223702
2021-07-01  0.966457    2.390666    1.763631    3.238281    2.203728
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>[**cummax &amp; cummin**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cummax.html):
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>cummax:累積最大值，常用於計算drawdown、創新高。
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>```python=
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>demo_cummax=df.cummax()
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>    0015    0050    0051    0052    0053
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>date                    
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a>2007-04-23  9.54    57.85   32.83   38.40   NaN
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>2007-04-24  9.54    58.10   32.99   38.65   NaN
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>2007-04-25  9.54    58.10   32.99   38.65   NaN
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a>2007-04-26  9.59    58.10   32.99   38.65   NaN
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a>2007-04-27  9.59    58.10   32.99   38.65   NaN
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a>... ... ... ... ... ...
<a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>2021-06-25  NaN 143.00  57.85   136.45  68.8
<a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a>2021-06-28  NaN 143.00  57.90   136.45  68.8
<a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a>2021-06-29  NaN 143.00  57.90   136.45  68.8
<a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a>2021-06-30  NaN 143.00  58.20   136.45  68.8
<a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a>2021-07-01  NaN 143.00  58.20   136.45  68.8
</code></pre></div>
cummin:累積最小值，常用於計算drawdown、創新低。</code>python=
demo_cummin=df.cummin()
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>
</code></pre></div></p>
<p>0015    0050    0051    0052    0053
date                  <br />
2007-04-23  9.54    57.85   32.83   38.40   NaN
2007-04-24  9.54    57.85   32.83   38.40   NaN
2007-04-25  9.52    57.60   32.80   38.40   NaN
2007-04-26  9.52    57.60   32.80   38.40   NaN
2007-04-27  9.52    57.50   32.72   38.40   NaN
... ... ... ... ... ...
2021-06-25  NaN 29.50   13.40   17.02   11.85
2021-06-28  NaN 29.50   13.40   17.02   11.85
2021-06-29  NaN 29.50   13.40   17.02   11.85
2021-06-30  NaN 29.50   13.40   17.02   11.85
2021-07-01  NaN 29.50   13.40   17.02   11.85
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>[**quantile**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.quantile.html):
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>計算第c百分位數數值，常用於取標的數前c%強標地。
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>```python=
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>demo_quantile=df.iloc[-1].quantile(0.9)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>126.0
</code></pre></div></p>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.corr.html"><strong>corr</strong></a>:
計算相關性。
```python=
demo_corr=df.iloc[:,:5].corr()
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>
</code></pre></div></p>
<p>0015    0050    0051    0052    0053
0015    1.000000    0.892513    0.922749    0.926133    0.823550
0050    0.892513    1.000000    0.852582    0.968580    0.989484
0051    0.922749    0.852582    1.000000    0.851140    0.870181
0052    0.926133    0.968580    0.851140    1.000000    0.983993
0053    0.823550    0.989484    0.870181    0.983993    1.000000
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>[**describe**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html):
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>計算統計資料。
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a>```python=
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>demo_describe=df.describe()
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>    0015    0050    0051    0052    0053
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>count   1640.000000 3503.000000 3500.000000 3395.000000 3435.000000
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>mean    7.697360    67.783269   29.989126   45.283546   29.846568
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a>std 1.482317    19.781026   6.076147    20.926838   9.881821
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>min 4.150000    29.500000   13.400000   17.020000   11.850000
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a>25% 7.090000    54.850000   26.497500   33.440000   23.880000
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>50% 7.490000    62.900000   29.440000   38.770000   27.100000
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a>75% 8.300000    78.250000   32.252500   50.100000   33.825000
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a>max 12.400000   143.000000  58.200000   136.450000  68.800000
</code></pre></div></p>
<h3 id="_84">移動窗格作業</h3>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shift.html"><strong>shift</strong></a>:
資料移動，常用於前後期數值增減比較、年增率計算。</p>
<p>ex:收盤價向下平移一列，第一列會變NaN。
```python=
demo_shift1=df.shift()
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>
</code></pre></div>
    0015    0050    0051    0052    0053
date                  <br />
2007-04-23  NaN NaN NaN NaN NaN
2007-04-24  9.54    57.85   32.83   38.40   NaN
2007-04-25  9.54    58.10   32.99   38.65   NaN
2007-04-26  9.52    57.60   32.80   38.59   NaN
2007-04-27  9.59    57.70   32.80   38.60   NaN
... ... ... ... ... ...
2021-06-25  NaN 136.70  57.60   124.70  65.75
2021-06-28  NaN 136.95  57.85   124.30  66.30
2021-06-29  NaN 137.20  57.90   124.20  66.15
2021-06-30  NaN 137.60  57.80   124.65  66.45
2021-07-01  NaN 138.95  58.20   125.00  66.80
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>ex:收盤價向上平移一列，最後一列會變NaN。
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>```python=
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a>demo_shift2=df.shift(-1)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>    0015    0050    0051    0052    0053
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>date                    
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>2007-04-23  9.54    58.10   32.99   38.65   NaN
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a>2007-04-24  9.52    57.60   32.80   38.59   NaN
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>2007-04-25  9.59    57.70   32.80   38.60   NaN
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>2007-04-26  9.55    57.50   32.72   38.40   NaN
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a>2007-04-27  9.37    56.90   32.07   38.10   NaN
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a>... ... ... ... ... ...
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a>2021-06-25  NaN 137.20  57.90   124.20  66.15
<a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>2021-06-28  NaN 137.60  57.80   124.65  66.45
<a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a>2021-06-29  NaN 138.95  58.20   125.00  66.80
<a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a>2021-06-30  NaN 138.30  57.90   124.35  66.20
<a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a>2021-07-01  NaN NaN NaN NaN NaN
</code></pre></div>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rolling.html"><strong>rolling</strong></a>:
移動窗格作業，常結合資料運算公式做滾動式計算。</p>
<p>ex:計算20日移動平均線(前n筆數資料未滿10日取na，未滿20日以n日計算)。
```python=
demo_rolling=df.rolling(20,min_periods=10).mean()
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>
</code></pre></div></p>
<p>0015    0050    0051    0052    0053
date                  <br />
2007-04-23  NaN NaN NaN NaN NaN
2007-04-24  NaN NaN NaN NaN NaN
2007-04-25  NaN NaN NaN NaN NaN
2007-04-26  NaN NaN NaN NaN NaN
2007-04-27  NaN NaN NaN NaN NaN
... ... ... ... ... ...
2021-06-25  NaN 137.0975    55.6150 124.5325    65.8150
2021-06-28  NaN 137.1675    55.8250 124.5675    65.8725
2021-06-29  NaN 137.1925    56.0050 124.5475    65.8950
2021-06-30  NaN 137.2550    56.1575 124.5425    65.9225
2021-07-01  NaN 137.2850    56.2975 124.5550    65.9500
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>[**diff**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.diff.html):
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>列數相減。
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a>ex:取每日漲跌價。
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a>```python=
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a>demo_diff=df.diff()
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>    0015    0050    0051    0052    0053
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>date                    
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>2007-04-23  NaN NaN NaN NaN NaN
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>2007-04-24  0.00    0.25    0.16    0.25    NaN
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>2007-04-25  -0.02   -0.50   -0.19   -0.06   NaN
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>2007-04-26  0.07    0.10    0.00    0.01    NaN
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>2007-04-27  -0.04   -0.20   -0.08   -0.20   NaN
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>... ... ... ... ... ...
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a>2021-06-25  NaN 0.25    0.25    -0.40   0.55
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a>2021-06-28  NaN 0.25    0.05    -0.10   -0.15
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a>2021-06-29  NaN 0.40    -0.10   0.45    0.30
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a>2021-06-30  NaN 1.35    0.40    0.35    0.35
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a>2021-07-01  NaN -0.65   -0.30   -0.65   -0.60
</code></pre></div></p>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pct_change.html"><strong>pct_change</strong></a>:
列數相除。</p>
<p>ex:取每日漲跌幅。
```python=
demo_pct_change=df.pct_change()
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>
</code></pre></div>
    0015    0050    0051    0052    0053
date                  <br />
2007-04-23  NaN NaN NaN NaN NaN
2007-04-24  0.000000    0.004322    0.004874    0.006510    NaN
2007-04-25  -0.002096   -0.008606   -0.005759   -0.001552   NaN
2007-04-26  0.007353    0.001736    0.000000    0.000259    NaN
2007-04-27  -0.004171   -0.003466   -0.002439   -0.005181   NaN
... ... ... ... ... ...
2021-06-25  0.000000    0.001829    0.004340    -0.003208   0.008365
2021-06-28  0.000000    0.001825    0.000864    -0.000805   -0.002262
2021-06-29  0.000000    0.002915    -0.001727   0.003623    0.004535
2021-06-30  0.000000    0.009811    0.006920    0.002808    0.005267
2021-07-01  0.000000    -0.004678   -0.005155   -0.005200   -0.008982
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>### [視覺化](https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html)
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>乖離率線圖:
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>```python=
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>df=data.get(&#39;price:收盤價&#39;).iloc[-400:][&#39;2330&#39;]
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a>mean_20=df.rolling(20).mean()
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>std_value=df.rolling(20).std()
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a>
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>up=mean_20+std_value*2
<a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a>down=mean_20-std_value*2
<a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a>up.plot(label=&#39;up&#39;,legend=True)
<a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a>down.plot(label=&#39;down&#39;,legend=True)
<a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a>mean_20.plot(label=&#39;ma_20&#39;,legend=True)
<a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a>df.plot(title=&#39;bias plot&#39;,label=&#39;close&#39;,legend=True,grid=True,figsize=(20, 8))
</code></pre></div>
<img alt="" src="https://i.imgur.com/pXH84vc.png" /></p>
<p>相關性熱力圖:
```python=
df=data.get('price:收盤價')
check_list=['1101','1102','2330','2454','6263','9939']
demo_corr=df.iloc[-600:][check_list].corr()</p>
<p>demo_corr.style.background_gradient(cmap ='viridis')\
        .set_properties(**{'font-size': '20px'})
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>![](https://i.imgur.com/LnI8tK1.png)
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a>### 實戰應用
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>了解pandas語法後，就可以著手實戰應用於開發策略。
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>均線多頭
</code></pre></div>
from finlab import data
df = data.get('price:收盤價')</p>
<h1 id="_85">限定範圍</h1>
<p>df = df[(df.index &gt; '2015') &amp; (df.index &lt; '2019')]</p>
<p>cond1 = df &gt; df.rolling(5).mean()
cond2 = df &gt; df.rolling(10,min_periods=5).mean()
cond3 = df &gt; df.rolling(20,min_periods=10).mean()
cond4 = df &gt; df.rolling(60,min_periods=40).mean()</p>
<p>position = (df * (cond1 &amp; cond2 &amp; cond3 &amp; cond4))
position = position[position &gt; 0]
position = position.is_largest(10)
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>突破布林通道上緣
</code></pre></div>
from finlab import data
df = data.get('price:收盤價')
mean_20 = df.rolling(20).mean()
std_value = df.rolling(20).std()</p>
<p>up = mean_20 + std_value*2</p>
<h1 id="_86">收盤價剛站上布林通道上緣</h1>
<p>cond1 = (df &gt; up) &amp; (df.shift() &lt; up)
cond2 = (df &gt; 5) &amp; (df &lt; 200)
position = (cond1 &amp; cond2)
position = position[position &gt; 0]
position = position.is_smallest(20)
```</p>
<h3 id="_87">參考資源</h3>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/10min.html">10分鐘上手Pandas</a>
<a href="https://pandas.pydata.org/pandas-docs/stable/index.html">Pandas官方網站</a></p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到頂端
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>